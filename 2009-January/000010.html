<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Feuerkraft-commit] r344 - in trunk/src: . buildings display editor	generic groundmap input particles scripting sound vehicles
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/feuerkraft-commit/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:feuerkraft-commit%40lists.berlios.de?Subject=Re%3A%20%5BFeuerkraft-commit%5D%20r344%20-%20in%20trunk/src%3A%20.%20buildings%20display%20editor%0A%09generic%20groundmap%20input%20particles%20scripting%20sound%20vehicles&In-Reply-To=%3C200901271116.n0RBGGA5005254%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000009.html">
   <LINK REL="Next"  HREF="000007.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Feuerkraft-commit] r344 - in trunk/src: . buildings display editor	generic groundmap input particles scripting sound vehicles</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:feuerkraft-commit%40lists.berlios.de?Subject=Re%3A%20%5BFeuerkraft-commit%5D%20r344%20-%20in%20trunk/src%3A%20.%20buildings%20display%20editor%0A%09generic%20groundmap%20input%20particles%20scripting%20sound%20vehicles&In-Reply-To=%3C200901271116.n0RBGGA5005254%40sheep.berlios.de%3E"
       TITLE="[Feuerkraft-commit] r344 - in trunk/src: . buildings display editor	generic groundmap input particles scripting sound vehicles">grumbel at mail.berlios.de
       </A><BR>
    <I>Tue Jan 27 12:16:16 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000009.html">[Feuerkraft-commit] r343 - in trunk/src: . buildings display editor	generic groundmap input particles scripting sound vehicles
</A></li>
        <LI>Next message: <A HREF="000007.html">[Feuerkraft-commit] r345 - in trunk/src: buildings editor generic	groundmap input particles sound vehicles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-01-27 12:16:10 +0100 (Tue, 27 Jan 2009)
New Revision: 344

Added:
   trunk/src/ai_manager.cpp
   trunk/src/ai_vehicle.cpp
   trunk/src/alist.cpp
   trunk/src/ambulance.cpp
   trunk/src/astar_pathfinder.cpp
   trunk/src/background.cpp
   trunk/src/bfirst_pathfinder.cpp
   trunk/src/buildings/ammotent.cpp
   trunk/src/buildings/building.cpp
   trunk/src/buildings/building_manager.cpp
   trunk/src/buildings/building_map.cpp
   trunk/src/buildings/building_map_data.cpp
   trunk/src/buildings/building_type_manager.cpp
   trunk/src/buildings/custom_building.cpp
   trunk/src/buildings/fuelstation.cpp
   trunk/src/buildings/headquarter.cpp
   trunk/src/buildings/tower.cpp
   trunk/src/buildings/tower_ai.cpp
   trunk/src/buildings/wall.cpp
   trunk/src/buildings/wall_door.cpp
   trunk/src/collision_manager.cpp
   trunk/src/color.cpp
   trunk/src/command_line_arguments.cpp
   trunk/src/communication_dialog.cpp
   trunk/src/controller_def.cpp
   trunk/src/dijkstra_pathfinder.cpp
   trunk/src/display/drawing_context.cpp
   trunk/src/display/scene_context.cpp
   trunk/src/display_manager.cpp
   trunk/src/draw_circle.cpp
   trunk/src/editor/editor.cpp
   trunk/src/energie.cpp
   trunk/src/explosion.cpp
   trunk/src/feuerkraft.cpp
   trunk/src/fonts.cpp
   trunk/src/game_delta.cpp
   trunk/src/game_mission.cpp
   trunk/src/game_obj.cpp
   trunk/src/game_obj_data_factory.cpp
   trunk/src/game_obj_factory.cpp
   trunk/src/game_obj_manager.cpp
   trunk/src/game_session.cpp
   trunk/src/game_session_manager.cpp
   trunk/src/game_world.cpp
   trunk/src/game_world_builder.cpp
   trunk/src/game_world_data.cpp
   trunk/src/generic/random.cpp
   trunk/src/geometry.cpp
   trunk/src/globals.cpp
   trunk/src/goal_manager.cpp
   trunk/src/groundmap/grid_map.cpp
   trunk/src/groundmap/grid_map_data.cpp
   trunk/src/groundmap/grid_tile.cpp
   trunk/src/groundmap/grid_tile_data.cpp
   trunk/src/groundmap/grid_tile_generator.cpp
   trunk/src/groundmap/ground_map_data.cpp
   trunk/src/groundmap/ground_map_data_factory.cpp
   trunk/src/groundmap/ground_type.cpp
   trunk/src/groundmap/multi_ground_map.cpp
   trunk/src/groundmap/multi_ground_map_data.cpp
   trunk/src/groundmap/sprite_tile.cpp
   trunk/src/groundmap/sprite_tile_data.cpp
   trunk/src/groundmap/tile_data_factory.cpp
   trunk/src/groundmap/tile_map.cpp
   trunk/src/groundmap/tile_map_data.cpp
   trunk/src/guile.cpp
   trunk/src/help.cpp
   trunk/src/input/axis_button.cpp
   trunk/src/input/axis_factory.cpp
   trunk/src/input/button_axis.cpp
   trunk/src/input/button_factory.cpp
   trunk/src/input/controller.cpp
   trunk/src/input/input_axis_input_device.cpp
   trunk/src/input/input_button_input_device.cpp
   trunk/src/input/input_manager.cpp
   trunk/src/input/input_manager_custom.cpp
   trunk/src/input/input_manager_impl.cpp
   trunk/src/input/input_manager_player.cpp
   trunk/src/input/input_recorder.cpp
   trunk/src/input/multi_button.cpp
   trunk/src/ipc.cpp
   trunk/src/keyboard_manager.cpp
   trunk/src/keys.cpp
   trunk/src/level_map.cpp
   trunk/src/line_segments.cpp
   trunk/src/marker.cpp
   trunk/src/math.cpp
   trunk/src/menu.cpp
   trunk/src/menu_handle_mgr.cpp
   trunk/src/menu_item.cpp
   trunk/src/message_buffer.cpp
   trunk/src/mine.cpp
   trunk/src/output_world_builder.cpp
   trunk/src/particles/fire_emitter.cpp
   trunk/src/particles/fire_particle.cpp
   trunk/src/particles/rocket_smoke_particle.cpp
   trunk/src/particles/smoke_emitter.cpp
   trunk/src/path_manager.cpp
   trunk/src/player.cpp
   trunk/src/player_view.cpp
   trunk/src/projectile.cpp
   trunk/src/property.cpp
   trunk/src/property_set.cpp
   trunk/src/radar.cpp
   trunk/src/resource_manager.cpp
   trunk/src/robot_tank.cpp
   trunk/src/rocket.cpp
   trunk/src/satchel_charge.cpp
   trunk/src/scm_functor.cpp
   trunk/src/scm_sequence_hook.cpp
   trunk/src/screen.cpp
   trunk/src/screenshot.cpp
   trunk/src/scripting/ai_commands.cpp
   trunk/src/scripting/ai_vehicle_commands.cpp
   trunk/src/scripting/building_commands.cpp
   trunk/src/scripting/clanlib_commands.cpp
   trunk/src/scripting/comm_commands.cpp
   trunk/src/scripting/debug_commands.cpp
   trunk/src/scripting/display_commands.cpp
   trunk/src/scripting/effect_commands.cpp
   trunk/src/scripting/game_commands.cpp
   trunk/src/scripting/gameobj_commands.cpp
   trunk/src/scripting/input_commands.cpp
   trunk/src/scripting/menu_commands.cpp
   trunk/src/scripting/object_commands.cpp
   trunk/src/scripting/player_commands.cpp
   trunk/src/scripting/script_helper.cpp
   trunk/src/scripting/sequence_commands.cpp
   trunk/src/scripting/sound_commands.cpp
   trunk/src/scripting/trigger_commands.cpp
   trunk/src/scripting/vehicle_commands.cpp
   trunk/src/sequence_manager.cpp
   trunk/src/sexpr_world_reader.cpp
   trunk/src/shockwave.cpp
   trunk/src/shortcut_pathfinder.cpp
   trunk/src/soldier.cpp
   trunk/src/soldier_ai.cpp
   trunk/src/sound/sound.cpp
   trunk/src/sound/sound_dummy.cpp
   trunk/src/sound/sound_real.cpp
   trunk/src/sound/sound_res_mgr.cpp
   trunk/src/start_screen.cpp
   trunk/src/system.cpp
   trunk/src/tree.cpp
   trunk/src/trigger_manager.cpp
   trunk/src/unit.cpp
   trunk/src/vector2d.cpp
   trunk/src/vehicle_ai.cpp
   trunk/src/vehicle_status.cpp
   trunk/src/vehicle_view.cpp
   trunk/src/vehicles/helicopter.cpp
   trunk/src/vehicles/jeep.cpp
   trunk/src/vehicles/rotor.cpp
   trunk/src/vehicles/tank.cpp
   trunk/src/vehicles/turret.cpp
   trunk/src/vehicles/vehicle.cpp
   trunk/src/view.cpp
Removed:
   trunk/src/ai_manager.cxx
   trunk/src/ai_vehicle.cxx
   trunk/src/alist.cxx
   trunk/src/ambulance.cxx
   trunk/src/astar_pathfinder.cxx
   trunk/src/background.cxx
   trunk/src/bfirst_pathfinder.cxx
   trunk/src/buildings/ammotent.cxx
   trunk/src/buildings/building.cxx
   trunk/src/buildings/building_manager.cxx
   trunk/src/buildings/building_map.cxx
   trunk/src/buildings/building_map_data.cxx
   trunk/src/buildings/building_type_manager.cxx
   trunk/src/buildings/custom_building.cxx
   trunk/src/buildings/fuelstation.cxx
   trunk/src/buildings/headquarter.cxx
   trunk/src/buildings/tower.cxx
   trunk/src/buildings/tower_ai.cxx
   trunk/src/buildings/wall.cxx
   trunk/src/buildings/wall_door.cxx
   trunk/src/collision_manager.cxx
   trunk/src/color.cxx
   trunk/src/command_line_arguments.cxx
   trunk/src/communication_dialog.cxx
   trunk/src/controller_def.cxx
   trunk/src/dijkstra_pathfinder.cxx
   trunk/src/display/drawing_context.cxx
   trunk/src/display/scene_context.cxx
   trunk/src/display_manager.cxx
   trunk/src/draw_circle.cxx
   trunk/src/editor/editor.cxx
   trunk/src/energie.cxx
   trunk/src/explosion.cxx
   trunk/src/feuerkraft.cxx
   trunk/src/fonts.cxx
   trunk/src/game_delta.cxx
   trunk/src/game_mission.cxx
   trunk/src/game_obj.cxx
   trunk/src/game_obj_data_factory.cxx
   trunk/src/game_obj_factory.cxx
   trunk/src/game_obj_manager.cxx
   trunk/src/game_session.cxx
   trunk/src/game_session_manager.cxx
   trunk/src/game_world.cxx
   trunk/src/game_world_builder.cxx
   trunk/src/game_world_data.cxx
   trunk/src/generic/random.cxx
   trunk/src/geometry.cxx
   trunk/src/globals.cxx
   trunk/src/goal_manager.cxx
   trunk/src/groundmap/grid_map.cxx
   trunk/src/groundmap/grid_map_data.cxx
   trunk/src/groundmap/grid_tile.cxx
   trunk/src/groundmap/grid_tile_data.cxx
   trunk/src/groundmap/grid_tile_generator.cxx
   trunk/src/groundmap/ground_map_data.cxx
   trunk/src/groundmap/ground_map_data_factory.cxx
   trunk/src/groundmap/ground_type.cxx
   trunk/src/groundmap/multi_ground_map.cxx
   trunk/src/groundmap/multi_ground_map_data.cxx
   trunk/src/groundmap/sprite_tile.cxx
   trunk/src/groundmap/sprite_tile_data.cxx
   trunk/src/groundmap/tile_data_factory.cxx
   trunk/src/groundmap/tile_map.cxx
   trunk/src/groundmap/tile_map_data.cxx
   trunk/src/guile.cxx
   trunk/src/help.cxx
   trunk/src/input/axis_button.cxx
   trunk/src/input/axis_factory.cxx
   trunk/src/input/button_axis.cxx
   trunk/src/input/button_factory.cxx
   trunk/src/input/controller.cxx
   trunk/src/input/input_axis_input_device.cxx
   trunk/src/input/input_button_input_device.cxx
   trunk/src/input/input_manager.cxx
   trunk/src/input/input_manager_custom.cxx
   trunk/src/input/input_manager_impl.cxx
   trunk/src/input/input_manager_player.cxx
   trunk/src/input/input_recorder.cxx
   trunk/src/input/multi_button.cxx
   trunk/src/ipc.cxx
   trunk/src/keyboard_manager.cxx
   trunk/src/keys.cxx
   trunk/src/level_map.cxx
   trunk/src/line_segments.cxx
   trunk/src/marker.cxx
   trunk/src/math.cxx
   trunk/src/menu.cxx
   trunk/src/menu_handle_mgr.cxx
   trunk/src/menu_item.cxx
   trunk/src/message_buffer.cxx
   trunk/src/mine.cxx
   trunk/src/output_world_builder.cxx
   trunk/src/particles/fire_emitter.cxx
   trunk/src/particles/fire_particle.cxx
   trunk/src/particles/rocket_smoke_particle.cxx
   trunk/src/particles/smoke_emitter.cxx
   trunk/src/path_manager.cxx
   trunk/src/player.cxx
   trunk/src/player_view.cxx
   trunk/src/projectile.cxx
   trunk/src/property.cxx
   trunk/src/property_set.cxx
   trunk/src/radar.cxx
   trunk/src/resource_manager.cxx
   trunk/src/robot_tank.cxx
   trunk/src/rocket.cxx
   trunk/src/satchel_charge.cxx
   trunk/src/scm_functor.cxx
   trunk/src/scm_sequence_hook.cxx
   trunk/src/screen.cxx
   trunk/src/screenshot.cxx
   trunk/src/scripting/ai_commands.cxx
   trunk/src/scripting/ai_vehicle_commands.cxx
   trunk/src/scripting/building_commands.cxx
   trunk/src/scripting/clanlib_commands.cxx
   trunk/src/scripting/comm_commands.cxx
   trunk/src/scripting/debug_commands.cxx
   trunk/src/scripting/display_commands.cxx
   trunk/src/scripting/effect_commands.cxx
   trunk/src/scripting/game_commands.cxx
   trunk/src/scripting/gameobj_commands.cxx
   trunk/src/scripting/input_commands.cxx
   trunk/src/scripting/menu_commands.cxx
   trunk/src/scripting/object_commands.cxx
   trunk/src/scripting/player_commands.cxx
   trunk/src/scripting/script_helper.cxx
   trunk/src/scripting/sequence_commands.cxx
   trunk/src/scripting/sound_commands.cxx
   trunk/src/scripting/trigger_commands.cxx
   trunk/src/scripting/vehicle_commands.cxx
   trunk/src/sequence_manager.cxx
   trunk/src/sexpr_world_reader.cxx
   trunk/src/shockwave.cxx
   trunk/src/shortcut_pathfinder.cxx
   trunk/src/soldier.cxx
   trunk/src/soldier_ai.cxx
   trunk/src/sound/sound.cxx
   trunk/src/sound/sound_dummy.cxx
   trunk/src/sound/sound_real.cxx
   trunk/src/sound/sound_res_mgr.cxx
   trunk/src/start_screen.cxx
   trunk/src/system.cxx
   trunk/src/tree.cxx
   trunk/src/trigger_manager.cxx
   trunk/src/unit.cxx
   trunk/src/vector2d.cxx
   trunk/src/vehicle_ai.cxx
   trunk/src/vehicle_status.cxx
   trunk/src/vehicle_view.cxx
   trunk/src/vehicles/helicopter.cxx
   trunk/src/vehicles/jeep.cxx
   trunk/src/vehicles/rotor.cxx
   trunk/src/vehicles/tank.cxx
   trunk/src/vehicles/turret.cxx
   trunk/src/vehicles/vehicle.cxx
   trunk/src/view.cxx
Modified:
   trunk/src/scripting/Makefile.am
Log:
Breaking point: started rename for *.?xx to *.?pp

Copied: trunk/src/ai_manager.cpp (from rev 341, trunk/src/ai_manager.cxx)


Property changes on: trunk/src/ai_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/ai_manager.cxx
===================================================================
--- trunk/src/ai_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/ai_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,67 +0,0 @@
-//  $Id: ai_manager.cxx,v 1.3 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;algorithm&gt;
-#include &quot;ai.hxx&quot;
-#include &quot;ai_manager.hxx&quot;
-
-AIManager* AIManager::instance_ = 0;
-
-AIManager*
-AIManager::instance()
-{
-  if (instance_)
-    return instance_;
-  else
-    return instance_ = new AIManager();
-}
-
-void
-AIManager::add(AI* ai)
-{
-  ais.push_back(ai);
-}
-
-void
-AIManager::remove(AI* ai)
-{
-  ais.erase(std::remove(ais.begin(), ais.end(), ai));
-}
-
-void
-AIManager::update(float delta)
-{
-  for (std::vector&lt;AI*&gt;::iterator i = ais.begin(); i != ais.end(); ++i)
-    {
-      (*i)-&gt;update(delta);
-    }
-}
-
-AI*
-AIManager::get_ai(GameObj* obj)
-{
-  for (std::vector&lt;AI*&gt;::iterator i = ais.begin(); i != ais.end(); ++i)
-    {
-      if ((*i)-&gt;get_object() == obj)
-        return *i;
-    }  
-  return 0;
-}
-
-/* EOF */

Copied: trunk/src/ai_vehicle.cpp (from rev 341, trunk/src/ai_vehicle.cxx)


Property changes on: trunk/src/ai_vehicle.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/ai_vehicle.cxx
===================================================================
--- trunk/src/ai_vehicle.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/ai_vehicle.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,273 +0,0 @@
-//  $Id: ai_vehicle.cxx,v 1.18 2003/06/08 15:31:27 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;math.h&gt;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;particles/smoke_particle.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;ai_vehicle.hxx&quot;
-#include &quot;projectile.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;mine.hxx&quot;
-#include &quot;particles/smoke_emitter.hxx&quot;
-#include &quot;level_map.hxx&quot;
-
-AIVehicle::AIVehicle(const FloatVector2d&amp; arg_pos)
-  : destroyed(false),
-    energie(100),
-    length(0.0f),
-    line_segments(pos.x, pos.y, 0.0f)
-{
-  pos = arg_pos;
-  velocity = 100.0f;
-  orientation = 0.0f;
-
-  line_segments.set_pos(pos.x, pos.y, 0.0f);
-
-  sprite = resources-&gt;get_sprite(&quot;feuerkraft/trooper&quot;);
-  sprite.set_alignment(origin_center);
-
-  destroyed_sprite = resources-&gt;get_sprite(&quot;feuerkraft/trooper_destroyed&quot;);
-  destroyed_sprite.set_alignment(origin_center);
-
-  current_order.type = AI_VO_NONE;
-  
-  properties-&gt;register_bool (&quot;destroyed&quot;,   &amp;destroyed);
-
-  smoke_emitter = new SmokeEmitter(pos);
-}
-
-void
-AIVehicle::update(float delta)
-{
-#if 0
-  if (current_order.type == AI_VO_NONE)
-    {
-      if (!orders.empty())
-        {
-          current_order = orders.back();
-          orders.pop_back();
-        }
-    }
-
-  switch(current_order.type)
-    {
-    case AI_VO_DRIVETO:
-      {
-        float old_orientation = orientation;
-        
-        FloatVector2d target_pos(current_order.drive_to.pos.x,
-                             current_order.drive_to.pos.y);
-
-        orientation = atan2(target_pos.y - pos.y,
-                            target_pos.x - pos.x);
-
-        float distance = (pos - target_pos).norm();
-
-        pos.x -= velocity * delta * cos(orientation+PI);
-        pos.y -= velocity * delta * sin(orientation+PI);
-
-        if (distance &lt; (pos - target_pos).norm())
-          {
-            orientation = old_orientation;
-            pos = target_pos;
-            next_order();
-          }
-        if (rand()% 15 == 1)
-          world-&gt;add (new SmokeParticle (pos));
-      } 
-      break;
-
-    case AI_VO_WAIT:
-      current_order.wait.seconds -= delta;
-      if (current_order.wait.seconds &lt; 0)
-        next_order();
-      break;
-
-    default:
-      break;
-    }
-#else
-  if (destroyed)
-    {
-      smoke_emitter-&gt;set_pos(pos + (FloatVector2d(-10.0f, -10.0f).rotate(orientation)));
-      smoke_emitter-&gt;update(delta);
-      return; 
-    }
-
-  if (current_order.type != AI_VO_NONE)
-    {
-      length += 100.0f * delta;
-      pos = line_segments.get_pos(length);
-      orientation = line_segments.get_orientation(length);
-
-      if (line_segments.get_length() &lt; length)
-        current_order.type = AI_VO_NONE;
-    }
-
-  if (energie &lt;= 0)
-    {
-      GameWorld::current()-&gt;add(new Explosion(pos, Explosion::MEDIUM));
-      destroyed = true;
-      return;
-    }
-
-  CollisionManager::current()-&gt;add_rect(get_id(), pos.x, pos.y, 38, 85, orientation);
-#endif
-}
-
-void
-AIVehicle::draw (View&amp; view)
-{
-  if (!destroyed)
-    {
-      sprite.set_angle(Math::rad2deg(orientation + PI));
-      view.get_sc().color().draw(sprite, pos.x, pos.y);
-    }
-  else
-    {
-      destroyed_sprite.set_angle(Math::rad2deg(orientation + PI));
-      view.get_sc().color().draw(destroyed_sprite, pos.x, pos.y);
-    }
-  //line_segments.draw(view);
-}
-
-void 
-AIVehicle::draw_levelmap (LevelMap&amp; levelmap)
-{
-  CL_Display::fill_rect (CL_Rect(int(pos.x / 40), int(pos.y / 40),
-				 int(pos.x / 40) + 4, int(pos.y / 40) + 4),
-			 CL_Color(255, 0, 0, 255));
-}
-
-void
-AIVehicle::add_order(AIVehicleOrder order)
-{
-  orders.push_front(order);
-}
-
-void
-AIVehicle::wait(float seconds)
-{
-  AIVehicleOrder order;
-  
-  order.type = AI_VO_WAIT;
-
-  order.wait.sequence_id = SequenceManager::current()-&gt;start_sequence();
-  order.wait.seconds = seconds;
-  
-  add_order(order);
-}
-
-void
-AIVehicle::next_order()
-{
-  switch(current_order.type)
-    {
-    case AI_VO_DRIVETO:
-      SequenceManager::current()-&gt;end_sequence(current_order.drive_to.sequence_id);
-      break;
-    case AI_VO_WAIT:
-      SequenceManager::current()-&gt;end_sequence(current_order.wait.sequence_id);
-      break;
-    default:
-      break;
-    }
-
-  if (!orders.empty())
-    {
-      current_order = orders.back();
-      orders.pop_back();
-    }
-  else
-    {
-      current_order.type = AI_VO_NONE;
-    }
-}
-
-void
-AIVehicle::clear_orders()
-{
-#if 0
-  orders.clear();
-  current_order.type = AI_VO_NONE;
-#else
-  FloatVector2d pos = line_segments.get_pos(length);
-  float orientation = line_segments.get_orientation(length);
-
-  line_segments.clear();
-  line_segments.set_pos(pos.x, pos.y, orientation);
-  length = 0;
-
-  current_order.type = AI_VO_NONE;
-#endif
-}
-
-void
-AIVehicle::draw_energie (View&amp; view)
-{
-  energie.draw (view, 
-		int(pos.x), int(pos.y - 40));
-}
-  
-void
-AIVehicle::drive_to(const FloatVector2d&amp; n_pos)
-{
-#if 0
-  AIVehicleOrder order;
-
-  order.type = AI_VO_DRIVETO;
-
-  order.drive_to.sequence_id = SequenceManager::current()-&gt;start_sequence();
-  order.drive_to.pos.x = n_pos.x;
-  order.drive_to.pos.y = n_pos.y;
-  
-  add_order(order);
-#else
-  current_order.type = AI_VO_DRIVETO;
-  line_segments.add_controll_point(n_pos.x, n_pos.y, 50.0f);
-#endif
-}
-
-void
-AIVehicle::on_collision(GameObj* obj)
-{
-  Projectile* projectile = dynamic_cast&lt;Projectile*&gt;(obj);
-  if (projectile)
-    {
-      energie -= 5;
-    }
-  else
-    {
-      Mine* mine = dynamic_cast&lt;Mine*&gt;(obj);
-      if (mine)
-        {
-          energie -= 25;
-        }
-    }
-}
-
-void
-AIVehicle::on_collision_with_building(Building* building)
-{
-}
-
-/* EOF */

Copied: trunk/src/alist.cpp (from rev 341, trunk/src/alist.cxx)


Property changes on: trunk/src/alist.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/alist.cxx
===================================================================
--- trunk/src/alist.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/alist.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,359 +0,0 @@
-//  $Id: alist.cxx,v 1.13 2003/06/23 08:43:32 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;alist.hxx&quot;
-
-AList::AList()
-{  
-}
-
-AList::AList(const AList&amp; alist)
-{
-  content = alist.content;
-
-  for(Content::iterator i = content.begin(); i != content.end(); ++i)
-    {
-      if (i-&gt;second.type == AL_STRING)
-        i-&gt;second.v_string = new std::string(*(i-&gt;second.v_string));
-    }
-}
-
-AList&amp;
-AList::operator=(const AList&amp; alist)
-{
-  for(Content::iterator i = content.begin(); i != content.end(); ++i)
-    {
-      if (i-&gt;second.type == AL_STRING)
-        delete i-&gt;second.v_string;
-    }
-  content.clear();
-
-  content = alist.content;
-
-  for(Content::iterator i = content.begin(); i != content.end(); ++i)
-    {
-      if (i-&gt;second.type == AL_STRING)
-        i-&gt;second.v_string = new std::string(*(i-&gt;second.v_string));
-    }
-  return *this;
-}
-
-AList::~AList()
-{
-  for(Content::iterator i = content.begin(); i != content.end(); ++i)
-    {
-      if (i-&gt;second.type == AL_STRING)
-        delete i-&gt;second.v_string;
-    }
-}
-
-AList::Value&amp;
-AList::ensure_free_cell(const std::string&amp; name, Type type)
-{
-  Value&amp; value = content[name];
-  if (value.type == AL_STRING)
-    delete value.v_string;
-  
-  if (value.type != type &amp;&amp; value.type != AL_NONE)
-    {
-      std::cout &lt;&lt; &quot;AList: Warning: Overwriting cell: &quot; &lt;&lt; name &lt;&lt; &quot; with other type.&quot; &lt;&lt; std::endl;
-    }
-  value.type = type;
-  
-  return value;
-}
-
-AList::AList&amp;
-AList::set_int(const std::string&amp; name, int value)
-{
-  Value&amp; v = ensure_free_cell(name, AL_INT);
-  v.v_int = value;
-  return *this;
-}
-
-AList&amp;
-AList::set_float(const std::string&amp; name, float value)
-{
-  Value&amp; v = ensure_free_cell(name, AL_FLOAT);
-  v.v_float = value;
-  return *this;
-}
-
-AList&amp;
-AList::set_bool(const std::string&amp; name, bool value)
-{
-  Value&amp; v = ensure_free_cell(name, AL_BOOL);
-  v.v_bool = value;
-  return *this;
-}
-
-AList&amp;
-AList::set_string(const std::string&amp; name, const std::string&amp; value)
-{
-  //std::cout &lt;&lt; &quot;AList: &quot; &lt;&lt; name &lt;&lt; &quot; '&quot; &lt;&lt; value &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-  Value&amp; v = ensure_free_cell(name, AL_STRING);
-  v.v_string = new std::string(value);
-  return *this;
-}
-
-AList&amp;
-AList::set_int_vector2d(const std::string&amp; name, IntVector2d&amp; value)
-{
-  Value&amp; v = ensure_free_cell(name, AL_INTVECTOR2D);
-  v.v_int_vector2d = value;
-  return *this;
-}
-
-AList&amp;
-AList::set_value (const std::string&amp; str, const Value&amp; value)
-{
-  switch (value.type)
-    {      
-    case AL_INT:
-      return set_int(str, value.v_int);
-
-    case AL_FLOAT:
-      return set_float(str, value.v_float);
-
-    case AL_BOOL:
-      return set_bool(str, value.v_bool);
-
-    case AL_STRING:
-      return set_string(str, *value.v_string);
-
-    default:
-      return *this; 
-    }
-}
-
-/*
-  AList&amp;
-  AList::set_float_vector2d(const std::string&amp; name, FloatVector2d&amp; value)
-  {
-  Value&amp; v = ensure_free_cell(name, AL_FLOATVECTOR2D);
-  v.v_float_vector2d = value;  
-  return *this;
-  }
-*/
-const AList::Value*
-AList::get_value(const std::string&amp; name, Type type) const
-{
-  Content::const_iterator i = content.find(name);
-
-  if (i == content.end())
-    {
-      return 0;
-    }
-  else
-    {
-      if (i-&gt;second.type == type)
-        return &amp;(i-&gt;second);
-      else
-        return 0;
-    } 
-}
-
-bool
-AList::retrieve_int(const std::string&amp; name, int&amp; value) const
-{
-  const Value* v = get_value(name, AL_INT);
-
-  if (!v)
-    return false;
-  else
-    {
-      value = v-&gt;v_int;
-      return true;
-    }
-}
-
-bool
-AList::retrieve_float(const std::string&amp; name, float&amp; value) const
-{
-  const Value* v = get_value(name, AL_FLOAT);
-  if (!v)
-    {
-      const Value* int_v = get_value(name, AL_INT);
-      if (int_v)
-        {
-          value = int_v-&gt;v_int;
-          return true;
-        }
-      else
-        return false;
-    }
-  else
-    {
-      value = v-&gt;v_float;
-      return true;
-    }
-}
-
-bool
-AList::retrieve_bool(const std::string&amp; name, bool&amp; value) const
-{
-  const Value* v = get_value(name, AL_BOOL);
-  if (!v)
-    return false;
-  else
-    {
-      value = v-&gt;v_bool;
-      return true;
-    }
-}
-
-bool
-AList::retrieve_string(const std::string&amp; name, std::string&amp; value) const
-{
-  const Value* v = get_value(name, AL_STRING);
-  if (v == 0)
-    return false;
-  else
-    {
-      value = *(v-&gt;v_string);
-      return true;
-    }
-}
-
-bool
-AList::retrieve_int_vector2d (const std::string&amp; name, IntVector2d&amp; value) const
-{
-  const Value* v = get_value(name, AL_INTVECTOR2D);
-  if (!v)
-    return false;
-  else
-    {
-      value = v-&gt;v_int_vector2d;
-      return true;
-    }
-}
-
-bool
-AList::retrieve_float_vector2d (const std::string&amp; name, FloatVector2d&amp; value) const
-{
-  return false;
-  /*
-  const Value* v = get_value(name, AL_FLOATVECTOR2D);
-  if (!v)
-    return false;
-  else
-    {
-      value = v-&gt;v_float_vector2d;
-      return true;
-      }*/
-}
-
-int
-AList::get_int(const std::string&amp; str, int def) const
-{
-  int res;
-  if (retrieve_int(str, res))
-    return res;
-  else
-    return def;
-}
-
-float
-AList::get_float(const std::string&amp; str, float def) const
-{
-  float res;
-  if (retrieve_float(str, res))
-    return res;
-  else
-    return def;
-}
-
-bool
-AList::get_bool(const std::string&amp; str, bool def) const
-{
-  bool res;
-  if (retrieve_bool(str, res))
-    return res;
-  else
-    return def;
-}
-
-std::string 
-AList::get_string(const std::string&amp; str, const std::string&amp; def) const
-{
-  std::string res;
-  if (retrieve_string(str, res))
-    return res;
-  else
-    return def;
-}
-
-void
-AList::merge(const AList&amp; lst)
-{
-  for(Content::const_iterator i = lst.content.begin(); i != lst.content.end(); ++i)
-    {
-      set_value(i-&gt;first, i-&gt;second);
-    }
-}
-
-/*
-  bool
-  AList::get_float_vector2d (const std::string&amp; name, FloatVector2d&amp; value) const
-  {
-  const Value* v = get_value(name, AL_FLOATVECTOR2D);
-  if (!v)
-  return false;
-  else
-  {
-  value = v-&gt;v_float_vector2d;
-  return true;
-  }
-  }
-*/
-
-std::ostream&amp; operator&lt;&lt; (std::ostream&amp; os, const AList&amp; lst)
-{
-  os &lt;&lt; &quot;[AList:]\n&quot;;
-  for(AList::const_iterator i = lst.begin(); i != lst.end(); ++i)
-    {
-      os &lt;&lt; &quot;  &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; -&gt; &quot; &lt;&lt; i-&gt;second &lt;&lt; std::endl;
-    }  
-  os &lt;&lt; std::endl;
-  return os;
-}
-
-std::ostream&amp; operator&lt;&lt; (std::ostream&amp; os, const AList::Value&amp; value)
-{
-  switch (value.type)
-    {      
-    case AList::AL_INT:
-      return os &lt;&lt; value.v_int;
-
-    case AList::AL_FLOAT:
-      return os &lt;&lt; value.v_float;
-
-    case AList::AL_BOOL:
-      return os &lt;&lt; value.v_bool;
-
-    case AList::AL_STRING:
-      return os &lt;&lt; *value.v_string;
-
-    default:
-      return os &lt;&lt; &quot;&lt;#unknown&gt;&gt;&quot;;
-    }
-}
-
-/* EOF */

Copied: trunk/src/ambulance.cpp (from rev 341, trunk/src/ambulance.cxx)


Property changes on: trunk/src/ambulance.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/ambulance.cxx
===================================================================
--- trunk/src/ambulance.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/ambulance.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,37 +0,0 @@
-//  $Id: ambulance.cxx,v 1.7 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;view.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;ambulance.hxx&quot;
-
-Ambulance::Ambulance()
-  : sur(resources-&gt;get_sprite(&quot;feuerkraft/ambulance&quot;))
-{
-  
-}
-
-void
-Ambulance::draw (View&amp; view)
-{
-  view.get_sc().color().draw(sur, 0, 0);
-}
-
-
-/* EOF */

Copied: trunk/src/astar_pathfinder.cpp (from rev 341, trunk/src/astar_pathfinder.cxx)


Property changes on: trunk/src/astar_pathfinder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/astar_pathfinder.cxx
===================================================================
--- trunk/src/astar_pathfinder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/astar_pathfinder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,335 +0,0 @@
-//  $Id: astar_pathfinder.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/core.h&gt;
-#include &lt;iostream&gt;
-#include &lt;unistd.h&gt;
-#include &quot;astar_pathfinder.hxx&quot;
-
-AStarPathfinder::AStarPathfinder(Field&lt;int&gt;* arg_field)
-  : field(*arg_field),
-    node_field(field.get_width(), field.get_height())
-{
-}
-
-void
-AStarPathfinder::init(Pos&amp; arg_start, Pos&amp; arg_end)
-{
-  start = arg_start;
-  end   = arg_end;
-
-  if (start.x == end.x
-      &amp;&amp; start.y == end.y)
-    {
-      state = ALREADY_ON_GOAL;
-      return;
-    }
-
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    for(int x = 0; x &lt; node_field.get_width(); ++x)
-      {
-        Node&amp; node = node_field(x,y);
-        node.visited = 0;
-        node.x = x;
-        node.y = y;
-        node.parent = PARENT_NONE;
-      }
-
-  state = WORKING;
-
-  Node&amp; node = node_field(start.x, start.y);
-  
-  node.visited = 1;
-  node.cost    = 0;
-  node.parent  = PARENT_GOAL;
-
-  make_neighbors_open(node);
-}
-
-bool
-AStarPathfinder::finished()
-{
-  return state != WORKING;
-}
-
-void
-AStarPathfinder::process_one_open_node()
-{
-  if (open_nodes.empty())
-    {
-      state = NO_PATH_AVAILABLE;
-      return;
-    }
-  else
-    {
-      Node&amp; cnode = *open_nodes.top();
-      open_nodes.pop();
-
-      assert(cnode.visited == 0);
-
-      cnode.visited = 1;
-      
-      // Goal reached
-      if (int(cnode.x) == end.x &amp;&amp; int(cnode.y) == end.y)
-        {
-          construct_path();
-          state = PATH_FOUND;
-          return;
-        }
-     
-      make_neighbors_open(cnode);
-    }
-}
-
-void
-AStarPathfinder::make_neighbors_open(Node&amp; cnode)
-{
-  if (cnode.x &gt; 0)
-    {
-      if (field(cnode.x - 1, cnode.y) == 0) // node is walkable
-        {
-          Node&amp; west = node_field(cnode.x - 1, cnode.y);
-
-          if (west.visited == 0 &amp;&amp; west.parent == PARENT_NONE)
-            {
-              west.parent = PARENT_EAST;
-              west.cost   = cnode.cost + 1;
-              add_to_open_nodes(west);
-            }
-        }
-    }
-
-  if (int(cnode.x) &lt; node_field.get_width()-1  &amp;&amp; field(cnode.x+1, cnode.y) == 0)
-    {
-      Node&amp; east = node_field(cnode.x + 1, cnode.y);
-      if (east.visited == 0  &amp;&amp; east.parent == PARENT_NONE) 
-        {
-          east.parent = PARENT_WEST;
-          east.cost   = cnode.cost + 1;
-          add_to_open_nodes(east);
-        }
-    }
-
-  if (cnode.y &gt; 0 &amp;&amp; field(cnode.x, cnode.y - 1) == 0)
-    {
-      Node&amp; north = node_field(cnode.x, cnode.y - 1);
-      if (north.visited == 0  &amp;&amp; north.parent == PARENT_NONE)
-        {
-          north.parent = PARENT_SOUTH;
-          north.cost   = cnode.cost + 1;
-          add_to_open_nodes(north);
-        }
-    }
-  
-  if (int(cnode.y) &lt; node_field.get_height() - 1  &amp;&amp; field(cnode.x, cnode.y+1) == 0)
-    {
-      Node&amp; south = node_field(cnode.x, cnode.y + 1);
-      if (south.visited == 0  &amp;&amp; south.parent == PARENT_NONE)
-        {
-          south.parent = PARENT_NORTH;
-          south.cost   = cnode.cost + 1;
-          add_to_open_nodes(south);
-        }
-    }
-}
-
-void
-AStarPathfinder::add_to_open_nodes(Node&amp; cnode)
-{
-  assert(cnode.parent != PARENT_NONE);
-  open_nodes.push(&amp;cnode);
-}
-
-void
-AStarPathfinder::display()
-{
-  //std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    {
-      for(int x = 0; x &lt; node_field.get_width(); ++x)
-        {
-          if (0)
-            {
-          if (node_field(x,y).parent == PARENT_SOUTH)
-            std::cout &lt;&lt; &quot;s&quot;;
-          else if (node_field(x,y).parent == PARENT_WEST)
-            std::cout &lt;&lt; &quot;w&quot;;
-          else if (node_field(x,y).parent == PARENT_EAST)
-            std::cout &lt;&lt; &quot;e&quot;;
-          else if (node_field(x,y).parent == PARENT_NORTH)
-            std::cout &lt;&lt; &quot;n&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-            }
-          if (is_path_node(x,y))
-            std::cout &lt;&lt; &quot;#&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-
-          if (x == start.x &amp;&amp; y == start.y)
-            std::cout &lt;&lt; &quot;S&quot;;
-          else if (x == end.x &amp;&amp; y == end.y)
-            std::cout &lt;&lt; &quot;G&quot;;
-          else if (field(x,y) != 0)
-            std::cout &lt;&lt; &quot;O&quot;;
-          else if (node_field(x,y).visited)
-            std::cout &lt;&lt; &quot;.&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-      }
-      std::cout &lt;&lt; std::endl;
-    }
-  std::cout &lt;&lt; &quot;OpenNodes: &quot; &lt;&lt; open_nodes.size() &lt;&lt; std::endl;
-  std::cout &lt;&lt; &quot;State: &quot; &lt;&lt; state &lt;&lt; std::endl;
-}
-
-bool
-AStarPathfinder::is_path_node(int x, int y)
-{
-  if (path.empty()) 
-    return false;
-  else
-    {
-      for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-          if (i-&gt;x == x &amp;&amp; i-&gt;y == y)
-            return true;
-        }
-      return false;
-    }
-}
-
-AStarPathfinder::Node&amp;
-AStarPathfinder::resolve_parent(Node&amp; node)
-{
-  if (node.parent == PARENT_NONE)
-    {
-      display();
-      assert(false);
-    }
-
-  switch(node.parent)
-    {
-    case PARENT_NORTH:
-      return node_field(node.x, node.y - 1);
-    case PARENT_SOUTH:
-      return node_field(node.x, node.y + 1);
-    case PARENT_EAST:
-      return node_field(node.x + 1, node.y);
-    case PARENT_WEST:
-      return node_field(node.x - 1, node.y);
-    default:
-      assert(!&quot;resolve path error&quot;);
-    }
-  assert(!&quot;resolve path error2&quot;);
-  return *(Node*)0;
-}
-
-void
-AStarPathfinder::construct_path()
-{
-  //std::cout &lt;&lt; &quot;Construct path&quot; &lt;&lt; std::endl;
-  // We construct the path reverse, so we start at the end
-  Node&amp; current_node = node_field(end.x, end.y);
-
-  while(current_node.parent != PARENT_GOAL)
-    {
-      //std::cout &lt;&lt; &quot;&gt;&gt;&gt; Node: &quot; &lt;&lt; current_node.x &lt;&lt; &quot; &quot; &lt;&lt; current_node.y &lt;&lt; std::endl;
-
-      path.push_back(Pos(current_node.x, current_node.y));
-      current_node = resolve_parent(current_node);
-    }
-}
-
-#ifdef TESTME
-int main()
-{
-  CL_SetupCore::init();
-
-  srand(time(NULL));
-  Field&lt;int&gt; field(80, 50);
-
-  unsigned int start_time = CL_System::get_time();
-  unsigned int end_time;
-  //for(int count = 0; count &lt; 100; ++count)
-  //{
-  for(int y = 0; y &lt; field.get_height(); ++y)
-    for(int x = 0; x &lt; field.get_width(); ++x)
-      {
-        field(x,y) = (rand()%20) &gt; 5 ? 0 : 1;
-      }
-
-  AStarPathfinder pathfinder(&amp;field);
-  Pos start;
-  Pos end;
-  start.x = rand()%field.get_width();
-  start.y = rand()%field.get_height();
-
-  end.x = rand()%field.get_width();
-  end.y = rand()%field.get_height();
-
-  pathfinder.init(start, end);
-  //pathfinder.display();
-
-  //int i = 0;
-  //std::cout &lt;&lt; &quot;Start: &quot; &lt;&lt; start.x &lt;&lt; &quot; &quot; &lt;&lt; start.y &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;End:   &quot; &lt;&lt; end.x &lt;&lt; &quot; &quot; &lt;&lt; end.y &lt;&lt; std::endl;
-
-  while(!pathfinder.finished())
-    {
-      for(int i = 0; i &lt; 10 &amp;&amp; !pathfinder.finished(); ++i)
-        pathfinder.process_one_open_node();
-
-      std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-      pathfinder.display();
-      getchar();
-    }
-  end_time = CL_System::get_time();
-
-  pathfinder.display();
-      
-  if (pathfinder.get_state() != AStarPathfinder::PATH_FOUND)
-    {
-      std::cout &lt;&lt; &quot;No Path could be found&quot; &lt;&lt; std::endl;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;Found path&quot; &lt;&lt; std::endl;
-      std::vector&lt;Pos&gt;&amp; path = pathfinder.get_path();
-      for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-          std::cout &lt;&lt; &quot;[&quot; &lt;&lt; i-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; i-&gt;y &lt;&lt; &quot;] &quot;;
-        }       
-      std::cout &lt;&lt; std::endl;
-    }
-
-  //      getchar();
-  //std::cout &lt;&lt; &quot;round: &quot; &lt;&lt; ++i &lt;&lt; std::endl;
-  //}
-  std::cout &lt;&lt; &quot;Msec: &quot; &lt;&lt; end_time - start_time &lt;&lt; std::endl;
-
-  CL_SetupCore::deinit();
-}
-#endif
-
-// Local Variables:
-// compile-command: &quot;g++-3.2 -DTESTME -Wall -O2 astar_pathfinder.cxx  -o astar_pathfinder -lclanCore&quot;
-// End:
-
-/* EOF */

Copied: trunk/src/background.cpp (from rev 341, trunk/src/background.cxx)


Property changes on: trunk/src/background.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/background.cxx
===================================================================
--- trunk/src/background.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/background.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,43 +0,0 @@
-//  $Id: background.cxx,v 1.14 2003/10/20 21:30:09 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;view.hxx&quot;
-#include &quot;background.hxx&quot;
-
-Background::Background (const CL_Sprite&amp; arg_sprite,
-                        float arg_z_pos)
-  : sprite(arg_sprite),
-    z_pos(arg_z_pos)
-{
-  sprite.set_alignment(origin_top_left);
-}
-
-void
-Background::draw (View&amp; view)
-{
-  //sprite.draw();
-  // FIXME: We should take the view size and surface size into account
-  for (int y = -1; y &lt;= 2; ++y)
-    for (int x = -1; x &lt;= 2; ++x)
-      sprite.draw(x * sprite.get_width()  + (int(view.get_x_offset()) % sprite.get_width()),
-                  y * sprite.get_height() + (int(view.get_y_offset()) % sprite.get_height()));
-}
-
-/* EOF */

Copied: trunk/src/bfirst_pathfinder.cpp (from rev 341, trunk/src/bfirst_pathfinder.cxx)


Property changes on: trunk/src/bfirst_pathfinder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/bfirst_pathfinder.cxx
===================================================================
--- trunk/src/bfirst_pathfinder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/bfirst_pathfinder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,331 +0,0 @@
-//  $Id: bfirst_pathfinder.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/core.h&gt;
-#include &lt;iostream&gt;
-#include &lt;unistd.h&gt;
-#include &quot;bfirst_pathfinder.hxx&quot;
-
-BFirstPathfinder::BFirstPathfinder(Field&lt;int&gt;* arg_field)
-  : field(*arg_field),
-    node_field(field.get_width(), field.get_height())
-{
-}
-
-void
-BFirstPathfinder::init(Pos&amp; arg_start, Pos&amp; arg_end)
-{
-  start = arg_start;
-  end   = arg_end;
-
-  if (start.x == end.x
-      &amp;&amp; start.y == end.y)
-    {
-      state = ALREADY_ON_GOAL;
-      return;
-    }
-
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    for(int x = 0; x &lt; node_field.get_width(); ++x)
-      {
-        Node&amp; node = node_field(x,y);
-        node.visited = 0;
-        node.x = x;
-        node.y = y;
-        node.parent = PARENT_NONE;
-      }
-
-  state = WORKING;
-
-  Node&amp; node = node_field(start.x, start.y);
-  
-  node.visited = 1;
-  node.cost    = 0;
-  node.parent  = PARENT_GOAL;
-
-  make_neighbors_open(node);
-}
-
-bool
-BFirstPathfinder::finished()
-{
-  return state != WORKING;
-}
-
-void
-BFirstPathfinder::process_one_open_node()
-{
-  if (open_nodes.empty())
-    {
-      state = NO_PATH_AVAILABLE;
-      return;
-    }
-  else
-    {
-      Node&amp; cnode = *open_nodes.front();
-      open_nodes.pop_front();
-
-      assert(cnode.visited == 0);
-
-      cnode.visited = 1;
-      cnode.cost    = 1;
- 
-      // Goal reached
-      if (int(cnode.x) == end.x &amp;&amp; int(cnode.y) == end.y)
-        {
-          construct_path();
-          state = PATH_FOUND;
-          return;
-        }
-     
-      make_neighbors_open(cnode);
-    }
-}
-
-void
-BFirstPathfinder::make_neighbors_open(Node&amp; cnode)
-{
-  if (cnode.x &gt; 0)
-    {
-      if (field(cnode.x - 1, cnode.y) == 0) // node is walkable
-        {
-          Node&amp; west = node_field(cnode.x - 1, cnode.y);
-
-          if (west.visited == 0 &amp;&amp; west.parent == PARENT_NONE)
-            {
-              west.parent = PARENT_EAST;
-              add_to_open_nodes(west);
-            }
-        }
-    }
-
-  if (int(cnode.x) &lt; node_field.get_width()-1  &amp;&amp; field(cnode.x+1, cnode.y) == 0)
-    {
-      Node&amp; east = node_field(cnode.x + 1, cnode.y);
-      if (east.visited == 0  &amp;&amp; east.parent == PARENT_NONE) 
-        {
-          east.parent = PARENT_WEST;
-          add_to_open_nodes(east);
-        }
-    }
-
-  if (cnode.y &gt; 0 &amp;&amp; field(cnode.x, cnode.y - 1) == 0)
-    {
-      Node&amp; north = node_field(cnode.x, cnode.y - 1);
-      if (north.visited == 0  &amp;&amp; north.parent == PARENT_NONE)
-        {
-          north.parent = PARENT_SOUTH;
-          add_to_open_nodes(north);
-        }
-    }
-  
-  if (int(cnode.y) &lt; node_field.get_height() - 1  &amp;&amp; field(cnode.x, cnode.y+1) == 0)
-    {
-      Node&amp; south = node_field(cnode.x, cnode.y + 1);
-      if (south.visited == 0  &amp;&amp; south.parent == PARENT_NONE)
-        {
-          south.parent = PARENT_NORTH;
-          add_to_open_nodes(south);
-        }
-    }
-}
-
-void
-BFirstPathfinder::add_to_open_nodes(Node&amp; cnode)
-{
-  assert(cnode.parent != PARENT_NONE);
-  open_nodes.push_back(&amp;cnode);
-}
-
-void
-BFirstPathfinder::display()
-{
-  //std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    {
-      for(int x = 0; x &lt; node_field.get_width(); ++x)
-        {
-          if (0)
-            {
-          if (node_field(x,y).parent == PARENT_SOUTH)
-            std::cout &lt;&lt; &quot;s&quot;;
-          else if (node_field(x,y).parent == PARENT_WEST)
-            std::cout &lt;&lt; &quot;w&quot;;
-          else if (node_field(x,y).parent == PARENT_EAST)
-            std::cout &lt;&lt; &quot;e&quot;;
-          else if (node_field(x,y).parent == PARENT_NORTH)
-            std::cout &lt;&lt; &quot;n&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-            }
-          if (is_path_node(x,y))
-            std::cout &lt;&lt; &quot;#&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-
-          if (x == start.x &amp;&amp; y == start.y)
-            std::cout &lt;&lt; &quot;S&quot;;
-          else if (x == end.x &amp;&amp; y == end.y)
-            std::cout &lt;&lt; &quot;G&quot;;
-          else if (field(x,y) != 0)
-            std::cout &lt;&lt; &quot;O&quot;;
-          else if (node_field(x,y).visited)
-            std::cout &lt;&lt; &quot;.&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-      }
-      std::cout &lt;&lt; std::endl;
-    }
-  std::cout &lt;&lt; &quot;OpenNodes: &quot; &lt;&lt; open_nodes.size() &lt;&lt; std::endl;
-  std::cout &lt;&lt; &quot;State: &quot; &lt;&lt; state &lt;&lt; std::endl;
-}
-
-bool
-BFirstPathfinder::is_path_node(int x, int y)
-{
-  if (path.empty()) 
-    return false;
-  else
-    {
-      for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-          if (i-&gt;x == x &amp;&amp; i-&gt;y == y)
-            return true;
-        }
-      return false;
-    }
-}
-
-BFirstPathfinder::Node&amp;
-BFirstPathfinder::resolve_parent(Node&amp; node)
-{
-  if (node.parent == PARENT_NONE)
-    {
-      display();
-      assert(false);
-    }
-
-  switch(node.parent)
-    {
-    case PARENT_NORTH:
-      return node_field(node.x, node.y - 1);
-    case PARENT_SOUTH:
-      return node_field(node.x, node.y + 1);
-    case PARENT_EAST:
-      return node_field(node.x + 1, node.y);
-    case PARENT_WEST:
-      return node_field(node.x - 1, node.y);
-    default:
-      assert(!&quot;resolve path error&quot;);
-    }
-  assert(!&quot;resolve path error2&quot;);
-  return *(Node*)0;
-}
-
-void
-BFirstPathfinder::construct_path()
-{
-  //std::cout &lt;&lt; &quot;Construct path&quot; &lt;&lt; std::endl;
-  // We construct the path reverse, so we start at the end
-  Node&amp; current_node = node_field(end.x, end.y);
-
-  while(current_node.parent != PARENT_GOAL)
-    {
-      //std::cout &lt;&lt; &quot;&gt;&gt;&gt; Node: &quot; &lt;&lt; current_node.x &lt;&lt; &quot; &quot; &lt;&lt; current_node.y &lt;&lt; std::endl;
-
-      path.push_back(Pos(current_node.x, current_node.y));
-      current_node = resolve_parent(current_node);
-    }
-}
-
-#ifdef TESTME
-int main()
-{
-  CL_SetupCore::init();
-
-  srand(time(NULL));
-  Field&lt;int&gt; field(80, 50);
-
-  std::cout &lt;&lt; &quot;Created field of size: &quot; 
-            &lt;&lt; field.get_width() &lt;&lt; &quot;x&quot; &lt;&lt; field.get_height() &lt;&lt; std::endl;
-
-  unsigned int start_time = CL_System::get_time();
-  unsigned int end_time;
-  //for(int count = 0; count &lt; 100; ++count)
-  //{
-  for(int y = 0; y &lt; field.get_height(); ++y)
-    for(int x = 0; x &lt; field.get_width(); ++x)
-      {
-        field(x,y) = (rand()%20) &gt; 5 ? 0 : 1;
-      }
-
-  BFirstPathfinder pathfinder(&amp;field);
-  Pos start;
-  Pos end;
-  start.x = rand()%field.get_width();
-  start.y = rand()%field.get_height();
-
-  end.x = rand()%field.get_width();
-  end.y = rand()%field.get_height();
-
-  pathfinder.init(start, end);
-  //pathfinder.display();
-
-  //int i = 0;
-  //std::cout &lt;&lt; &quot;Start: &quot; &lt;&lt; start.x &lt;&lt; &quot; &quot; &lt;&lt; start.y &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;End:   &quot; &lt;&lt; end.x &lt;&lt; &quot; &quot; &lt;&lt; end.y &lt;&lt; std::endl;
-
-  while(!pathfinder.finished())
-    {
-      pathfinder.process_one_open_node();
-      //getchar();
-    }
-  end_time = CL_System::get_time();
-
-  pathfinder.display();
-      
-  if (pathfinder.get_state() != BFirstPathfinder::PATH_FOUND)
-    {
-      std::cout &lt;&lt; &quot;No Path could be found&quot; &lt;&lt; std::endl;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;Found path&quot; &lt;&lt; std::endl;
-      std::vector&lt;Pos&gt;&amp; path = pathfinder.get_path();
-      for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-          std::cout &lt;&lt; &quot;[&quot; &lt;&lt; i-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; i-&gt;y &lt;&lt; &quot;] &quot;;
-        }       
-      std::cout &lt;&lt; std::endl;
-    }
-
-  //      getchar();
-  //std::cout &lt;&lt; &quot;round: &quot; &lt;&lt; ++i &lt;&lt; std::endl;
-  //}
-  std::cout &lt;&lt; &quot;Msec: &quot; &lt;&lt; end_time - start_time &lt;&lt; std::endl;
-
-  CL_SetupCore::deinit();
-}
-#endif
-
-// Local Variables:
-// compile-command: &quot;g++-3.2 -DTESTME -Wall -O2 bfirst_pathfinder.cxx  -o bfirst_pathfinder -lclanCore&quot;
-// End:
-
-/* EOF */

Copied: trunk/src/buildings/ammotent.cpp (from rev 341, trunk/src/buildings/ammotent.cxx)


Property changes on: trunk/src/buildings/ammotent.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/ammotent.cxx
===================================================================
--- trunk/src/buildings/ammotent.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/ammotent.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,87 +0,0 @@
-//  $Id: ammotent.cxx,v 1.12 2003/06/22 18:34:52 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &quot;../color.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;../radar.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../vehicles/vehicle.hxx&quot;
-#include &quot;../display/drawing_context.hxx&quot;
-#include &quot;ammotent.hxx&quot;
-
-Ammotent::Ammotent (const AList&amp; lst)
-  : Building (lst),
-    ammotent (resources-&gt;get_sprite(&quot;feuerkraft/ammotent&quot;)),
-    pos (x_pos * 40 + 40, y_pos * 40 + 60), // FIXME: Hard coded tilesize again...
-    reloading(false)
-{
-}
-
-Ammotent::~Ammotent ()
-{
-}
-
-void 
-Ammotent::draw (View&amp; view)
-{
-  view.get_sc().color().draw(ammotent, pos.x, pos.y);
-  if (reloading)
-    {
-      view.get_sc().color().draw_fillrect(pos.x - 32, pos.y + 25,
-                                  pos.x + 31, pos.y + 57,
-                                  CL_Color(CL_Colorf(1.0f, 1.0f, 1.0f, 
-                                                     sin(GameWorld::current()-&gt;get_time () * 10.0f)
-                                                     * .3f + .5f)));
-    }
-}
-
-void
-Ammotent::draw_radar (Radar&amp; radar)
-{
-  radar.draw_blip (pos, 4, 0, 0, 1.0f);
-}
-
-void 
-Ammotent::update (float delta)
-{
-  delta *= 50;
-
-  reloading = false;
-
-  GameObjManager* objs = GameWorld::current()-&gt;get_game_obj_manager();
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(*i);
-
-      if (vehicle &amp;&amp; (vehicle-&gt;get_pos ().x &gt; pos.x - 40
-		      &amp;&amp; vehicle-&gt;get_pos ().x &lt; pos.x + 40
-		      &amp;&amp; vehicle-&gt;get_pos ().y &gt; pos.y + 20
-		      &amp;&amp; vehicle-&gt;get_pos ().y &lt; pos.y + 60))
-	{
-	  if (vehicle-&gt;get_velocity () == 0.0)
-	    {
-	      vehicle-&gt;reload_ammo (delta);
-	      reloading = true;
-	    }
-	}
-    }
-}
-
-/* EOF */

Copied: trunk/src/buildings/building.cpp (from rev 341, trunk/src/buildings/building.cxx)


Property changes on: trunk/src/buildings/building.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/building.cxx
===================================================================
--- trunk/src/buildings/building.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/building.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,51 +0,0 @@
-//  $Id: building.cxx,v 1.6 2003/08/20 00:02:46 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../property_set.hxx&quot;
-#include &quot;../radar.hxx&quot;
-#include &quot;building.hxx&quot;
-
-Building::Building (const AList&amp; lst)
-  : x_pos (lst.get_int(&quot;x-pos&quot;)),
-    y_pos (lst.get_int(&quot;y-pos&quot;))
-{
-  register_properties();
-}
-
-Building::~Building ()
-{
-  delete properties;
-}
-
-void
-Building::register_properties()
-{
-  properties = new PropertySet();
-
-  properties-&gt;register_int(&quot;x-pos&quot;, &amp;x_pos);
-  properties-&gt;register_int(&quot;y-pos&quot;, &amp;y_pos);
-}
-
-void
-Building::draw_radar(Radar&amp; radar)
-{
-  radar.draw_blip(FloatVector2d(x_pos * 40, y_pos * 40), 3, .5f, .5f, .5f);
-}
-
-/* EOF */

Copied: trunk/src/buildings/building_manager.cpp (from rev 341, trunk/src/buildings/building_manager.cxx)


Property changes on: trunk/src/buildings/building_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/building_manager.cxx
===================================================================
--- trunk/src/buildings/building_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/building_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,59 +0,0 @@
-//  $Id: building_manager.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../game_world.hxx&quot;
-#include &quot;building_map.hxx&quot;
-#include &quot;building.hxx&quot;
-#include &quot;building_manager.hxx&quot;
-
-BuildingManager* BuildingManager::current_ = 0;
-int BuildingManager::next_id = 1;
-
-BuildingManager::BuildingManager()
-{
-  current_ = this;
-}
-
-BuildingManager::~BuildingManager()
-{
-  
-}
-
-Building*
-BuildingManager::get_building_by_id(int handle)
-{
-  for(Buildings::iterator i = buildings.begin(); i != buildings.end(); ++i)
-    {
-      if ((*i)-&gt;get_id() == handle)
-        return *i;
-    }
-  return 0;
-}
-
-void
-BuildingManager::add_building(Building* building, int x, int y)
-{
-  buildings.push_back(building);
-  building-&gt;set_id(next_id);
-  ++next_id;
-
-  GameWorld::current()-&gt;get_buildingmap()-&gt;add_building(building, x, y);
-}
-
-/* EOF */

Copied: trunk/src/buildings/building_map.cpp (from rev 341, trunk/src/buildings/building_map.cxx)


Property changes on: trunk/src/buildings/building_map.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/building_map.cxx
===================================================================
--- trunk/src/buildings/building_map.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/building_map.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,201 +0,0 @@
-//  $Id: building_map.cxx,v 1.9 2003/06/22 21:51:21 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../view.hxx&quot;
-#include &quot;building_map.hxx&quot;
-#include &quot;building.hxx&quot;
-
-#include &quot;tower.hxx&quot;
-#include &quot;fuelstation.hxx&quot;
-#include &quot;ammotent.hxx&quot;
-#include &quot;headquarter.hxx&quot;
-#include &quot;wall.hxx&quot;
-#include &quot;wall_door.hxx&quot;
-
-BuildingMap::BuildingMap(const BuildingMapData&amp; data)
-  : BuildingMapData (data)
-{
-  for (std::vector&lt;BuildingData&gt;::iterator i = buildings_data.begin ();
-       i != buildings_data.end ();
-       ++i)
-    {
-      if (i-&gt;first == &quot;tower&quot;)
-	{
-	  buildings.push_back(new Tower(i-&gt;second));
-	}
-      else if (&quot;ammotent&quot; == i-&gt;first)
-	{
-	  buildings.push_back(new Ammotent(i-&gt;second));
-	}
-      else if (&quot;wall&quot; == i-&gt;first)
-	{
-	  buildings.push_back(new Wall(i-&gt;second));
-	}
-      else if (&quot;fuelstation&quot; == i-&gt;first)
-	{
-	  //std::cout &lt;&lt; &quot;BuildingMapData: creating ammotent&quot; &lt;&lt; std::endl;
-	  buildings.push_back(new Fuelstation(i-&gt;second));
-	}
-      else if (&quot;headquarter&quot; == i-&gt;first)
-	{
-	  //std::cout &lt;&lt; &quot;BuildingMapData: creating headquarter&quot; &lt;&lt; std::endl;
-	  buildings.push_back(new Headquarter(i-&gt;second));
-	}
-      else if (&quot;walldoor&quot; == i-&gt;first)
-	{
-	  buildings.push_back(new WallDoor(i-&gt;second));
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;BuildingMapData: Error: &quot; &lt;&lt; i-&gt;first &lt;&lt; std::flush;
-	}
-    }
-
-  building_map.resize(width * height);
-  
-  // Clear all pointers in the building map
-  for (std::vector&lt;Building*&gt;::iterator i = building_map.begin();
-       i != building_map.end();
-       ++i)
-    {
-      *i = NULL;
-    }
-
-  // 'Draw' the buildings onto the building_map
-  for (std::vector&lt;Building*&gt;::iterator i = buildings.begin();
-       i != buildings.end ();
-       ++i)
-    {
-      Building* building = *i;
-      
-      for (int x = building-&gt;get_x_pos();
-	   x &lt; building-&gt;get_x_pos() + building-&gt;get_map_width();
-	   ++x)
-	{
-	  for (int y = building-&gt;get_y_pos(); 
-	       y &lt; building-&gt;get_y_pos() + building-&gt;get_map_height();
-	       ++y)
-	    {
-	      if (x &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; height)
-		building_map[(y * width) + x] = building;
-	      else
-		std::cout &lt;&lt; &quot;BuildingMap: Error: building position out of range: &quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; std::endl;
-	    }
-	}
-    }
-}
-
-// Draw the object onto the screen
-void
-BuildingMap::draw (View&amp; view)
-{
-  for (std::vector&lt;Building*&gt;::iterator i = buildings.begin ();
-       i != buildings.end ();
-       ++i)
-    {
-      (*i)-&gt;draw (view);
-    }
-}
-
-void
-BuildingMap::draw_energie (View&amp; view)
-{
-  for (std::vector&lt;Building*&gt;::iterator i = buildings.begin ();
-       i != buildings.end ();
-       ++i)
-    {
-      (*i)-&gt;draw_energie (view);
-    }  
-}
-
-void
-BuildingMap::draw_radar (Radar&amp; radar)
-{
-  for (std::vector&lt;Building*&gt;::iterator i = buildings.begin ();
-       i != buildings.end ();
-       ++i)
-    {
-      (*i)-&gt;draw_radar (radar);
-    }  
-}
-  
-// Update the object once a game loop
-void
-BuildingMap::update (float delta)
-{
-  for (std::vector&lt;Building*&gt;::iterator i = buildings.begin ();
-       i != buildings.end ();
-       ++i)
-    {
-      (*i)-&gt;update (delta);
-    }
-}
-
-Building*
-BuildingMap::get_building (const FloatVector2d&amp; pos)
-{
-  int x = int(pos.x)/40;
-  int y = int(pos.y)/40;
-
-  if (pos.x &lt; 0)
-    x -= 1;
-
-  if (pos.y &lt; 0)
-    y -= 1;
-
-  if (x &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; y &gt;=0 &amp;&amp; y &lt; height)
-    {
-      Building* b = building_map[(y * width) + x];
-      if (b &amp;&amp; b-&gt;alive () &amp;&amp; b-&gt;is_active ())
-	return b;
-      else
-	return NULL;
-    }
-  else
-    return NULL;
-}
-
-GameObjData*
-BuildingMap::get_data ()
-{
-  // FIXME: No Sync
-  return this;
-}
-
-void
-BuildingMap::add_building(Building* building, int x_pos, int y_pos)
-{
-  //std::cout &lt;&lt; &quot;Adding building &quot; &lt;&lt; building &lt;&lt; &quot; at &quot; &lt;&lt; x_pos &lt;&lt; &quot;, &quot; &lt;&lt; y_pos &lt;&lt; std::endl;
-
-  for (int x = x_pos; x &lt; x_pos + building-&gt;get_map_width(); ++x)
-    {
-      for (int y = y_pos; y &lt; y_pos + building-&gt;get_map_height(); ++y)
-        {
-          if (x &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; height)
-            building_map[(y * width) + x] = building;
-          else
-            std::cout &lt;&lt; &quot;BuildingMap: Error: building position out of range: &quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; std::endl;
-        }
-    }
-
-  buildings.push_back(building);
-}
-
-/* EOF */

Copied: trunk/src/buildings/building_map_data.cpp (from rev 341, trunk/src/buildings/building_map_data.cxx)


Property changes on: trunk/src/buildings/building_map_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/building_map_data.cxx
===================================================================
--- trunk/src/buildings/building_map_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/building_map_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,88 +0,0 @@
-//  $Id: building_map_data.cxx,v 1.7 2003/06/22 21:51:21 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;building_map_data.hxx&quot;
-#include &quot;building_map.hxx&quot;
-#include &quot;../guile.hxx&quot;
-
-BuildingMapData::BuildingMapData (SCM desc)
-{
-  //std::cout &lt;&lt; &quot;BuildingMapData: parsing: start&quot; &lt;&lt; std::endl;
-
-  // FIXME: Hardcoded is ugly!
-  width = 256;
-  height = 256;
-
-  while (!gh_null_p (desc))
-    {
-      SCM symbol = gh_caar(desc);
-      SCM data   = gh_cdar(desc);
-
-      AList alst = Guile::scm2alist(data);
-      std::string str = Guile::symbol2string(symbol);
-
-      // FIXME: Should be placed in a BuildingDataFactory class
-      buildings_data.push_back(BuildingData(str, alst));
-
-      //std::cout &lt;&lt; &quot;BuildingData: &quot; &lt;&lt; str &lt;&lt; &quot;\n&quot; &lt;&lt; alst &lt;&lt; std::endl;
-
-      desc = gh_cdr(desc);
-    }
-}
-
-BuildingMapData::~BuildingMapData ()
-{
-}
-
-GameObj*
-BuildingMapData::create ()
-{
-  return new BuildingMap(*this);
-}
-
-SCM
-BuildingMapData::dump_to_scm ()
-{
-  return SCM_EOL;
-#if 0
-  SCM building_map_scm = SCM_EOL;
-
-  for (std::vector&lt;BuildingData*&gt;::iterator i = buildings_data.begin ();
-       i != buildings_data.end (); ++i)
-    {
-      SCM obj = (*i)-&gt;dump_to_scm ();
-
-      if (obj == SCM_BOOL_F)
-	{
-	  std::cout &lt;&lt; &quot;BuildingMapData: Error dumping: &quot; &lt;&lt; typeid(**i).name () &lt;&lt; std::endl;
-	}
-      else // dump successful
-	{
-	  building_map_scm = gh_cons (obj, building_map_scm);
-	}
-    }
-
-  building_map_scm = gh_cons (gh_symbol2scm (&quot;buildingmap&quot;), gh_reverse (building_map_scm));
-
-  return building_map_scm;
-#endif
-}
-
-/* EOF */

Copied: trunk/src/buildings/building_type_manager.cpp (from rev 341, trunk/src/buildings/building_type_manager.cxx)


Property changes on: trunk/src/buildings/building_type_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/building_type_manager.cxx
===================================================================
--- trunk/src/buildings/building_type_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/building_type_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,96 +0,0 @@
-//  $Id: building_type_manager.cxx,v 1.5 2003/06/23 09:56:39 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-
-#include &quot;wall_door.hxx&quot;
-#include &quot;wall.hxx&quot;
-#include &quot;tower.hxx&quot;
-#include &quot;fuelstation.hxx&quot;
-#include &quot;ammotent.hxx&quot;
-
-#include &quot;building_type_manager.hxx&quot;
-
-BuildingTypeManager* BuildingTypeManager::current_ = 0;
-
-BuildingTypeManager::BuildingTypeManager()
-{
-  next_id = 2;
-  current_ = this;
-
-  register_factory(new GenericBuildingFactory&lt;Fuelstation&gt;(&quot;fuelstation&quot;));
-  register_factory(new GenericBuildingFactory&lt;Ammotent&gt;(&quot;ammotent&quot;));
-  register_factory(new GenericBuildingFactory&lt;Wall&gt;(&quot;wall&quot;));
-  register_factory(new GenericBuildingFactory&lt;WallDoor&gt;(&quot;walldoor&quot;));
-  register_factory(new GenericBuildingFactory&lt;Tower&gt;(&quot;tower&quot;));
-}
-
-int
-BuildingTypeManager::register_factory(BuildingFactory* factory)
-{
-  factories.push_back(factory);
-  factory-&gt;id = next_id;
-  return next_id++;
-}
-
-Building*
-BuildingTypeManager::create_building(int type_id, const AList&amp; params)
-{
-  for (Factories::iterator i = factories.begin(); i != factories.end(); ++i)
-    {
-      if ((*i)-&gt;id == type_id)
-        {
-          return (*i)-&gt;create(params);
-        }
-    }
-
-  // FIXME: throw something here
-  std::cout &lt;&lt; &quot;BuildingTypeManager: Invalid type handle: &quot; &lt;&lt; type_id &lt;&lt; std::endl;
-  return 0;
-}
-
-int
-BuildingTypeManager::name_to_id(const std::string&amp; name)
-{
- for (Factories::iterator i = factories.begin(); i != factories.end(); ++i)
-    {
-      if ((*i)-&gt;name == name)
-        {
-          return (*i)-&gt;id;
-        }
-    }
- // FIXME: throw something here
- return 0;
-}
-
-std::string
-BuildingTypeManager::id_to_name(int id)
-{
- for (Factories::iterator i = factories.begin(); i != factories.end(); ++i)
-    {
-      if ((*i)-&gt;id == id)
-        {
-          return (*i)-&gt;name;
-        }
-    }
- // FIXME: throw something here
- return &quot;invalid-id&quot;;
-}
-
-/* EOF */

Copied: trunk/src/buildings/custom_building.cpp (from rev 341, trunk/src/buildings/custom_building.cxx)


Property changes on: trunk/src/buildings/custom_building.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/custom_building.cxx
===================================================================
--- trunk/src/buildings/custom_building.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/custom_building.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,67 +0,0 @@
-//  $Id: custom_building.cxx,v 1.9 2003/06/23 08:43:32 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../alist.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;custom_building.hxx&quot;
-
-CustomBuilding::CustomBuilding(const AList&amp; type, const AList&amp; lst)
-  : Building(lst)
-{
-  std::string sprite_str = &quot;feuerkraft/nobuilding&quot;;
-  int         i_energie = 100;
-  width   = 2;
-  height  = 2;
-
-  type.retrieve_string(&quot;sprite&quot;,  sprite_str);
-  type.retrieve_int   (&quot;energie&quot;, i_energie);
-  type.retrieve_int   (&quot;width&quot;,   width);
-  type.retrieve_int   (&quot;height&quot;,  height);
-
-  energie.set_max_energie(i_energie);
-
-  sprite = resources-&gt;get_sprite(sprite_str);
-}
-
-void
-CustomBuilding::draw(View&amp; view)
-{
-  view.get_sc().color().draw(sprite,
-                     x_pos * 40 + get_map_width()*20, 
-                     y_pos * 40 + get_map_height()*20); // FIXME: Hardcoded tilesize
-}
-
-void
-CustomBuilding::draw_energie(View&amp; view)
-{
-  energie.draw(view, x_pos*40 + get_map_width()*20, (y_pos*40));
-}
-
-void
-CustomBuilding::update(float)
-{
-}
-
-void
-CustomBuilding::collide (Projectile*)
-{
-  energie -= 5;
-}
-
-/* EOF */

Copied: trunk/src/buildings/fuelstation.cpp (from rev 341, trunk/src/buildings/fuelstation.cxx)


Property changes on: trunk/src/buildings/fuelstation.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/fuelstation.cxx
===================================================================
--- trunk/src/buildings/fuelstation.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/fuelstation.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,86 +0,0 @@
-//  $Id: fuelstation.cxx,v 1.12 2003/06/22 18:34:52 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;cmath&gt;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;../color.hxx&quot;
-#include &quot;../radar.hxx&quot;
-#include &quot;../vehicles/vehicle.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../display/drawing_context.hxx&quot;
-#include &quot;fuelstation.hxx&quot;
-
-Fuelstation::Fuelstation(const AList&amp; lst)
-  : Building(lst),
-    fuelstation (resources-&gt;get_sprite(&quot;feuerkraft/fuelstation&quot;)),
-    pos (x_pos * 40 + 40, y_pos * 40 + 60), // FIXME: Hardcoded tilesize
-    refueling (false)
-{
-}
-
-Fuelstation::~Fuelstation ()
-{
-}
-
-void 
-Fuelstation::draw (View&amp; view)
-{
-  view.get_sc().color().draw(fuelstation, pos.x, pos.y);
-  if (refueling)
-    {
-      view.get_sc().color().draw_fillrect(pos.x - 32, pos.y + 25,
-                                  pos.x + 31, pos.y + 57,
-                                  CL_Color(CL_Colorf(1.0, 1.0, 1.0,
-                                                     sin(GameWorld::current()-&gt;get_time () * 10.0f)
-                                                     * .3f + .5f)));
-    }
-}
-
-void
-Fuelstation::draw_radar (Radar&amp; radar)
-{
-  radar.draw_blip (pos, 4, 0, 0, 1.0f);
-}
-
-void 
-Fuelstation::update (float delta)
-{
-  delta *= 50;
-
-  refueling = false;
-
-  GameObjManager* objs = GameWorld::current()-&gt;get_game_obj_manager();
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(*i);
-      if (vehicle &amp;&amp; (vehicle-&gt;get_pos ().x &gt; pos.x - 40
-		      &amp;&amp; vehicle-&gt;get_pos ().x &lt; pos.x + 40
-		      &amp;&amp; vehicle-&gt;get_pos ().y &gt; pos.y + 20
-		      &amp;&amp; vehicle-&gt;get_pos ().y &lt; pos.y + 60))
-	{
-	  if (vehicle-&gt;get_velocity () == 0.0)
-	    {
-	      vehicle-&gt;refuel (delta);
-	      refueling = true;
-	    }
-	}
-    }
-}
-
-/* EOF */

Copied: trunk/src/buildings/headquarter.cpp (from rev 341, trunk/src/buildings/headquarter.cxx)


Property changes on: trunk/src/buildings/headquarter.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/headquarter.cxx
===================================================================
--- trunk/src/buildings/headquarter.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/headquarter.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,91 +0,0 @@
-//  $Id: headquarter.cxx,v 1.9 2003/06/22 19:22:56 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../radar.hxx&quot;
-#include &quot;../explosion.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;headquarter.hxx&quot;
-
-Headquarter::Headquarter (const AList&amp; lst)
-  : Building (lst),
-    pos (x_pos * 40 + 40, y_pos * 40 + 40),
-    headquarter (resources-&gt;get_sprite(&quot;feuerkraft/headquarter&quot;)),
-    headquarter_damaged (resources-&gt;get_sprite(&quot;feuerkraft/headquarterdamaged&quot;)),
-    headquarter_destroyed (resources-&gt;get_sprite(&quot;feuerkraft/headquarterdestroyed&quot;)),
-    energie (100),
-    destroyed (false)
-{
-  current_sur = &headquarter;
-}
-
-Headquarter::~Headquarter ()
-{
-}
-
-void 
-Headquarter::update (float delta)
-{
-  if (energie &lt;= 0 &amp;&amp; !destroyed)
-    {
-      GameWorld::current()-&gt;add(new Explosion (pos, Explosion::MEDIUM));
-      destroyed = true;
-    }
-}
-
-void 
-Headquarter::draw (View&amp; view)
-{
-  view.get_sc().color().draw(*current_sur, pos.x, pos.y);
-  energie.draw (view, int(pos.x), int(pos.y - 40));
-}
-
-void
-Headquarter::draw_radar (Radar&amp; radar)
-{
-  radar.draw_blip (pos, 4);
-}
-
-bool 
-Headquarter::is_colliding (FloatVector2d obj_pos)
-{
-  return (!destroyed &amp;&amp;
-	  obj_pos.x &gt; pos.x - 40 &amp;&amp; obj_pos.x &lt; pos.x + 40 &amp;&amp;
-	  obj_pos.y &gt; pos.y - 40 &amp;&amp; obj_pos.y &lt; pos.y + 40);
-}
-
-void 
-Headquarter::collide (Projectile*)
-{
-  energie -= 10;
-
-  if (energie &gt; 60)
-    current_sur = &headquarter;
-  else if (energie &gt; 0)
-    current_sur = &amp;headquarter_damaged;
-  else
-    current_sur = &amp;headquarter_destroyed;
-}
-
-bool
-Headquarter::alive ()
-{
-  return (energie &gt; 0);
-}
-
-/* EOF */

Copied: trunk/src/buildings/tower.cpp (from rev 341, trunk/src/buildings/tower.cxx)


Property changes on: trunk/src/buildings/tower.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/tower.cxx
===================================================================
--- trunk/src/buildings/tower.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/tower.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,143 +0,0 @@
-//  $Id: tower.cxx,v 1.12 2003/10/20 21:30:09 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../property_set.hxx&quot;
-#include &quot;../radar.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../input/controller.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;../explosion.hxx&quot;
-#include &quot;tower.hxx&quot;
-
-Tower::Tower(const AList&amp; lst)
-  : Building(lst),
-    towerbase(resources-&gt;get_sprite(&quot;feuerkraft/tower/base&quot;)),
-    towerdamaged (resources-&gt;get_sprite(&quot;feuerkraft/tower/damaged&quot;)),
-    towerdestroyed (resources-&gt;get_sprite(&quot;feuerkraft/tower/destroyed&quot;)),
-    turret (resources-&gt;get_sprite(&quot;feuerkraft/tower/turret&quot;)),
-    energie (lst.get_int(&quot;start-energie&quot;, 100)),
-    destroyed (false)
-{  
-  //int energie;
-  //std::cout &lt;&lt; lst.retrieve_int(&quot;start-energie&quot;, energie) &lt;&lt; std::endl;
-  //std::cout &lt;&lt; lst &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;Tower Energie: &quot; &lt;&lt; lst.get_int(&quot;start-energie&quot;, 100) &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;--Tower Energie: &quot; &lt;&lt; lst.get_int(&quot;sta-energie&quot;, 100) &lt;&lt; std::endl;
-
-  orientation = lst.get_float(&quot;orientation&quot;);
-  pos.x = x_pos * 40 + 40;
-  pos.y = y_pos * 40 + 40;
-
-  steering = 0;
-
-  Building::properties-&gt;register_float(&quot;orientation&quot;, &amp;orientation);
-}
-  
-Tower::~Tower ()
-{
-}
-
-// Draw the object onto the screen
-void
-Tower::draw (View&amp; view)
-{
-  if (energie &gt; 50)
-    {
-      view.get_sc().color().draw(towerbase, pos.x, pos.y);
-    }
-  else if (energie &gt; 0)
-    {
-      view.get_sc().color().draw(towerdamaged, pos.x, pos.y);
-    }
-  else
-    {
-      view.get_sc().color().draw(towerdestroyed, pos.x, pos.y);
-    }
-
-  if (energie &gt; 0)
-    {
-      turret.set_angle(orientation);
-      view.get_sc().color().draw(turret, pos.x, pos.y);
-    }
-}
-  
-void
-Tower::draw_energie (View&amp; view)
-{
-  energie.draw (view, int(pos.x), int (pos.y) - 40);
-}
-
-void
-Tower::draw_radar (Radar&amp; radar)
-{
-  radar.draw_blip (pos, 4);
-}
-
-// Update the object once a game loop
-void
-Tower::update (float delta)
-{
-  if (!(energie &gt; 0))
-    return;
-
-  orientation = Math::normalize_angle(orientation + steering * delta);
-
-  if (!destroyed &amp;&amp; !(energie &gt; 0))
-    {
-      GameWorld::current()-&gt;add (new Explosion (pos, Explosion::MEDIUM));
-      destroyed = true;
-    }
-}
-
-void
-Tower::update_controlls(const Controller&amp; controller)
-{
-  steering = controller.get_axis_state(ORIENTATION_AXIS);
-}
-
-void
-Tower::collide (int hits)
-{
-  energie -= hits;
-  if (!destroyed &amp;&amp; !(energie &gt; 0))
-    {
-      GameWorld::current()-&gt;add (new Explosion (pos, Explosion::LARGE));
-      destroyed = true;
-    }
-}
-
-void 
-Tower::collide (Projectile*)
-{
-  energie -= 5;   
-  if (!destroyed &amp;&amp; !(energie &gt; 0))
-    {
-      GameWorld::current()-&gt;add (new Explosion (pos, Explosion::LARGE));
-      destroyed = true;
-    }
-}
-
-bool
-Tower::alive ()
-{
-  return !destroyed;
-}
-
-/* EOF */

Copied: trunk/src/buildings/tower_ai.cpp (from rev 341, trunk/src/buildings/tower_ai.cxx)


Property changes on: trunk/src/buildings/tower_ai.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/tower_ai.cxx
===================================================================
--- trunk/src/buildings/tower_ai.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/tower_ai.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,69 +0,0 @@
-//  $Id: tower_ai.cxx,v 1.1 2003/06/18 13:04:21 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../math.hxx&quot;
-#include &quot;../player.hxx&quot;
-#include &quot;../unit.hxx&quot;
-#include &quot;../property_set.hxx&quot;
-#include &quot;tower_ai.hxx&quot;
-
-extern Player*  player;
-
-TowerAI::TowerAI(Tower* arg_tower)
-  : tower(arg_tower),
-    ai_count(0)
-{
-}
-
-void
-TowerAI::update(float delta)
-{
-  ai_count -= delta;
-
-  if (ai_count &lt;= 0)
-    {
-      ai_count = 0.0f;
-
-      FloatVector2d pos(tower-&gt;get_x_pos() * 40 + 40,
-                        tower-&gt;get_y_pos() * 40 + 40);
-
-      FloatVector2d target_pos = player-&gt;get_current_unit()-&gt;get_pos();
-      
-      FloatVector2d diff = target_pos - pos;
-      
-      //      float angle = Math::normalize_angle(tower-&gt;get_orientation() - diff.get_orientation());
-      
-      tower-&gt;Building::get_properties()-&gt;set_float(&quot;orientation&quot;, diff.get_orientation() + Math::pi);
-
-      /*if (angle &gt; 0)        controller.set_axis_state(ORIENTATION_AXIS, -1.0f);
-      else
-        controller.set_axis_state(ORIENTATION_AXIS, 1.0f);
-
-      tower-&gt;update_controlls(controller);
-      */
-    }
-}
-
-GameObj*
-TowerAI::get_object()
-{
-  return 0;
-}
-
-/* EOF */

Copied: trunk/src/buildings/wall.cpp (from rev 341, trunk/src/buildings/wall.cxx)


Property changes on: trunk/src/buildings/wall.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/wall.cxx
===================================================================
--- trunk/src/buildings/wall.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/wall.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,75 +0,0 @@
-//  $Id: wall.cxx,v 1.9 2003/06/23 09:56:39 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../property_set.hxx&quot;
-#include &quot;../radar.hxx&quot;
-#include &quot;../view.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;wall.hxx&quot;
-
-Wall::Wall (const AList&amp; lst)
-  : Building(lst),
-    pos (x_pos * 40 + 20, y_pos * 40 + 20),
-    wall (resources-&gt;get_sprite(&quot;feuerkraft/wall&quot;)),
-    wall_damaged (resources-&gt;get_sprite (&quot;feuerkraft/wall_damaged&quot;)),
-    wall_destroyed (resources-&gt;get_sprite (&quot;feuerkraft/wall_destroyed&quot;))
-{
-  energie = lst.get_int(&quot;energie&quot;, 100);
-  properties-&gt;register_int(&quot;energie&quot;, &amp;energie);
-}
-
-Wall::~Wall ()
-{
-}
-
-void 
-Wall::draw (View&amp; view)
-{
-  if (energie &gt; 60)
-    view.get_sc().color().draw (wall, pos.x, pos.y);
-  else if (energie &gt; 0)
-    view.get_sc().color().draw (wall_damaged, pos.x, pos.y);
-  else
-    view.get_sc().color().draw (wall_destroyed, pos.x, pos.y);
-}
-
-void
-Wall::draw_radar (Radar&amp; radar)
-{
-  radar.draw_blip (pos, 2);
-}
-
-void
-Wall::update(float)
-{
-}
-
-void 
-Wall::collide (Projectile*)
-{
-  energie -= 25;
-}
-
-bool
-Wall::alive ()
-{
-  return energie &gt; 0;
-}
-
-/* EOF */

Copied: trunk/src/buildings/wall_door.cpp (from rev 341, trunk/src/buildings/wall_door.cxx)


Property changes on: trunk/src/buildings/wall_door.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/buildings/wall_door.cxx
===================================================================
--- trunk/src/buildings/wall_door.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/buildings/wall_door.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,105 +0,0 @@
-//  $Id: wall_door.cxx,v 1.10 2003/06/22 19:22:56 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../vehicles/vehicle.hxx&quot;
-#include &quot;../view.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;wall_door.hxx&quot;
-
-WallDoor::WallDoor(const AList&amp; lst)
-  : Building(lst)
-{
-  if (lst.get_string(&quot;orientation&quot;) == &quot;vertical&quot;)
-    {
-      sprite = resources-&gt;get_sprite(&quot;feuerkraft/vdoor&quot;);
-      pos = FloatVector2d(x_pos * 40 + 20, y_pos * 40 + 60);
-      map_width = 1;
-      map_height = 3;
-    }
-  else 
-    {
-      sprite = resources-&gt;get_sprite(&quot;feuerkraft/hdoor&quot;);
-      pos = FloatVector2d(x_pos * 40 + 60, y_pos * 40 + 20);
-      map_width = 3;
-      map_height = 1;
-    }
-}
-
-WallDoor::~WallDoor ()
-{
-}
-
-void
-WallDoor::draw (View&amp; view)
-{
-  if (status != S_OPENED)
-    view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-void
-WallDoor::draw_radar (Radar&amp; radar)
-{
-}
-
-void
-WallDoor::update(float)
-{
-  status = S_CLOSED;
-  
-  GameObjManager* objs = GameWorld::current()-&gt;get_game_obj_manager();
-
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(*i);
-      if (vehicle)
-	{
-	  FloatVector2d diff = pos;
-	  diff -= vehicle-&gt;get_pos ();
-
-	  if (diff.get_length() &lt; 75.0f)
-	    {
-	      status = S_OPENED;
-	      return;
-	    }
-	}
-    }
-}
-
-void
-WallDoor::collide (Projectile*)
-{
-}
-
-bool
-WallDoor::is_active ()
-{
-  if (status == S_OPENED)
-    return false;
-  else
-    return true;
-}
-
-bool
-WallDoor::alive ()
-{
-  return true;
-}
-
-/* EOF */

Copied: trunk/src/collision_manager.cpp (from rev 341, trunk/src/collision_manager.cxx)


Property changes on: trunk/src/collision_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/collision_manager.cxx
===================================================================
--- trunk/src/collision_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/collision_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,261 +0,0 @@
-//  $Id: collision_manager.cxx,v 1.9 2003/06/18 14:38:28 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;assert.h&gt;
-#include &lt;math.h&gt;
-#include &quot;math.hxx&quot;
-#include &quot;color.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;buildings/building.hxx&quot;
-#include &quot;buildings/building_map.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;display/drawing_context.hxx&quot;
-
-CollisionManager* CollisionManager::current_ = 0;
-
-CollisionManager*
-CollisionManager::current()
-{
-  return current_;
-}
-
-CollisionManager::CollisionManager()
-{
-  current_ = this;
-}
-
-void
-CollisionManager::clear()
-{
-  shapes.clear();
-}
-
-void
-CollisionManager::run()
-{
-  // Check for GameObj&lt;-&gt;GameObj collisions
-  for(Shapes::iterator i = shapes.begin(); i != shapes.end(); ++i)
-    {
-      for(Shapes::iterator j = i + 1; j != shapes.end(); ++j)
-        {
-          if (i-&gt;type == SHAPE_CIRCLE)
-            {
-              if (j-&gt;type == SHAPE_CIRCLE) {
-                check_circle_circle_collision(i-&gt;circle, j-&gt;circle);
-              } else if (j-&gt;type == SHAPE_RECT) {
-                check_circle_rect_collision(i-&gt;circle, j-&gt;rect);
-              }
-            }
-          else if (i-&gt;type == SHAPE_RECT)
-            {
-              if (j-&gt;type == SHAPE_CIRCLE) {
-                check_circle_rect_collision(j-&gt;circle, i-&gt;rect);
-              } else if (j-&gt;type == SHAPE_RECT) {
-                check_rect_rect_collision(i-&gt;rect, j-&gt;rect);
-              }
-            }
-          else
-            {
-              assert(false);
-            }
-        }
-    }
-  
-  // Check for GameObj building collision
-  for(Shapes::iterator i = shapes.begin(); i != shapes.end(); ++i)
-    {
-      switch (i-&gt;type)
-        {
-        case SHAPE_CIRCLE:
-          {
-            BuildingMap* building_map = GameWorld::current()-&gt;get_buildingmap();
-            Building* building = building_map-&gt;get_building(FloatVector2d(i-&gt;circle.x, i-&gt;circle.y));
-            
-            if (!building)
-              building = building_map-&gt;get_building(FloatVector2d(i-&gt;circle.x - i-&gt;circle.radius, i-&gt;circle.y));
-
-            if (!building)
-              building = building_map-&gt;get_building(FloatVector2d(i-&gt;circle.x + i-&gt;circle.radius, i-&gt;circle.y));
-
-            if (!building)
-              building = building_map-&gt;get_building(FloatVector2d(i-&gt;circle.x, i-&gt;circle.y - i-&gt;circle.radius));
-
-            if (!building)
-              building = building_map-&gt;get_building(FloatVector2d(i-&gt;circle.x, i-&gt;circle.y + i-&gt;circle.radius));
-            
-            if (building)
-              {
-                GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(i-&gt;circle.object_id);
-                assert(obj);
-                obj-&gt;on_collision_with_building(building);
-              }
-          }
-          break;
-        case SHAPE_RECT:
-          // fixme: not handled
-          break;
-        default:
-          std::cout &lt;&lt; &quot;Unhandled type: &quot; &lt;&lt; i-&gt;type &lt;&lt; std::endl;
-        }
-    }
-}
-
-void
-CollisionManager::draw(View&amp; view)
-{
-  for(Shapes::iterator i = shapes.begin(); i != shapes.end(); ++i)
-    {
-      switch (i-&gt;type)
-        {
-        case SHAPE_CIRCLE:
-          view.get_sc().color().draw_circle(i-&gt;circle.x, i-&gt;circle.y, i-&gt;circle.radius,
-                                    CL_Color(255, 0, 0));
-          break;
-        case SHAPE_RECT:
-          {
-            CL_Color color(255, 0, 0);
-            Math::Quad quad = rect2quad(i-&gt;rect);
-            view.get_sc().color().draw_line(quad.a.x, quad.a.y, quad.b.x, quad.b.y, color);
-            view.get_sc().color().draw_line(quad.b.x, quad.b.y, quad.c.x, quad.c.y, color);
-            view.get_sc().color().draw_line(quad.c.x, quad.c.y, quad.d.x, quad.d.y, color);
-            view.get_sc().color().draw_line(quad.d.x, quad.d.y, quad.a.x, quad.a.y, color);
-          }
-          break;
-        default:
-          std::cout &lt;&lt; &quot;CollisionManager: unhandled type: &quot; &lt;&lt; i-&gt;type &lt;&lt; std::endl;
-        }
-    }
-}
-
-void
-CollisionManager::add_circle(int object_id, float x, float y, float radius)
-{
-  Shape shape;
-
-  shape.type = SHAPE_CIRCLE;
-
-  shape.circle.object_id = object_id;
-  shape.circle.x = x;
-  shape.circle.y = y;
-  shape.circle.radius = radius;
-
-  shapes.push_back(shape);
-}
-
-void
-CollisionManager::add_point(int object_id, float x, float y)
-{
-  add_circle(object_id, x, y, .5f);
-}
-
-void
-CollisionManager::add_rect(int object_id, float x, float y, float width, float height, float orientation)
-{
-  Shape shape;
-#if 0
-  shape.type = SHAPE_RECT;
-
-  shape.rect.object_id = object_id;
-  shape.rect.x = x;
-  shape.rect.y = y;
-  shape.rect.width  = width;
-  shape.rect.height = height;
-  shape.rect.orientation = orientation;
-#else
-  shape.type = SHAPE_CIRCLE;
-  
-  shape.circle.object_id = object_id;
-  shape.circle.x = x;
-  shape.circle.y = y;
-  shape.circle.radius = (width + height)/4;
-#endif
-  shapes.push_back(shape);
-}
-
-Math::Quad
-CollisionManager::rect2quad(const Rectangle&amp; rect)
-{
-  Math::Quad quad;
-
-  float dist = sqrt((rect.width/2) * (rect.width/2) + (rect.height/2) * (rect.height/2));
-
-  float angle = atan2(rect.height/2, rect.width/2);
-
-  // upper/left
-  quad.a.x = rect.x + dist * sin(angle - rect.orientation);
-  quad.a.y = rect.y + dist * cos(angle - rect.orientation);
-  // upper/right
-  quad.b.x = rect.x + dist * sin(-angle - rect.orientation);
-  quad.b.y = rect.y + dist * cos(-angle - rect.orientation);
-  // lower/right
-  quad.c.x = rect.x + dist * sin(angle - rect.orientation + Math::pi);
-  quad.c.y = rect.y + dist * cos(angle - rect.orientation + Math::pi);
-  // lower/left
-  quad.d.x = rect.x + dist * sin(-angle - rect.orientation + Math::pi);
-  quad.d.y = rect.y + dist * cos(-angle - rect.orientation + Math::pi);
-
-  return quad;
-}
-
-void
-CollisionManager::check_rect_rect_collision(const Rectangle&amp; rect1, const Rectangle&amp; rect2)
-{
-  if (Math::quad_collide(rect2quad(rect1), rect2quad(rect2)))
-    {
-      GameObj* obj1 = GameObjManager::current()-&gt;get_object_by_id(rect1.object_id);
-      GameObj* obj2 = GameObjManager::current()-&gt;get_object_by_id(rect2.object_id);
-
-      assert(obj1);
-      assert(obj2);
-
-      obj1-&gt;on_collision(obj2);
-      obj2-&gt;on_collision(obj1);
-    }
-}
-
-void
-CollisionManager::check_circle_rect_collision(const Circle&amp; circle, const Rectangle&amp; rect)
-{
-  
-}
-
-void
-CollisionManager::check_circle_circle_collision(const Circle&amp; circle1, const Circle&amp; circle2)
-{
-  float a = circle2.x - circle1.x;
-  float b = circle2.y - circle1.y;
-  float dist = sqrt(a*a + b*b);
-
-  if (dist &lt; circle1.radius + circle2.radius)
-    {
-      GameObj* obj1 = GameObjManager::current()-&gt;get_object_by_id(circle1.object_id);
-      GameObj* obj2 = GameObjManager::current()-&gt;get_object_by_id(circle2.object_id);
-
-      assert(obj1);
-      assert(obj2);
-
-      obj1-&gt;on_collision(obj2);
-      obj2-&gt;on_collision(obj1);
-    }
-}
-
-/* EOF */

Copied: trunk/src/color.cpp (from rev 341, trunk/src/color.cxx)


Property changes on: trunk/src/color.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/color.cxx
===================================================================
--- trunk/src/color.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/color.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,47 +0,0 @@
-//  $Id: color.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;color.hxx&quot;
-
-Color::Color()
-{
-  red   = 1.0f;
-  green = 1.0f;
-  blue  = 1.0f;
-  alpha = 1.0f;
-}
-
-Color::Color(float red_, float green_, float blue_, float alpha_)
-{
-  red   = red_;
-  green = green_;
-  blue  = blue_;
-  alpha = alpha_;
-}
-
-CL_Color
-Color::get_cl_color() const
-{
-  return CL_Color(static_cast&lt;int&gt;(255 * red),
-                  static_cast&lt;int&gt;(255 * green),
-                  static_cast&lt;int&gt;(255 * blue),
-                  static_cast&lt;int&gt;(255 * alpha));
-}
-
-/* EOF */

Copied: trunk/src/command_line_arguments.cpp (from rev 341, trunk/src/command_line_arguments.cxx)


Property changes on: trunk/src/command_line_arguments.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/command_line_arguments.cxx
===================================================================
--- trunk/src/command_line_arguments.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/command_line_arguments.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,167 +0,0 @@
-//  $Id: command_line_arguments.cxx,v 1.7 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;config.h&gt;
-#include &lt;iostream&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;ClanLib/Core/System/command_line.h&gt;
-#include &quot;command_line_arguments.hxx&quot;
-
-CommandLineArguments::CommandLineArguments()
-{
-  load_defaults();
-}
-
-
-CommandLineArguments::CommandLineArguments(int argc, char** argv)
-{
-  load_defaults();
-  parse_arguments(argc, argv);
-}
-
-void
-CommandLineArguments::load_defaults()
-{
-  // Default Screen Size
-  screen_width  = 800;
-  screen_height = 600;
-  fullscreen    = false;
-
-  mission_file = &quot;&quot;;
-  fps          = 30.0f;
-  joystick     = -1;
-  verbose      = true;
-  datadir      = &quot;&quot;;
-  music_enabled = false;
-  sound_enabled = false;
-}
-  
-void
-CommandLineArguments::parse_arguments(int argc, char** argv)
-{
-  CL_CommandLine argp;
-    
-  argp.set_help_indent(22);
-  argp.add_usage (&quot;[LEVELFILE]&quot;);
-  argp.add_doc   (&quot;Feuerkraft is a tank battle game&quot;);
-
-  argp.add_group(&quot;General Options:&quot;);
-  argp.add_option('v', &quot;verbose&quot;, &quot;&quot;,  &quot;Produce verbose output&quot;);
-  argp.add_option('V', &quot;version&quot;, &quot;&quot;,  &quot;Print the exact version of the game&quot;);
-  argp.add_option('q', &quot;quiet&quot;,   &quot;&quot;,  &quot;Produce no output&quot;);
-  argp.add_option('h', &quot;help&quot;,   &quot;&quot;,   &quot;Produce this help output&quot;);
-  argp.add_option('d', &quot;datadir&quot;, &quot;DATADIR&quot;, &quot;Set the path to search for gamedata&quot;);
-
-  argp.add_group(&quot;Display Options:&quot;);
-  argp.add_option('g', &quot;geometry&quot;,   &quot;WIDTHxHEIGHT&quot;, &quot;Set screen size&quot;);
-  argp.add_option('w', &quot;fullscreen&quot;, &quot;&quot;,    &quot;Switch to Fullscreen on startup&quot;);
-  argp.add_option('f', &quot;fps&quot;,        &quot;FPS&quot;, &quot;Limit of frames per second&quot;);
-
-  argp.add_group(&quot;Audio Options:&quot;);
-  argp.add_option('m', &quot;music&quot;, &quot;&quot;,  &quot;Enable music&quot;);
-  argp.add_option('s', &quot;sound&quot;, &quot;&quot;,  &quot;Enable sound&quot;);
-
-  argp.add_group(&quot;Input Options:&quot;);
-  argp.add_option('c', &quot;controller&quot;, &quot;FILE&quot;,   &quot;Use controller as defined in FILE&quot;);
-
-  argp.add_group(&quot;Demo Recording/Playback Options:&quot;);
-  argp.add_option('r', &quot;record&quot;,      &quot;FILE&quot;, &quot;Record input events to FILE&quot;);
-  argp.add_option('a', &quot;record-video&quot;,&quot;DIR&quot;,  &quot;Record a gameplay video to DIR&quot;);
-  argp.add_option('p', &quot;play&quot;,        &quot;FILE&quot;, &quot;Playback input events from FILE&quot;);
-
-  argp.parse_args(argc, argv);
-
-  while (argp.next())
-    {
-      switch(argp.get_key())
-        {
-        case CL_CommandLine::REST_ARG:
-          mission_file = argp.get_argument();
-          break;
-
-        case 'a':
-          video_record_directory = argp.get_argument();
-          break;
-
-        case 'r':
-          event_record_file = argp.get_argument();
-          break;
-
-        case 'h':
-          argp.print_help();
-          exit(EXIT_SUCCESS);
-          break;
-
-        case 'p':
-          playback_file = argp.get_argument();
-          break;
-
-        case 'f':
-          fps = strtof(argp.get_argument().c_str(), 0);
-          break;
-
-        case 'V':
-          std::cout &lt;&lt; PACKAGE_STRING &lt;&lt; std::endl;
-          exit(EXIT_SUCCESS);
-          break;
-
-        case 'v':
-          verbose = true;
-          break;
-
-        case 'd':
-          datadir = argp.get_argument();
-          break;
-
-        case 'q':
-          verbose = false;
-          break;
-
-        case 'm':
-          music_enabled = true;
-          break;
-
-        case 'c':
-          controller_file = argp.get_argument();
-          break;
-
-        case 's':
-          sound_enabled = true;
-          break;
-
-        case 'w':
-          fullscreen = true;
-          break;
-
-        case 'g':
-          if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;, &amp;screen_width, &amp;screen_height) != 2)
-            {
-              std::cout &lt;&lt; &quot;Screen size value incorrect: '&quot; &lt;&lt; argp.get_argument() &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-              exit(EXIT_FAILURE);
-            }
-          break;
-
-        default: 
-          std::cout &lt;&lt; &quot;CommandLineArguments: Unhandled key: &quot; &lt;&lt; argp.get_key() &lt;&lt; std::endl;
-          break;
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/communication_dialog.cpp (from rev 341, trunk/src/communication_dialog.cxx)


Property changes on: trunk/src/communication_dialog.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/communication_dialog.cxx
===================================================================
--- trunk/src/communication_dialog.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/communication_dialog.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,93 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;ClanLib/Core/System/system.h&gt;
-#include &quot;fonts.hxx&quot;
-#include &quot;unit.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;communication_dialog.hxx&quot;
-
-CommunicationDialog* CommunicationDialog::current_ = 0;
-
-CommunicationDialog::CommunicationDialog()
-{
-  current_ = this;
-  spike = resources-&gt;get_sprite(&quot;feuerkraft/dialogspike&quot;);
-}
-
-CommunicationDialog::~CommunicationDialog()
-{
-}
-
-void
-CommunicationDialog::draw (CL_GraphicContext&amp; gc)
-{
-  for(Messages::iterator i = messages.begin(); i != messages.end(); ++i)
-    {
-      Unit* unit = dynamic_cast&lt;Unit*&gt;(GameObjManager::current()-&gt;get_object_by_id(i-&gt;first));
-      if (unit)
-        {
-          CL_Font font = Fonts::font;
-          CL_Rect bbox = font.bounding_rect(0, 0, i-&gt;second.text);
-
-          FloatVector2d unit_pos   = View::current()-&gt;world_to_screen(unit-&gt;get_pos());
-          FloatVector2d dialog_pos = unit_pos + FloatVector2d(0, -60 - bbox.get_height());
-
-          spike.draw((int)unit_pos.x-15, (int)unit_pos.y-40);
-
-          CL_Display::fill_rect(CL_Rect(CL_Point(int(dialog_pos.x - bbox.get_width()/2 - 10),
-                                                 int(dialog_pos.y - 10)),
-                                        CL_Size(bbox.get_width()  + 20, 
-                                                bbox.get_height() + 20)),
-                                CL_Color(0,0,0, 100));
-
-          font.set_alignment(origin_top_center);
-          font.draw(int(dialog_pos.x), int(dialog_pos.y), i-&gt;second.text);
-        }
-    }
-}
-
-void
-CommunicationDialog::send(int unit_id, const std::string&amp; text)
-{
-  Message message;
-
-  message.time = CL_System::get_time();
-  message.text = text;
-
-  messages[unit_id] = message;
-}
-
-void
-CommunicationDialog::update (float delta)
-{
-  // Remove old messages from the display
-  for (Messages::iterator i = messages.begin(); i != messages.end(); ++i)
-    {
-      if (i-&gt;second.time + 2000 &lt; CL_System::get_time())
-        {
-          messages.erase(i);
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/controller_def.cpp (from rev 341, trunk/src/controller_def.cxx)


Property changes on: trunk/src/controller_def.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/controller_def.cxx
===================================================================
--- trunk/src/controller_def.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/controller_def.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,96 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;controller_def.hxx&quot;
-
-int
-ControllerDef::get_button_count()
-{
-  return 4;
-}
-
-int
-ControllerDef::get_axis_count()
-{
-  return 3;
-}
-
-std::string
-ControllerDef::button_id2name(int id)
-{
-  switch (id)
-    {
-    case PRIMARY_FIRE_BUTTON:
-      return &quot;primary-button&quot;;
-    case SECONDARY_FIRE_BUTTON:
-      return &quot;secondary-button&quot;;
-    case USE_BUTTON:
-      return &quot;use-button&quot;;
-    case MENU_BUTTON:
-      return &quot;menu-button&quot;;
-    default:
-      return &quot;unknown&quot;;
-    }
-}
-
-int
-ControllerDef::button_name2id(const std::string&amp; name)
-{
-  if      (name == &quot;primary-button&quot;)
-    return PRIMARY_FIRE_BUTTON;
-  else if (name == &quot;secondary-button&quot;)
-    return SECONDARY_FIRE_BUTTON;
-  else if (name == &quot;use-button&quot;)
-    return USE_BUTTON;
-  else if (name == &quot;menu-button&quot;)
-    return MENU_BUTTON;
-  else
-    return -1;
-}
-
-std::string
-ControllerDef::axis_id2name(int id)
-{
-  switch (id)
-    {
-    case ORIENTATION_AXIS:
-      return &quot;orientation-axis&quot;;
-    case ACCELERATE_AXIS:
-      return &quot;accelerate-axis&quot;;
-    case STRAFE_AXIS:
-      return &quot;strafe-axis&quot;;
-    default:
-      return &quot;unknown&quot;;
-    }
-}
-
-int 
-ControllerDef::axis_name2id(const std::string&amp; name)
-{
-  if (name == &quot;orientation-axis&quot;)
-    return ORIENTATION_AXIS;
-  else if (name == &quot;accelerate-axis&quot;)
-    return ACCELERATE_AXIS;
-  else if (name == &quot;strafe-axis&quot;)
-    return STRAFE_AXIS;
-  else
-    return -1;
-}
-
-/* EOF */

Copied: trunk/src/dijkstra_pathfinder.cpp (from rev 341, trunk/src/dijkstra_pathfinder.cxx)


Property changes on: trunk/src/dijkstra_pathfinder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/dijkstra_pathfinder.cxx
===================================================================
--- trunk/src/dijkstra_pathfinder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/dijkstra_pathfinder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,364 +0,0 @@
-//  $Id: dijkstra_pathfinder.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/core.h&gt;
-#include &lt;iostream&gt;
-#include &lt;unistd.h&gt;
-#include &quot;dijkstra_pathfinder.hxx&quot;
-
-DijkstraPathfinder::DijkstraPathfinder(Field&lt;int&gt;* arg_field)
-  : field(*arg_field),
-    node_field(field.get_width(), field.get_height())
-{
-}
-
-void
-DijkstraPathfinder::init(Pos&amp; arg_start, Pos&amp; arg_end)
-{
-  start = arg_start;
-  end   = arg_end;
-
-  path.clear();
-
-  if (start.x == end.x
-      &amp;&amp; start.y == end.y)
-    {
-      state = ALREADY_ON_GOAL;
-      return;
-    }
-
-  // initing node_field
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    for(int x = 0; x &lt; node_field.get_width(); ++x)
-      {
-        Node&amp; node = node_field(x,y);
-
-        node.visited = 0;
-        node.parent  = PARENT_NONE;
-        node.cost    = 0;
-        node.x = x;
-        node.y = y;
-      }
-  
-  open_nodes = OpenNodes();
-
-  state = WORKING;
-
-  Node&amp; node = node_field(start.x, start.y);
-  
-  node.visited = 1;
-  node.cost    = 0;
-  node.parent  = PARENT_GOAL;
-
-  make_neighbors_open(node);
-}
-
-bool
-DijkstraPathfinder::finished()
-{
-  return state != WORKING;
-}
-
-inline 
-void
-DijkstraPathfinder::process_one_open_node()
-{
-  if (open_nodes.empty())
-    {
-      state = NO_PATH_AVAILABLE;
-      return;
-    }
-  else
-    {
-      Node&amp; cnode = *open_nodes.top();
-      open_nodes.pop();
-
-      assert(cnode.visited == 0);
-      cnode.visited = 1;
-      
-      // Goal reached
-      if (int(cnode.x) == end.x &amp;&amp; int(cnode.y) == end.y)
-        {
-          construct_path();
-          state = PATH_FOUND;
-          return;
-        }
-     
-      make_neighbors_open(cnode);
-    }
-}
-
-void
-DijkstraPathfinder::make_neighbors_open(Node&amp; cnode)
-{
-  // FIXME: We don't handle neightbors with smaller cost here
-  /*
-    if n' is in Open
-    and n'.cost &lt; = newcost
-    continue
-  */
-  if (cnode.x &gt; 0)
-    {
-      if (field(cnode.x - 1, cnode.y) == 0) // node is walkable
-        {
-          Node&amp; west = node_field(cnode.x - 1, cnode.y);
-
-          if (west.visited == 0 &amp;&amp; west.parent == PARENT_NONE)
-            {
-              west.parent = PARENT_EAST;
-              //west.cost   = cnode.cost + 1;
-              west.cost = int(PosDistance(Pos(cnode.x - 1, cnode.y), end));
-              add_to_open_nodes(west);
-            }
-        }
-    }
-
-  if (int(cnode.x) &lt; node_field.get_width()-1  &amp;&amp; field(cnode.x+1, cnode.y) == 0)
-    {
-      Node&amp; east = node_field(cnode.x + 1, cnode.y);
-      if (east.visited == 0  &amp;&amp; east.parent == PARENT_NONE) 
-        {
-          east.parent = PARENT_WEST;
-          //east.cost   = cnode.cost + 1;
-          east.cost     = int(PosDistance(Pos(cnode.x + 1, cnode.y), end));
-          add_to_open_nodes(east);
-        }
-    }
-
-  if (cnode.y &gt; 0 &amp;&amp; field(cnode.x, cnode.y - 1) == 0)
-    {
-      Node&amp; north = node_field(cnode.x, cnode.y - 1);
-      if (north.visited == 0  &amp;&amp; north.parent == PARENT_NONE)
-        {
-          north.parent = PARENT_SOUTH;
-          //north.cost   = cnode.cost + 1;
-          north.cost     = int(PosDistance(Pos(cnode.x, cnode.y-1), end));
-          add_to_open_nodes(north);
-        }
-    }
-  
-  if (int(cnode.y) &lt; node_field.get_height() - 1  &amp;&amp; field(cnode.x, cnode.y+1) == 0)
-    {
-      Node&amp; south = node_field(cnode.x, cnode.y + 1);
-      if (south.visited == 0  &amp;&amp; south.parent == PARENT_NONE)
-        {
-          south.parent = PARENT_NORTH;
-          //south.cost   = cnode.cost + 1;
-          south.cost     = int(PosDistance(Pos(cnode.x, cnode.y+1), end));
-          add_to_open_nodes(south);
-        }
-    }
-}
-
-inline void
-DijkstraPathfinder::add_to_open_nodes(Node&amp; cnode)
-{
-  assert(cnode.parent != PARENT_NONE);
-  open_nodes.push(&amp;cnode);
-}
-
-void
-DijkstraPathfinder::display()
-{
-  //std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-  for(int y = 0; y &lt; node_field.get_height(); ++y)
-    {
-      for(int x = 0; x &lt; node_field.get_width(); ++x)
-        {
-          if (0)
-            {
-              if (node_field(x,y).parent == PARENT_SOUTH)
-                std::cout &lt;&lt; &quot;s&quot;;
-              else if (node_field(x,y).parent == PARENT_WEST)
-                std::cout &lt;&lt; &quot;w&quot;;
-              else if (node_field(x,y).parent == PARENT_EAST)
-                std::cout &lt;&lt; &quot;e&quot;;
-              else if (node_field(x,y).parent == PARENT_NORTH)
-                std::cout &lt;&lt; &quot;n&quot;;
-              else
-                std::cout &lt;&lt; &quot; &quot;;
-            }
-          if (is_path_node(x,y))
-            std::cout &lt;&lt; &quot;#&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-
-          if (x == start.x &amp;&amp; y == start.y)
-            std::cout &lt;&lt; &quot;S&quot;;
-          else if (x == end.x &amp;&amp; y == end.y)
-            std::cout &lt;&lt; &quot;G&quot;;
-          else if (field(x,y) != 0)
-            std::cout &lt;&lt; &quot;O&quot;;
-          else if (node_field(x,y).visited)
-            std::cout &lt;&lt; &quot;.&quot;;
-          else
-            std::cout &lt;&lt; &quot; &quot;;
-        }
-      std::cout &lt;&lt; std::endl;
-    }
-  std::cout &lt;&lt; &quot;OpenNodes: &quot; &lt;&lt; open_nodes.size() &lt;&lt; std::endl;
-  std::cout &lt;&lt; &quot;State: &quot; &lt;&lt; state &lt;&lt; std::endl;
-}
-
-bool
-DijkstraPathfinder::is_path_node(int x, int y)
-{
-  if (path.empty()) 
-    return false;
-  else
-    {
-      for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-          if (i-&gt;x == x &amp;&amp; i-&gt;y == y)
-            return true;
-        }
-      return false;
-    }
-}
-
-DijkstraPathfinder::Node&amp;
-DijkstraPathfinder::resolve_parent(Node&amp; node)
-{
-  if (node.parent == PARENT_NONE)
-    {
-      display();
-      assert(false);
-    }
-
-  switch(node.parent)
-    {
-    case PARENT_NORTH:
-      return node_field(node.x, node.y - 1);
-    case PARENT_SOUTH:
-      return node_field(node.x, node.y + 1);
-    case PARENT_EAST:
-      return node_field(node.x + 1, node.y);
-    case PARENT_WEST:
-      return node_field(node.x - 1, node.y);
-    default:
-      assert(!&quot;resolve path error&quot;);
-    }
-  assert(!&quot;resolve path error2&quot;);
-  return *(Node*)0;
-}
-
-void
-DijkstraPathfinder::construct_path()
-{
-  //std::cout &lt;&lt; &quot;Construct path&quot; &lt;&lt; std::endl;
-  // We construct the path reverse, so we start at the end
-  Node&amp; current_node = node_field(end.x, end.y);
-
-  while(current_node.parent != PARENT_GOAL)
-    {
-      //std::cout &lt;&lt; &quot;&gt;&gt;&gt; Node: &quot; &lt;&lt; current_node.x &lt;&lt; &quot; &quot; &lt;&lt; current_node.y &lt;&lt; std::endl;
-
-      path.push_back(Pos(current_node.x, current_node.y));
-      current_node = resolve_parent(current_node);
-    }
-}
-
-#ifdef TESTME
-/*
-  .2msec for 256x256 grid
-*/
-int main()
-{
-  CL_SetupCore::init();
-
-  srand(time(NULL));
-  Field&lt;int&gt; field(80, 50);
-
-  unsigned int start_time = CL_System::get_time();
-  unsigned int end_time;
-
-  for(int y = 0; y &lt; field.get_height(); ++y)
-    for(int x = 0; x &lt; field.get_width(); ++x)
-      {
-        field(x,y) = (rand()%100) &gt; 40 ? 0 : 1;
-      }
-
-  DijkstraPathfinder pathfinder(&amp;field);
-
-  Pos start;
-  Pos end;
-
-  for(int count = 0; count &lt; 1000; ++count)
-    {
-  start.x = rand()%field.get_width();
-  start.y = rand()%field.get_height();
-  
-  end.x = rand()%field.get_width();
-  end.y = rand()%field.get_height();
-
-      pathfinder.init(start, end);
-      //pathfinder.display();
-
-      //int i = 0;
-      //std::cout &lt;&lt; &quot;Start: &quot; &lt;&lt; start.x &lt;&lt; &quot; &quot; &lt;&lt; start.y &lt;&lt; std::endl;
-      //std::cout &lt;&lt; &quot;End:   &quot; &lt;&lt; end.x &lt;&lt; &quot; &quot; &lt;&lt; end.y &lt;&lt; std::endl;
-
-      while(!pathfinder.finished())
-        {
-          //for(int i = 0; i &lt; 10 &amp;&amp; !pathfinder.finished(); ++i)
-          pathfinder.process_one_open_node();
-
-          //getchar();
-        }
-      if (1)
-        {
-          std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-          pathfinder.display();
-          getchar();
-        }
- 
-      //pathfinder.display();
-      
-      /*
-        if (pathfinder.get_state() != DijkstraPathfinder::PATH_FOUND)
-        {
-        std::cout &lt;&lt; &quot;No Path could be found&quot; &lt;&lt; std::endl;
-        }
-        else
-        {
-        std::cout &lt;&lt; &quot;Found path&quot; &lt;&lt; std::endl;
-        std::vector&lt;Pos&gt;&amp; path = pathfinder.get_path();
-        for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-        std::cout &lt;&lt; &quot;[&quot; &lt;&lt; i-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; i-&gt;y &lt;&lt; &quot;] &quot;;
-        }       
-        std::cout &lt;&lt; std::endl;
-        }
-      */
-
-      //      getchar();
-      //std::cout &lt;&lt; &quot;round: &quot; &lt;&lt; ++i &lt;&lt; std::endl;
-    }
-  end_time = CL_System::get_time();
-  std::cout &lt;&lt; &quot;Msec: &quot; &lt;&lt; end_time - start_time &lt;&lt; std::endl;
-
-  CL_SetupCore::deinit();
-}
-#endif
-
-// Local Variables:
-// compile-command: &quot;g++-3.2 -DTESTME -g -Wall -O2 dijkstra_pathfinder.cxx  -o dijkstra_pathfinder -lclanCore&quot;
-// End:
-
-/* EOF */

Copied: trunk/src/display/drawing_context.cpp (from rev 342, trunk/src/display/drawing_context.cxx)


Property changes on: trunk/src/display/drawing_context.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/src/display/drawing_context.cxx
===================================================================
--- trunk/src/display/drawing_context.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/display/drawing_context.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,220 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &lt;ClanLib/Display/sprite.h&gt;
-#include &lt;ClanLib/Display/graphic_context.h&gt;
-#include &lt;iostream&gt;
-#include &quot;drawing_context.hxx&quot;
-
-struct DrawingRequestsSorter
-{
-  bool operator()(DrawingRequest* a, DrawingRequest* b) {
-    return a-&gt;get_z_pos() &lt; b-&gt;get_z_pos();
-  }
-};
-
-class FillScreenDrawingRequest : public DrawingRequest
-{
-private:
-  CL_Color color;
-public:
-  FillScreenDrawingRequest(const CL_Color&amp; color_) 
-    : DrawingRequest(CL_Vector(0, 0, -1000.0f)), color(color_)
-  {
-  }
-  virtual ~FillScreenDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    gc-&gt;clear(color);
-  }
-};
-
-class SpriteDrawingRequest : public DrawingRequest
-{
-private:
-  CL_Sprite sprite;
-
-public:
-  SpriteDrawingRequest(const CL_Sprite&amp; sprite_, const CL_Vector&amp; pos_)
-    : DrawingRequest(pos_),
-      sprite(sprite_)
-  {}
-  virtual ~SpriteDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    sprite.draw(static_cast&lt;int&gt;(pos.x), static_cast&lt;int&gt;(pos.y), gc);
-  }
-};
-
-class TextDrawingRequest : public DrawingRequest
-{
-private:
-  std::string text;
-public:
-  TextDrawingRequest(const std::string&amp; text_, const CL_Vector&amp; pos_)
-    : DrawingRequest(pos_),
-      text(text_)
-  {}
-  virtual ~TextDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    // FIXME: not implemented
-  }
-};
-
-DrawingContext::DrawingContext()
-{
-  translate_stack.push_back(CL_Pointf(0, 0));
-}
-
-void
-DrawingContext::render(CL_GraphicContext* gc)
-{
-  std::stable_sort(drawingrequests.begin(), drawingrequests.end(), DrawingRequestsSorter());
-  
-  for(DrawingRequests::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      (*i)-&gt;draw(gc);
-    }
-}
-
-void
-DrawingContext::clear()
-{
-  for(DrawingRequests::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      delete *i;
-    }
-  drawingrequests.clear();
-}
-
-void
-DrawingContext::draw(DrawingRequest* request)
-{
-  drawingrequests.push_back(request);
-}
-
-void
-DrawingContext::draw(const CL_Sprite&amp;   sprite,  float x, float y, float z)
-{ // FIXME: This should get flattend down to a simple texture draw
-  // command for easier sorting after texture-id/alpha
-  draw(new SpriteDrawingRequest(sprite, CL_Vector(translate_stack.back().x + x,
-                                                  translate_stack.back().y + y,
-                                                  z)));
-}
-
-void
-DrawingContext::draw(const std::string&amp; text,    float x, float y, float z)
-{ 
-  draw(new TextDrawingRequest(text, CL_Vector(x, y, z)));
-}
-
-void
-DrawingContext::draw_line (float x1, float y1, float x2, float y2, 
-                           const CL_Color&amp; color)
-{
-}
-
-void
-DrawingContext::draw_fillrect (float x1, float y1, float x2, float y2, 
-		      const CL_Color&amp; color)
-{
-}
-
-void
-DrawingContext::draw_rect (float x1, float y1, float x2, float y2, 
-		  const CL_Color&amp; color)
-{
-}
-
-void
-DrawingContext::draw_pixel (float x_pos, float y_pos, 
-		   const CL_Color&amp; color)
-{
-}
-
-void
-DrawingContext::draw_circle (float x_pos, float y_pos, float radius,
-                             const CL_Color&amp; color)
-{
-}
-
-/** Draws an arc, starting from angle_start to angle_end in
-      counterclockwise direction. Angles are taken in radian */
-void
-DrawingContext::draw_arc (float x_pos, float y_pos, float radius, float angle_start, float angle_end,
-                          const CL_Color&amp; color)
-{
-}
-
-void
-DrawingContext::fill_screen(const CL_Color&amp; color)
-{
-  draw(new FillScreenDrawingRequest(color));
-}
-
-void
-DrawingContext::rotate(float angel)
-{
-  // FIXME: not implemented
-}
-
-void
-DrawingContext::scale(float x, float y)
-{
-  // FIXME: not implemented
-}
-
-void
-DrawingContext::translate(float x, float y)
-{
-  translate_stack.back().x += x;
-  translate_stack.back().y += y;
-}
-
-void
-DrawingContext::push_modelview()
-{
-  translate_stack.push_back(translate_stack.back());
-}
-
-void
-DrawingContext::pop_modelview()
-{
-  translate_stack.pop_back();
-  assert(!translate_stack.empty());
-}
-
-void
-DrawingContext::reset_modelview()
-{
-  translate_stack.clear();
-  translate_stack.push_back(CL_Pointf(0, 0));
-}
-
-CL_Rect
-DrawingContext::get_clip_rect()
-{
-  return CL_Rect(CL_Point(static_cast&lt;int&gt;(translate_stack.back().x),
-                          static_cast&lt;int&gt;(translate_stack.back().y)),
-                 CL_Size(800, 600));
-}
-
-/* EOF */

Copied: trunk/src/display/scene_context.cpp (from rev 342, trunk/src/display/scene_context.cxx)


Property changes on: trunk/src/display/scene_context.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/src/display/scene_context.cxx
===================================================================
--- trunk/src/display/scene_context.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/display/scene_context.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,149 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/display.h&gt;
-#include &lt;ClanLib/gl.h&gt;
-#include &quot;scene_context.hxx&quot;
-
-class SceneContextImpl
-{
-public:
-  DrawingContext color;
-  DrawingContext light;
-  DrawingContext highlight; 
-
-  CL_OpenGLSurface lightmap;
-  CL_Canvas        canvas;
-
-  SceneContextImpl() 
-    : lightmap(CL_PixelBuffer(200, 
-                              150,
-                              200*4, CL_PixelFormat::rgba8888)),
-      canvas(lightmap)
-  {
-    canvas.get_gc()-&gt;set_scale(0.25, 0.25);
-  }
-};
-
-SceneContext::SceneContext()
-{
-  impl = new SceneContextImpl();
-}
-
-SceneContext::~SceneContext()
-{
-  delete impl;
-}
-
-DrawingContext&amp;
-SceneContext::color()
-{
-  return impl-&gt;color; 
-}
-
-DrawingContext&amp;
-SceneContext::light()
-{ 
-  return impl-&gt;light; 
-}
-
-DrawingContext&amp;
-SceneContext::highlight()
-{ 
-  return impl-&gt;highlight; 
-}
-
-
-/** Translate the drawing context */
-void
-SceneContext::translate(float x, float y)
-{
-  impl-&gt;color.translate(x, y);
-  impl-&gt;light.translate(x, y);
-  impl-&gt;highlight.translate(x, y);
-}
-
-/** Set the rotation of the drawing context */
-void
-SceneContext::rotate(float angel)
-{
-  impl-&gt;color.rotate(angel);
-  impl-&gt;light.rotate(angel);
-  impl-&gt;highlight.rotate(angel);
-}
-
-/** Set the scaling of the drawing context */
-void
-SceneContext::scale(float x, float y)
-{
-  impl-&gt;color.scale(x, y);
-  impl-&gt;light.scale(x, y);
-  impl-&gt;highlight.scale(x, y);
-}
-
-void
-SceneContext::push_modelview()
-{
-  impl-&gt;color.push_modelview();
-  impl-&gt;light.push_modelview();
-  impl-&gt;highlight.push_modelview();
-}
-
-void
-SceneContext::pop_modelview()
-{
-  impl-&gt;color.pop_modelview();
-  impl-&gt;light.pop_modelview();
-  impl-&gt;highlight.pop_modelview();
-}
-
-void
-SceneContext::reset_modelview()
-{
-  impl-&gt;color.reset_modelview();
-  impl-&gt;light.reset_modelview();
-  impl-&gt;highlight.reset_modelview();
-}
-
-void
-SceneContext::render()
-{
-  // Render all buffers
-  // FIXME: Render all to pbuffer for later combining of them
-  impl-&gt;color.render(0);
-  
-  impl-&gt;light.render(impl-&gt;canvas.get_gc());
-  impl-&gt;canvas.sync_surface();
-
-  //impl-&gt;lightmap.set_blend_func(blend_src_alpha, blend_one);
-  impl-&gt;lightmap.set_blend_func(blend_dest_color, blend_zero);
-  //GL_DST_COLOR, GL_ZERO
-  impl-&gt;lightmap.set_scale(4.0f, 4.0f);
-  impl-&gt;lightmap.draw();
-  impl-&gt;canvas.get_gc()-&gt;clear();
-
-  impl-&gt;highlight.render(0);
-
-  // Clear all DrawingContexts
-  impl-&gt;color.clear();
-  impl-&gt;light.clear();
-  impl-&gt;highlight.clear();
-}
-
-/* EOF */

Copied: trunk/src/display_manager.cpp (from rev 341, trunk/src/display_manager.cxx)


Property changes on: trunk/src/display_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/display_manager.cxx
===================================================================
--- trunk/src/display_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/display_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,151 +0,0 @@
-//  $Id: display_manager.cxx,v 1.6 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;assert.hxx&quot;
-#include &quot;help.hxx&quot;
-#include &quot;radar.hxx&quot;
-#include &quot;menu.hxx&quot;
-#include &quot;level_map.hxx&quot;
-#include &quot;vehicle_status.hxx&quot;
-#include &quot;message_buffer.hxx&quot;
-#include &quot;communication_dialog.hxx&quot;
-#include &quot;display_manager.hxx&quot;
-
-extern Player*  player;
-DisplayManager* DisplayManager::current_ = 0;
-
-void
-DisplayManager::init()
-{
-  AssertMsg(current_ == 0, &quot;DisplayManager already initialized, this must not be done more than once!&quot;);
-  current_ = new DisplayManager();
-}
-
-void
-DisplayManager::deinit()
-{
-  delete current_;
-}
-
-DisplayManager::DisplayManager()
-{
-  level_map = new LevelMap();
-
-  screen.add(message_buffer = new MessageBuffer(CL_Display::get_width()/2, CL_Display::get_height() - 30));
-  help = new Help();
-  screen.add(radar = new Radar(FloatVector2d(64, 64), player));
-  screen.add(new CommunicationDialog());
-  screen.add(vehicle_status = new VehicleStatus());
-}
-
-DisplayManager::~DisplayManager()
-{
-}
-
-void
-DisplayManager::add(GuiObj* obj)
-{
-  screen.add(obj);
-}
-
-void
-DisplayManager::update(float delta)
-{
-  screen.update(delta);
-}
-
-void
-DisplayManager::draw(CL_GraphicContext&amp; gc)
-{
-  screen.draw(gc);
-}
-
-void
-DisplayManager::show_levelmap()
-{
-  screen.add(level_map);
-}
-
-void
-DisplayManager::hide_levelmap()
-{
-  screen.remove(level_map);
-}
-
-LevelMap*
-DisplayManager::get_levelmap()
-{
-  if (screen.has(level_map))
-    return level_map;
-  else
-    return 0;
-}
-
-void
-DisplayManager::show_help()
-{
-  screen.add(help);
-}
-
-void
-DisplayManager::hide_help()
-{
-  screen.remove(help);
-}
-
-void
-DisplayManager::push_menu(Menu* arg_menu)
-{
-  //hide_menu(); // Hide current menu
-  if (!menu.empty())
-    {
-      screen.remove(menu.back());
-    }
-
-  menu.push_back(arg_menu);
-  screen.add(arg_menu);
-}
-
-void
-DisplayManager::pop_menu()
-{
-  if (!menu.empty())
-    {
-      screen.remove(menu.back()); 
-      menu.pop_back();
-      if (!menu.empty())
-        {
-          screen.add(menu.back());
-        }
-    }
-}
-  
-void
-DisplayManager::hide_menu()
-{
-  if (!menu.empty())
-    {
-      for (Menus::iterator i = menu.begin(); i != menu.end(); ++i)
-        screen.remove(*i);
-      menu.clear();
-    }
-}
-
-/* EOF */

Copied: trunk/src/draw_circle.cpp (from rev 341, trunk/src/draw_circle.cxx)


Property changes on: trunk/src/draw_circle.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/draw_circle.cxx
===================================================================
--- trunk/src/draw_circle.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/draw_circle.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,54 +0,0 @@
-//  $Id: draw_circle.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;draw_circle.hxx&quot;
-
-int main()
-{
-  Field&lt;int&gt; field(50, 50);
-  srand(time(NULL));
-  //draw_circle(field, 20, 20, 12);
-  draw_fill_circle(field, 20, 20, 12);
-  //draw_fill_circle(field, 30, 30, 6);
-
-  for(int count = 0; count &lt; 40; ++count)
-    draw_fill_circle(field, (rand()%29)+10, (rand()%29)+10, rand()%9);
-
-  //draw_fill_circle(field, 20, 20, 0);
-  //draw_fill_circle(field, 20, 20, 2);
-
-  for(int y = 0; y &lt; field.get_height(); ++y)
-    {
-      for(int x = 0; x &lt; field.get_width(); ++x)
-        {
-          if (field(x,y) == 0)
-            std::cout &lt;&lt; &quot; .&quot;;
-          else 
-            std::cout &lt;&lt; &quot; &quot; &lt;&lt; field(x,y);
-        }
-      std::cout &lt;&lt; std::endl;
-    }
-}
-
-// Local Variables:
-// compile-command: &quot;g++-3.2 -DTESTME -Wall -O2 draw_circle.cxx  -o draw_circle -lclanCore&quot;
-// End:
-
-/* EOF */

Copied: trunk/src/editor/editor.cpp (from rev 341, trunk/src/editor/editor.cxx)


Property changes on: trunk/src/editor/editor.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/editor/editor.cxx
===================================================================
--- trunk/src/editor/editor.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/editor/editor.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,24 +0,0 @@
-//  $Id: editor.cxx,v 1.1 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;editor.hxx&quot;
-
-
-
-/* EOF */

Copied: trunk/src/energie.cpp (from rev 341, trunk/src/energie.cxx)


Property changes on: trunk/src/energie.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/energie.cxx
===================================================================
--- trunk/src/energie.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/energie.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,79 +0,0 @@
-//  $Id: energie.cxx,v 1.8 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;color.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;energie.hxx&quot;
-
-Energie::Energie ()
-{
-  max_energie = 100.0f;
-  energie = max_energie;
-  last_change = 0;
-}
-
-void
-Energie::set_max_energie(float arg_max_energie)
-{
-  max_energie = arg_max_energie;
-  energie = max_energie;
-}
-
-Energie::Energie (int arg_energie) :
-  max_energie (arg_energie),
-  energie (arg_energie),
-  last_change (0)
-{
-  
-}
-
-void
-Energie::draw (View&amp; view, int x_pos, int y_pos)
-{
-  int time_diff = CL_System::get_time () - last_change ;
-
-  float ratio = energie / max_energie;
-  
-  if (ratio &lt; 0)
-    ratio = 0;
-
-  //  std::cout &lt;&lt; &quot;Ratio: &quot; &lt;&lt; ratio &lt;&lt; std::endl;
-
-  if (time_diff &lt; 1000
-      &amp;&amp; CL_System::get_time () &gt; 2000)
-    {
-      // Black border rectangle
-      view.get_sc().color().draw_fillrect(x_pos - 32, y_pos - 5,
-                                  x_pos + 32, y_pos + 5,
-                                  CL_Color(CL_Colorf(0.0f, 0.0f, 0.0f,
-                                                     (1000.0f - float(time_diff))/1000.0f * 0.8f)));
-      
-      // Energie bar
-      view.get_sc().color().draw_fillrect(x_pos - 30, y_pos - 3,
-                                  x_pos - 30 + (ratio * 60),
-                                  y_pos + 3,
-                                  CL_Color(CL_Colorf(1.0f - energie/float(max_energie),
-                                                     ratio,
-                                                     0.0f, 
-                                                     (1000.0f - float(time_diff)) / 1000.0f * 0.9f)));
-      //std::cout &lt;&lt; &quot;Alpha: &quot; &lt;&lt; float(time_diff) / 500.0 &lt;&lt; std::endl;
-    }
-}
-
-/* EOF */

Copied: trunk/src/explosion.cpp (from rev 341, trunk/src/explosion.cxx)


Property changes on: trunk/src/explosion.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/explosion.cxx
===================================================================
--- trunk/src/explosion.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/explosion.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,122 +0,0 @@
-//  $Id: explosion.cxx,v 1.10 2003/06/06 09:49:00 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;shockwave.hxx&quot;
-#include &quot;explosion.hxx&quot;
-#include &quot;generic/random.hxx&quot;
-#include &quot;sound/sound.hxx&quot;
-#include &quot;particles/explosion_particle.hxx&quot;
-
-Explosion::Explosion (const FloatVector2d&amp; arg_pos, Size arg_size) 
-  : is_drawn (false),
-    pos (arg_pos),
-    en_size (arg_size)
-{
-  new_particle_time = 0.0f;
-
-  switch (en_size)
-    {
-    case SMALL:
-      lifetime = .5;
-      size = .6;
-      break;
-    case MEDIUM:
-      lifetime = .5;
-      size = 1.0f;
-      break;
-    case LARGE:
-      lifetime = 25;
-      GameWorld::current()-&gt;add(new Shockwave(pos));
-      size = 2;
-      PingusSound::play_sound(&quot;explosion&quot;);
-      break;
-    }
-
-  lifetime = .5f;
-
-  new_particle_time = 1.0f;
-
-};
-
-void 
-Explosion::draw (View&amp; view) 
-{
-}
-  
-void 
-Explosion::update (float delta) 
-{
-  lifetime -= delta;
-
-  new_particle_time += delta;
-  
-  if (new_particle_time &gt; 0.200)
-    {
-      for (int i = 0; i &lt; 4; ++i)
-	{     
-	  switch (en_size)
-	    {
-	    case LARGE:
-	      GameWorld::current()-&gt;add (new ExplosionParticle(FloatVector2d (pos.x + (rand()%40 - 20), 
-                                                                          pos.y + (rand()%40 - 20)),
-                                                               FloatVector2d (rand ()%20 - 10, rand ()%20 - 10), 
-                                                               Random::frand(size) + 1.0)); 
-	      GameWorld::current()-&gt;add (new ExplosionParticle(FloatVector2d (pos.x + (rand()%40 - 20), 
-                                                                          pos.y + (rand()%40 - 20)),
-                                                               FloatVector2d (rand ()%20 - 10, rand ()%20 - 10), 
-                                                               Random::frand(size) + 1.0)); 
-	      break;
-
-            case MEDIUM:
-              GameWorld::current()-&gt;add (new ExplosionParticle(FloatVector2d (pos.x + (rand()%10 - 5), 
-                                                                          pos.y + (rand()%10 - 5)),
-                                                               FloatVector2d (rand ()%20 - 10, rand ()%20 - 10), 
-                                                               Random::frand(size) + .5)); 
-              break;
-
-	    default:
-              GameWorld::current()-&gt;add (new ExplosionParticle(FloatVector2d (pos.x + (rand()%10 - 5), 
-                                                                          pos.y + (rand()%10 - 5)),
-                                                               FloatVector2d (rand ()%20 - 10, rand ()%20 - 10), 
-                                                               Random::frand(size) + .01)); 
-	      break;
-	    }
-	  lifetime = 0;
-	}
-      
-      new_particle_time = 0;
-    }
-}
-
-bool 
-Explosion::removable () 
-{
-  //std::cout &lt;&lt; &quot;Lifetime: &quot; &lt;&lt; lifetime &lt;&lt; std::endl;
-
-  return lifetime &lt;= 0;
-}
-
-float 
-Explosion::get_z_pos () 
-{
-  return 115; 
-}
-
-
-/* EOF */

Copied: trunk/src/feuerkraft.cpp (from rev 341, trunk/src/feuerkraft.cxx)


Property changes on: trunk/src/feuerkraft.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/feuerkraft.cxx
===================================================================
--- trunk/src/feuerkraft.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/feuerkraft.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,221 +0,0 @@
-//  $Id: feuerkraft.cxx,v 1.55 2003/10/31 23:24:41 grumbel Exp $
-// 
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;config.h&gt;
-#include &lt;iostream&gt;
-#include &lt;ClanLib/gl.h&gt;
-#include &lt;ClanLib/Display/setupdisplay.h&gt;
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;ClanLib/Display/keyboard.h&gt;
-#include &lt;ClanLib/Display/Providers/provider_factory.h&gt;
-#include &lt;ClanLib/Display/keys.h&gt;
-#include &lt;ClanLib/GL/setupgl.h&gt;
-#include &lt;ClanLib/core.h&gt;
-#include &lt;libguile.h&gt;
-#include &lt;time.h&gt;
-
-#include &quot;feuerkraft_error.hxx&quot;
-#include &quot;fonts.hxx&quot;
-#include &quot;input/input_manager.hxx&quot;
-#include &quot;game_session_manager.hxx&quot;
-#include &quot;keyboard_manager.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;path_manager.hxx&quot;
-#include &quot;globals.hxx&quot;
-#include &quot;sound/sound.hxx&quot;
-#include &quot;command_line_arguments.hxx&quot;
-#include &quot;guile.hxx&quot;
-#include &quot;feuerkraft.hxx&quot;
-
-//#define WITH_STATIC_READLINE 1
-
-#ifdef WITH_STATIC_READLINE
-extern &quot;C&quot; void scm_init_readline();
-#endif
-extern &quot;C&quot; void SWIG_init(void);
-          
-
-// Global Instance of the main class
-Feuerkraft feuerkraft;
-CommandLineArguments* args;
-
-Feuerkraft::Feuerkraft()
-{
-  args = 0;
-}
-
-Feuerkraft::~Feuerkraft()
-{
-  delete args;
-}
-
-void 
-Feuerkraft::init()
-{
-  // Init Guile
-  scm_init_guile ();
-  Guile::enable_debug();
-  Guile::enable_readline();
-
-  // Init Swig
-  SWIG_init();
-
-  // Init ClanLib
-  CL_SetupCore::init();
-  CL_SetupDisplay::init();
-  CL_SetupGL::init();
-
-  // Init Sound Subsystem
-  music_enabled = args-&gt;music_enabled;
-  sound_enabled = args-&gt;sound_enabled;
-  PingusSound::init();
-
-  // Init pseudo random number generator
-  srand (time (0));
-
-  // Find the location of Feuerkrafts data files (images, sounds, etc.) 
-  if (!args-&gt;datadir.empty())
-    {
-    }
-  else
-    {
-      path_manager.add_path(CL_System::get_exe_path() + &quot;../data&quot;);
-      path_manager.add_path(&quot;../data&quot;);
-      path_manager.add_path(&quot;data&quot;);
-      path_manager.add_path(&quot;share/games/feuerkraft&quot;);
-      path_manager.add_path(&quot;../share/games/feuerkraft&quot;);
-      path_manager.find_path(&quot;feuerkraft.xml&quot;);     
-    }
-
-  // Create the main window
-  window = new CL_DisplayWindow(PACKAGE_STRING,
-                                args-&gt;screen_width, args-&gt;screen_height, 
-                                args-&gt;fullscreen);
-  CL_Display::set_current_window (window);
-  CL_Display::clear();
-
-  resources = new ResourceManager ();
-  Fonts::init();
-
-  KeyboardManager::instance();
-
-  if (args-&gt;playback_file.empty())
-    {
-      if (args-&gt;controller_file.empty())
-        {
-          InputManager::init(path_manager.complete(&quot;controller/keyboard.scm&quot;));
-        }
-      else
-        {
-          InputManager::init(args-&gt;controller_file);
-        }
-    }
-  else
-    {
-      InputManager::init_playback(args-&gt;playback_file);
-    }
-
-  if (!args-&gt;event_record_file.empty())
-    InputManager::setup_recorder(args-&gt;event_record_file);
-}
-
-void 
-Feuerkraft::deinit()
-{
-  Fonts::deinit();
-  PingusSound::deinit();
-
-  delete window;
-
-  CL_SetupGL::deinit();
-  CL_SetupDisplay::deinit();
-  CL_SetupCore::deinit();
-}
-	
-int
-Feuerkraft::main(int argc, char** argv)
-{
-  // Create a console window for text-output if not available
-  CL_ConsoleWindow console(&quot;Console&quot;);
-  console.redirect_stdio();
-  
-  try
-    {
-      // Make arguments accessible for all member functions
-      args = new CommandLineArguments(argc, argv);
-
-      // Init all subsystems
-      init();
-      
-      if (args-&gt;mission_file.empty())
-        args-&gt;mission_file = path_manager.complete(&quot;missions/airport.feu&quot;);
-
-      CL_Slot slot = CL_Keyboard::sig_key_down().connect(this, &amp;Feuerkraft::key_down);
-
-      GameSessionManager::instance()-&gt;load(args-&gt;mission_file);
-      GameSessionManager::instance()-&gt;run();
-
-      // Shutdown everything
-      deinit();
-    }
-  catch (CL_Error&amp; err)
-    {
-      std::cout &lt;&lt; &quot;CL_Error: &quot; &lt;&lt; err.message.c_str() &lt;&lt; std::endl;
-    }
-  catch (FeuerkraftError&amp; err)
-    {
-      std::cout &lt;&lt; &quot;FeuerkraftError: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;
-    }
-  catch (std::exception&amp; err)
-    {
-      std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;
-    }
-  catch (...)
-    {
-      std::cout &lt;&lt; &quot;Bug: Unknown exception catched, don't know what to do&quot; &lt;&lt; std::endl;
-    }
-
-  // Display console close message and wait for a key
-  console.display_close_message();
-
-  return 0;
-}
-
-void
-Feuerkraft::key_down(const CL_InputEvent&amp; event)
-{
-  if (event.id == CL_KEY_F12)
-    {
-      std::string filename = &quot;screenshot.jpg&quot;;
-      std::cout &lt;&lt; &quot;Saving screenshot to: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-      CL_ProviderFactory::save(CL_Display::get_front_buffer(),
-                               filename);
-    } 
-  else if (event.id == CL_KEY_F11)
-    {
-      if (CL_Display::is_fullscreen())
-        CL_Display::set_windowed();
-      else
-        CL_Display::set_fullscreen(CL_Display::get_width(),
-                                   CL_Display::get_height(),
-                                   32);
-    }
-}
-
-// EOF //

Copied: trunk/src/fonts.cpp (from rev 341, trunk/src/fonts.cxx)


Property changes on: trunk/src/fonts.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/fonts.cxx
===================================================================
--- trunk/src/fonts.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/fonts.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,38 +0,0 @@
-//  $Id: fonts.cxx,v 1.3 2003/06/05 21:17:11 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;resource_manager.hxx&quot;
-#include &quot;fonts.hxx&quot;
-
-namespace Fonts {
-
-CL_Font font;
-
-void init()
-{
-  font = resources-&gt;get_font(&quot;font&quot;);
-}
-
-void deinit(){
-  // nothing to do
-}
-
-} // namespace Fonts
-
-/* EOF */

Copied: trunk/src/game_delta.cpp (from rev 341, trunk/src/game_delta.cxx)


Property changes on: trunk/src/game_delta.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_delta.cxx
===================================================================
--- trunk/src/game_delta.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_delta.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,28 +0,0 @@
-//  $Id: game_delta.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;game_delta.hxx&quot;
-
-float 
-GameDelta::get_time ()
-{
-  return time_delta; 
-}
-
-/* EOF */

Copied: trunk/src/game_mission.cpp (from rev 341, trunk/src/game_mission.cxx)


Property changes on: trunk/src/game_mission.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_mission.cxx
===================================================================
--- trunk/src/game_mission.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_mission.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,84 +0,0 @@
-//  $Id: game_mission.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;guile/gh.h&gt;
-#include &lt;iostream&gt;
-#include &quot;guile.hxx&quot;
-#include &quot;game_mission.hxx&quot;
-#include &quot;game_world.hxx&quot;
-
-GameMission::GameMission (SCM desc)
-  : creation_time (0),
-    world (0)    
-{
-  if (SCM_NULLP(desc))
-    {
-      std::cout &lt;&lt; &quot;GameMission: SCM contains no data&quot; &lt;&lt; std::endl;
-      // FIXME: Error handling
-    }
-
-  SCM symbol = SCM_CAAR(desc);
- 
-  if (Guile::equal_p(scm_str2symbol(&quot;feuerkraft-mission&quot;), symbol))
-    {
-      std::cout &lt;&lt; &quot;GameMission: SCM is mission data&quot; &lt;&lt; std::endl;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;GameMission: SCM is not mission-data&quot; &lt;&lt; std::endl;
-      // FIXME: Error handling
-    }
-  
-  desc = SCM_CDR(desc);
-
-  while (!SCM_NULLP(desc))
-    {
-      // Current line
-      SCM symbol = SCM_CAAR(desc);
-      SCM data   = SCM_CDAR(desc);
-
-      if (Guile::equal_p(scm_str2symbol(&quot;author-name&quot;), symbol))
-	{
-	  author_name = Guile::scm2string(SCM_CADR(data));
-	}
-      else if (Guile::equal_p(scm_str2symbol(&quot;author-email&quot;), symbol))
-	{
-	  author_email = Guile::scm2string(SCM_CADR(data));
-	}
-      else if (Guile::equal_p(scm_str2symbol(&quot;creation-time&quot;), symbol))
-	{
-	  creation_time = gh_scm2int(SCM_CADR(data));
-	}
-      else if (Guile::equal_p(scm_str2symbol(&quot;world&quot;), symbol))
-	{
-	  
-	}
-      
-      // Goto next line
-      desc = SCM_CDR(desc);
-    }
-}
-
-GameMission::~GameMission ()
-{
-  delete world;
-}
-
-
-/* EOF */

Copied: trunk/src/game_obj.cpp (from rev 341, trunk/src/game_obj.cxx)


Property changes on: trunk/src/game_obj.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_obj.cxx
===================================================================
--- trunk/src/game_obj.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_obj.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,52 +0,0 @@
-//  $Id: game_obj.cxx,v 1.6 2003/06/18 13:03:13 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;property_set.hxx&quot;
-#include &quot;game_obj.hxx&quot;
-
-GameObj::GameObj()
-  : id(-1),
-    hidden(false),
-    remove_me (false)
-{
-  properties = new PropertySet();
-  properties-&gt;register_int(&quot;id&quot;, &amp;id);
-  properties-&gt;register_bool(&quot;remove-me&quot;, &amp;remove_me);
-  properties-&gt;register_bool(&quot;hidden&quot;, &amp;hidden);
-}
-
-GameObj::~GameObj()
-{
-  delete properties;
-}
-
-void
-GameObj::on_collision(GameObj* obj)
-{
-  std::cout &lt;&lt; &quot;GameObj: collision from &quot; &lt;&lt; get_id() &lt;&lt; &quot; with: &quot; &lt;&lt; obj-&gt;get_id() &lt;&lt; std::endl;
-}
-
-void
-GameObj::on_collision_with_building(Building* building)
-{
-  std::cout &lt;&lt; &quot;GameObj: collision with building: &quot; &lt;&lt; get_id() &lt;&lt; std::endl;
-}
-
-/* EOF */

Copied: trunk/src/game_obj_data_factory.cpp (from rev 341, trunk/src/game_obj_data_factory.cxx)


Property changes on: trunk/src/game_obj_data_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_obj_data_factory.cxx
===================================================================
--- trunk/src/game_obj_data_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_obj_data_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,46 +0,0 @@
-//  $Id: game_obj_data_factory.cxx,v 1.6 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;guile/gh.h&gt;
-#include &quot;guile.hxx&quot;
-#include &quot;game_obj_data_factory.hxx&quot;
-
-GameObjData*
-GameObjDataFactory::create (SCM symbol, SCM data)
-{
-  /*
-  if (Guile::equal_p(scm_str2symbol(&quot;tree&quot;), symbol))
-    {
-      return new TreeData (data);
-    }
-  else*/
-    if (Guile::equal_p(scm_str2symbol(&quot;tank&quot;), symbol))
-    {
-      std::cout &lt;&lt; &quot;GameObjDataFactory::create: not implemented&quot; &lt;&lt; std::endl;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;GameObjDataFactory: Unknown symbol: &quot; &lt;&lt; std::flush;
-      gh_display (symbol);
-      gh_newline ();
-    }
-  return 0;
-}
-
-/* EOF */

Copied: trunk/src/game_obj_factory.cpp (from rev 341, trunk/src/game_obj_factory.cxx)


Property changes on: trunk/src/game_obj_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_obj_factory.cxx
===================================================================
--- trunk/src/game_obj_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_obj_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,132 +0,0 @@
-//  $Id: game_obj_factory.cxx,v 1.10 2003/06/22 17:22:47 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;property_set.hxx&quot;
-
-// GameObjs
-#include &quot;vehicles/tank.hxx&quot;
-#include &quot;vehicles/helicopter.hxx&quot;
-#include &quot;tree.hxx&quot;
-#include &quot;marker.hxx&quot;
-#include &quot;mine.hxx&quot;
-#include &quot;soldier.hxx&quot;
-#include &quot;satchel_charge.hxx&quot;
-
-#include &quot;game_obj.hxx&quot;
-#include &quot;game_obj_factory.hxx&quot;
-
-GameObjFactory* GameObjFactory::instance_ = 0;
-
-GameObjFactory::GameObjFactory()
-{
-  // If anything is changed here, make sure to update
-  // data/feuerkraft.scm
-
-  // FIXME: Types should be named here, to not having update to files
-  register_factory(&quot;none&quot;,       0); // id=0 -&gt; the empty factory
-  register_factory(&quot;tree&quot;,       new GameObjGenericFactory&lt;Tree&gt;());
-  register_factory(&quot;marker&quot;,     new GameObjGenericFactory&lt;Marker&gt;());
-  register_factory(&quot;mine&quot;,       new GameObjGenericFactory&lt;Mine&gt;());
-  register_factory(&quot;satchel&quot;,    new GameObjGenericFactory&lt;SatchelCharge&gt;());
-  register_factory(&quot;soldier&quot;,    new GameObjGenericFactory&lt;Soldier&gt;());
-  register_factory(&quot;tank&quot;,       new GameObjGenericFactory&lt;Tank&gt;());
-  register_factory(&quot;helicopter&quot;, new GameObjGenericFactory&lt;Helicopter&gt;());
-}
-
-GameObjFactory* 
-GameObjFactory::instance()
-{
-  if (instance_)
-    return instance_;
-  else
-    return (instance_ = new GameObjFactory());
-}
-
-GameObj*
-GameObjFactory::create(int type_id, const AList&amp; alst)
-{
-  GameObj* obj = create_raw_object(type_id, alst);
-
-  if (obj)
-    {
-      // FIXME: All this should be no longer needed if objects get the AList
-      // as constructor
-#if 0      
-      PropertySet* props = obj-&gt;get_properties();
-
-      for (AList::const_iterator i = alst.begin(); i != alst.end(); ++i)
-        {
-          //std::cout &lt;&lt; &quot;&gt;&gt;&gt;# &quot; &lt;&lt; i-&gt;second.type &lt;&lt; std::endl;
-          
-          switch(i-&gt;second.type)
-            {
-            case AList::AL_INT:
-              props-&gt;set_int(i-&gt;first, i-&gt;second.v_int);
-              break;
-            case AList::AL_FLOAT:
-              props-&gt;set_float(i-&gt;first, i-&gt;second.v_float);
-              break;
-            case AList::AL_STRING:
-              props-&gt;set_string(i-&gt;first, *i-&gt;second.v_string);
-              break;
-            case AList::AL_BOOL:
-              props-&gt;set_bool(i-&gt;first, i-&gt;second.v_bool);
-              break;
-            default:
-              std::cout &lt;&lt; &quot;GameObjFactory: Unhandled property&quot; &lt;&lt; std::endl;
-            }
-        }
-
-      obj-&gt;properties_updated();
-#endif
-    }
-
-  return obj;
-}
-
-GameObj* 
-GameObjFactory::create_raw_object(int type_id, const AList&amp; lst)
-{
-  GameObjAbstractFactory* factory = get_factory(type_id);
-
-  if (factory)
-    return factory-&gt;create(lst);
-  else
-    return 0;
-}
-
-GameObjAbstractFactory*
-GameObjFactory::get_factory(int type_id)
-{
-  if (type_id &gt;= 0 &amp;&amp; type_id &lt; int(factories.size()))
-    return factories[type_id];
-  else 
-    return 0;
-}
-
-int
-GameObjFactory::register_factory(const char* name, GameObjAbstractFactory* factory)
-{
-  int type_id = factories.size();
-  factories.push_back(factory);
-  return type_id;
-}
-
-/* EOF */

Copied: trunk/src/game_obj_manager.cpp (from rev 341, trunk/src/game_obj_manager.cxx)


Property changes on: trunk/src/game_obj_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_obj_manager.cxx
===================================================================
--- trunk/src/game_obj_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_obj_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,60 +0,0 @@
-//  $Id: game_obj_manager.cxx,v 1.4 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;assert.hxx&quot;
-#include &quot;game_obj.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-
-GameObjManager* GameObjManager::current_manager = 0;
-
-GameObjManager::GameObjManager(GameWorld* world)
-  : game_world(world)
-{
-  current_manager = this;
-  next_obj_id = 0;
-}
-
-int
-GameObjManager::add_object(GameObj* obj)
-{
-  AssertMsg(obj, &quot;GameObjManager: No valid GameObj passed!&quot;);
-
-  game_objs.push_back(obj);
-  obj-&gt;set_id(next_obj_id);
-  return next_obj_id++;
-}
-
-void
-GameObjManager::remove_object(GameObj* obj)
-{
-  obj-&gt;remove();
-}
-
-GameObj*
-GameObjManager::get_object_by_id(int id)
-{
-  for (GameObjs::iterator i = game_objs.begin(); i != game_objs.end(); ++i)
-    {
-      if ((*i)-&gt;get_id() == id)
-        return *i;
-    }
-  return 0;
-}
-
-/* EOF */

Copied: trunk/src/game_session.cpp (from rev 341, trunk/src/game_session.cxx)


Property changes on: trunk/src/game_session.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_session.cxx
===================================================================
--- trunk/src/game_session.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_session.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,334 +0,0 @@
-//  $Id: game_session.cxx,v 1.6 2003/06/23 09:04:10 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Core/System/system.h&gt;
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;ClanLib/Display/display_window.h&gt;
-#include &lt;ClanLib/Display/mouse.h&gt;
-#include &lt;ClanLib/Display/keyboard.h&gt;
-#include &lt;ClanLib/Display/keys.h&gt;
-#include &lt;sstream&gt;
-#include &lt;iostream&gt;
-#include &lt;assert.h&gt;
-
-#include &quot;globals.hxx&quot;
-#include &quot;particles/explosion_particle.hxx&quot;
-#include &quot;menu.hxx&quot;
-#include &quot;groundmap/ground_map.hxx&quot;
-#include &quot;player_view.hxx&quot;
-#include &quot;input/input_manager.hxx&quot;
-#include &quot;soldier.hxx&quot;
-#include &quot;game_obj_factory.hxx&quot;
-
-#include &quot;vehicles/tank.hxx&quot;
-#include &quot;vehicles/helicopter.hxx&quot;
-
-#include &quot;background.hxx&quot;
-#include &quot;robot_tank.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;display_manager.hxx&quot;
-#include &quot;buildings/building_type_manager.hxx&quot;
-#include &quot;scripting/clanlib_commands.hxx&quot;
-#include &quot;scripting/menu_commands.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;sexpr_world_reader.hxx&quot;
-#include &quot;guile.hxx&quot;
-#include &quot;soldier_ai.hxx&quot;
-#include &quot;ai_manager.hxx&quot;
-#include &quot;ai_vehicle.hxx&quot;
-#include &quot;vehicle_ai.hxx&quot;
-#include &quot;output_world_builder.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;player.hxx&quot;
-#include &quot;path_manager.hxx&quot;
-#include &quot;command_line_arguments.hxx&quot;
-#include &quot;screenshot.hxx&quot;
-#include &quot;game_session.hxx&quot;
-
-// FIXME: Replace this with a PlayerManager class or something similar
-Player*  player;
-
-GameSession::GameSession(const std::string&amp; arg_filename)
-  : control_state(UNIT_CONTROL),
-    filename(arg_filename),
-    do_quit(false),
-    do_pause(false)
-{  
-}
-
-void
-GameSession::init()
-{
-  loops = 0;
-  deltas = 0.0;
-
-  start_time = CL_System::get_time ();
-  frames = 0;
-
-  collision_mgr       = new CollisionManager();
-  buildingtypemanager = new BuildingTypeManager();
-
-  // Load helper functions
-  // FIXME: These functions need a better place
-  scm_c_primitive_load(path_manager.complete(&quot;feuerkraft.scm&quot;).c_str());
-  scm_c_primitive_load(path_manager.complete(&quot;input.scm&quot;).c_str());
-  
-  // Deserialize the game world
-  {
-    std::cout &lt;&lt; &quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Parsing map &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot; &lt;&lt; std::endl;
-    SCM fdes = scm_open_file (scm_makfrom0str(filename.c_str()), 
-                              scm_makfrom0str(&quot;r&quot;));
-    SCM lst = scm_read (fdes);
-    scm_close (fdes);
-
-    // unstable Testing stuff
-    //OutputWorldBuilder builder;
-    //SexprWorldReader(lst, &amp;builder).run();
-
-    // Now we create the real world
-    world = new GameWorld(lst);
-    std::cout &lt;&lt; &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Parsing map &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot; &lt;&lt; std::endl;
-  }
-  // End: Test of parsing code
-
-  // The all mighty soldier that the player controlls
-  Soldier* soldier = new Soldier(AList());
-  soldier-&gt;set_position(FloatVector2d (500, 1100));
-
-  {
-    Soldier* soldier = new Soldier(AList());
-    soldier-&gt;set_position(FloatVector2d (1400, 1500));
-    SoldierAI* ai = new SoldierAI(soldier);
-    world-&gt;add(soldier);
-    AIManager::instance()-&gt;add(ai);
-  }
-
-  {
-    Soldier* soldier = new Soldier(AList());
-    soldier-&gt;set_position(FloatVector2d (1300, 1600));
-    SoldierAI* ai = new SoldierAI(soldier);
-    world-&gt;add(soldier);
-    AIManager::instance()-&gt;add(ai);
-  }
-
-  world-&gt;add(new RobotTank(660, 1245, 0, 100.0f));
-  world-&gt;add(new Helicopter(AList()
-                            .set_float(&quot;x-pos&quot;, 600)
-                            .set_float(&quot;y-pos&quot;, 1245)
-                            .set_int(&quot;type&quot;, 0)));
-  world-&gt;add(new Helicopter(AList()
-                            .set_float(&quot;x-pos&quot;, 600)
-                            .set_float(&quot;y-pos&quot;, 1445)
-                            .set_int(&quot;type&quot;, 1)));
-  world-&gt;add(new Helicopter(AList()
-                            .set_float(&quot;x-pos&quot;, 660)
-                            .set_float(&quot;y-pos&quot;, 1645)
-                            .set_int(&quot;type&quot;, 2)));
-
-  world-&gt;add(new Tank(FloatVector2d (650, 1245), 5, &quot;feuerkraft/tank&quot;, &quot;feuerkraft/turret&quot;, &quot;feuerkraft/fire2&quot;));
-  world-&gt;add(new Tank(FloatVector2d (750, 1245), 5, &quot;feuerkraft/tank&quot;, &quot;feuerkraft/turret&quot;, &quot;feuerkraft/fire2&quot;));
-  world-&gt;add(new Tank(FloatVector2d (850, 1245), 5, &quot;feuerkraft/tank&quot;, &quot;feuerkraft/turret&quot;, &quot;feuerkraft/fire2&quot;));
-
-  {
-    Tank* tank = new Tank(FloatVector2d (450, 1245), 5, &quot;feuerkraft/tank&quot;, &quot;feuerkraft/turret&quot;, &quot;feuerkraft/fire2&quot;);
-    world-&gt;add(tank);
-    AIManager::instance()-&gt;add(new VehicleRoboAI(tank));
-  }
-
-  {
-    Tank* tank = new Tank(FloatVector2d (0, 1245), 5, &quot;feuerkraft/tank2&quot;, &quot;feuerkraft/turret&quot;, &quot;feuerkraft/fire2&quot;);
-    world-&gt;add(tank);
-    AIManager::instance()-&gt;add(new VehicleRoboAI(tank));
-  }
-
-  {
-    Tank* tank = new Tank(FloatVector2d (-100, 1245), 5, &quot;feuerkraft/tank&quot;, &quot;feuerkraft/turret2&quot;, &quot;feuerkraft/fire2&quot;);
-    world-&gt;add(tank);
-    AIManager::instance()-&gt;add(new VehicleRoboAI(tank));
-  }
-
-  {
-    Tank* tank = new Tank(FloatVector2d (560, 1245), 5, &quot;feuerkraft/tank2&quot;, &quot;feuerkraft/turret2&quot;, &quot;feuerkraft/fire2&quot;);
-    world-&gt;add(tank);
-    VehiclePathAI* ai = new VehiclePathAI(tank);
-
-    ai-&gt;drive_to(FloatVector2d(200, 200));
-    ai-&gt;drive_to(FloatVector2d(500, 200));
-    ai-&gt;drive_to(FloatVector2d(500, 500));
-    ai-&gt;drive_to(FloatVector2d(1500, 500));
-    ai-&gt;drive_to(FloatVector2d(1500, 300));
-
-    AIManager::instance()-&gt;add(ai);
-  }
-
-  world-&gt;add(new Background (resources-&gt;get_sprite(&quot;feuerkraft/sand&quot;), -10.0f));
-  world-&gt;add(soldier);
-
-  player = new Player(soldier);
-  view   = new View(0, 0, CL_Display::get_width(), CL_Display::get_height(), new PlayerViewUpdater(player));
-  DisplayManager::init();
-}
-
-void 
-GameSession::update()
-{
-  int delta_wait = static_cast&lt;int&gt;(1000/args-&gt;fps);
-  float delta = delta_wait/1000.0f;;
-
-  deltas += delta;
-  ++loops;
-
-  if (CL_Keyboard::get_keycode(CL_KEY_D))
-    Guile::enter_repl();
-
-  unsigned int last_time = CL_System::get_time ();
-
-  // Update stuff
-  if (!do_pause)
-    {
-      collision_mgr-&gt;clear();
-      AIManager::instance()-&gt;update(delta);
-      world-&gt;update(delta);
-      collision_mgr-&gt;run();
-      view-&gt;update(delta);
-    }
-
-  GameWorld::current()-&gt;draw(*view);
-  GameWorld::current()-&gt;draw_energie(*view);
-  view-&gt;get_sc().render();
-  view-&gt;get_sc().light().fill_screen(CL_Color(50, 50, 100));
-
-  if (draw_colmap)
-    collision_mgr-&gt;draw(*view);
-
-  if (!do_pause)
-    DisplayManager::current()-&gt;update(delta);
-      
-  DisplayManager::current()-&gt;draw(*(CL_Display::get_current_window()-&gt;get_gc()));
-
-  if (CL_Mouse::get_keycode(CL_MOUSE_MIDDLE))
-    world-&gt;add(new ExplosionParticle(view-&gt;screen_to_world(FloatVector2d(CL_Mouse::get_x (),
-                                                                         CL_Mouse::get_y ())),
-                                     FloatVector2d(), 3.0f));
-
-  // Comment out for variable frame rate
-  int sleep_time = (last_time + delta_wait) - CL_System::get_time();
-  if (sleep_time &gt; 0)
-    CL_System::sleep (sleep_time);
-
-  // Flip front and backbuffer. This makes the changes visible:
-  CL_Display::flip ();
-
-  if (!args-&gt;video_record_directory.empty())
-    {
-      std::stringstream filename;
-      filename &lt;&lt; args-&gt;video_record_directory;
-      filename.width(8);
-      filename.fill('0');
-      filename &lt;&lt; frames;
-      filename &lt;&lt; &quot;.ppm&quot;;
-      Screenshot::write_screenshot_pnm(filename.str());
-    }
-
-  ++frames;
-	    
-  // Update keyboard input and handle system events:
-  // Exits the loop if ClanLib requests shutdown - for instance if
-  // someone closes the window.
-  CL_System::keep_alive();
-  clanlib_call_post_keep_alive_func();
-  InputManager::update(delta);
-
-  InputEventLst lst = InputManager::get_controller().get_events();
-  for(InputEventLst::iterator i = lst.begin(); i != lst.end(); ++i)
-    {
-      if (i-&gt;type == BUTTON_EVENT)
-        {
-          if (i-&gt;button.name == MENU_BUTTON &amp;&amp; i-&gt;button.is_down())
-            {
-              if (control_state == MENU_CONTROL)
-                {
-                  menu_hide();
-                  control_state = UNIT_CONTROL;
-                }
-              else 
-                {
-                  menu_show(0);
-                  control_state = MENU_CONTROL;
-                }
-            }
-          else if (i-&gt;button.name == USE_BUTTON &amp;&amp; i-&gt;button.is_down())
-            {
-              // FIXME: Unclean hack
-              gh_call0(gh_lookup(&quot;join-nearest-vehicle&quot;));
-            }
-        }
-    }
-
-  switch (control_state)
-    {
-    case MENU_CONTROL:
-      if (DisplayManager::current()-&gt;get_menu())
-        DisplayManager::current()-&gt;get_menu()-&gt;process_events(InputManager::get_controller().get_events());
-      else
-        {
-          std::cout &lt;&lt; &quot;Error: Menu not available, fallback to unit&quot; &lt;&lt; std::endl;
-          control_state = UNIT_CONTROL;
-        }
-      break;
-
-    case UNIT_CONTROL:
-      player-&gt;get_current_unit()-&gt;update_controlls(InputManager::get_controller());
-      break;
-      
-    default: 
-      std::cout &lt;&lt; &quot;Unknown ControlState, switching back to UNIT_CONTROL&quot; &lt;&lt; std::endl;
-      control_state = UNIT_CONTROL;
-      break;
-    }
-
-  InputManager::clear();
-}
-
-void
-GameSession::deinit()
-{
-  delete world;
-  delete buildingtypemanager;
-  delete collision_mgr;
-
-  DisplayManager::deinit();
-
-  std::cout &lt;&lt; &quot;Avarage delta: &quot; &lt;&lt; deltas/loops &lt;&lt; std::endl;
-  std::cout &lt;&lt; &quot;Avarage fps:   &quot; 
-            &lt;&lt; float (frames) / (CL_System::get_time () - start_time) * 1000.0 &lt;&lt; std::endl;
-}
-
-void
-GameSession::pause()
-{
-  do_pause = !do_pause;
-}
-
-void
-GameSession::save(const std::string&amp; arg_filename)
-{
-}
-
-/* EOF */

Copied: trunk/src/game_session_manager.cpp (from rev 341, trunk/src/game_session_manager.cxx)


Property changes on: trunk/src/game_session_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_session_manager.cxx
===================================================================
--- trunk/src/game_session_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_session_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,103 +0,0 @@
-//  $Id: game_session_manager.cxx,v 1.1 2003/06/10 00:38:50 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;path_manager.hxx&quot;
-#include &quot;game_session.hxx&quot;
-#include &quot;game_session_manager.hxx&quot;
-
-GameSessionManager* GameSessionManager::instance_ = 0;
-
-GameSessionManager* 
-GameSessionManager::instance()
-{
-  if (instance_)
-    return instance_;
-  else
-    return (instance_ = new GameSessionManager());
-}
-
-GameSessionManager::GameSessionManager()
-  : session_changed(false),
-    do_quit(false),
-    current_session(0),
-    new_session(0)
-{
-}
-
-GameSessionManager::~GameSessionManager()
-{
-  delete current_session;
-}
-
-void
-GameSessionManager::load(const std::string&amp; filename)
-{
-  if (!current_session)
-    {
-      current_session = new GameSession(filename);
-    }
-  else
-    {
-      new_session     = new GameSession(path_manager.complete(filename));
-      session_changed = true;
-    }
-}
-
-void
-GameSessionManager::save(const std::string&amp; filename)
-{
-  std::cout &lt;&lt; &quot;### Saving game to '&quot; &lt;&lt; filename &lt;&lt; &quot;' not implemented&quot; &lt;&lt; std::endl;
-  current_session-&gt;save(filename);
-}
-
-void
-GameSessionManager::run()
-{
-  while(!do_quit)
-    {
-      current_session-&gt;init();
-
-      while(!do_quit &amp;&amp; !session_changed)
-        current_session-&gt;update();
-
-      current_session-&gt;deinit();
-
-      if (session_changed)
-        {
-          delete current_session;
-          current_session = new_session;
-          session_changed = false;
-        }
-    }
-}
-
-void
-GameSessionManager::pause()
-{
-  current_session-&gt;pause();
-}
-
-void
-GameSessionManager::quit()
-{
-  do_quit = true;
-}
-
-/* EOF */

Copied: trunk/src/game_world.cpp (from rev 341, trunk/src/game_world.cxx)


Property changes on: trunk/src/game_world.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_world.cxx
===================================================================
--- trunk/src/game_world.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_world.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,210 +0,0 @@
-//  $Id: game_world.cxx,v 1.20 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;algorithm&gt;
-#include &lt;functional&gt;
-
-#include &quot;mine.hxx&quot;
-#include &quot;vehicles/tank.hxx&quot;
-#include &quot;projectile.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;groundmap/ground_map_data.hxx&quot;
-#include &quot;groundmap/ground_map.hxx&quot;
-#include &quot;game_obj.hxx&quot;
-#include &quot;math.hxx&quot;
-#include &quot;game_obj_data.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;path_manager.hxx&quot;
-#include &quot;trigger_manager.hxx&quot;
-#include &quot;buildings/building_manager.hxx&quot;
-#include &quot;buildings/building_map.hxx&quot;
-
-GameWorld* GameWorld::current_world = 0;
-
-GameWorld::GameWorld (SCM scm)
-  : GameWorldData (scm),
-    game_obj_manager(new GameObjManager(this)),
-    building_manager(new BuildingManager()),
-    trigger_manager (new TriggerManager()),
-    current_time(0.0f),
-    wind(40.0f, 30.0f)
-{
-  current_world = this;
-  
-  if (groundmap_data)
-    groundmap = groundmap_data-&gt;create ();//this);
-
-  if (buildingmap_data)
-    buildingmap = buildingmap_data-&gt;create();
-
-  if (!groundmap) 
-    {
-      std::cout &lt;&lt; &quot;GameWorld: No groundmap created, bailout&quot; &lt;&lt; std::endl;
-      assert(groundmap);
-    }
-  
-  if (!buildingmap)
-    {
-      std::cout &lt;&lt; &quot;GameWorld: No buildingmap created, bailout&quot; &lt;&lt; std::endl;
-      assert(buildingmap);
-    }
-
-  game_obj_manager-&gt;add_object(groundmap);
-  game_obj_manager-&gt;add_object(buildingmap);
-
-  for (std::vector&lt;GameObjData*&gt;::iterator i = gameobj_data.begin (); i != gameobj_data.end (); ++i)
-    {
-      game_obj_manager-&gt;add_object((*i)-&gt;create());
-    }
-  
-  // FIXME: a little hacky
-  //world_module = scm_c_define_module(&quot;feuerkraft game-world&quot;, 0, 0);
-  //last_module  = scm_set_current_module(world_module);
-
-  // Load scripts
-  for(std::vector&lt;std::string&gt;::iterator i = scripts.begin(); i != scripts.end(); ++i)
-    {
-      std::cout &lt;&lt; &quot;### Loading Script: &quot; &lt;&lt; *i &lt;&lt; std::endl;
-      scm_c_primitive_load((path_manager.complete(&quot;missions/&quot; + *i)).c_str());
-      std::cout &lt;&lt; &quot;### DONE: Loading Script: &quot; &lt;&lt; *i &lt;&lt; std::endl;
-    }
-}
-
-GameWorld::~GameWorld ()
-{
-  delete game_obj_manager;
-  delete building_manager;
-  delete trigger_manager;
-  // FIXME: Memory Leak, we should clear the gameobj list here
-
-  // Restore module FIXME: a little hacky
-  //scm_set_current_module(last_module);
-}
-
-void 
-GameWorld::add (GameObj* obj)
-{
-  game_obj_manager-&gt;add_object(obj);
-}
-
-void 
-GameWorld::add_front (GameObj* obj)
-{
-  // FIXME: no go...
-  game_obj_manager-&gt;add_object(obj);
-}
-
-struct z_pos_sorter
-{
-  bool operator() (GameObj* a, GameObj* b)
-  {
-    return a-&gt;get_z_pos () &lt; b-&gt;get_z_pos ();
-  }
-};
-
-void 
-GameWorld::draw (View&amp; view)
-{
-  game_obj_manager-&gt;get_objects().sort (z_pos_sorter ());
-
-  GameObjManager* objs = game_obj_manager;
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      if (!(*i)-&gt;is_hidden())
-        (*i)-&gt;draw (view);
-    }
-}
-
-void 
-GameWorld::draw_energie (View&amp; view)
-{
-  GameObjManager* objs = game_obj_manager;
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      if (!(*i)-&gt;is_hidden())
-        (*i)-&gt;draw_energie (view);
-    }
-}
-
-void
-GameWorld::draw_levelmap (LevelMap&amp; levelmap)
-{
-  //groundmap-&gt;draw_levelmap (levelmap);
-
-  GameObjManager* objs = game_obj_manager;
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      if (!(*i)-&gt;is_hidden())
-        (*i)-&gt;draw_levelmap(levelmap);
-    }
-}
-
-struct is_removable
-{
-  bool operator() (GameObj* obj)
-  {
-    return obj-&gt;removable ();
-  }
-};
-
-void 
-GameWorld::update(float delta)
-{
-  current_time += delta;
-
-  //wind = FloatVector2d(40.0f).rotate((Math::frand()-.5f) * 5.0f * delta);
-
-  trigger_manager-&gt;update(delta);
-
-  game_obj_manager-&gt;get_objects().remove_if(is_removable ()); 
-
-  GameObjManager* objs = game_obj_manager;
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    if (!(*i)-&gt;is_hidden())
-      (*i)-&gt;update (delta);
-}
-
-BuildingMap*
-GameWorld::get_buildingmap ()
-{
-  // FIXME: This is a ugly ugly hack...
-  return dynamic_cast&lt;BuildingMap*&gt;(buildingmap);
-}
-
-GroundMap*
-GameWorld::get_groundmap ()
-{
-  return groundmap;
-}
-
-GameObjManager*
-GameWorld::get_game_obj_manager()
-{
-  return game_obj_manager;
-}
-
-FloatVector2d
-GameWorld::get_wind() const
-{
-  return wind;
-}
-
-/* EOF */

Copied: trunk/src/game_world_builder.cpp (from rev 341, trunk/src/game_world_builder.cxx)


Property changes on: trunk/src/game_world_builder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_world_builder.cxx
===================================================================
--- trunk/src/game_world_builder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_world_builder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,80 +0,0 @@
-//  $Id: game_world_builder.cxx,v 1.3 2003/06/22 21:51:21 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;game_world.hxx&quot;
-#include &quot;game_world_builder.hxx&quot;
-
-GameWorldBuilder::GameWorldBuilder()
-{
-  // The allocated GameWorld class is freeded by the caller of get_world()
-  //world = new GameWorld();
-}
-
-GameWorldBuilder::~GameWorldBuilder()
-{
-  // Delete the world if get_world() wasn't called
-  delete world;
-}
-
-void
-GameWorldBuilder::add_object (const std::string&amp; type, const AList&amp;)
-{
-  
-}
-
-void
-GameWorldBuilder::add_brush(const std::string&amp; resname, const AList&amp;)
-{
-  
-}
-
-void
-GameWorldBuilder::add_building(const std::string&amp; type, const AList&amp;)
-{
-  
-}
-
-void
-GameWorldBuilder::add_groundmap(const std::string&amp; type, const AList&amp;)
-{
-  
-}
-
-void
-GameWorldBuilder::add_script(const std::string&amp; resname)
-{
-  std::cout &lt;&lt; &quot;### Loading Script: &quot; &lt;&lt; resname &lt;&lt; std::endl;
-  scm_c_primitive_load(resname.c_str());
-  std::cout &lt;&lt; &quot;### DONE: Loading Script: &quot; &lt;&lt; resname &lt;&lt; std::endl;
-}
-
-GameWorld*
-GameWorldBuilder::get_world() 
-{
-  GameWorld* the_world = world;
-
-  // remove our world handle, so that we don't delete world
-  // in the destructor
-  world = 0; 
-
-  return the_world; 
-}
-
-/* EOF */

Copied: trunk/src/game_world_data.cpp (from rev 341, trunk/src/game_world_data.cxx)


Property changes on: trunk/src/game_world_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/game_world_data.cxx
===================================================================
--- trunk/src/game_world_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/game_world_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,173 +0,0 @@
-//  $Id: game_world_data.cxx,v 1.7 2003/08/20 00:15:10 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;typeinfo&gt;
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &quot;guile.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;buildings/building_map_data.hxx&quot;
-#include &quot;groundmap/ground_map_data.hxx&quot;
-#include &quot;game_obj_data.hxx&quot;
-#include &quot;groundmap/ground_map_data_factory.hxx&quot;
-#include &quot;game_obj_data_factory.hxx&quot;
-#include &quot;game_world_data.hxx&quot;
-
-GameWorldData::GameWorldData (SCM desc)
-  : needs_delete (true)
-{
-  assert(gh_pair_p(desc));
-
-  if (gh_equal_p (gh_symbol2scm (&quot;feuerkraft-scenario&quot;), gh_car(desc)))
-    desc = gh_cdr(desc);
-  else
-    {
-      std::cout &lt;&lt; &quot;File is not a feuerkraft scenario&quot; &lt;&lt; std::endl;
-      assert(false);
-    }
-
-  while (gh_pair_p(desc))
-    {
-      if (gh_pair_p (gh_car (desc)))
-	{
-	  SCM symbol = gh_caar(desc);
-	  SCM data   = gh_cdar(desc);   
-
-	  if (gh_symbol_p (symbol))
-	    {
-	      if (gh_equal_p (gh_symbol2scm (&quot;groundmap&quot;), symbol))
-		{
-		  groundmap_data = GroundMapDataFactory::create (data);
-		}
-	      else if (gh_equal_p (gh_symbol2scm (&quot;buildings&quot;), symbol)) 
-		{
-		  buildingmap_data = new BuildingMapData (data);
-		}
-	      else if (gh_equal_p (gh_symbol2scm (&quot;objects&quot;), symbol))
-		{
-		  parse_objects(data);
-		}
-	      else if (gh_equal_p (gh_symbol2scm (&quot;scripts&quot;), symbol))
-		{
-		  parse_scripts(data);
-		}
-	      else
-		{
-		  std::cout &lt;&lt; &quot;GameWorldData: Error: &quot; &lt;&lt; symbol &lt;&lt; &quot; &quot; &lt;&lt; data &lt;&lt; std::endl;;
-		}
-	    }
-	  else
-	    {
-	      std::cout &lt;&lt; &quot;GameWorldData: Error not a symbol: &quot;;// &lt;&lt; symbol &lt;&lt; &quot; &quot; &lt;&lt; data &lt;&lt; std::endl;;
-	      gh_display (symbol); gh_newline ();
-	    }
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;GameWorldData: Error not a pair: &quot; &lt;&lt; gh_car(desc) &lt;&lt; std::endl;;
-	}
-
-      desc = gh_cdr(desc);
-    }
-}
-
-void
-GameWorldData::parse_objects (SCM desc)
-{
-  //std::cout &lt;&lt; &quot;GameWorldData::parse_objects&quot; &lt;&lt; std::endl;
-  //gh_display (desc);
-  //gh_newline ();
-  while (gh_pair_p(desc)) // is a list
-    {
-      if (gh_pair_p (gh_car (desc))) // is a symbol/value pair
-	{
-	  SCM symbol = gh_caar(desc);
-	  SCM data   = gh_cdar(desc);   
-
-	  GameObjData* obj = GameObjDataFactory::create (symbol, data);
-	  if (obj)
-	    {
-	      gameobj_data.push_back (obj);
-	    }
-	  else
-	    {
-	      std::cout &lt;&lt; &quot;Error: GameWorldData::parse_objects&quot; &lt;&lt; std::endl;
-	    }
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;Error: GameWorldData::parse_objects&quot; &lt;&lt; std::endl;
-	}
-      desc = gh_cdr (desc);
-    }
-}
-
-GameWorldData::~GameWorldData ()
-{
-  if (needs_delete)
-    {
-      // FIXME: Memory Leak, we should clear the gameobj_data list here
-    }
-}
-
-SCM
-GameWorldData::dump_to_scm ()
-{
-  std::cout &lt;&lt; &quot;GameWorldData::dump_to_scm()&quot; &lt;&lt; std::endl;
-
-  SCM world_lst = SCM_EOL;
-
-  SCM objs = SCM_EOL;
-  for (std::vector&lt;GameObjData*&gt;::iterator i = gameobj_data.begin (); i != gameobj_data.end (); ++i)
-    {
-      if (*i)
-	{
-	  SCM obj = (*i)-&gt;dump_to_scm ();
-	  if (obj == SCM_BOOL_F)
-	    {
-	      std::cout &lt;&lt; &quot;GameWorldData: Error dumping: &quot; &lt;&lt; typeid(**i).name () &lt;&lt; std::endl;
-	    }
-	  else // Object successfully dumped
-	    {
-	      objs = gh_cons (obj, objs);
-	    }
-	}
-    }
-  
-  world_lst = gh_cons (gh_symbol2scm (&quot;objects&quot;), gh_reverse(objs));
-
-  world_lst = SCM_BOOL_F; //scm_listify (gh_symbol2scm (&quot;world&quot;), world_lst, SCM_UNDEFINED);
-
-  return world_lst;
-}
-
-void
-GameWorldData::parse_scripts(SCM desc)
-{
-  while(!gh_null_p(desc))
-    {
-      SCM script = gh_car(desc);
-
-      scripts.push_back(Guile::scm2string(script));
-      
-      desc = gh_cdr(desc);
-    }
-}
-
-/* EOF */

Copied: trunk/src/generic/random.cpp (from rev 341, trunk/src/generic/random.cxx)


Property changes on: trunk/src/generic/random.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/generic/random.cxx
===================================================================
--- trunk/src/generic/random.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/generic/random.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,47 +0,0 @@
-//  $Id: random.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;stdlib.h&gt;
-#include &quot;random.hxx&quot;
-
-float
-Random::frand (float max)
-{
-  return (float(::rand ()) / RAND_MAX) * max;
-}
-
-float
-Random::frand (float min, float max)
-{
-  return frand(max - min) + min;
-}
-
-int
-Random::rand (int max)
-{
-  return ::rand() % max;
-}
-
-int
-Random::rand (int min, int max)
-{
-  return ::rand () % (max - min) + min;
-}
-
-/* EOF */

Copied: trunk/src/geometry.cpp (from rev 341, trunk/src/geometry.cxx)


Property changes on: trunk/src/geometry.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/geometry.cxx
===================================================================
--- trunk/src/geometry.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/geometry.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,29 +0,0 @@
-//  $Id: geometry.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;geometry.hxx&quot;
-
-bool 
-Circle::do_not_intersec (const Circle&amp; c)
-{
-  return (get_position ().distance (c.get_position ()) 
-	  &gt; get_radius () + c.get_radius());
-}
-
-/* EOF */

Copied: trunk/src/globals.cpp (from rev 341, trunk/src/globals.cxx)


Property changes on: trunk/src/globals.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/globals.cxx
===================================================================
--- trunk/src/globals.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/globals.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,27 +0,0 @@
-//  $Id: globals.cxx,v 1.3 2003/06/17 22:06:13 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;globals.hxx&quot;
-
-bool music_enabled = true;
-bool sound_enabled = true;
-bool draw_colmap   = false;
-int  verbose = 1;
-
-/* EOF */

Copied: trunk/src/goal_manager.cpp (from rev 341, trunk/src/goal_manager.cxx)


Property changes on: trunk/src/goal_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/goal_manager.cxx
===================================================================
--- trunk/src/goal_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/goal_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,24 +0,0 @@
-//  $Id: goal_manager.cxx,v 1.1 2003/06/18 13:05:35 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;goal_manager.hxx&quot;
-
-
-
-/* EOF */

Copied: trunk/src/groundmap/grid_map.cpp (from rev 341, trunk/src/groundmap/grid_map.cxx)


Property changes on: trunk/src/groundmap/grid_map.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/grid_map.cxx
===================================================================
--- trunk/src/groundmap/grid_map.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/grid_map.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,121 +0,0 @@
-//  $Id: grid_map.cxx,v 1.11 2003/10/20 20:58:40 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;grid_tile.hxx&quot;
-#include &quot;../path_manager.hxx&quot;
-#include &quot;grid_map.hxx&quot;
-
-GridMap::GridMap (const GridMapData&amp; data)
-  : GridMapData (data),
-    tiles (path_manager.complete(&quot;tiles.scm&quot;)),
-    surface(provider)
-{
-  std::vector&lt;GridTileData&gt; tile_data;
-  
-  width  = grid_width  - 1;
-  height = grid_height - 1;
-
-  tile_data.resize (width * height);
-
-  // Generated a temporary tile_data
-  for (int y = 0; y &lt; height; ++y)
-    {
-      for (int x = 0; x &lt; width; ++x)
-	{
-	  tile_data[x + (y * width)] = GridTileData (grid_data[(x + 0) + ((y + 0) * grid_width)],
-						     grid_data[(x + 1) + ((y + 0) * grid_width)],
-						     grid_data[(x + 1) + ((y + 1) * grid_width)],
-						     grid_data[(x + 0) + ((y + 1) * grid_width)]);
-	}
-    }
-
-  // Resize the gridmap to the correct size and fill it with tiles
-  gridmap.resize (tile_data.size ());
-  for (unsigned int i = 0; i != tile_data.size (); ++i)
-    {
-      gridmap[i] = tiles.create(tile_data[i]);
-    }
-
-}
-
-GridMap::~GridMap ()
-{
-  
-}
-
-void
-GridMap::draw (View&amp; view)
-{
-  //std::cout &lt;&lt; &quot;Drawing&quot; &lt;&lt; std::endl;
-
-  /* FIXME: This code should be shared with TileMap */
-  int tile_x_offset = int(-(view.get_x_offset ()) / 40);
-  int tile_y_offset = int(-(view.get_y_offset ()) / 40);
-  int tile_width    = tile_x_offset + (view.get_width()  / 40) + 2;
-  int tile_height   = tile_y_offset + (view.get_height() / 40) + 2; 
-  // FIXME: one tile more to avoid artefacts, hack, hack hack...
-  
-  for (int y = tile_y_offset; y &lt; tile_height; ++y)
-    for (int x = tile_x_offset; x &lt; tile_width; ++x)
-      {
-	// FIXME: Hard coded gridmap size is ugly
-	if (y &lt; height &amp;&amp; y &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; x &gt;= 0) // Could be optimized away
-	  {
-	    if (gridmap [(width * y) + x]) // Tile is not empty
-	      {
-		gridmap [(width * y) + x]-&gt;draw (view, 
-						 int(x * 40) + 20, // FIXME: Map offset needs to be
-						 int(y * 40) + 20); // FIXME: configurable;
-	      }
-	    else
-	      {
-		//std::cout &lt;&lt; &quot;Empty tile at: &quot;&lt;&lt; x &lt;&lt; &quot;x&quot; &lt;&lt; y &lt;&lt; std::endl;
-	      }
-	  }
-      }
-}
-
-void
-GridMap::update (float)
-{
-  
-}
-
-void
-GridMap::draw_levelmap (LevelMap&amp; levelmap)
-{
-  surface.set_alpha(0.95f);
-  surface.draw (0, 0);
-  surface.set_alpha(1.0f);
-}
-
-GroundType
-GridMap::get_groundtype (float x, float y)
-{
-  // FIXME: This doesn't look right, tile size is hardcoded
-  int ix = int((x + 20) / 40);
-  int iy = int((y + 20) / 40);
-
-  if (ix &gt;= 0 &amp;&amp; ix &lt; grid_width &amp;&amp; iy &gt;= 0 &amp;&amp; iy &lt; grid_height)
-    return grid_data[ix + (iy * grid_width)];
-  else
-    return GT_EMPTY;
-}
-
-/* EOF */

Copied: trunk/src/groundmap/grid_map_data.cpp (from rev 341, trunk/src/groundmap/grid_map_data.cxx)


Property changes on: trunk/src/groundmap/grid_map_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/grid_map_data.cxx
===================================================================
--- trunk/src/groundmap/grid_map_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/grid_map_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,100 +0,0 @@
-//  $Id: grid_map_data.cxx,v 1.5 2003/10/20 20:58:40 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/Providers/png_provider.h&gt;
-
-#include &quot;../path_manager.hxx&quot;
-#include &quot;grid_map.hxx&quot;
-#include &quot;grid_map_data.hxx&quot;
-
-GridMapData::GridMapData (SCM desc)
-{
-  grid_width  = -1;
-  grid_height = -1;
-  
-  while (!gh_null_p (desc))
-    {
-      SCM symbol = gh_caar(desc);
-      SCM data   = gh_cdar(desc);
-
-      if (gh_equal_p (gh_symbol2scm (&quot;file&quot;), symbol))
-        {
-          parse_from_file (data);
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;GridMapData: Unknown data type: '&quot; &lt;&lt; std::flush;
-          gh_display (symbol);
-          std::cout &lt;&lt; &quot;' with data: &quot; &lt;&lt; std::flush;
-          gh_display (data);
-          std::cout &lt;&lt; std::endl;
-          return;
-        }
-
-      desc = gh_cdr (desc);
-    }
-}
-
-GridMapData::~GridMapData ()
-{
-  // delete provider; FIXME: disabled cause it could lead to throuble with copy c'tor
-}
-
-void
-GridMapData::parse_from_file (SCM desc)
-{
-  /* GridMaps will always get a one pixel boarder with the base
-     enviroment */
-  char* str = gh_scm2newstr(gh_car (desc), 0);
-  std::cout &lt;&lt; &quot;Loading from: &quot; &lt;&lt; str &lt;&lt; std::endl;
-  std::string filename = str;
-#ifndef WIN32
-  free (str);
-#endif
-
-  provider = CL_PNGProvider (path_manager.complete(&quot;missions/&quot; + filename));
-
-  provider.lock ();
-  //FIXME:Display2 assert (provider.is_indexed ());
-
-  grid_width  = provider.get_width () + 2;
-  grid_height = provider.get_height () + 2;
-
-  grid_data.resize (grid_width * grid_height);
-  
-  for (int i = 0; i &lt; grid_height * grid_width; ++i)
-    grid_data[i] = GT_SAND; // FIXME: should be variable not hardcoded!
-
-  unsigned char* buffer = static_cast&lt;unsigned char*&gt;(provider.get_data ());
-  for (int y = 0; y &lt; provider.get_height (); ++y)
-    for (int x = 0; x &lt; provider.get_width (); ++x)
-      grid_data[(x + 1) + ((y+1) * grid_width)] 
-	= static_cast&lt;GroundType&gt;(buffer[x + (provider.get_width () * y)]);
-
-  provider.unlock (); 
-}
-
-GroundMap*
-GridMapData::create ()
-{
-  return new GridMap (*this);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/grid_tile.cpp (from rev 341, trunk/src/groundmap/grid_tile.cxx)


Property changes on: trunk/src/groundmap/grid_tile.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/grid_tile.cxx
===================================================================
--- trunk/src/groundmap/grid_tile.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/grid_tile.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,38 +0,0 @@
-//  $Id: grid_tile.cxx,v 1.7 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/core.h&gt;
-#include &quot;../view.hxx&quot;
-#include &quot;grid_tile.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-
-GridTile::GridTile (std::string filename)
-{  
-  //std::cout &lt;&lt; &quot;Loading: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-  sprite = resources-&gt;get_sprite (filename);
-  //std::cout &lt;&lt; &quot;Done: Loading: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-}
-
-void
-GridTile::draw(View&amp; view, float x, float y)
-{
-  view.get_sc().color().draw(sprite, x, y);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/grid_tile_data.cpp (from rev 341, trunk/src/groundmap/grid_tile_data.cxx)


Property changes on: trunk/src/groundmap/grid_tile_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/grid_tile_data.cxx
===================================================================
--- trunk/src/groundmap/grid_tile_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/grid_tile_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,86 +0,0 @@
-//  $Id: grid_tile_data.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;grid_tile.hxx&quot;
-#include &quot;grid_tile_data.hxx&quot;
-
-GridTile*
-GridTileData::create ()
-{
-  //return new GridTile (*this);
-  return 0;// FIXME: Unused
-}
-
-static bool Gridless(const GridTileData&amp; a, const GridTileData&amp; b)
-{
-  if (a.ul &lt; b.ul)
-    return true;
-  else if (a.ul &gt; b.ul) 
-    return false;
-  else
-    if (a.ur &lt; b.ur)
-      return true;
-    else if (a.ur &gt; b.ur) 
-      return false;    
-    else
-      if (a.br &lt; b.br)
-	return true;
-      else if (a.br &gt; b.br) 
-	return false;    
-      else
-	if (a.bl &lt; b.bl)
-	  return true;
-	else if (a.bl &gt; b.bl) 
-	  return false;
-
-  return false;
-}
-
-bool operator&lt;(const GridTileData&amp; a, const GridTileData&amp; b)
-{
-  /*
-  std::cout &lt;&lt; &quot;if (&quot;  &lt;&lt; (int)a.ul &lt;&lt; (int)a.ur &lt;&lt; (int)a.br  &lt;&lt; (int)a.bl
-	    &lt;&lt; &quot; &lt; &quot; 
-	    &lt;&lt; (int)b.ul &lt;&lt; (int)b.ur &lt;&lt; (int)b.br &lt;&lt; (int)b.bl
-	    &lt;&lt; &quot;) != &quot; &lt;&lt; Gridless (a, b) &lt;&lt; &quot;: &quot; &lt;&lt; &quot;print \&quot;Error\&quot;&quot;&lt;&lt; std::endl;
-  */
-  return Gridless (a, b);
-}
-
-std::ostream&amp; operator&lt;&lt;(std::ostream&amp; s, const GridTileData&amp; b)
-{
-  s &lt;&lt; &quot;#&lt;GroundType &quot;
-    &lt;&lt; GroundType2string(b.ul) &lt;&lt; &quot;, &quot;
-    &lt;&lt; GroundType2string(b.ur) &lt;&lt; &quot;, &quot;
-    &lt;&lt; GroundType2string(b.br) &lt;&lt; &quot;, &quot;
-    &lt;&lt; GroundType2string(b.bl)
-    &lt;&lt; &quot;&gt;&quot;;
-  return s;
-}
-
-bool
-GridTileData::operator==(const GridTileData&amp; b)
-{
-  return (this-&gt;ur == b.ur
-	  &amp;&amp; this-&gt;ul == b.ul
-	  &amp;&amp; this-&gt;bl == b.bl
-	  &amp;&amp; this-&gt;br == b.br); 
-}
-
-/* EOF */

Copied: trunk/src/groundmap/grid_tile_generator.cpp (from rev 341, trunk/src/groundmap/grid_tile_generator.cxx)


Property changes on: trunk/src/groundmap/grid_tile_generator.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/grid_tile_generator.cxx
===================================================================
--- trunk/src/groundmap/grid_tile_generator.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/grid_tile_generator.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,180 +0,0 @@
-//  $Id: grid_tile_generator.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../command_line_arguments.hxx&quot;
-#include &quot;grid_tile.hxx&quot;
-#include &quot;grid_tile_generator.hxx&quot;
-
-GridTileGenerator::GridTileGenerator (std::string filename)
-  : emptytile (new GridTile (&quot;feuerkraft/emptytile&quot;))
-{
-  SCM fdes = scm_open_file (gh_str02scm(filename.c_str ()), 
-			    gh_str02scm(&quot;r&quot;));
-  SCM lst  = scm_read (fdes);
-
-  lst = gh_cdr(lst); // Skip the 'tiles' mark
-
-  while (gh_pair_p(lst))
-    {
-      parse_line (gh_car (lst));
-      lst = gh_cdr(lst); 
-    }
-
-  scm_close (fdes);
-}
-
-GridTileGenerator::~GridTileGenerator ()
-{
-  delete emptytile;
-}
-
-void
-GridTileGenerator::parse_line (SCM desc)
-{
-  SCM data = gh_car (desc);
-  SCM lst  = gh_cdr (desc);
-
-  GridTileData gdata = scm2GridTileData (data);
-
-  TileTable::iterator i;
-  for (i = tiles.begin (); i != tiles.end (); ++i)
-    if (i-&gt;first == gdata)
-      break;
-
-  if (i != tiles.end ())
-    {
-      std::cout &lt;&lt; &quot;GridTileGenerator: collision in file: &quot; &lt;&lt; gdata &lt;&lt; std::endl;
-    }
-  else
-    {
-      tiles.push_back (TileTableEntry(gdata, scm2GridTileVector (lst)));
-    }
-}
-
-GridTileData
-GridTileGenerator::scm2GridTileData (SCM desc)
-{
-  GridTileData data;
-  // FIXME: No error checking here
-  data.ul = symbol2GroundType(gh_car (desc));
-  data.ur = symbol2GroundType(gh_cadr (desc));
-  data.br = symbol2GroundType(gh_caddr (desc));
-  data.bl = symbol2GroundType(gh_car(gh_cdddr (desc)));
-  
-  return data;
-}
-
-GroundType
-GridTileGenerator::symbol2GroundType (SCM symbol)
-{
-  if (gh_equal_p (gh_symbol2scm (&quot;s&quot;), symbol))
-    {
-      return GT_SAND;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;f&quot;), symbol))
-    {
-      return GT_FLATWATER;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;d&quot;), symbol))
-    {
-      return GT_DEEPWATER;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;g&quot;), symbol))
-    {
-      return GT_GRASS;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;m&quot;), symbol))
-    {
-      return GT_MUD;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;a&quot;), symbol))
-    {
-      return GT_ASPHALT;
-    }
-  else if (gh_equal_p (gh_symbol2scm (&quot;w&quot;), symbol))
-    {
-      return GT_WETSAND;
-    }
-  else 
-    {
-      return GT_EMPTY;
-    }
-}
-
-std::vector&lt;GridTile*&gt;
-GridTileGenerator::scm2GridTileVector (SCM desc)
-{
-  std::vector&lt;GridTile*&gt; vec;
-
-  while (gh_pair_p(desc))
-    {
-      char* str = gh_scm2newstr (gh_car (desc), 0);
-      vec.push_back (new GridTile (str));
-      
-#ifndef WIN32
-      free (str);
-#endif
-
-      desc = gh_cdr (desc);
-    }
-
-  return vec;
-}
-
-GridTile*
-GridTileGenerator::create (const GridTileData&amp; data)
-{
-  if (data.ur == GT_EMPTY || data.ul == GT_EMPTY || data.bl == GT_EMPTY || data.br == GT_EMPTY)
-    {
-      return 0;
-    }
-  
-  // We switch to transparent when the tile has the same 'color' as the base ground
-  // FIXME: ground color needs to be variable
-  if (data.ur == GT_SAND &amp;&amp; data.ul == GT_SAND &amp;&amp; data.bl == GT_SAND &amp;&amp; data.br == GT_SAND)
-    {
-      return 0;
-    }
-
-  TileTable::iterator i;
-  for (i = tiles.begin (); i != tiles.end (); ++i)
-    if (i-&gt;first == data)
-      break;
-
-  if (i != tiles.end ())
-    {
-      if (i-&gt;second.size () &gt; 0)
-	return (i-&gt;second)[rand () % (i-&gt;second.size ())]; // Return a random tile
-      else
-	{
-	  // The tile list is empty, no tile available
-          if (args-&gt;verbose)
-            std::cout &lt;&lt; &quot;GridTileGenerator: Warning: Tile: &quot; &lt;&lt; data &lt;&lt; &quot; missing&quot; &lt;&lt; std::endl;
-          return 0;
-	}
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;GridTileGenerator: Warning: Tile: &quot; &lt;&lt; data &lt;&lt; &quot; missing&quot; &lt;&lt; std::endl;
-      return emptytile;
-    }
-}
-
-/* EOF */

Copied: trunk/src/groundmap/ground_map_data.cpp (from rev 341, trunk/src/groundmap/ground_map_data.cxx)


Property changes on: trunk/src/groundmap/ground_map_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/ground_map_data.cxx
===================================================================
--- trunk/src/groundmap/ground_map_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/ground_map_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,22 +0,0 @@
-//  $Id: ground_map_data.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;ground_map_data.hxx&quot;
-
-/* EOF */

Copied: trunk/src/groundmap/ground_map_data_factory.cpp (from rev 341, trunk/src/groundmap/ground_map_data_factory.cxx)


Property changes on: trunk/src/groundmap/ground_map_data_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/ground_map_data_factory.cxx
===================================================================
--- trunk/src/groundmap/ground_map_data_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/ground_map_data_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,71 +0,0 @@
-//  $Id: ground_map_data_factory.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;tile_map_data.hxx&quot;
-#include &quot;multi_ground_map.hxx&quot;
-#include &quot;grid_map_data.hxx&quot;
-#include &quot;ground_map_data_factory.hxx&quot;
-
-GroundMapData* 
-GroundMapDataFactory::create (SCM desc)
-{
-  MultiGroundMapData* multigroundmap = new MultiGroundMapData ();
-
-  /*std::cout &lt;&lt; &quot;GroundMapFactory: desc: &quot;&lt;&lt; std::flush;
-  gh_display (desc);
-  gh_newline ();*/
-
-  while (gh_pair_p (desc))
-    {
-      SCM symbol = gh_caar (desc);
-      SCM data   = gh_cdar (desc);
-
-      /*      
-      std::cout &lt;&lt; &quot;GroundMapFactory: symbol: &quot;&lt;&lt; std::flush;
-      gh_display (symbol);
-      gh_newline ();
-      
-      std::cout &lt;&lt; &quot;GroundMapFactory: data: &quot;&lt;&lt; std::flush;
-      gh_display (data);
-      gh_newline ();
-      */
-      if (gh_equal_p (gh_symbol2scm (&quot;tilemap&quot;), symbol))
-	{
-	  multigroundmap-&gt;add(new TileMapData (data));
-	}
-      else if (gh_equal_p (gh_symbol2scm (&quot;gridmap&quot;), symbol))
-	{
-	  multigroundmap-&gt;add(new GridMapData (data));
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;GroundMapFactory: Unknown map type: &quot; &lt;&lt; std::flush;
-	  gh_display (symbol);
-	  gh_newline ();
-	  //return 0;
-	}
-
-      desc = gh_cdr (desc);
-    }
-
-  return multigroundmap;
-}
-
-/* EOF */

Copied: trunk/src/groundmap/ground_type.cpp (from rev 341, trunk/src/groundmap/ground_type.cxx)


Property changes on: trunk/src/groundmap/ground_type.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/ground_type.cxx
===================================================================
--- trunk/src/groundmap/ground_type.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/ground_type.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,48 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;ground_type.hxx&quot;
-
-std::string GroundType2string(const GroundType&amp; a)
-{
-  switch (a)
-    {
-    case GT_EMPTY:
-      return &quot;empty&quot;;
-    case GT_SAND:
-      return &quot;sand&quot;;
-    case GT_GRASS:
-      return &quot;grass&quot;;
-    case GT_MUD:
-      return &quot;mud&quot;;
-    case GT_FLATWATER:
-      return &quot;flatwater&quot;;
-    case GT_DEEPWATER:
-      return &quot;deepwater&quot;;
-    case GT_ASPHALT: 
-      return &quot;asphalt&quot;;
-    case GT_WETSAND:
-      return &quot;wetsand&quot;;
-    default:
-      return &quot;unknown&quot;;
-    }
-}
-
-/* EOF */

Copied: trunk/src/groundmap/multi_ground_map.cpp (from rev 341, trunk/src/groundmap/multi_ground_map.cxx)


Property changes on: trunk/src/groundmap/multi_ground_map.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/multi_ground_map.cxx
===================================================================
--- trunk/src/groundmap/multi_ground_map.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/multi_ground_map.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,77 +0,0 @@
-//  $Id: multi_ground_map.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;multi_ground_map.hxx&quot;
-
-MultiGroundMap::MultiGroundMap (const MultiGroundMapData&amp; data)
-  : MultiGroundMapData (data)
-{
-  for (std::vector&lt;GroundMapData*&gt;::iterator i = mapsdata.begin (); i != mapsdata.end (); ++i)
-    {
-      maps.push_back ((*i)-&gt;create ());
-    }
-}
-
-MultiGroundMap::~MultiGroundMap ()
-{
-  for (std::vector&lt;GroundMap*&gt;::iterator i = maps.begin (); i != maps.end (); ++i)
-    {
-      delete *i;
-    }
-}
-
-/** Return the type of ground, x and y are in world coordinates */
-GroundType
-MultiGroundMap::get_groundtype (float x, float y)
-{
-  for (std::vector&lt;GroundMap*&gt;::reverse_iterator i = maps.rbegin (); i != maps.rend (); ++i)
-    {
-      GroundType type = (*i)-&gt;get_groundtype (x, y);
-      if (type != GT_EMPTY)
-	return type;
-    }  
-  return GT_SAND;
-}
-
-void
-MultiGroundMap::draw(View&amp; view)
-{
-  for (std::vector&lt;GroundMap*&gt;::reverse_iterator i = maps.rbegin (); i != maps.rend (); ++i)
-    {
-      (*i)-&gt;draw(view);
-    }
-}
-
-void
-MultiGroundMap::draw_levelmap(LevelMap&amp; levelmap)
-{
-  for (std::vector&lt;GroundMap*&gt;::reverse_iterator i = maps.rbegin (); i != maps.rend (); ++i)
-    {
-      (*i)-&gt;draw_levelmap(levelmap);
-    } 
-}
-
-void
-MultiGroundMap::add (GroundMap* groundmap)
-{
-  if (groundmap)
-    maps.push_back (groundmap);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/multi_ground_map_data.cpp (from rev 341, trunk/src/groundmap/multi_ground_map_data.cxx)


Property changes on: trunk/src/groundmap/multi_ground_map_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/multi_ground_map_data.cxx
===================================================================
--- trunk/src/groundmap/multi_ground_map_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/multi_ground_map_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,44 +0,0 @@
-//  $Id: multi_ground_map_data.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;multi_ground_map.hxx&quot;
-#include &quot;multi_ground_map_data.hxx&quot;
-
-MultiGroundMapData::MultiGroundMapData ()
-{
-}
-
-MultiGroundMapData::~MultiGroundMapData ()
-{
-  // FIXME: delete here could be problematic when we copy this class
-}
-
-void
-MultiGroundMapData::add (GroundMapData* groundmapdata)
-{
-  mapsdata.push_back (groundmapdata);
-}
-
-GroundMap*
-MultiGroundMapData::create()
-{
-  return new MultiGroundMap(*this);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/sprite_tile.cpp (from rev 341, trunk/src/groundmap/sprite_tile.cxx)


Property changes on: trunk/src/groundmap/sprite_tile.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/sprite_tile.cxx
===================================================================
--- trunk/src/groundmap/sprite_tile.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/sprite_tile.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,50 +0,0 @@
-//  $Id: sprite_tile.cxx,v 1.4 2003/05/19 19:00:56 grumbel Exp $
-// 
-//  Feuerkraft
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef SPRITETILE_CXX
-#define SPRITETILE_CXX
-
-#include &lt;ClanLib/display.h&gt;
-#include &quot;sprite_tile.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../view.hxx&quot;
-
-SpriteTile::SpriteTile (const SpriteTileData&amp; data)
-  : SpriteTileData (data),
-    sprite (resources-&gt;get_sprite (sprite_location.c_str ()))
-{
-  sprite.set_alignment (origin_top_left);
-}
-
-void
-SpriteTile::draw(View&amp; view, float x, float y)
-{
-  view.get_sc().color().draw(sprite, x, y);
-}
-
-/** FIXME: 'float delta' should be replaced with GameDelta */
-void
-SpriteTile::update (float delta)
-{
-  sprite.update (delta);
-}
-
-#endif
-
-/* EOF */

Copied: trunk/src/groundmap/sprite_tile_data.cpp (from rev 341, trunk/src/groundmap/sprite_tile_data.cxx)


Property changes on: trunk/src/groundmap/sprite_tile_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/sprite_tile_data.cxx
===================================================================
--- trunk/src/groundmap/sprite_tile_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/sprite_tile_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,37 +0,0 @@
-//  $Id: sprite_tile_data.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;sprite_tile.hxx&quot;
-#include &quot;sprite_tile_data.hxx&quot;
-
-SpriteTileData::SpriteTileData ()
-{
-}
-
-SpriteTileData::~SpriteTileData ()
-{
-}
-
-Tile*
-SpriteTileData::create_Tile ()
-{
-  return new SpriteTile (*this);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/tile_data_factory.cpp (from rev 341, trunk/src/groundmap/tile_data_factory.cxx)


Property changes on: trunk/src/groundmap/tile_data_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/tile_data_factory.cxx
===================================================================
--- trunk/src/groundmap/tile_data_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/tile_data_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,86 +0,0 @@
-//  $Id: tile_data_factory.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-
-#include &quot;tile_data.hxx&quot;
-#include &quot;sprite_tile_data.hxx&quot;
-#include &quot;sprite_tile.hxx&quot;
-#include &quot;tile_data_factory.hxx&quot;
-
-TileData*
-TileDataFactory::create (SCM desc)
-{
-  SCM symbol = gh_car (desc);
-  SCM data   = gh_cdr (desc);
-  
-  if (gh_equal_p (gh_symbol2scm (&quot;spritetile&quot;), symbol))
-    {
-      return create_SpriteTileData (data);
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;TileDataFactory: Unknown tile type: '&quot; &lt;&lt; std::flush;
-      gh_display (symbol);
-      std::cout &lt;&lt; &quot;' with data: &quot; &lt;&lt; std::flush;
-      gh_display (data);
-      std::cout &lt;&lt; std::endl;
-      return 0;
-    }
-}
-
-SpriteTileData*
-TileDataFactory::create_SpriteTileData (SCM desc)
-{
-  SpriteTileData* sprite_data = new SpriteTileData ();
-
-  //std::cout &lt;&lt; &quot;TileDataFactory:create_SpriteTileData:&quot; &lt;&lt; std::flush;
-  //gh_display (desc);
-  //std::cout &lt;&lt; std::endl;
-
-  while (!gh_null_p (desc))
-    {
-      SCM symbol = gh_caar(desc);
-      SCM data   = gh_cdar(desc);
-
-      if (gh_equal_p (gh_symbol2scm (&quot;location&quot;), symbol))
-	{
-	  char* str = gh_scm2newstr(gh_car (data), 0);
-	  sprite_data-&gt;sprite_location = str;
-#ifndef WIN32	// Freeing this crashed under VisualC++
-	  free (str);
-#endif	
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;TileDataFactory: Unknown sprite tile type: '&quot; &lt;&lt; std::flush;
-	  gh_display (symbol);
-	  std::cout &lt;&lt; &quot;' with data: &quot; &lt;&lt; std::flush;
-	  gh_display (data);
-	  std::cout &lt;&lt; std::endl;
-	  return 0;
-	}
-
-      desc = gh_cdr (desc);
-    }
-
-  return sprite_data;
-}
-
-/* EOF */

Copied: trunk/src/groundmap/tile_map.cpp (from rev 341, trunk/src/groundmap/tile_map.cxx)


Property changes on: trunk/src/groundmap/tile_map.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/tile_map.cxx
===================================================================
--- trunk/src/groundmap/tile_map.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/tile_map.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,110 +0,0 @@
-//  $Id: tile_map.cxx,v 1.5 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;tile.hxx&quot;
-#include &quot;tile_data.hxx&quot;
-#include &quot;tile_map.hxx&quot;
-
-TileMap::TileMap (const TileMapData&amp; data)
-  : TileMapData (data)
-{
-  // Create the tiles from tiles_data
-  for (std::vector&lt;TileData*&gt;::iterator it = tiles_data.begin ();
-       it != tiles_data.end ();
-       ++it)
-    {
-      //std::cout &lt;&lt; &quot;Tiles: &quot; &lt;&lt; *it &lt;&lt; std::endl;
-      if (*it)
-	tiles.push_back ((*it)-&gt;create_Tile ());
-      else
-	tiles.push_back (NULL);
-    }
-
-  // Create the tilemap out of tiles_data and tiles
-  tilemap.resize (tilemap_data.size ());
-  for (unsigned int i = 0; i &lt; tilemap.size (); ++i)
-    {
-      if (tilemap_data[i] &gt;= 0 &amp;&amp; tilemap_data[i] &lt; int(tiles.size()))
-	{
-	  tilemap[i] = tiles[tilemap_data[i]];
-	  //std::cout &lt;&lt; &quot;Tile: &quot; &lt;&lt; tilemap_data[i] &lt;&lt; &quot; &quot; &lt;&lt; tiles[tilemap_data[i]] &lt;&lt; std::endl;
-	}
-      else
-	{
-	  //std::cout &lt;&lt; &quot;Tile&quot; &lt;&lt; tiles.size() &lt;&lt; &quot;: &quot; &lt;&lt; tilemap_data[i] &lt;&lt; std::endl;
-	}
-    }
-  
-  //std::cout &lt;&lt; &quot;Tilemap: &quot; &lt;&lt; width &lt;&lt; &quot;x&quot; &lt;&lt; height &lt;&lt; std::endl;
-
-}
-
-TileMap::~TileMap ()
-{
-  for (std::vector&lt;Tile*&gt;::iterator i = tiles.begin (); i != tiles.end (); ++i)
-    delete *i;
-}
-
-GroundType
-TileMap::get_groundtype (float x, float y)
-{
-  return GT_FLATWATER;
-}
-
-void
-TileMap::draw(View&amp; view)
-{
-  //std::cout &lt;&lt; &quot;Offset: &quot; &lt;&lt; view-&gt;get_x_offset () &lt;&lt; std::endl;
-
-  int tile_x_offset = int(-(view.get_x_offset () / 40));
-  int tile_y_offset = int(-(view.get_y_offset () / 40));
-  int tile_width    = tile_x_offset + (view.get_width () / 40) + 1;
-  int tile_height   = tile_y_offset + (view.get_height () / 40) + 1; 
- // FIXME: one tile more to avoid artefacts, hack, hack hack...
-  
-
-  for (int y = tile_y_offset; y &lt; tile_height; ++y)
-    for (int x = tile_x_offset; x &lt; tile_width; ++x)
-    {
-      // FIXME: Hard coded tilemap size is ugly
-      if (y &lt; height &amp;&amp; y &gt;= 0 &amp;&amp; x &lt; width &amp;&amp; x &gt;= 0) // Could be optimized away
-	if (tilemap [(width * y) + x])
-          {
-            tilemap [(width * y) + x]-&gt;draw (view , 
-                                             int(x * 40),
-                                             int(y * 40));
-          }
-    }
-}
-
-void
-TileMap::draw_levelmap (LevelMap&amp; levelmap)
-{
-}
-
-void
-TileMap::update (float delta)
-{
-  //std::cout &lt;&lt; &quot;TileMap::update&quot; &lt;&lt; std::endl;
-  for (std::vector&lt;Tile*&gt;::iterator i = tiles.begin (); i != tiles.end (); ++i)
-    if (*i)
-      (*i)-&gt;update (delta);
-}
-
-/* EOF */

Copied: trunk/src/groundmap/tile_map_data.cpp (from rev 341, trunk/src/groundmap/tile_map_data.cxx)


Property changes on: trunk/src/groundmap/tile_map_data.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/groundmap/tile_map_data.cxx
===================================================================
--- trunk/src/groundmap/tile_map_data.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/groundmap/tile_map_data.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,156 +0,0 @@
-//  $Id: tile_map_data.cxx,v 1.5 2003/10/20 20:58:40 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/Providers/png_provider.h&gt;
-
-#include &quot;../path_manager.hxx&quot;
-#include &quot;tile_data_factory.hxx&quot;
-#include &quot;tile_map_data.hxx&quot;
-#include &quot;tile_map.hxx&quot;
-
-TileMapData::TileMapData (SCM desc)
-{
-  width = -1;
-  height = -1;
-
-  while (!gh_null_p (desc))
-    {
-      SCM symbol = gh_caar(desc);
-      SCM data   = gh_cdar(desc);
-
-      if (gh_equal_p (gh_symbol2scm (&quot;width&quot;), symbol))
-	{
-	  width = gh_scm2int(gh_car (data));
-	}
-      else if (gh_equal_p (gh_symbol2scm (&quot;height&quot;), symbol))
-	{
-	  height = gh_scm2int(gh_car (data));
-	}
-      else if (gh_equal_p (gh_symbol2scm (&quot;tiles&quot;), symbol))
-	{
-	  parse_tiles (data);
-	}
-      else if (gh_equal_p (gh_symbol2scm (&quot;file&quot;), symbol))
-	{
-	  parse_from_file (data);
-	}
-      else if (gh_equal_p (gh_symbol2scm (&quot;map&quot;), symbol))
-	{
-	  parse_map (data);
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;TileMapData: Unknown data type: '&quot; &lt;&lt; std::flush;
-	  gh_display (symbol);
-	  std::cout &lt;&lt; &quot;' with data: &quot; &lt;&lt; std::flush;
-	  gh_display (data);
-	  std::cout &lt;&lt; std::endl;
-	  return;
-	}
-
-      desc = gh_cdr (desc);
-    }
-}
-
-TileMapData::~TileMapData ()
-{ 
-}
-
-void
-TileMapData::parse_from_file (SCM desc)
-{
-  char* str = gh_scm2newstr(gh_car (desc), 0);
-  std::cout &lt;&lt; &quot;Loading from: &quot; &lt;&lt; str &lt;&lt; std::endl;
-  std::string filename = str;
-  free (str);
-
-  CL_PNGProvider provider(path_manager.complete(&quot;missions/&quot; + filename));
-
-  provider.lock ();
-  //FIXME:Display2 assert (provider.is_indexed ());
-
-  width  = provider.get_width ();
-  height = provider.get_height ();
-
-  tilemap_data.resize (width * height);
-  
-  unsigned char* buffer = static_cast&lt;unsigned char*&gt;(provider.get_data ());
-  for (int i = 0; i &lt; width * height; ++i)
-    tilemap_data[i] = buffer[i];
-
-  provider.unlock ();
-}
-
-void
-TileMapData::parse_map (SCM desc)
-{
-  assert (width != -1);
-  assert (height != -1);
-  tilemap_data.resize (width * height);
-  
-  // Init the map to '0'
-  for (std::vector&lt;int&gt;::iterator it = tilemap_data.begin ();
-       it != tilemap_data.end (); ++it)
-    *it = 0;
-  
-  /*std::cout &lt;&lt; &quot;Tilemap MapData: &quot; &lt;&lt; std::flush;
-  gh_display (desc);
-  gh_newline ();*/
-  
-  int i = 0;
-  bool to_large = false;
-  while (!gh_null_p (desc))
-    {
-      if (i &lt; static_cast&lt;int&gt;(tilemap_data.size()))
-	{
-	  tilemap_data[i] = gh_scm2int (gh_car (desc));
-	  ++i;
-	}
-      else
-	{
-	  to_large = true;
-	  ++i;
-	}
-      
-      desc = gh_cdr(desc);
-    }
-
-  std::cout &lt;&lt; &quot;TileMapData: map to large: &quot; &lt;&lt; width * height
-	    &lt;&lt; &quot; &lt; &quot; &lt;&lt; i &lt;&lt; std::endl;
-}
-
-void
-TileMapData::parse_tiles (SCM desc)
-{
-  //std::cout &lt;&lt; &quot;TileMapData::parse_tiles: &quot; tiles_ &lt;&lt; std::endl;
-  while (!gh_null_p (desc))
-    {
-      tiles_data.push_back (TileDataFactory::create (gh_car(desc)));
-      desc = gh_cdr (desc);
-    }
-}
-
-GroundMap*
-TileMapData::create ()
-{
-  return new TileMap (*this);
-}
-
-/* EOF */

Copied: trunk/src/guile.cpp (from rev 341, trunk/src/guile.cxx)


Property changes on: trunk/src/guile.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/guile.cxx
===================================================================
--- trunk/src/guile.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/guile.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,340 +0,0 @@
-//  $Id: guile.cxx,v 1.18 2003/08/20 00:15:10 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &lt;guile/gh.h&gt;
-#include &lt;ClanLib/Core/System/cl_assert.h&gt;
-
-#include &quot;property.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;guile.hxx&quot;
-
-namespace Guile {
-std::string
-scm2string (SCM data)
-{
-  std::string str;
-  
-  if (gh_string_p(data))
-    {
-      char* tmpstr = gh_scm2newstr(data, 0);
-      str = tmpstr;
-      free(tmpstr);
-    } else {
-      SCM scmstr = scm_make_string(SCM_MAKINUM(0), SCM_UNDEFINED);
-      SCM port = scm_mkstrport(SCM_INUM0, scmstr,
-                               SCM_OPN | SCM_WRTNG, &quot;scm_mkstrport&quot;);
-      scm_display(data, port);
-      char* tmpstr = gh_scm2newstr(scmstr, 0);
-      str = tmpstr;
-      free(tmpstr);
-    }
-  return str;
-}
-
-SCM vector2scm (const FloatVector2d&amp; vec)
-{
-  /** If this causes throuble on WIN32, replace it with gh_cons() */
-  return SCM_BOOL_F; /*scm_listify (gh_symbol2scm (&quot;pos&quot;),
-                       gh_double2scm(vec.x),
-                       gh_double2scm(vec.y),
-                       gh_double2scm(vec.z),
-                       SCM_UNDEFINED);*/
-}
-
-SCM pos2scm (int x, int y)
-{
-  return SCM_BOOL_F;/*scm_listify (gh_symbol2scm (&quot;pos&quot;),
-                      gh_int2scm (x),
-                      gh_int2scm (y), 
-                      SCM_UNDEFINED);*/
-}
-
-void pretty_print (std::ostream&amp; stream, SCM obj)
-{
-  std::cout &lt;&lt; &quot;pretty_print&quot; &lt;&lt; std::endl;
-  // FIXME: ...lalala..
-  gh_write (obj);
-  gh_newline ();
-
-}
-
-bool equal_p(SCM a, SCM b)
-{
-  return SCM_NFALSEP(scm_equal_p(a, b));
-}
-
-SCM symbol2scm(const char* str)
-{
-  return scm_str2symbol(str);
-}
-
-std::string keyword2string(SCM keyword)
-{
-  assert(SCM_KEYWORDP(keyword));
-  //puts(&quot;keyword2string: &quot;);
-  //gh_display(keyword);
-  //gh_newline();
-  //gh_display(scm_keyword_dash_symbol(keyword));
-  //gh_newline();
-
-  char* str = gh_symbol2newstr(scm_keyword_dash_symbol(keyword), 0);
-  std::string ret = str + 1; // skip the dash
-  free(str);
-  return ret;
-}
-
-AList keywords2alist(SCM lst)
-{
-  AList alist;
-  while(gh_pair_p(lst) &amp;&amp; !gh_null_p(gh_cdr(lst)))
-    {
-      SCM key  = gh_car(lst);
-      SCM data = gh_cadr(lst);
-    
-      if (scm_keyword_p(key) == SCM_BOOL_F)
-        {
-          std::cout &lt;&lt; &quot;Skipping keyword: &quot; &lt;&lt; key &lt;&lt; std::endl;
-        }
-      else
-        {
-          std::string keyword = Guile::keyword2string(key);
-          if (gh_string_p(data))
-            {
-              alist.set_string(keyword,
-                               Guile::scm2string(data));
-            }
-          else if (gh_exact_p(data))
-            {
-              alist.set_int(keyword,
-                            gh_scm2int(data));
-            }
-          else if (gh_inexact_p(data))
-            {
-              alist.set_float(keyword,
-                              gh_scm2double(data));
-            }
-          else if (gh_boolean_p(data))
-            {
-              alist.set_bool(keyword,
-                             gh_scm2bool(data));
-            }
-          else if (gh_list_p(data) &amp;&amp; gh_length(data) == 2
-                   &amp;&amp; gh_exact_p(gh_car(data)) 
-                   &amp;&amp; gh_exact_p(gh_cadr(data)))
-            {
-              IntVector2d vec;
-              vec.x = gh_scm2int(gh_car(data));
-              vec.y = gh_scm2int(gh_cadr(data));
-              alist.set_int_vector2d(keyword,
-                                     vec);
-            }
-          else if (gh_symbol_p(data))
-            {
-              alist.set_string(keyword,
-                               Guile::symbol2string(data));
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;Guile: Error: Couldn't handle data&quot; &lt;&lt; std::endl;
-              gh_display(data);
-              gh_newline();
-            }          
-        }
-
-      lst = gh_cddr(lst);
-    }
-  return alist;
-}
-
-AList scm2alist(SCM lst)
-{
-  AList alist;
-  while(!gh_null_p(lst))
-    {
-      SCM key  = gh_caar(lst);
-      SCM data = gh_cdar(lst);
-
-      if (gh_pair_p(data) &amp;&amp; gh_null_p(gh_cdr(data)))
-        data = gh_car(data);
-
-      if (!gh_symbol_p(key))
-        {
-          std::cout &lt;&lt; &quot;Guile: Error: key not a symbol&quot; &lt;&lt; std::endl;
-          gh_display(key);
-          gh_newline();
-        }
-      else
-        {
-          if (gh_string_p(data))
-            {
-              alist.set_string(Guile::symbol2string(key), 
-                               Guile::scm2string(data));
-            }
-          else if (gh_exact_p(data))
-            {
-              alist.set_int(Guile::symbol2string(key), 
-                            gh_scm2int(data));
-            }
-          else if (gh_inexact_p(data))
-            {
-              alist.set_float(Guile::symbol2string(key), 
-                              gh_scm2double(data));
-            }
-          else if (gh_boolean_p(data))
-            {
-              alist.set_bool(Guile::symbol2string(key), 
-                             gh_scm2bool(data));
-            }
-          else if (gh_list_p(data) &amp;&amp; gh_length(data) == 2
-                   &amp;&amp; gh_exact_p(gh_car(data)) 
-                   &amp;&amp; gh_exact_p(gh_cadr(data)))
-            {
-              IntVector2d vec;
-              vec.x = gh_scm2int(gh_car(data));
-              vec.y = gh_scm2int(gh_cadr(data));
-              alist.set_int_vector2d(Guile::symbol2string(key), 
-                                     vec);
-            }
-          else if (gh_symbol_p(data))
-            {
-              alist.set_string(Guile::symbol2string(key),
-                               Guile::symbol2string(data));
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;Guile: Error: Couldn't handle data&quot; &lt;&lt; std::endl;
-              gh_display(data);
-              gh_newline();
-            }
-        }
-
-      lst = gh_cdr(lst);
-    }
-  return alist;
-}
-
-std::string symbol2string(SCM symbol)
-{
-  char* c_str = gh_symbol2newstr(symbol, 0);
-  std::string str = c_str;
-  free(c_str);
-  return str;
-}
-
-void enter_repl()
-{
-  SCM func = gh_lookup(&quot;feuerkraft:repl&quot;);
-  if (func != SCM_BOOL_F)
-    {
-      scm_call_0(func);
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;### Error: feuerkraft.scm must be loaded to use the repl!&quot; &lt;&lt; std::endl;
-    }
-}
-
-void scm2property(PropertySet&amp; properties, const char* name, SCM value)
-{
-  if (gh_string_p(value))
-    {
-      properties.set_string(name, Guile::scm2string(value));
-    }
-  else if (gh_boolean_p(value))
-    {
-      properties.set_bool(name, gh_scm2bool(value));
-    }
-  else if (gh_exact_p(value))
-    {
-      properties.set_int(name, gh_scm2int(value));
-    }
-  else if (gh_inexact_p(value))
-    {
-      properties.set_float(name, gh_scm2double(value));
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;Unhandled value&quot; &lt;&lt; std::endl;
-    }
-}
-
-SCM  property2scm(const Property&amp; property)
-{
-  switch(property.get_type())
-    {
-    case Property::T_INT:
-      return gh_int2scm(property.get_int());
-      break;
-              
-    case Property::T_FLOAT:
-      return gh_double2scm(property.get_float());
-      break;
-
-    case Property::T_BOOL:
-      return gh_bool2scm(property.get_bool());
-      break;
-
-    case Property::T_STRING:
-      return gh_str02scm(property.get_string().c_str());
-      break;
-
-    default:
-      std::cout &lt;&lt; &quot;Guile: Unhandled property type&quot; &lt;&lt; std::endl;
-      return SCM_UNSPECIFIED;
-      break;
-    }
-}
-
-void enable_debug()
-{
-#if 0 // OLD Guile
-  SCM_DEVAL_P = 1;
-  SCM_BACKTRACE_P = 1;
-  SCM_RECORD_POSITIONS_P = 1;
-  SCM_RESET_DEBUG_MODE;
-#else
-  gh_eval_str(&quot;(debug-enable 'debug)&quot;
-              &quot;(debug-enable 'backtrace)&quot;
-              &quot;(read-enable  'positions)&quot;);
-#endif
-}
-
-/** Disable all debugging */
-void disable_debug()
-{
-  gh_eval_str(&quot;(debug-disable 'debug)&quot;
-              &quot;(debug-disable 'backtrace)&quot;
-              &quot;(read-disable  'positions)&quot;);
-}
-
-void enable_readline()
-{
-#ifdef WITH_STATIC_READLINE
-  std::cout &lt;&lt; &quot;Loading readline... &quot; &lt;&lt; std::endl;
-  scm_init_readline();
-#endif
-
-  gh_eval_str(&quot;(use-modules (ice-9 readline))&quot;
-              &quot;(activate-readline)&quot;);
-}
-
-} // namespace Guile
-
-/* EOF */

Copied: trunk/src/help.cpp (from rev 341, trunk/src/help.cxx)


Property changes on: trunk/src/help.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/help.cxx
===================================================================
--- trunk/src/help.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/help.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,57 +0,0 @@
-//  $Id: help.cxx,v 1.2 2003/06/06 11:11:19 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;fonts.hxx&quot;
-#include &quot;help.hxx&quot;
-
-Help::Help()
-{
-  font = Fonts::font;
-}
-
-Help::~Help()
-{
-}
-
-void
-Help::draw(CL_GraphicContext&amp; gc)
-{
-  int center_x = CL_Display::get_width()/2;
-  int center_y = CL_Display::get_height()/2;
-
-  CL_Display::fill_rect(CL_Rect(center_x - 200, center_y - 150,
-                                center_x + 200, center_y + 150),
-                        CL_Color(100, 100, 0, 230));
-  font.set_alignment(origin_top_left);
-  font.draw(center_x - 190, center_y - 120, 
-            &quot;F1 - show/hide this help screen\n&quot;
-            &quot;Esc - leave game\n&quot;
-            &quot;j  - enter/leave a vehicle\n&quot;
-            &quot;left - turn left\n&quot;
-            &quot;right - turn right\n&quot;
-            );
-}
-
-void
-Help::update(float delta)
-{
-}
-
-/* EOF */

Copied: trunk/src/input/axis_button.cpp (from rev 341, trunk/src/input/axis_button.cxx)


Property changes on: trunk/src/input/axis_button.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/axis_button.cxx
===================================================================
--- trunk/src/input/axis_button.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/axis_button.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,72 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;input_axis.hxx&quot;
-#include &quot;axis_button.hxx&quot;
-
-AxisButton::AxisButton(InputAxis* axis, bool top)
-  : axis(axis),
-    down(false),
-    top(top)
-{
-  on_axis_move_slot = axis-&gt;on_move().connect(this, &amp;AxisButton::on_axis_move);
-}
-
-AxisButton::~AxisButton()
-{
-}
-
-void
-AxisButton::update(float delta)
-{
-}
-
-void
-AxisButton::on_axis_move(float pos)
-{
-  if (top)
-    {
-      if (down &amp;&amp; pos &lt; 0.5f)
-        {
-          down = false;
-          button_up();
-        }
-      else if (!down &amp;&amp; pos &gt; 0.5f)
-        {
-          down = true;
-          button_down();
-        }
-    }
-  else
-    {
-      if (down &amp;&amp; pos &gt; -0.5f)
-        {
-          down = false;
-          button_up();
-        }
-      else if (!down &amp;&amp; pos &lt; -0.5f)
-        {
-          down = true;
-          button_down();
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/input/axis_factory.cpp (from rev 341, trunk/src/input/axis_factory.cxx)


Property changes on: trunk/src/input/axis_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/axis_factory.cxx
===================================================================
--- trunk/src/input/axis_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/axis_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,79 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/joystick.h&gt;
-#include &quot;input_axis_input_device.hxx&quot;
-#include &quot;../feuerkraft_error.hxx&quot;
-#include &quot;../guile.hxx&quot;
-#include &quot;button_factory.hxx&quot;
-#include &quot;button_axis.hxx&quot;
-#include &quot;axis_factory.hxx&quot;
-
-InputAxis* 
-AxisFactory::create(SCM lst)
-{
-  while(gh_pair_p(lst))
-    {
-      SCM sym  = gh_car(lst);
-      SCM data = gh_cdr(lst);
-      
-      if (gh_equal_p(sym, gh_symbol2scm(&quot;joystick-axis&quot;)))
-        {
-          return create_joystick_axis(data);
-        }
-      if (gh_equal_p(sym, gh_symbol2scm(&quot;button-axis&quot;)))
-        {
-          return create_button_axis(data);
-        }
-      else
-        {
-          throw FeuerkraftError(&quot;AxisFactory::create: parse error&quot;);
-        }
-
-      lst = gh_cdr(lst);
-    }
-  return 0;
-}
-
-InputAxis*
-AxisFactory::create_joystick_axis(SCM lst)
-{
-  int device_num = gh_scm2int(gh_car(lst));
-  int axis_num   = gh_scm2int(gh_cadr(lst));
-
-  if (device_num &gt;= 0 &amp;&amp; device_num &lt; CL_Joystick::get_device_count())
-    return new InputAxisInputDevice(CL_Joystick::get_device(device_num), axis_num);
-  else
-    {
-      throw FeuerkraftError(&quot;Error: AxisFactory::create_joystick_axis: &quot; 
-                            + Guile::scm2string(lst));
-      return 0;
-    }
-}
-
-InputAxis*
-AxisFactory::create_button_axis(SCM lst)
-{
-  InputButton* left  = ButtonFactory::create(gh_car(lst));
-  InputButton* right = ButtonFactory::create(gh_cadr(lst));
-
-  return new ButtonAxis(left, right);
-}
-
-/* EOF */

Copied: trunk/src/input/button_axis.cpp (from rev 341, trunk/src/input/button_axis.cxx)


Property changes on: trunk/src/input/button_axis.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/button_axis.cxx
===================================================================
--- trunk/src/input/button_axis.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/button_axis.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,87 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;input_button.hxx&quot;
-#include &quot;button_axis.hxx&quot;
-
-ButtonAxis::ButtonAxis(InputButton* left, InputButton* right)
-  : left(left), right(right)
-{
-  slots.push_back(left-&gt;on_key_down().connect(this, &amp;ButtonAxis::on_left_down));
-  slots.push_back(left-&gt;on_key_up().connect  (this, &amp;ButtonAxis::on_left_up));
-
-  slots.push_back(right-&gt;on_key_down().connect(this, &amp;ButtonAxis::on_right_down));
-  slots.push_back(right-&gt;on_key_up().connect  (this, &amp;ButtonAxis::on_right_up));
-
-  left_state  = false;
-  right_state = false;
-  
-  pos = 0.0f;
-}
-
-void
-ButtonAxis::update(float delta)
-{
-  left-&gt;update(delta);
-  right-&gt;update(delta);
-
-  float new_pos = 0.0f;
-  if (left_state)
-    {
-      new_pos -= 1.0f;
-    }
-  
-  if (right_state)
-    {
-      new_pos += 1.0f;
-    }
-
-  if (new_pos != pos)
-    {
-      pos = new_pos;
-      move(pos);
-    }
-}
-
-void
-ButtonAxis::on_left_up()
-{
-  left_state = false;
-}
-
-void
-ButtonAxis::on_left_down()
-{
-  left_state = true;
-}
-
-void
-ButtonAxis::on_right_up()
-{
-  right_state = false;
-}
-
-void
-ButtonAxis::on_right_down()
-{
-  right_state = true;
-}
-
-/* EOF */

Copied: trunk/src/input/button_factory.cpp (from rev 341, trunk/src/input/button_factory.cxx)


Property changes on: trunk/src/input/button_factory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/button_factory.cxx
===================================================================
--- trunk/src/input/button_factory.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/button_factory.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,111 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/joystick.h&gt;
-#include &lt;ClanLib/Display/keyboard.h&gt;
-#include &lt;ClanLib/Core/System/clanstring.h&gt;
-#include &quot;../guile.hxx&quot;
-#include &quot;../feuerkraft_error.hxx&quot;
-#include &quot;input_button.hxx&quot;
-#include &quot;input_axis.hxx&quot;
-#include &quot;input_button_input_device.hxx&quot;
-#include &quot;axis_factory.hxx&quot;
-#include &quot;axis_button.hxx&quot;
-#include &quot;multi_button.hxx&quot;
-#include &quot;button_factory.hxx&quot;
-
-InputButton* 
-ButtonFactory::create(SCM lst)
-{
-  SCM sym = gh_car(lst);
-
-  if (gh_equal_p(sym, gh_symbol2scm(&quot;joystick-button&quot;)))
-    {
-      return create_joystick_button(gh_cdr(lst));
-    }
-  else if (gh_equal_p(sym, gh_symbol2scm(&quot;keyboard-button&quot;)))
-    {
-      return create_keyboard_button(gh_cdr(lst));
-    }
-  else if (gh_equal_p(sym, gh_symbol2scm(&quot;axis-button&quot;)))
-    {
-      return create_axis_button(gh_cdr(lst));
-    }
-  else if (gh_equal_p(sym, gh_symbol2scm(&quot;multi-button&quot;)))
-    {
-      return create_multi_button(gh_cdr(lst));
-    }
-  else
-    {
-      throw FeuerkraftError(&quot;ButtonFactory::create: parse error: '&quot;
-                            + Guile::scm2string(lst) + &quot;'&quot;);
-    }
-      
-  return 0;
-}
-
-InputButton*
-ButtonFactory::create_axis_button(SCM lst)
-{
-  InputAxis* axis = AxisFactory::create(gh_car(lst));
-  bool top = gh_scm2bool(gh_cadr(lst));
-  
-  return new AxisButton(axis, top);
-}
-
-InputButton*
-ButtonFactory::create_joystick_button(SCM lst)
-{
-  int device_num = gh_scm2int(gh_car(lst));
-  int button_num = gh_scm2int(gh_cadr(lst));
-  
-  if (device_num &gt;= 0 &amp;&amp; device_num &lt; CL_Joystick::get_device_count())
-    return new InputButtonInputDevice(CL_Joystick::get_device(device_num), button_num);
-  else
-    {
-      throw FeuerkraftError(&quot;Error: ButtonFactory::create_joystick_button: device out of range&quot;
-                            + CL_String::to(device_num) + &quot; &quot; + Guile::scm2string(lst));
-    }
-}
-
-InputButton*
-ButtonFactory::create_keyboard_button(SCM lst)
-{
-  std::string key_str = Guile::scm2string(gh_car(lst));
-  int key_num         = CL_Keyboard::get_device().string_to_keyid(key_str);
-
-  // FIXME: No error checking
-  return new InputButtonInputDevice(CL_Keyboard::get_device(), key_num);
-}
-
-InputButton*
-ButtonFactory::create_multi_button(SCM lst)
-{
-  MultiButton* button = new MultiButton();
-  
-  while (!gh_null_p(lst))
-    {
-      button-&gt;add(create(gh_car(lst)));
-      lst = gh_cdr(lst);
-    }
-  
-  return button;
-}
-
-/* EOF */

Copied: trunk/src/input/controller.cpp (from rev 341, trunk/src/input/controller.cxx)


Property changes on: trunk/src/input/controller.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/controller.cxx
===================================================================
--- trunk/src/input/controller.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/controller.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,90 +0,0 @@
-//  $Id: controller.cxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../assert.hxx&quot;
-#include &quot;controller.hxx&quot;
-
-Controller::Controller()
-{
-  buttons.resize(ControllerDef::get_button_count());
-  axes.resize(ControllerDef::get_axis_count());
-}
-
-float
-Controller::get_axis_state(int name) const
-{
-  AssertMsg(name &lt; int(axes.size()), &quot;Controllor: Unknown AxisName&quot;);  
-  return axes[name];
-}
-        
-
-bool
-Controller::get_button_state(int name) const
-{
-  AssertMsg(name &lt; int(buttons.size()), &quot;Controllor: Unknown ButtonName&quot;);  
-  return buttons[name];
-}
-
-void
-Controller::set_axis_state(int name, float pos)
-{
-  AssertMsg(name &lt; static_cast&lt;int&gt;(axes.size()), &quot;Controllor: Unknown AxisName&quot;);
-  axes[name] = pos;
-}
-
-void
-Controller::set_button_state(int name, bool down)
-{
-  AssertMsg(name &lt; static_cast&lt;int&gt;(buttons.size()), &quot;Controller: Unknown ButtonName&quot;);
-  buttons[name] = down;
-}
-
-void
-Controller::add_axis_event(int name, float pos)
-{
-  InputEvent event;
-  event.type = AXIS_EVENT;
-  event.axis.name = name;
-  event.axis.pos  = pos;
-  events.push_back(event);
-}
-
-void
-Controller::add_button_event(int name, bool down)
-{
-  InputEvent event;
-  event.type = BUTTON_EVENT;
-  event.button.name = name;
-  event.button.down = down;
-  events.push_back(event);
-}
-
-InputEventLst
-Controller::get_events() const
-{
-  return events;
-}
-
-void
-Controller::set_events(const InputEventLst&amp; lst)
-{
-  events = lst;
-}
-
-/* EOF */

Copied: trunk/src/input/input_axis_input_device.cpp (from rev 341, trunk/src/input/input_axis_input_device.cxx)


Property changes on: trunk/src/input/input_axis_input_device.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_axis_input_device.cxx
===================================================================
--- trunk/src/input/input_axis_input_device.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_axis_input_device.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,38 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/input_event.h&gt;
-#include &quot;input_axis_input_device.hxx&quot;
-
-InputAxisInputDevice::InputAxisInputDevice(CL_InputDevice&amp; dev, int num)
-  : dev(dev), axis_num(num)
-{
-  slots.push_back(dev.sig_axis_move().connect(this, &amp;InputAxisInputDevice::on_axis_move));
-}
-
-void
-InputAxisInputDevice::on_axis_move(const CL_InputEvent&amp; event)
-{
-  if (event.id == axis_num)
-    {
-      move(event.axis_pos);
-    }
-}
-
-/* EOF */

Copied: trunk/src/input/input_button_input_device.cpp (from rev 341, trunk/src/input/input_button_input_device.cxx)


Property changes on: trunk/src/input/input_button_input_device.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_button_input_device.cxx
===================================================================
--- trunk/src/input/input_button_input_device.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_button_input_device.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,49 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/input_event.h&gt;
-#include &quot;input_button_input_device.hxx&quot;
-
-InputButtonInputDevice::InputButtonInputDevice(CL_InputDevice&amp; dev_, int keycode_)
-  : dev(dev_), keycode(keycode_)
-{
-  slots.push_back(dev.sig_key_down().connect(this, &amp;InputButtonInputDevice::on_key_down));
-  slots.push_back(dev.sig_key_up().connect(this, &amp;InputButtonInputDevice::on_key_up));
-}
-
-void
-InputButtonInputDevice::on_key_down(const CL_InputEvent&amp; event)
-{
-  if (keycode == event.id)
-    {
-      button_down();
-    }
-}
-
-void
-InputButtonInputDevice::on_key_up(const CL_InputEvent&amp; event)
-{
-  if (keycode == event.id)
-    {
-      button_up();
-    }
-}
-
-/* EOF */

Copied: trunk/src/input/input_manager.cpp (from rev 341, trunk/src/input/input_manager.cxx)


Property changes on: trunk/src/input/input_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_manager.cxx
===================================================================
--- trunk/src/input/input_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,98 +0,0 @@
-//  $Id: input_manager.cxx,v 1.4 2003/08/20 00:15:10 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;assert.h&gt;
-#include &lt;stdexcept&gt;
-#include &lt;sstream&gt;
-#include &lt;ClanLib/Display/joystick.h&gt;
-
-#include &quot;../feuerkraft_error.hxx&quot;
-#include &quot;input_manager_custom.hxx&quot;
-#include &quot;input_manager_player.hxx&quot;
-#include &quot;input_manager_impl.hxx&quot;
-#include &quot;input_recorder.hxx&quot;
-#include &quot;input_manager.hxx&quot;
-
-InputManagerImpl* InputManager::impl = 0;
-InputRecorder* InputManager::recorder = 0;
-
-void
-InputManager::init_playback(const std::string&amp; filename)
-{
-  impl = new InputManagerPlayer(filename);
-}
-
-void
-InputManager::init(const std::string&amp; filename)
-{
-  std::cout &lt;&lt; &quot;InputManager::init(&quot; &lt;&lt; filename &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
-  SCM port = scm_open_file(gh_str02scm(filename.c_str()),
-                           gh_str02scm(&quot;r&quot;));
-  SCM lst  = scm_read(port);
-
-  if (gh_equal_p(gh_symbol2scm(&quot;feuerkraft-controller&quot;), gh_car(lst)))
-    {
-      impl = new InputManagerCustom(gh_cdr(lst));
-    }
-  else
-    {
-      throw FeuerkraftError(&quot;Error: not a valid controller file: &quot; + filename);
-    }
-  scm_close_port(port);
-}
-
-void
-InputManager::setup_recorder(const std::string&amp; filename)
-{
-  if (recorder)
-    delete recorder;
-
-  recorder = new InputRecorder(filename);
-}
-
-void 
-InputManager::deinit()
-{
-  delete impl;
-}
-
-void
-InputManager::update(float delta)
-{
-  assert(impl);
-  impl-&gt;update(delta);
-  if (recorder)
-    recorder-&gt;record(get_controller());
-}
-
-Controller
-InputManager::get_controller()
-{
-  assert(impl);
-  return impl-&gt;get_controller();
-}
-
-void
-InputManager::clear()
-{
-  impl-&gt;clear();
-}
-
-/* EOF */

Copied: trunk/src/input/input_manager_custom.cpp (from rev 341, trunk/src/input/input_manager_custom.cxx)


Property changes on: trunk/src/input/input_manager_custom.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_manager_custom.cxx
===================================================================
--- trunk/src/input/input_manager_custom.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_manager_custom.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,141 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/keyboard.h&gt;
-#include &lt;ClanLib/Display/joystick.h&gt;
-#include &lt;ClanLib/Display/display_iostream.h&gt;
-#include &lt;ClanLib/Display/keys.h&gt;
-
-#include &quot;../guile.hxx&quot;
-#include &quot;../assert.hxx&quot;
-#include &quot;../controller_def.hxx&quot;
-#include &quot;input_button_input_device.hxx&quot;
-#include &quot;input_axis_input_device.hxx&quot;
-#include &quot;button_factory.hxx&quot;
-#include &quot;axis_factory.hxx&quot;
-
-#include &quot;input_manager_custom.hxx&quot;
-
-InputManagerCustom::InputManagerCustom(SCM lst)
-{
-  init(lst);
-
-  for (int i = 0; i &lt; (int)buttons.size(); ++i)
-    {
-      if (buttons[i])
-        {
-          slots.push_back(buttons[i]-&gt;on_key_down().connect(this, &amp;InputManagerCustom::on_button_down, i));
-          slots.push_back(buttons[i]-&gt;on_key_up().connect  (this, &amp;InputManagerCustom::on_button_up,   i));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;# Warrning: Button '&quot; &lt;&lt; ControllerDef::button_id2name(i)
-                    &lt;&lt; &quot;' not configured and will not be usable&quot; &lt;&lt; std::endl;
-        }
-    }
-
-  for (int i = 0; i &lt; (int)axes.size(); ++i)
-    {
-      if (axes[i])
-        {
-          slots.push_back(axes[i]-&gt;on_move().connect(this, &amp;InputManagerCustom::on_axis_move, i));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;# Warrning: Axis '&quot; &lt;&lt; ControllerDef::axis_id2name(i)
-                    &lt;&lt; &quot;' not configured and will not be usable&quot; &lt;&lt; std::endl;
-        }
-    }
-}
-
-void 
-InputManagerCustom::init(SCM lst)
-{
-  buttons.resize(ControllerDef::get_button_count());
-  axes.resize(ControllerDef::get_axis_count());
-  
-  while (gh_pair_p(lst))
-    {
-      SCM sym  = gh_caar(lst);
-      SCM data = gh_cadar(lst);
-
-      std::string name = Guile::symbol2string(sym);
-
-      int id = ControllerDef::button_name2id(name);
-      if (id != -1)
-        {
-          buttons[id] = ButtonFactory::create(data);
-        }
-      else
-        {
-          id = ControllerDef::axis_name2id(name);
-          if (id != -1)
-            {
-              axes[id] = AxisFactory::create(data);
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;# Warning: InputManagerCustom::init: Error unknown tag: &quot; 
-                        &lt;&lt; Guile::scm2string(sym) &lt;&lt; std::endl;
-            }
-        }
-
-      lst = gh_cdr(lst);
-    }
-}  
-
-void
-InputManagerCustom::on_axis_move(float pos, int name)
-{
-  add_axis_event(name, pos);
-  controller.set_axis_state(name, pos);
-}
-
-void
-InputManagerCustom::on_button_up(int name)
-{
-  add_button_event(name, false);
-  controller.set_button_state(name, false);
-}
-
-void
-InputManagerCustom::on_button_down(int name)
-{
-  add_button_event(name, true);
-  controller.set_button_state(name, true);
-}
-
-void
-InputManagerCustom::update(float delta)
-{
-  for (int i = 0; i &lt; (int)buttons.size(); ++i)
-    {
-      if (buttons[i])
-        buttons[i]-&gt;update(delta);
-    }
-
-  for (int i = 0; i &lt; (int)axes.size(); ++i)
-    {
-      if (axes[i])
-        axes[i]-&gt;update(delta);
-    }
-}
-
-/* EOF */

Copied: trunk/src/input/input_manager_impl.cpp (from rev 341, trunk/src/input/input_manager_impl.cxx)


Property changes on: trunk/src/input/input_manager_impl.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_manager_impl.cxx
===================================================================
--- trunk/src/input/input_manager_impl.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_manager_impl.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,61 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;input_manager_impl.hxx&quot;
-
-InputEventLst
-InputManagerImpl::get_events()
-{
-  return events;
-}
-
-Controller
-InputManagerImpl::get_controller()
-{
-  controller.set_events(events);
-  return controller;
-}
-
-void
-InputManagerImpl::add_axis_event(int name, float pos)
-{
-  InputEvent event;
-  event.type = AXIS_EVENT;
-  event.axis.name = name;
-  event.axis.pos  = pos;
-  events.push_back(event);
-}
-
-void
-InputManagerImpl::add_button_event(int name, bool down)
-{
-  InputEvent event;
-  event.type = BUTTON_EVENT;
-  event.button.name = name;
-  event.button.down = down;
-  events.push_back(event);
-}
-
-void
-InputManagerImpl::clear()
-{
-  events.clear();
-}
-
-/* EOF */

Copied: trunk/src/input/input_manager_player.cpp (from rev 341, trunk/src/input/input_manager_player.cxx)


Property changes on: trunk/src/input/input_manager_player.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_manager_player.cxx
===================================================================
--- trunk/src/input/input_manager_player.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_manager_player.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,93 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../guile.hxx&quot;
-#include &quot;input_manager_player.hxx&quot;
-
-InputManagerPlayer::InputManagerPlayer(const std::string&amp; filename)
-{
-  std::cout &lt;&lt; &quot;InputManagerPlayer::InputManagerPlayer(&quot; &lt;&lt; filename &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
-  entry_counter = 0;
-  SCM port = scm_open_file(gh_str02scm(filename.c_str()),
-                           gh_str02scm(&quot;r&quot;));
-  SCM entry;
-  while(scm_eof_object_p(entry = scm_read(port)) == SCM_BOOL_F)
-    {
-      InputEventLst lst;
-      int entry_num = gh_scm2int(gh_cadr(entry));
-      entry = gh_cddr(entry);
-      
-      while(gh_pair_p(entry))
-        {
-          lst.push_back(scm2event(gh_car(entry)));
-          entry = gh_cdr(entry);
-        }
-      entries.push(Entry(entry_num, lst));
-    }
-  scm_close_port(port);
-}
-
-InputEvent
-InputManagerPlayer::scm2event(SCM entry)
-{
-  InputEvent event;
-  SCM sym  = gh_car(entry);
-  SCM data = gh_cdr(entry);
-
-  if (gh_equal_p(gh_symbol2scm(&quot;axis&quot;), sym)) 
-    {
-      event.type = AXIS_EVENT;
-      event.axis.name = gh_scm2int(gh_car(data));
-      event.axis.pos  = gh_scm2double(gh_cadr(data));
-    } 
-  else if (gh_equal_p(gh_symbol2scm(&quot;button&quot;), sym))
-    {
-      event.type = BUTTON_EVENT;
-      event.button.name = gh_scm2int(gh_car(data));
-      event.button.down = gh_scm2int(gh_cadr(data));
-    } 
-  else 
-    {
-      std::cout &lt;&lt; &quot;scm2event: Unknown sym: &quot; &lt;&lt; Guile::scm2string(sym) &lt;&lt; std::endl;
-    }
-  return event;
-}
-  
-void
-InputManagerPlayer::update(float delta)
-{
-  if (entries.front().entry_num == entry_counter)
-    {
-      events = entries.front().events;
-      
-      for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
-        {
-          if (i-&gt;type == AXIS_EVENT)
-            controller.set_axis_state(i-&gt;axis.name, i-&gt;axis.pos);
-          else if  (i-&gt;type == BUTTON_EVENT)
-            controller.set_button_state(i-&gt;button.name, i-&gt;button.down);
-        }
-      entries.pop();
-    }
-
-  entry_counter += 1;
-}
-
-/* EOF */

Copied: trunk/src/input/input_recorder.cpp (from rev 341, trunk/src/input/input_recorder.cxx)


Property changes on: trunk/src/input/input_recorder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/input_recorder.cxx
===================================================================
--- trunk/src/input/input_recorder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/input_recorder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,61 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;input_recorder.hxx&quot;
-
-InputRecorder::InputRecorder(const std::string&amp; filename)
-  : out(filename.c_str())
-{
-  entry_counter = 0;
-}
-
-InputRecorder::~InputRecorder()
-{
-  out.close();
-}
-
-void
-InputRecorder::record(const Controller&amp; controller)
-{
-  InputEventLst lst = controller.get_events();
-
-  if (!lst.empty())
-    {
-      out &lt;&lt; &quot;(entry &quot; &lt;&lt; entry_counter &lt;&lt; std::endl;
- 
-      for (InputEventLst::iterator i = lst.begin(); i != lst.end(); ++i)
-        {
-          switch(i-&gt;type)
-            {
-            case AXIS_EVENT:
-              out &lt;&lt; &quot;  (axis &quot; &lt;&lt; i-&gt;axis.name &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;axis.get_pos() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
-              break;
-          
-            case BUTTON_EVENT:
-              out &lt;&lt; &quot;  (button &quot; &lt;&lt; i-&gt;button.name &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;button.down &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
-              break;
-            }
-        }
-      out &lt;&lt; &quot;)\n&quot; &lt;&lt; std::endl;
-    }
-
-  entry_counter += 1;
-}
-
-/* EOF */

Copied: trunk/src/input/multi_button.cpp (from rev 341, trunk/src/input/multi_button.cxx)


Property changes on: trunk/src/input/multi_button.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/input/multi_button.cxx
===================================================================
--- trunk/src/input/multi_button.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/input/multi_button.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,65 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;multi_button.hxx&quot;
-
-MultiButton::MultiButton()
-{
-  press_count = 0;
-}
-
-void
-MultiButton::add(InputButton* button)
-{
-  buttons.push_back(button);
-  slots.push_back(button-&gt;on_key_down().connect(this, &amp;MultiButton::pressed));
-  slots.push_back(button-&gt;on_key_up().connect(this, &amp;MultiButton::released));
-}
-
-void
-MultiButton::update(float delta)
-{
-  for (Buttons::iterator i = buttons.begin(); i != buttons.end(); ++i)
-    (*i)-&gt;update(delta);
-}
-
-void
-MultiButton::released()
-{
-  press_count -= 1;
-
-  if (press_count == 0)
-    button_up();
-
-  // FIXME: Workaround
-  if (press_count &lt; 0)
-    press_count = 0;
-}
-
-void
-MultiButton::pressed()
-{
-  press_count += 1;
-
-  if (press_count == 1)
-    button_down();
-}
-
-/* EOF */

Copied: trunk/src/ipc.cpp (from rev 341, trunk/src/ipc.cxx)


Property changes on: trunk/src/ipc.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/ipc.cxx
===================================================================
--- trunk/src/ipc.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/ipc.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,98 +0,0 @@
-//  $Id: ipc.cxx,v 1.1 2003/06/04 13:16:17 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;stdexcept&gt;
-#include &lt;sstream&gt;
-#include &lt;iostream&gt;
-#include &lt;unistd.h&gt;
-#include &lt;sys/types.h&gt;
-#include &lt;fcntl.h&gt;
-#include &lt;errno.h&gt;
-#include &lt;string.h&gt;
-#include &lt;sys/stat.h&gt;
-
-#include &quot;ipc.hxx&quot;
-
-IPC::IPC(const std::string&amp; arg_filename)
-  : filename(arg_filename)
-{
-  if (mkfifo(filename.c_str(), S_IREAD | S_IWRITE) != 0)
-    {
-      throw std::runtime_error(strerror(errno));
-    }
-
-  if ((stream_fd = open(filename.c_str(), O_RDONLY)) == -1)
-    {
-      throw std::runtime_error(strerror(errno));
-    }
-}
-
-IPC::~IPC()
-{
-  close(stream_fd);
-  unlink(filename.c_str());
-}
-
-void 
-IPC::update()
-{
-  if (something_to_read())
-    {
-      const ssize_t bufsize = 4096;
-      char buf[bufsize];
-      std::stringstream complete_buf;
-
-      ssize_t read_size;
-      do
-        {
-          read_size = read(stream_fd, buf, bufsize);
-
-          complete_buf.write(buf, read_size);
-        }
-      while (read_size == bufsize);
-
-      // Reopen the stream for a new bunch of input
-      close(stream_fd);
-      if ((stream_fd = open(filename.c_str(), O_RDONLY)) == -1)
-        {
-          throw std::runtime_error(strerror(errno));
-        }
-
-      std::cout &lt;&lt; &quot;[[[\n&quot; 
-                &lt;&lt; complete_buf.str() 
-                &lt;&lt; &quot;]]]\n&quot;;
-    }
-}
-
-bool
-IPC::something_to_read()
-{
-  fd_set fset;
-  struct timeval timeout;
-
-  FD_ZERO(&amp;fset);
-  FD_SET(stream_fd, &amp;fset);
-
-  timeout.tv_sec = 0;
-  timeout.tv_usec = 0;
-
-  return (select (FD_SETSIZE, &amp;fset, NULL, NULL, &amp;timeout) &gt; 0);
-}
-
-/* EOF */

Copied: trunk/src/keyboard_manager.cpp (from rev 341, trunk/src/keyboard_manager.cxx)


Property changes on: trunk/src/keyboard_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/keyboard_manager.cxx
===================================================================
--- trunk/src/keyboard_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/keyboard_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,82 +0,0 @@
-//  $Id: keyboard_manager.cxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/keyboard.h&gt;
-#include &lt;ClanLib/Display/joystick.h&gt;
-#include &lt;ClanLib/Display/mouse.h&gt;
-#include &quot;command_line_arguments.hxx&quot;
-#include &quot;keyboard_manager.hxx&quot;
-
-KeyboardManager* KeyboardManager::instance_ = 0;
-
-KeyboardManager::KeyboardManager()
-{
-  slots.push_back(CL_Keyboard::sig_key_down().connect(this, &amp;KeyboardManager::button_down));
-  slots.push_back(CL_Keyboard::sig_key_up().connect(this, &amp;KeyboardManager::button_up));
-  slots.push_back(CL_Mouse::sig_key_down().connect(this, &amp;KeyboardManager::button_down));
-  slots.push_back(CL_Mouse::sig_key_up().connect(this, &amp;KeyboardManager::button_up));
-
-  if (args-&gt;joystick != -1)
-    {
-      for (int i = 0; i &lt; CL_Joystick::get_device_count(); ++i)
-        {
-          CL_InputDevice joy = CL_Joystick::get_device(i);
-          slots.push_back(joy.sig_key_up().connect(this, &amp;KeyboardManager::button_up));
-          slots.push_back(joy.sig_key_down().connect(this, &amp;KeyboardManager::button_down));
-        }
-    }
-}
-
-KeyboardManager::~KeyboardManager()
-{
-  for(Callbacks::iterator i = callbacks.begin(); i != callbacks.end(); ++i)
-    {
-      delete *i;
-    }
-}
-
-void
-KeyboardManager::button_up(const CL_InputEvent&amp; event)
-{
-}
-
-void
-KeyboardManager::button_down(const CL_InputEvent&amp; event)
-{
-  for(Callbacks::iterator i = callbacks.begin(); i != callbacks.end(); ++i)
-    {
-      if (event.device.get_type() != CL_InputDevice::joystick)
-        {
-          if (event.id == (*i)-&gt;key_id)
-            {
-              (*i)-&gt;run();
-            }
-        }
-      else
-        {
-          if (event.id == (*i)-&gt;key_id - 1000)
-            {
-              (*i)-&gt;run();
-            }
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/keys.cpp (from rev 341, trunk/src/keys.cxx)


Property changes on: trunk/src/keys.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/keys.cxx
===================================================================
--- trunk/src/keys.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/keys.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,273 +0,0 @@
-//  $Id: keys.cxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;string.h&gt;
-#include &lt;ClanLib/display.h&gt;
-#include &quot;keys.hxx&quot;
-
-#ifdef WIN32
-#  define strcasecmp _stricmp
-#endif
-
-// FIXME: Not all keys CL_KEY_'s work on my X11, so I had to manually remove them!
-const char* keyid2string(int id)
-{
-  switch (id)
-    {
-    case 1001: return &quot;JOY_1&quot;;
-    case 1002: return &quot;JOY_2&quot;;
-    case 1003: return &quot;JOY_3&quot;;
-    case 1004: return &quot;JOY_4&quot;;
-
-    case CL_MOUSE_LEFT: return &quot;MOUSE_LEFT&quot;; 
-    case CL_MOUSE_RIGHT: return &quot;MOUSE_RIGHT&quot;; 
-    case CL_MOUSE_MIDDLE: return &quot;MOUSE_MIDDLE&quot;; 
-    case CL_MOUSE_WHEEL_UP: return &quot;MOUSE_WHEEL_UP&quot;; 
-    case CL_MOUSE_WHEEL_DOWN: return &quot;MOUSE_WHEEL_DOWN&quot;; 
-    case CL_MOUSE_XBUTTON1: return &quot;MOUSE_XBUTTON1&quot;; 
-    case CL_MOUSE_XBUTTON2: return &quot;MOUSE_XBUTTON2&quot;; 
-
-    case CL_KEY_BACKSPACE: return &quot;KEY_BACKSPACE&quot;; 
-    case CL_KEY_TAB: return &quot;KEY_TAB&quot;; 
-    case CL_KEY_CLEAR: return &quot;KEY_CLEAR&quot;; 
-    case CL_KEY_RETURN: return &quot;KEY_RETURN&quot;; 
-    case CL_KEY_MENU: return &quot;KEY_MENU&quot;; 
-    case CL_KEY_PAUSE: return &quot;KEY_PAUSE&quot;; 
-    case CL_KEY_KANJI: return &quot;KEY_KANJI&quot;; 
-    case CL_KEY_ESCAPE: return &quot;KEY_ESCAPE&quot;; 
-    case CL_KEY_SPACE: return &quot;KEY_SPACE&quot;; 
-    case CL_KEY_PRIOR: return &quot;KEY_PRIOR&quot;; 
-    case CL_KEY_NEXT: return &quot;KEY_NEXT&quot;; 
-    case CL_KEY_END: return &quot;KEY_END&quot;; 
-    case CL_KEY_HOME: return &quot;KEY_HOME&quot;; 
-    case CL_KEY_LEFT: return &quot;KEY_LEFT&quot;; 
-    case CL_KEY_UP: return &quot;KEY_UP&quot;; 
-    case CL_KEY_RIGHT: return &quot;KEY_RIGHT&quot;; 
-    case CL_KEY_DOWN: return &quot;KEY_DOWN&quot;; 
-    case CL_KEY_SELECT: return &quot;KEY_SELECT&quot;; 
-    case CL_KEY_PRINT: return &quot;KEY_PRINT&quot;; 
-    case CL_KEY_EXECUTE: return &quot;KEY_EXECUTE&quot;; 
-    case CL_KEY_INSERT: return &quot;KEY_INSERT&quot;; 
-    case CL_KEY_DELETE: return &quot;KEY_DELETE&quot;; 
-    case CL_KEY_HELP: return &quot;KEY_HELP&quot;; 
-    case CL_KEY_0: return &quot;KEY_0&quot;; 
-    case CL_KEY_1: return &quot;KEY_1&quot;; 
-    case CL_KEY_2: return &quot;KEY_2&quot;; 
-    case CL_KEY_3: return &quot;KEY_3&quot;; 
-    case CL_KEY_4: return &quot;KEY_4&quot;; 
-    case CL_KEY_5: return &quot;KEY_5&quot;; 
-    case CL_KEY_6: return &quot;KEY_6&quot;; 
-    case CL_KEY_7: return &quot;KEY_7&quot;; 
-    case CL_KEY_8: return &quot;KEY_8&quot;; 
-    case CL_KEY_9: return &quot;KEY_9&quot;; 
-    case CL_KEY_A: return &quot;KEY_A&quot;; 
-    case CL_KEY_B: return &quot;KEY_B&quot;; 
-    case CL_KEY_C: return &quot;KEY_C&quot;; 
-    case CL_KEY_D: return &quot;KEY_D&quot;; 
-    case CL_KEY_E: return &quot;KEY_E&quot;; 
-    case CL_KEY_F: return &quot;KEY_F&quot;; 
-    case CL_KEY_G: return &quot;KEY_G&quot;; 
-    case CL_KEY_H: return &quot;KEY_H&quot;; 
-    case CL_KEY_I: return &quot;KEY_I&quot;; 
-    case CL_KEY_J: return &quot;KEY_J&quot;; 
-    case CL_KEY_K: return &quot;KEY_K&quot;; 
-    case CL_KEY_L: return &quot;KEY_L&quot;; 
-    case CL_KEY_M: return &quot;KEY_M&quot;; 
-    case CL_KEY_N: return &quot;KEY_N&quot;; 
-    case CL_KEY_O: return &quot;KEY_O&quot;; 
-    case CL_KEY_P: return &quot;KEY_P&quot;; 
-    case CL_KEY_Q: return &quot;KEY_Q&quot;; 
-    case CL_KEY_R: return &quot;KEY_R&quot;; 
-    case CL_KEY_S: return &quot;KEY_S&quot;; 
-    case CL_KEY_T: return &quot;KEY_T&quot;; 
-    case CL_KEY_U: return &quot;KEY_U&quot;; 
-    case CL_KEY_V: return &quot;KEY_V&quot;; 
-    case CL_KEY_W: return &quot;KEY_W&quot;; 
-    case CL_KEY_X: return &quot;KEY_X&quot;; 
-    case CL_KEY_Y: return &quot;KEY_Y&quot;; 
-    case CL_KEY_Z: return &quot;KEY_Z&quot;; 
-    case CL_KEY_NUMPAD0: return &quot;KEY_NUMPAD0&quot;; 
-    case CL_KEY_NUMPAD1: return &quot;KEY_NUMPAD1&quot;; 
-    case CL_KEY_NUMPAD2: return &quot;KEY_NUMPAD2&quot;; 
-    case CL_KEY_NUMPAD3: return &quot;KEY_NUMPAD3&quot;; 
-    case CL_KEY_NUMPAD4: return &quot;KEY_NUMPAD4&quot;; 
-    case CL_KEY_NUMPAD5: return &quot;KEY_NUMPAD5&quot;; 
-    case CL_KEY_NUMPAD6: return &quot;KEY_NUMPAD6&quot;; 
-    case CL_KEY_NUMPAD7: return &quot;KEY_NUMPAD7&quot;; 
-    case CL_KEY_NUMPAD8: return &quot;KEY_NUMPAD8&quot;; 
-    case CL_KEY_NUMPAD9: return &quot;KEY_NUMPAD9&quot;; 
-    case CL_KEY_F1: return &quot;KEY_F1&quot;; 
-    case CL_KEY_F2: return &quot;KEY_F2&quot;; 
-    case CL_KEY_F3: return &quot;KEY_F3&quot;; 
-    case CL_KEY_F4: return &quot;KEY_F4&quot;; 
-    case CL_KEY_F5: return &quot;KEY_F5&quot;; 
-    case CL_KEY_F6: return &quot;KEY_F6&quot;; 
-    case CL_KEY_F7: return &quot;KEY_F7&quot;; 
-    case CL_KEY_F8: return &quot;KEY_F8&quot;; 
-    case CL_KEY_F9: return &quot;KEY_F9&quot;; 
-    case CL_KEY_F10: return &quot;KEY_F10&quot;; 
-    case CL_KEY_F11: return &quot;KEY_F11&quot;; 
-    case CL_KEY_F12: return &quot;KEY_F12&quot;; 
-    case CL_KEY_F13: return &quot;KEY_F13&quot;; 
-    case CL_KEY_F14: return &quot;KEY_F14&quot;; 
-    case CL_KEY_F15: return &quot;KEY_F15&quot;; 
-    case CL_KEY_F16: return &quot;KEY_F16&quot;; 
-    case CL_KEY_F17: return &quot;KEY_F17&quot;; 
-    case CL_KEY_F18: return &quot;KEY_F18&quot;; 
-    case CL_KEY_F19: return &quot;KEY_F19&quot;; 
-    case CL_KEY_F20: return &quot;KEY_F20&quot;; 
-    case CL_KEY_F21: return &quot;KEY_F21&quot;; 
-    case CL_KEY_F22: return &quot;KEY_F22&quot;; 
-    case CL_KEY_F23: return &quot;KEY_F23&quot;; 
-    case CL_KEY_F24: return &quot;KEY_F24&quot;; 
-    case CL_KEY_NUMLOCK: return &quot;KEY_NUMLOCK&quot;; 
-    case CL_KEY_SCROLL: return &quot;KEY_SCROLL&quot;; 
-    case CL_KEY_LSHIFT: return &quot;KEY_LSHIFT&quot;; 
-    case CL_KEY_RSHIFT: return &quot;KEY_RSHIFT&quot;; 
-    case CL_KEY_LCONTROL: return &quot;KEY_LCONTROL&quot;; 
-    case CL_KEY_RCONTROL: return &quot;KEY_RCONTROL&quot;; 
-    case CL_KEY_LMENU: return &quot;KEY_LMENU&quot;; 
-    case CL_KEY_RMENU: return &quot;KEY_RMENU&quot;; 
-    default:
-      return &quot;&lt;unknown&gt;&quot;;
-    }
-}
-
-int string2keyid(const char* key)
-{
-  if      (strcasecmp(key, &quot;JOY_1&quot;) == 0) { return 1001; }
-  else if (strcasecmp(key, &quot;JOY_2&quot;) == 0) { return 1002; }
-  else if (strcasecmp(key, &quot;JOY_3&quot;) == 0) { return 1003; }
-  else if (strcasecmp(key, &quot;JOY_4&quot;) == 0) { return 1004; }
-
-  else if (strcasecmp(key, &quot;MOUSE_LEFT&quot;) == 0) { return CL_MOUSE_LEFT; }
-  else if (strcasecmp(key, &quot;MOUSE_RIGHT&quot;) == 0) { return CL_MOUSE_RIGHT; }
-  else if (strcasecmp(key, &quot;MOUSE_MIDDLE&quot;) == 0) { return CL_MOUSE_MIDDLE; }
-  else if (strcasecmp(key, &quot;MOUSE_WHEEL_UP&quot;) == 0) { return CL_MOUSE_WHEEL_UP; }
-  else if (strcasecmp(key, &quot;MOUSE_WHEEL_DOWN&quot;) == 0) { return CL_MOUSE_WHEEL_DOWN; }
-  else if (strcasecmp(key, &quot;MOUSE_XBUTTON1&quot;) == 0) { return CL_MOUSE_XBUTTON1; }
-  else if (strcasecmp(key, &quot;MOUSE_XBUTTON2&quot;) == 0) { return CL_MOUSE_XBUTTON2; }
-
-  else if (strcasecmp(key, &quot;KEY_BACKSPACE&quot;) == 0) { return CL_KEY_BACKSPACE; }
-  else if (strcasecmp(key, &quot;KEY_TAB&quot;) == 0) { return CL_KEY_TAB; }
-  else if (strcasecmp(key, &quot;KEY_CLEAR&quot;) == 0) { return CL_KEY_CLEAR; }
-  else if (strcasecmp(key, &quot;KEY_RETURN&quot;) == 0) { return CL_KEY_RETURN; }
-  else if (strcasecmp(key, &quot;KEY_SHIFT&quot;) == 0) { return CL_KEY_SHIFT; }
-  else if (strcasecmp(key, &quot;KEY_CONTROL&quot;) == 0) { return CL_KEY_CONTROL; }
-  else if (strcasecmp(key, &quot;KEY_MENU&quot;) == 0) { return CL_KEY_MENU; }
-  else if (strcasecmp(key, &quot;KEY_PAUSE&quot;) == 0) { return CL_KEY_PAUSE; }
-  else if (strcasecmp(key, &quot;KEY_KANJI&quot;) == 0) { return CL_KEY_KANJI; }
-  else if (strcasecmp(key, &quot;KEY_ESCAPE&quot;) == 0) { return CL_KEY_ESCAPE; }
-  else if (strcasecmp(key, &quot;KEY_SPACE&quot;) == 0) { return CL_KEY_SPACE; }
-  else if (strcasecmp(key, &quot;KEY_PRIOR&quot;) == 0) { return CL_KEY_PRIOR; }
-  else if (strcasecmp(key, &quot;KEY_NEXT&quot;) == 0) { return CL_KEY_NEXT; }
-  else if (strcasecmp(key, &quot;KEY_END&quot;) == 0) { return CL_KEY_END; }
-  else if (strcasecmp(key, &quot;KEY_HOME&quot;) == 0) { return CL_KEY_HOME; }
-  else if (strcasecmp(key, &quot;KEY_LEFT&quot;) == 0) { return CL_KEY_LEFT; }
-  else if (strcasecmp(key, &quot;KEY_UP&quot;) == 0) { return CL_KEY_UP; }
-  else if (strcasecmp(key, &quot;KEY_RIGHT&quot;) == 0) { return CL_KEY_RIGHT; }
-  else if (strcasecmp(key, &quot;KEY_DOWN&quot;) == 0) { return CL_KEY_DOWN; }
-  else if (strcasecmp(key, &quot;KEY_SELECT&quot;) == 0) { return CL_KEY_SELECT; }
-  else if (strcasecmp(key, &quot;KEY_PRINT&quot;) == 0) { return CL_KEY_PRINT; }
-  else if (strcasecmp(key, &quot;KEY_EXECUTE&quot;) == 0) { return CL_KEY_EXECUTE; }
-  else if (strcasecmp(key, &quot;KEY_INSERT&quot;) == 0) { return CL_KEY_INSERT; }
-  else if (strcasecmp(key, &quot;KEY_DELETE&quot;) == 0) { return CL_KEY_DELETE; }
-  else if (strcasecmp(key, &quot;KEY_HELP&quot;) == 0) { return CL_KEY_HELP; }
-  else if (strcasecmp(key, &quot;KEY_0&quot;) == 0) { return CL_KEY_0; }
-  else if (strcasecmp(key, &quot;KEY_1&quot;) == 0) { return CL_KEY_1; }
-  else if (strcasecmp(key, &quot;KEY_2&quot;) == 0) { return CL_KEY_2; }
-  else if (strcasecmp(key, &quot;KEY_3&quot;) == 0) { return CL_KEY_3; }
-  else if (strcasecmp(key, &quot;KEY_4&quot;) == 0) { return CL_KEY_4; }
-  else if (strcasecmp(key, &quot;KEY_5&quot;) == 0) { return CL_KEY_5; }
-  else if (strcasecmp(key, &quot;KEY_6&quot;) == 0) { return CL_KEY_6; }
-  else if (strcasecmp(key, &quot;KEY_7&quot;) == 0) { return CL_KEY_7; }
-  else if (strcasecmp(key, &quot;KEY_8&quot;) == 0) { return CL_KEY_8; }
-  else if (strcasecmp(key, &quot;KEY_9&quot;) == 0) { return CL_KEY_9; }
-  else if (strcasecmp(key, &quot;KEY_A&quot;) == 0) { return CL_KEY_A; }
-  else if (strcasecmp(key, &quot;KEY_B&quot;) == 0) { return CL_KEY_B; }
-  else if (strcasecmp(key, &quot;KEY_C&quot;) == 0) { return CL_KEY_C; }
-  else if (strcasecmp(key, &quot;KEY_D&quot;) == 0) { return CL_KEY_D; }
-  else if (strcasecmp(key, &quot;KEY_E&quot;) == 0) { return CL_KEY_E; }
-  else if (strcasecmp(key, &quot;KEY_F&quot;) == 0) { return CL_KEY_F; }
-  else if (strcasecmp(key, &quot;KEY_G&quot;) == 0) { return CL_KEY_G; }
-  else if (strcasecmp(key, &quot;KEY_H&quot;) == 0) { return CL_KEY_H; }
-  else if (strcasecmp(key, &quot;KEY_I&quot;) == 0) { return CL_KEY_I; }
-  else if (strcasecmp(key, &quot;KEY_J&quot;) == 0) { return CL_KEY_J; }
-  else if (strcasecmp(key, &quot;KEY_K&quot;) == 0) { return CL_KEY_K; }
-  else if (strcasecmp(key, &quot;KEY_L&quot;) == 0) { return CL_KEY_L; }
-  else if (strcasecmp(key, &quot;KEY_M&quot;) == 0) { return CL_KEY_M; }
-  else if (strcasecmp(key, &quot;KEY_N&quot;) == 0) { return CL_KEY_N; }
-  else if (strcasecmp(key, &quot;KEY_O&quot;) == 0) { return CL_KEY_O; }
-  else if (strcasecmp(key, &quot;KEY_P&quot;) == 0) { return CL_KEY_P; }
-  else if (strcasecmp(key, &quot;KEY_Q&quot;) == 0) { return CL_KEY_Q; }
-  else if (strcasecmp(key, &quot;KEY_R&quot;) == 0) { return CL_KEY_R; }
-  else if (strcasecmp(key, &quot;KEY_S&quot;) == 0) { return CL_KEY_S; }
-  else if (strcasecmp(key, &quot;KEY_T&quot;) == 0) { return CL_KEY_T; }
-  else if (strcasecmp(key, &quot;KEY_U&quot;) == 0) { return CL_KEY_U; }
-  else if (strcasecmp(key, &quot;KEY_V&quot;) == 0) { return CL_KEY_V; }
-  else if (strcasecmp(key, &quot;KEY_W&quot;) == 0) { return CL_KEY_W; }
-  else if (strcasecmp(key, &quot;KEY_X&quot;) == 0) { return CL_KEY_X; }
-  else if (strcasecmp(key, &quot;KEY_Y&quot;) == 0) { return CL_KEY_Y; }
-  else if (strcasecmp(key, &quot;KEY_Z&quot;) == 0) { return CL_KEY_Z; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD0&quot;) == 0) { return CL_KEY_NUMPAD0; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD1&quot;) == 0) { return CL_KEY_NUMPAD1; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD2&quot;) == 0) { return CL_KEY_NUMPAD2; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD3&quot;) == 0) { return CL_KEY_NUMPAD3; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD4&quot;) == 0) { return CL_KEY_NUMPAD4; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD5&quot;) == 0) { return CL_KEY_NUMPAD5; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD6&quot;) == 0) { return CL_KEY_NUMPAD6; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD7&quot;) == 0) { return CL_KEY_NUMPAD7; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD8&quot;) == 0) { return CL_KEY_NUMPAD8; }
-  else if (strcasecmp(key, &quot;KEY_NUMPAD9&quot;) == 0) { return CL_KEY_NUMPAD9; }
-  else if (strcasecmp(key, &quot;KEY_F1&quot;) == 0) { return CL_KEY_F1; }
-  else if (strcasecmp(key, &quot;KEY_F2&quot;) == 0) { return CL_KEY_F2; }
-  else if (strcasecmp(key, &quot;KEY_F3&quot;) == 0) { return CL_KEY_F3; }
-  else if (strcasecmp(key, &quot;KEY_F4&quot;) == 0) { return CL_KEY_F4; }
-  else if (strcasecmp(key, &quot;KEY_F5&quot;) == 0) { return CL_KEY_F5; }
-  else if (strcasecmp(key, &quot;KEY_F6&quot;) == 0) { return CL_KEY_F6; }
-  else if (strcasecmp(key, &quot;KEY_F7&quot;) == 0) { return CL_KEY_F7; }
-  else if (strcasecmp(key, &quot;KEY_F8&quot;) == 0) { return CL_KEY_F8; }
-  else if (strcasecmp(key, &quot;KEY_F9&quot;) == 0) { return CL_KEY_F9; }
-  else if (strcasecmp(key, &quot;KEY_F10&quot;) == 0) { return CL_KEY_F10; }
-  else if (strcasecmp(key, &quot;KEY_F11&quot;) == 0) { return CL_KEY_F11; }
-  else if (strcasecmp(key, &quot;KEY_F12&quot;) == 0) { return CL_KEY_F12; }
-  else if (strcasecmp(key, &quot;KEY_F13&quot;) == 0) { return CL_KEY_F13; }
-  else if (strcasecmp(key, &quot;KEY_F14&quot;) == 0) { return CL_KEY_F14; }
-  else if (strcasecmp(key, &quot;KEY_F15&quot;) == 0) { return CL_KEY_F15; }
-  else if (strcasecmp(key, &quot;KEY_F16&quot;) == 0) { return CL_KEY_F16; }
-  else if (strcasecmp(key, &quot;KEY_F17&quot;) == 0) { return CL_KEY_F17; }
-  else if (strcasecmp(key, &quot;KEY_F18&quot;) == 0) { return CL_KEY_F18; }
-  else if (strcasecmp(key, &quot;KEY_F19&quot;) == 0) { return CL_KEY_F19; }
-  else if (strcasecmp(key, &quot;KEY_F20&quot;) == 0) { return CL_KEY_F20; }
-  else if (strcasecmp(key, &quot;KEY_F21&quot;) == 0) { return CL_KEY_F21; }
-  else if (strcasecmp(key, &quot;KEY_F22&quot;) == 0) { return CL_KEY_F22; }
-  else if (strcasecmp(key, &quot;KEY_F23&quot;) == 0) { return CL_KEY_F23; }
-  else if (strcasecmp(key, &quot;KEY_F24&quot;) == 0) { return CL_KEY_F24; }
-  else if (strcasecmp(key, &quot;KEY_NUMLOCK&quot;) == 0) { return CL_KEY_NUMLOCK; }
-  else if (strcasecmp(key, &quot;KEY_SCROLL&quot;) == 0) { return CL_KEY_SCROLL; }
-  else if (strcasecmp(key, &quot;KEY_LSHIFT&quot;) == 0) { return CL_KEY_LSHIFT; }
-  else if (strcasecmp(key, &quot;KEY_RSHIFT&quot;) == 0) { return CL_KEY_RSHIFT; }
-  else if (strcasecmp(key, &quot;KEY_LCONTROL&quot;) == 0) { return CL_KEY_LCONTROL; }
-  else if (strcasecmp(key, &quot;KEY_RCONTROL&quot;) == 0) { return CL_KEY_RCONTROL; }
-  else if (strcasecmp(key, &quot;KEY_LMENU&quot;) == 0) { return CL_KEY_LMENU; }
-  else if (strcasecmp(key, &quot;KEY_RMENU&quot;) == 0) { return CL_KEY_RMENU; }
-  else { return 0; }
-}
-
-/* EOF */

Copied: trunk/src/level_map.cpp (from rev 341, trunk/src/level_map.cxx)


Property changes on: trunk/src/level_map.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/level_map.cxx
===================================================================
--- trunk/src/level_map.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/level_map.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,42 +0,0 @@
-//  $Id: level_map.cxx,v 1.6 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;game_world.hxx&quot;
-#include &quot;level_map.hxx&quot;
-
-LevelMap::LevelMap ()
-{
-}
-
-LevelMap::~LevelMap ()
-{
-}
-
-void
-LevelMap::update (float delta)
-{
-}
-
-void
-LevelMap::draw (CL_GraphicContext&amp; gc)
-{
-  GameWorld::current()-&gt;draw_levelmap (*this);
-}
-
-/* EOF */

Copied: trunk/src/line_segments.cpp (from rev 341, trunk/src/line_segments.cxx)


Property changes on: trunk/src/line_segments.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/line_segments.cxx
===================================================================
--- trunk/src/line_segments.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/line_segments.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,504 +0,0 @@
-//  $Id: line_segments.cxx,v 1.14 2003/06/18 14:38:28 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &quot;math.hxx&quot;
-#include &quot;color.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;line_segments.hxx&quot;
-
-LineSegments::LineSegments(float arg_init_x, float arg_init_y, float arg_init_orientation)
-  : init_x(arg_init_x),
-    init_y(arg_init_y),
-    init_orientation(arg_init_orientation)
-{
-}
-
-float
-LineSegments::get_orientation(const Segment&amp; segment, float len)
-{
-  switch(segment.type)
-    {
-    case RADIAL:
-      {
-        const float&amp; start_angle = segment.radial.start_angle;
-        const float&amp; end_angle   = segment.radial.end_angle;
-        //const float&amp; radius      = segment.radial.radius;
-        
-        float angle;
-
-        if (segment.radial.turn_right)
-          angle = Math::normalize_angle(end_angle - start_angle);
-        else
-          angle = Math::normalize_angle(start_angle - end_angle);
-
-        float relative = len / (segment.radial.radius * angle);
-
-        angle = angle * relative;
-
-        if (segment.radial.turn_right)
-          return start_angle + angle + Math::pi_2;
-        else
-          return start_angle - angle - Math::pi_2;
-      }
-      break;
-
-    case STRAIGHT:
-      {
-        return atan2(segment.straight.y2 - segment.straight.y1,
-                     segment.straight.x2 - segment.straight.x1);
-      }
-      break;
-
-    default:
-      assert(false);
-    }
-  return 0;  
-}
-
-float
-LineSegments::calc_length(const Segment&amp; segment)
-{
-  switch(segment.type)
-    {
-    case RADIAL:
-      {
-        if (segment.radial.turn_right)
-          {
-            float angle = Math::normalize_angle(segment.radial.end_angle - segment.radial.start_angle);
-            return angle * segment.radial.radius;
-          }
-        else
-          {
-            float angle = Math::normalize_angle(segment.radial.start_angle - segment.radial.end_angle);
-            return angle * segment.radial.radius;
-          }
-      }
-      break;
-
-    case STRAIGHT:
-      {
-        float xlen = segment.straight.x2 - segment.straight.x1;
-        float ylen = segment.straight.y2 - segment.straight.y1;
-        return sqrt(xlen*xlen + ylen*ylen);
-      }
-      break;
-
-    default:
-      assert(false);
-    }
-  return 0;
-}
-
-LineSegments::Segments::iterator
-LineSegments::get_segment(float l)
-{
-  float len = 0.0f;
-  
-  Segments::iterator seg = segments.end();
-  for(Segments::iterator i = segments.begin(); i != segments.end(); ++i)
-    {
-      if (len &lt; l)
-        seg = i;
-      else
-        return seg;
-    }
-  return seg;
-}
-
-float
-LineSegments::get_orientation(float l)
-{
-  float len = 0.0f; 
-  
-  Segments::iterator seg = segments.begin();
-  while(seg != segments.end())
-    {
-      len += seg-&gt;length;
-      if (len &gt; l)
-        break;
-      ++seg;
-    }
-
-  if (seg == segments.end())
-    {
-      std::cout &lt;&lt; &quot;trying to access bejoint last segment: &quot; &lt;&lt; l &lt;&lt; &quot; &quot; &lt;&lt; get_length() &lt;&lt; std::endl;
-      return get_end_orientation();
-    }
-  else
-    return get_orientation(*seg, seg-&gt;length - (len - l));
-}
-
-FloatVector2d
-LineSegments::get_pos(float l)
-{
-  float len = 0.0f; 
-  
-  Segments::iterator seg = segments.begin();
-  while(seg != segments.end())
-    {
-      len += seg-&gt;length;
-      if (len &gt; l)
-        break;
-      ++seg;
-    }
-
-  if (seg == segments.end())
-    {
-      std::cout &lt;&lt; &quot;trying to access bejoint last segment: &quot; &lt;&lt; l &lt;&lt; &quot; &quot; &lt;&lt; get_length() &lt;&lt; std::endl;
-      return get_end_pos();
-    }
-  else
-    return get_pos(*seg, seg-&gt;length - (len - l));
-}
-
-float
-LineSegments::get_end_orientation()
-{
-  if (segments.size() &gt; 0)
-    {
-      Segment&amp; segment = segments.back();
-  
-      switch (segment.type)
-        {
-        case STRAIGHT:
-          return atan2(segment.straight.y2 - segment.straight.y1,
-                       segment.straight.x2 - segment.straight.x1);
-          break;
-
-        case RADIAL:
-      
-          break;
-        }
-      return 0;
-    }
-  else
-    {
-      return init_orientation;
-    }
-}
-
-FloatVector2d
-LineSegments::get_end_pos()
-{
-  if (segments.size() &gt; 0)
-    {
-      Segment&amp; segment = segments.back();
-      switch (segment.type)
-        {
-        case STRAIGHT:
-          return FloatVector2d(segment.straight.x2,
-                           segment.straight.y2);
-        case RADIAL:
-          return FloatVector2d(segment.radial.x + segment.radial.radius * cos(segment.radial.end_angle),
-                           segment.radial.y + segment.radial.radius * sin(segment.radial.end_angle));
-          break;
-        }
-      return FloatVector2d();
-    }
-  else
-    {
-      return FloatVector2d(init_x, init_y);
-    }
-}
-
-float
-LineSegments::get_length()
-{
-  float len = 0.0f;
-
-  for(Segments::iterator i = segments.begin(); i != segments.end(); ++i)
-    len += i-&gt;length;
-  
-  return len;
-}
-
-FloatVector2d
-LineSegments::get_pos(const Segment&amp; segment, float len)
-{
-  switch(segment.type)
-    {
-    case RADIAL:
-      {
-        const float&amp; start_angle = segment.radial.start_angle;
-        const float&amp; end_angle   = segment.radial.end_angle;
-        const float&amp; radius      = segment.radial.radius;
-        
-        float angle;
-
-        if (segment.radial.turn_right)
-          angle = Math::normalize_angle(end_angle - start_angle);
-        else
-          angle = Math::normalize_angle(start_angle - end_angle);
-
-        float relative = len / (segment.radial.radius * angle);
-
-        angle = angle * relative;
-
-        if (segment.radial.turn_right)
-          return FloatVector2d(segment.radial.x + cos(start_angle + angle)*radius,
-                           segment.radial.y + sin(start_angle + angle)*radius);
-        else
-          return FloatVector2d(segment.radial.x + cos(start_angle - angle)*radius,
-                           segment.radial.y + sin(start_angle - angle)*radius);
-      }
-      break;
-    case STRAIGHT:
-      {
-        // relative position on the segment
-        float rel_pos = len/calc_length(segment);
-        float xlen    = segment.straight.x2 - segment.straight.x1;
-        float ylen    = segment.straight.y2 - segment.straight.y1;
-
-        return FloatVector2d(segment.straight.x1 + (xlen * rel_pos),
-                         segment.straight.y1 + (ylen * rel_pos));
-      }
-      break;
-    }
-  return FloatVector2d();
-}
-
-void
-LineSegments::add_straight_segment(float x1, float y1, float x2, float y2)
-{
-  Segment segment;
-
-  segment.straight.x1 = x1;
-  segment.straight.y1 = y1;
-  segment.straight.x2 = x2;
-  segment.straight.y2 = y2;
-
-  segment.type   = STRAIGHT;
-  segment.length = calc_length(segment);
-  
-  //std::cout &lt;&lt; &quot;Line length: &quot; &lt;&lt; segment.length &lt;&lt; std::endl;
-
-  segments.push_back(segment);
-}
-
-void
-LineSegments::add_radial_segment(float x, float y, float radius, 
-                                 float start_angle, float stop_angle, bool turn_right)
-{
-  Segment segment;
-
-  segment.radial.x = x;
-  segment.radial.y = y;
-  segment.radial.radius = radius;
-  segment.radial.start_angle = start_angle;
-  segment.radial.end_angle   = stop_angle;
-  segment.radial.turn_right  = turn_right;
-
-  segment.type   = RADIAL;
-  segment.length = calc_length(segment);
-
-  segments.push_back(segment);
-}
-
-bool LineSegments::calc_route(float start_x, float start_y, 
-                              float dest_x, float dest_y, 
-                              float start_orientation, 
-                              float radius, bool turn_right,
-                              float&amp; px, float&amp; py, float&amp; qx, float&amp; qy,
-                              float&amp; angle_start, float&amp; angle_final, float&amp; length)
-{
-  // See AI Programming Wisdom, pp. 189
-  float angle_to_p  = turn_right ? start_orientation - Math::pi_2 : start_orientation + Math::pi_2;
-  px = start_x + (radius * cos(angle_to_p));
-  py = start_y + (radius * sin(angle_to_p));
-  float dx = dest_x - px;
-  float dy = dest_y - py;
-  float h  = sqrt(dx*dx + dy*dy);
-
-  if (h &lt; radius)
-    {
-      //std::cout &lt;&lt; &quot;Couldn't generate line segment&quot; &lt;&lt; std::endl;
-      return false;
-    }
-
-  float d = sqrt(h*h - radius*radius);
-  float theta = acos(radius / h);
-  
-  float phi = atan2(dy, dx);
-
-  angle_final = Math::normalize_angle(turn_right ? phi + theta : phi - theta);
-  qx = px + radius * cos(angle_final);
-  qy = py + radius * sin(angle_final);
-  
-  angle_start = Math::normalize_angle(angle_to_p + Math::pi);
-
-  float total_curve = turn_right ? angle_start - angle_final : angle_final - angle_start;
-
-  float curve_length = Math::normalize_angle(total_curve) * radius;
-
-  length = d + curve_length;
-  
-  return true;
-}
-
-void
-LineSegments::add_controll_point(float dest_x, float dest_y, float radius)
-{ 
-  float start_orientation = get_end_orientation();
-  float start_x = get_end_pos().x;
-  float start_y = get_end_pos().y;
-
-  float l_px, l_py, l_qx, l_qy, l_angle_start, l_angle_final, l_length;
-  bool  l_possible;
-
-  l_possible = calc_route(start_x, start_y,
-                          dest_x, dest_y,
-                          start_orientation, radius, true,
-                          l_px, l_py, l_qx, l_qy,
-                          l_angle_start, l_angle_final, l_length);
-  
-  float r_px, r_py, r_qx, r_qy, r_angle_start, r_angle_final, r_length;
-  bool r_possible;
-  r_possible = calc_route(start_x, start_y, 
-                          dest_x, dest_y,
-                          start_orientation,
-                          radius, false,
-                          r_px, r_py, r_qx, r_qy, 
-                          r_angle_start, r_angle_final, r_length);
-  
-  if (l_possible &amp;&amp; r_possible)
-    {
-      if (l_length &lt; r_length)
-        {
-          add_radial_segment(l_px, l_py, radius, l_angle_start, l_angle_final, false);
-          add_straight_segment(l_qx, l_qy, dest_x, dest_y);
-        }
-      else
-        {
-          add_radial_segment(r_px, r_py, radius, r_angle_start, r_angle_final, true);
-          add_straight_segment(r_qx, r_qy, dest_x, dest_y); 
-        }
-    }
-  else if (l_possible)
-    {
-      add_radial_segment(l_px, l_py, radius, l_angle_start, l_angle_final, false);
-      add_straight_segment(l_qx, l_qy, dest_x, dest_y);
-    }
-  else if (r_possible)
-    {
-      add_radial_segment(r_px, r_py, radius, r_angle_start, r_angle_final, true);
-      add_straight_segment(r_qx, r_qy, dest_x, dest_y);
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;LineSegment: Already at the requested controll point, doing nothing&quot; &lt;&lt; std::endl;
-    }
-}
-
-void
-LineSegments::clear()
-{
-  segments.clear();  
-}
-
-void
-LineSegments::draw(View&amp; view)
-{
-#if 0
-  for(float i = 0; i &lt; get_length(); i += 15)
-    {
-      FloatVector2d pos = get_pos(i);
-      //std::cout &lt;&lt; &quot;Pos: &quot; &lt;&lt; pos &lt;&lt; std::endl;
-      view-&gt;draw_fillrect(int(pos.x-5), int(pos.y-5),
-                          int(pos.x+5), int(pos.y+5),
-                          1.0f, 0.0f, 0.0f, .5f); // red      
-    }
-#endif
-
-  //std::cout &lt;&lt; &quot;-----: &quot; &lt;&lt; segments.size()  &lt;&lt; std::endl;
-  for(Segments::iterator i = segments.begin(); i != segments.end(); ++i)
-    {
-      switch(i-&gt;type)
-        {
-        case RADIAL:
-          //std::cout &lt;&lt; &quot;Radial: &quot; &lt;&lt; (int)i-&gt;radial.x &lt;&lt; &quot;, &quot; &lt;&lt;(int)i-&gt;radial.y
-          //        &lt;&lt; &quot; &quot; &lt;&lt; (int)i-&gt;radial.radius &lt;&lt; std::endl;
-          /*
-          view-&gt;draw_circle((int)i-&gt;radial.x, (int)i-&gt;radial.y, (int)i-&gt;radial.radius,
-          Color(1.0f, 1.0f, 1.0f, .3f));*/
-
-
-          if (i-&gt;radial.turn_right)
-            {
-              view.get_sc().color().draw_arc(i-&gt;radial.x, i-&gt;radial.y, i-&gt;radial.radius,
-                                     i-&gt;radial.start_angle, i-&gt;radial.end_angle, 
-                                     CL_Color(255, 255, 255));
-              /*
-              view.draw_fillrect((int)i-&gt;radial.x-5, (int)i-&gt;radial.y-5,
-                                  (int)i-&gt;radial.x+5, (int)i-&gt;radial.y+5,
-                                  Color(0.0f, 0.0f, 1.0f)); //blue
-              */
-            }
-          else
-            {
-              view.get_sc().color().draw_arc(i-&gt;radial.x, i-&gt;radial.y, i-&gt;radial.radius,
-                                     i-&gt;radial.end_angle, i-&gt;radial.start_angle, 
-                                     CL_Color(255, 255, 255));
-              /*
-              view.draw_fillrect(i-&gt;radial.x-5, i-&gt;radial.y-5,
-                                  i-&gt;radial.x+5, i-&gt;radial.y+5,
-                                  Color(1.0f, 0.0f, 0.0f)); // red
-              */
-            }
-          /*
-          {
-            int x = int(i-&gt;radial.x + i-&gt;radial.radius * cos(i-&gt;radial.start_angle));
-            int y = int(i-&gt;radial.y + i-&gt;radial.radius * sin(i-&gt;radial.start_angle));
-            view.draw_fillrect(x-5, y-5,
-                                x+5, y+5,
-                                Color(0.0, 0.0f, 1.0f));
-          }
-
-          {
-            int x = int(i-&gt;radial.x + i-&gt;radial.radius * cos(i-&gt;radial.end_angle));
-            int y = int(i-&gt;radial.y + i-&gt;radial.radius * sin(i-&gt;radial.end_angle));
-            view.draw_fillrect(x-5, y-5,
-                                x+5, y+5,
-                                Color(1.0, 0.0f, 1.0f));
-          }*/
-          break;
-
-        case STRAIGHT:
-          view.get_sc().color().draw_line(i-&gt;straight.x1, i-&gt;straight.y1,
-                                  i-&gt;straight.x2, i-&gt;straight.y2, 
-                                  CL_Color(255, 255, 255, 255));
-          break;
-        default:
-          std::cout &lt;&lt; &quot;Unhandled type: &quot; &lt;&lt; i-&gt;type &lt;&lt; std::endl;
-          break;
-        }
-    }
-}
-
-void
-LineSegments::set_pos(float arg_init_x, float arg_init_y, float arg_init_orientation)
-{
-  init_x = arg_init_x;
-  init_y = arg_init_y;
-  init_orientation = arg_init_orientation;
-}
-
-/* EOF */

Copied: trunk/src/marker.cpp (from rev 341, trunk/src/marker.cxx)


Property changes on: trunk/src/marker.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/marker.cxx
===================================================================
--- trunk/src/marker.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/marker.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,63 +0,0 @@
-//  $Id: marker.cxx,v 1.3 2003/06/23 09:56:39 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;property_set.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;marker.hxx&quot;
-#include &quot;alist.hxx&quot;
-#include &quot;radar.hxx&quot;
-#include &quot;view.hxx&quot;
-
-Marker::Marker(const AList&amp; lst)
-{
-  passed_time = 0;
-  properties-&gt;register_float(&quot;x-pos&quot;, &amp;pos.x);
-  properties-&gt;register_float(&quot;y-pos&quot;, &amp;pos.y);
-
-  pos.x = lst.get_float(&quot;x-pos&quot;);
-  pos.y = lst.get_float(&quot;y-pos&quot;);
-
-  sprite = resources-&gt;get_sprite(&quot;feuerkraft/marker&quot;);
-  sprite.set_blend_func(blend_src_alpha, blend_one);
-}
-
-Marker::~Marker()
-{
-}
-
-void
-Marker::draw (View&amp; view)
-{
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-void
-Marker::draw_radar(Radar&amp; radar)
-{
-  radar.draw_blip(pos, 3, 1.0f, 1.0f, 1.0f);
-}
-
-void
-Marker::update(float delta)
-{
-  passed_time += delta;
-  sprite.set_alpha(sin(passed_time * 7.0f) * .2 + .3);
-}
-
-/* EOF */

Copied: trunk/src/math.cpp (from rev 341, trunk/src/math.cxx)


Property changes on: trunk/src/math.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/math.cxx
===================================================================
--- trunk/src/math.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/math.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,116 +0,0 @@
-//  $Id: math.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;math.hxx&quot;
-
-namespace Math {
-
-
-bool quad_collide(const Quad&amp; quad1, const Quad&amp; quad2)
-{
-  // add bounding box check here
-  
-  if (lines_intersect(quad1.a, quad1.b,
-                      quad2.a, quad2.b))
-    return true;
-  else if (lines_intersect(quad1.b, quad1.c,
-                           quad2.a, quad2.b))
-    return true;
-  else if (lines_intersect(quad1.c, quad1.d,
-                           quad2.a, quad2.b))
-    return true;
-  else if (lines_intersect(quad1.d, quad1.a,
-                           quad2.a, quad2.b))
-    return true;
-  // snip
-  else if (lines_intersect(quad1.a, quad1.b,
-                           quad2.b, quad2.c))
-    return true;
-  else if (lines_intersect(quad1.b, quad1.c,
-                           quad2.b, quad2.c))
-    return true;
-  else if (lines_intersect(quad1.c, quad1.d,
-                           quad2.b, quad2.c))
-    return true;
-  else if (lines_intersect(quad1.d, quad1.a,
-                           quad2.b, quad2.c))  
-    return true;
-  // snip
-  else if (lines_intersect(quad1.a, quad1.b,
-                           quad2.c, quad2.d))
-    return true;
-  else if (lines_intersect(quad1.b, quad1.c,
-                           quad2.c, quad2.d))
-    return true;
-  else if (lines_intersect(quad1.c, quad1.d,
-                           quad2.c, quad2.d))
-    return true;
-  else if (lines_intersect(quad1.d, quad1.a,
-                           quad2.c, quad2.d))  
-    return true;
-  // snip
-  else if (lines_intersect(quad1.a, quad1.b,
-                           quad2.d, quad2.a))
-    return true;
-  else if (lines_intersect(quad1.b, quad1.c,
-                           quad2.d, quad2.a))
-    return true;
-  else if (lines_intersect(quad1.c, quad1.d,
-                           quad2.d, quad2.a))
-    return true;
-  else if (lines_intersect(quad1.d, quad1.a,
-                           quad2.d, quad2.a))
-    return true;
-
-  else // no lines intersect, but one quad might be completly inside of another quad
-    {
-      if (point_inside_quad(quad1.a, quad2)
-          || point_inside_quad(quad1.b, quad2)
-          || point_inside_quad(quad1.c, quad2)
-          || point_inside_quad(quad1.d, quad2))
-        return true;
-      else if (point_inside_quad(quad2.a, quad1)
-               || point_inside_quad(quad2.b, quad1)
-               || point_inside_quad(quad2.c, quad1)
-               || point_inside_quad(quad2.d, quad1))
-        return true;
-      else
-        return false;
-    }
-}
-
-bool point_inside_quad(const Point&amp; point, const Quad&amp; quad)
-{
-  Triangle triangle1, triangle2;
-
-  triangle1.a = quad.a;
-  triangle1.b = quad.b;
-  triangle1.c = quad.c;
-
-  triangle2.a = quad.b;
-  triangle2.b = quad.c;
-  triangle2.c = quad.d;
-
-  return point_inside_triangle(point, triangle1)
-    || point_inside_triangle(point, triangle2);
-}
-
-} // namespace Math
-
-/* EOF */

Copied: trunk/src/menu.cpp (from rev 341, trunk/src/menu.cxx)


Property changes on: trunk/src/menu.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/menu.cxx
===================================================================
--- trunk/src/menu.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/menu.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,183 +0,0 @@
-//  $Id: menu.cxx,v 1.7 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;assert.hxx&quot;
-#include &quot;display_manager.hxx&quot;
-#include &quot;fonts.hxx&quot;
-#include &quot;input/input_manager.hxx&quot;
-#include &quot;menu_item.hxx&quot;
-#include &quot;menu.hxx&quot;
-
-Menu::Menu()
-{
-  current_item = 0;
-  pos = 0;
-  moving = false;
-}
-
-Menu::~Menu()
-{
-}
-
-void
-Menu::add_item(MenuItem* item)
-{
-  items.push_back(item);
-}
-
-void
-Menu::update(float delta)
-{
-  
-}
-
-void
-Menu::draw(CL_GraphicContext&amp; gc)
-{
-  // Draw menu background 
-  CL_Display::fill_rect(CL_Rect(CL_Display::get_width() - 170, 0,
-                                CL_Display::get_width(), items.size() 
-                                * (Fonts::font.get_height() + 4) + 20),
-                        CL_Color(0,0,0, 50));
-
-  // Draw menu items
-  int y = 10;
-  for(MenuItems::iterator i = items.begin(); i != items.end(); ++i)
-    {
-      if ((i - items.begin()) == current_item)
-        (*i)-&gt;draw_highlight(CL_Display::get_width() - 160, y);
-      else
-        (*i)-&gt;draw(CL_Display::get_width() - 160, y);
-
-      y += (Fonts::font.get_height() + 4);
-    }
-}
-
-void
-Menu::next_item()
-{
-  AssertMsg(items.size() &gt; 0, &quot;Menu is empty!&quot;);
-
-  if (current_item == static_cast&lt;int&gt;(items.size()) - 1)
-    current_item = 0;
-  else
-    current_item += 1;
-}
-
-void
-Menu::previous_item()
-{
-  AssertMsg(items.size() &gt; 0, &quot;Menu is empty!&quot;);
-
-  if (current_item == 0)
-    current_item = items.size()-1;
-  else
-    current_item -= 1;
-}
-
-void
-Menu::call_current_item()
-{
-  AssertMsg(items.size() &gt; 0, &quot;Menu is empty!&quot;);
-
-  items[current_item]-&gt;call();
-}
-
-void
-Menu::hide()
-{
-  if (DisplayManager::current()-&gt;get_menu() == this)
-    DisplayManager::current()-&gt;hide_menu();
-}
-
-void
-Menu::process_events(const InputEventLst&amp; lst)
-{
-  for(InputEventLst::const_iterator i = lst.begin(); i != lst.end(); ++i)
-    {
-      switch(i-&gt;type)
-        {
-        case AXIS_EVENT:
-          switch (i-&gt;axis.name)
-            {
-            case ACCELERATE_AXIS:
-              // not using events for analog, but states
-              break;
-            default:
-              break;
-            }
-          break;
-        case BUTTON_EVENT:
-          switch (i-&gt;button.name)
-            {
-            case PRIMARY_FIRE_BUTTON:
-              if (i-&gt;button.down)
-                {
-                  std::cout &lt;&lt; &quot;--- button event&quot; &lt;&lt; std::endl;
-                  call_current_item();
-                  hide();
-                }
-              break;
-            case SECONDARY_FIRE_BUTTON:
-              // FIXME: Go a menu item back (hack)
-              DisplayManager::current()-&gt;pop_menu();
-              break;
-            default:
-              break;
-            }
-          break;
-        default:
-          break;
-        }
-    }
-
-  // FIXME: no delta
-  float delta = InputManager::get_controller().get_axis_state(ACCELERATE_AXIS);
-  
-  if (delta &gt; .1f &amp;&amp; !moving)
-    {
-      pos = 5.0f;
-      moving = true;
-    }
-  else if (delta &lt; -.1f &amp;&amp; !moving)
-    {
-      pos = -5.0f;
-      moving = true;
-    }
-  else if (moving &amp;&amp; fabsf(delta) &lt; .1f)
-    {
-      moving = false;
-    }
-  
-  pos += delta/4.0f;
-  
-  if (pos &gt;= 1.0f)
-    {
-      next_item();
-      pos = 0.0f;
-    }
-  else if (pos &lt;= -1.0f)
-    {
-      previous_item();
-      pos = 0.0f;
-    }
-}
-
-/* EOF */

Copied: trunk/src/menu_handle_mgr.cpp (from rev 341, trunk/src/menu_handle_mgr.cxx)


Property changes on: trunk/src/menu_handle_mgr.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/menu_handle_mgr.cxx
===================================================================
--- trunk/src/menu_handle_mgr.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/menu_handle_mgr.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,25 +0,0 @@
-//  $Id: menu_handle_mgr.cxx,v 1.1 2003/06/06 09:49:35 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;menu_handle_mgr.hxx&quot;
-
-HandleManager&lt;Menu&gt;     menu_handle_mgr;
-HandleManager&lt;MenuItem&gt; menu_item_handle_mgr;
-
-/* EOF */

Copied: trunk/src/menu_item.cpp (from rev 341, trunk/src/menu_item.cxx)


Property changes on: trunk/src/menu_item.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/menu_item.cxx
===================================================================
--- trunk/src/menu_item.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/menu_item.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,72 +0,0 @@
-//  $Id: menu_item.cxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;fonts.hxx&quot;
-#include &quot;display_manager.hxx&quot;
-#include &quot;menu_item.hxx&quot;
-
-MenuItemSubMenuFunctor::MenuItemSubMenuFunctor(Menu* arg_submenu)
-  : submenu(arg_submenu)
-{
-}
-
-void
-MenuItemSubMenuFunctor::call()
-{ // FIXME: This could be implemented on the scheme site
-  DisplayManager::current()-&gt;push_menu(submenu);
-}
-
-MenuItem::MenuItem(const std::string&amp; arg_label, MenuItemFunctor* arg_functor)
-  : label(arg_label),
-    functor(arg_functor)
-{
-  
-}
-
-MenuItem::~MenuItem()
-{
-  delete functor;
-}
-
-void
-MenuItem::draw_highlight(int x, int y)
-{
-  CL_Display::fill_rect(CL_Rect(x, y, x + 150, y + Fonts::font.get_height() + 2),
-                        CL_Color(255, 255, 255, 230));
-  Fonts::font.set_alignment(origin_top_left);
-  Fonts::font.draw(x + 10, y + 1, label);
-}
-
-void
-MenuItem::draw(int x, int y)
-{
-  CL_Display::fill_rect(CL_Rect(x, y, x + 150, y + Fonts::font.get_height() + 2),
-                        CL_Color(85,85,0, 230));
-  Fonts::font.set_alignment(origin_top_left);
-  Fonts::font.draw(x + 10, y + 1, label);
-}
-
-void
-MenuItem::call()
-{
-  functor-&gt;call();
-}
-
-/* EOF */

Copied: trunk/src/message_buffer.cpp (from rev 341, trunk/src/message_buffer.cxx)


Property changes on: trunk/src/message_buffer.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/message_buffer.cxx
===================================================================
--- trunk/src/message_buffer.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/message_buffer.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,77 +0,0 @@
-//  $Id: message_buffer.cxx,v 1.3 2003/06/08 15:49:00 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;assert.hxx&quot;
-#include &quot;fonts.hxx&quot;
-#include &quot;message_buffer.hxx&quot;
-
-MessageBuffer* MessageBuffer::current_ = 0;
-
-MessageBuffer::MessageBuffer(int arg_x, int arg_y)
-{
-  current_ = this;
-  x_pos = arg_x;
-  y_pos = arg_y;
-}
-
-MessageBuffer* 
-MessageBuffer::current()
-{
-  AssertMsg(current_, &quot;comm-* commands must not be called on script loading!&quot;);
-  return current_;
-}
-
-void
-MessageBuffer::add(const std::string&amp; str)
-{
-  MessageBufferEntry entry;
-  entry.display_time = 0;
-  entry.message = str;
-  buffer.push_back(entry);
-}
-
-void
-MessageBuffer::draw(CL_GraphicContext&amp; gc)
-{
-  int y = y_pos;
-
-  for(Buffer::reverse_iterator i = buffer.rbegin(); i != buffer.rend(); ++i)
-    {
-      if (i-&gt;display_time &lt; 5.0f)
-        {
-          if (i-&gt;display_time &gt; 4.0f)
-            Fonts::font.set_alpha(1.0f - (i-&gt;display_time - 4.0f));
-          Fonts::font.set_alignment(origin_top_center);
-          Fonts::font.draw(x_pos, y, i-&gt;message);
-          Fonts::font.set_alpha(1.0f);
-        }
-      y -= Fonts::font.get_height() + 2;
-    }
-}
-
-void
-MessageBuffer::update(float delta)
-{
-  for(Buffer::iterator i = buffer.begin(); i != buffer.end(); ++i)
-    {
-      i-&gt;display_time += delta;
-    }  
-}
-
-/* EOF */

Copied: trunk/src/mine.cpp (from rev 341, trunk/src/mine.cxx)


Property changes on: trunk/src/mine.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/mine.cxx
===================================================================
--- trunk/src/mine.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/mine.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,126 +0,0 @@
-//  $Id: mine.cxx,v 1.11 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;alist.hxx&quot;
-#include &quot;vehicles/tank.hxx&quot;
-#include &quot;mine.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;game_world.hxx&quot;
-#include &quot;groundmap/ground_map.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-Mine::Mine (const AList&amp; lst)
-  : pos (0, 0),
-    active (2),
-    detonated (false),
-    hole (resources-&gt;get_sprite (&quot;feuerkraft/hole&quot;))
-{
-  properties-&gt;register_float(&quot;x-pos&quot;, &amp;pos.x);
-  properties-&gt;register_float(&quot;y-pos&quot;, &amp;pos.y);
-  
-  pos.x = lst.get_float(&quot;x-pos&quot;);
-  pos.y = lst.get_float(&quot;y-pos&quot;);
-
-  GroundType type = GameWorld::current()-&gt;get_groundmap ()-&gt;get_groundtype (pos.x, pos.y);
-  if (type == GT_FLATWATER)
-    {
-      sur = resources-&gt;get_sprite (&quot;feuerkraft/minewater&quot;);
-      sur_active = resources-&gt;get_sprite (&quot;feuerkraft/minewateractive&quot;);
-    }
-  else if (type == GT_DEEPWATER)
-    {
-      sur = resources-&gt;get_sprite (&quot;feuerkraft/minewater&quot;);
-      sur_active = resources-&gt;get_sprite (&quot;feuerkraft/minewateractive&quot;);
-      remove (); // Mines can't be placed in deepwater
-    }
-  else
-    {
-      sur = resources-&gt;get_sprite (&quot;feuerkraft/mine&quot;);
-      sur_active = resources-&gt;get_sprite (&quot;feuerkraft/mineactive&quot;);
-    }
-}
-
-void 
-Mine::update (float delta) 
-{
-  if (!is_active ())
-    {
-      active -= delta;
-    }
-  else if (!detonated)
-    {
-      CollisionManager::current()-&gt;add_circle(get_id(), pos.x, pos.y, 8);
-    }
-}
-
-void
-Mine::on_collision(GameObj* obj)
-{
-  Mine::detonate();
-}
-
-bool 
-Mine::is_active ()
-{
-  return (active &lt;= 0);
-}
-
-void 
-Mine::draw (View&amp; view) 
-{
-  if (!is_active ())
-    {
-      view.get_sc().color().draw(sur, pos.x, pos.y);
-    }
-  else if (!detonated)
-    {
-      view.get_sc().color().draw(sur_active, pos.x, pos.y);
-    }
-  else
-    {
-      //view-&gt;draw (hole, pos);
-    }
-}
-
-void 
-Mine::detonate () 
-{
-  // Search for game objects in the given area to make damage
-  GameObjManager* objs = GameWorld::current()-&gt;get_game_obj_manager();
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      //Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(*i);
-      
-      // If distance to the mine is smaller than 100 apply a force
-      /*if (vehicle &amp;&amp; (vehicle-&gt;get_pos () - get_pos ()).get_length() &lt; 100.0)
-	{
-	  FloatVector2d force(pos - vehicle-&gt;get_pos());
-	  force = (100.0f) * (pos - vehicle-&gt;get_pos()).get_length();
-	  vehicle-&gt;collide(force);
-	}*/
-    }
-
-  GameWorld::current()-&gt;add (new Explosion(pos, Explosion::MEDIUM));
-  detonated = true;
-  //remove ();
-}
-
-/* EOF */

Copied: trunk/src/output_world_builder.cpp (from rev 341, trunk/src/output_world_builder.cxx)


Property changes on: trunk/src/output_world_builder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/output_world_builder.cxx
===================================================================
--- trunk/src/output_world_builder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/output_world_builder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,99 +0,0 @@
-//  $Id: output_world_builder.cxx,v 1.5 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;output_world_builder.hxx&quot;
-
-OutputWorldBuilder::OutputWorldBuilder()
-{
-}
-
-void
-OutputWorldBuilder::add_object(const std::string&amp; type, const AList&amp; alist)
-{
-  std::cout &lt;&lt; &quot;OutputWorldBuilder: gameobj: &quot; &lt;&lt; type &lt;&lt; std::endl;
-  print_alist(alist);
-}
-
-void
-OutputWorldBuilder::add_brush(const std::string&amp; resname, const AList&amp; alist)
-{
-  std::cout &lt;&lt; &quot;OutputWorldBuilder: brush: &quot; &lt;&lt; resname &lt;&lt; std::endl;
-  print_alist(alist);
-}
-
-void
-OutputWorldBuilder::add_building(const std::string&amp; type, const AList&amp; alist)
-{
-  std::cout &lt;&lt; &quot;OutputWorldBuilder: building: &quot; &lt;&lt; type &lt;&lt; std::endl;
-  print_alist(alist);
-}
-
-void
-OutputWorldBuilder::add_groundmap(const std::string&amp; type, const AList&amp; alist)
-{
-  std::cout &lt;&lt; &quot;OutputWorldBuilder: groundmap: &quot; &lt;&lt; type &lt;&lt; std::endl;
-  print_alist(alist);
-}
-
-void
-OutputWorldBuilder::add_script(const std::string&amp; resname)
-{
-  std::cout &lt;&lt; &quot;OutputWorldBuilder: script: &quot; &lt;&lt; resname &lt;&lt; std::endl;
-}
-
-void
-OutputWorldBuilder::print_alist(const AList&amp; alist)
-{
-  for(AList::const_iterator i = alist.begin(); i != alist.end(); ++i)
-    {
-      std::cout &lt;&lt; &quot;  &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; -&gt; &quot;;
-      switch(i-&gt;second.type)
-        {
-        case AList::AL_INT:
-          std::cout &lt;&lt; i-&gt;second.v_int &lt;&lt; std::endl;
-          break;
-        case AList::AL_FLOAT:
-          std::cout &lt;&lt; i-&gt;second.v_float &lt;&lt; std::endl;
-          break;
-        case AList::AL_BOOL:
-          std::cout &lt;&lt; i-&gt;second.v_bool &lt;&lt; std::endl;
-          break;
-        case AList::AL_STRING:
-          std::cout &lt;&lt; *i-&gt;second.v_string &lt;&lt; std::endl;
-          break;
-        case AList::AL_INTVECTOR2D:
-          std::cout &lt;&lt; &quot;[&quot; &lt;&lt; (*i).second.v_int_vector2d.x
-                    &lt;&lt; &quot;, &quot; &lt;&lt; (*i).second.v_int_vector2d.y
-                    &lt;&lt; &quot;]&quot;
-                    &lt;&lt; std::endl;
-          break;
-          /*case AList::AL_FLOATVECTOR2D:
-          std::cout &lt;&lt; &quot;[&quot; &lt;&lt; (*i).second.v_float_vector2d.x
-                    &lt;&lt; &quot;, &quot; &lt;&lt; (*i).second.v_float_vector2d.y
-                    &lt;&lt; &quot;]&quot;
-                    &lt;&lt; std::endl;
-                    break;*/
-        default:
-          std::cout &lt;&lt; &quot;&lt;unhandled&gt;&quot; &lt;&lt; std::endl;
-          break;
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/particles/fire_emitter.cpp (from rev 341, trunk/src/particles/fire_emitter.cxx)


Property changes on: trunk/src/particles/fire_emitter.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/particles/fire_emitter.cxx
===================================================================
--- trunk/src/particles/fire_emitter.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/particles/fire_emitter.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,24 +0,0 @@
-//  $Id: fire_emitter.cxx,v 1.1 2003/06/07 17:18:34 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;fire_emitter.hxx&quot;
-
-
-
-/* EOF */

Copied: trunk/src/particles/fire_particle.cpp (from rev 341, trunk/src/particles/fire_particle.cxx)


Property changes on: trunk/src/particles/fire_particle.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/particles/fire_particle.cxx
===================================================================
--- trunk/src/particles/fire_particle.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/particles/fire_particle.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,69 +0,0 @@
-//  $Id: fire_particle.cxx,v 1.2 2003/06/08 15:31:27 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/color.h&gt;
-#include &quot;../math.hxx&quot;
-#include &quot;../view.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;fire_particle.hxx&quot;
-
-FireParticle::FireParticle(const FloatVector2d&amp; arg_pos)
-  : sprite(resources-&gt;get_sprite(&quot;feuerkraft/firep&quot;)),
-    pos(arg_pos),
-    life_time(0)
-{
-  sprite.set_angle(Math::rad2deg(Math::frand() * Math::pi*2));
-  sprite.set_blend_func(blend_src_alpha, blend_one);
-}
-
-void
-FireParticle::update(float delta)
-{
-  pos += GameWorld::current()-&gt;get_wind() * delta * 1.3f;
-
-  life_time += delta;
-
-  if (life_time &gt; .33f)
-    {
-      life_time = .33f;
-      remove();
-    }
-
-  // black  CL_Color(  0,   0,   0);
-  // red    CL_Color(255,   0,   0);
-  // yellow CL_Color(255, 255,   0);
-  // white  CL_Color(255, 255, 255);
-
-  float factor = life_time * 3.0f;
-  
-  CL_Color color(life_time &gt;= 0.75 ? 255 : int(255 * (life_time - 0.75f)/0.25f),
-                 int(factor * 255),
-                 life_time &gt;= 0.25 ? 255 : int(255 * (life_time - 0.25f)/0.75f));
-  sprite.set_color(color);
-  sprite.set_alpha(1.0f - factor);
-  sprite.set_scale(1.0 - factor/2, 1.0 - factor/2);
-}
-
-void
-FireParticle::draw (View&amp; view)
-{
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-/* EOF */

Copied: trunk/src/particles/rocket_smoke_particle.cpp (from rev 341, trunk/src/particles/rocket_smoke_particle.cxx)


Property changes on: trunk/src/particles/rocket_smoke_particle.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/particles/rocket_smoke_particle.cxx
===================================================================
--- trunk/src/particles/rocket_smoke_particle.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/particles/rocket_smoke_particle.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,65 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../view.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;rocket_smoke_particle.hxx&quot;
-
-RocketSmokeParticle::RocketSmokeParticle(const FloatVector2d&amp; arg_pos)
-{
-  pos = arg_pos;
-  size = 1;
-  angle = rand () % 360;    
-  sprite = resources-&gt;get_sprite(&quot;feuerkraft/rocket_smoke&quot;);
-  max_life_time = 10.0f;
-  life_time = max_life_time;
-  //velocity = FloatVector2d (80.0f, 0.0f);
-}
-
-RocketSmokeParticle::~RocketSmokeParticle()
-{
-}
-
-void
-RocketSmokeParticle::update (float delta) 
-{
-  pos += GameWorld::current()-&gt;get_wind() * delta;
-
-  Particle::update (delta);
-
-  life_time -= delta;
-}
-
-void
-RocketSmokeParticle::draw (View&amp; view) 
-{    
-  sprite.set_alpha ((life_time/max_life_time) * .3);
-  sprite.set_scale (0.8f + ((1 - life_time/max_life_time)) * 4.0f,
-                    0.8f + ((1 - life_time/max_life_time)) * 4.0f);
-  sprite.set_angle(angle);
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-float
-RocketSmokeParticle::get_z_pos () 
-{
-  return 100; 
-}
-
-/* EOF */

Copied: trunk/src/particles/smoke_emitter.cpp (from rev 341, trunk/src/particles/smoke_emitter.cxx)


Property changes on: trunk/src/particles/smoke_emitter.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/particles/smoke_emitter.cxx
===================================================================
--- trunk/src/particles/smoke_emitter.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/particles/smoke_emitter.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,59 +0,0 @@
-//  $Id: smoke_emitter.cxx,v 1.2 2003/06/09 20:27:31 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../game_world.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;fire_particle.hxx&quot;
-#include &quot;smoke_particle.hxx&quot;
-#include &quot;smoke_emitter.hxx&quot;
-
-SmokeEmitter::SmokeEmitter(const FloatVector2d&amp; arg_pos)
-  : pos(arg_pos)
-{
-  last_particle = 0.0f;
-}
-
-void
-SmokeEmitter::set_pos(const FloatVector2d&amp; arg_pos)
-{
-  pos = arg_pos;
-}
-
-void
-SmokeEmitter::update(float delta)
-{
-  float particle_release_count = .3f;
-
-  last_particle += delta;
-
-  GameWorld::current()-&gt;add(new FireParticle(pos+ FloatVector2d::make_polar(Math::frand() * 5,
-                                                                                  Math::frand() * Math::pi*2)));
-
-  while (last_particle &gt; particle_release_count)
-    {
-      GameWorld::current()-&gt;add(new FireParticle(pos + FloatVector2d::make_polar(Math::frand() * 5,
-                                                                                  Math::frand() * Math::pi*2)));
-
-      GameWorld::current()-&gt;add(new SmokeParticle(pos + FloatVector2d::make_polar(Math::frand() * 20,
-                                                                                  Math::frand() * Math::pi*2)));
-      last_particle -= particle_release_count;
-    }
-}
-
-/* EOF */

Copied: trunk/src/path_manager.cpp (from rev 341, trunk/src/path_manager.cxx)


Property changes on: trunk/src/path_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/path_manager.cxx
===================================================================
--- trunk/src/path_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/path_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,106 +0,0 @@
-//  $Id: path_manager.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;system.hxx&quot;
-#include &quot;path_manager.hxx&quot;
-
-PathManager path_manager;
-
-PathManager::PathManager ()
-  : path_found (false)
-{
-}
-
-PathManager::~PathManager ()
-{
-}
-
-void
-PathManager::add_path (const std::string&amp; path)
-{
-  //std::cout &lt;&lt; &quot;PathManager: add_path: &quot; &lt;&lt; path &lt;&lt; std::endl;
-  path_list.push_back (path);
-}
-
-std::string
-PathManager::complete (const std::string&amp; relative_path)
-{
-  std::string comp_path = base_path + &quot;/&quot; + relative_path;
-  //std::cout &lt;&lt; &quot;PathManager: &quot; &lt;&lt; relative_path &lt;&lt; &quot; -&gt; &quot; &lt;&lt; comp_path &lt;&lt; std::endl;
-
-  return comp_path;
-}
-
-bool
-PathManager::find_path (const std::list&lt;std::string&gt;&amp; file_list)
-{
-  for (PathIter i = path_list.begin (); !path_found &amp;&amp; i != path_list.end (); ++i)
-    {
-      bool found_file = true;
-      for (PathIter f = file_list.begin (); found_file &amp;&amp; f != file_list.end (); ++f)
-	{
-	  if (!System::exist(*i + &quot;/&quot; + *f))
-	    found_file = false;
-	}
-      if (found_file)
-	{
-	  path_found = true;
-	  base_path = *i;
-
-	  std::cout &lt;&lt; &quot;PathManager: Using base_path: &quot; &lt;&lt; base_path &lt;&lt; std::endl;
-
-	  return true;
-	}
-    }
-
-  std::cout &lt;&lt; &quot;PathManager: No base path found&quot; &lt;&lt; std::endl;
-
-  return false;
-}
-
-/** Search for a path which contains the file 'file' */
-bool
-PathManager::find_path (const std::string&amp; file)
-{
-  for (PathIter i = path_list.begin (); !path_found &amp;&amp; i != path_list.end (); ++i)
-    {
-      if (System::exist(*i + &quot;/&quot; + file))
-	{
-	  path_found = true;
-	  base_path = *i;
-
-	  std::cout &lt;&lt; &quot;PathManager: Using base_path: &quot; &lt;&lt; base_path &lt;&lt; std::endl;
-
-	  return true;
-	}
-    }
-
-  std::cout &lt;&lt; &quot;PathManager: No base path found&quot; &lt;&lt; std::endl;
-
-  return false;
-}
-
-void
-PathManager::set_path (const std::string&amp; path)
-{
-  base_path = path;
-}
-
-/* EOF */

Copied: trunk/src/player.cpp (from rev 341, trunk/src/player.cxx)


Property changes on: trunk/src/player.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/player.cxx
===================================================================
--- trunk/src/player.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/player.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,55 +0,0 @@
-//  $Id: player.cxx,v 1.5 2003/06/17 22:06:13 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &quot;player.hxx&quot;
-
-Player::Player(Unit* arg_unit)
-{
-  soldier = arg_unit;
-  set_current_unit(arg_unit);
-}
-
-Unit*
-Player::get_soldier()
-{
-  return soldier;
-}
-
-void
-Player::set_soldier(Unit* new_soldier)
-{
-  soldier = new_soldier;
-  set_current_unit(soldier);
-}
-
-void
-Player::set_current_unit(Unit* arg_unit)
-{
-  unit = arg_unit;
-}
-
-Unit*
-Player::get_current_unit()
-{
-  assert(unit);
-  return unit;
-}
-
-/* EOF */

Copied: trunk/src/player_view.cpp (from rev 341, trunk/src/player_view.cxx)


Property changes on: trunk/src/player_view.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/player_view.cxx
===================================================================
--- trunk/src/player_view.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/player_view.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,38 +0,0 @@
-//  $Id: player_view.cxx,v 1.4 2003/06/04 13:10:09 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;player.hxx&quot;
-#include &quot;player_view.hxx&quot;
-
-PlayerViewUpdater::PlayerViewUpdater(Player* arg_player)
-  : VehicleViewUpdater(arg_player-&gt;get_current_unit()),
-    player(arg_player)
-{
-}
-
-void
-PlayerViewUpdater::update(float delta, ViewState&amp; state)
-{
-  // FIXME: Polling considered evil, maybe CL_Signal will help
-  set_unit(player-&gt;get_current_unit());
-
-  VehicleViewUpdater::update(delta, state);
-}
-
-/* EOF */

Copied: trunk/src/projectile.cpp (from rev 341, trunk/src/projectile.cxx)


Property changes on: trunk/src/projectile.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/projectile.cxx
===================================================================
--- trunk/src/projectile.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/projectile.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,125 +0,0 @@
-//  $Id: projectile.cxx,v 1.14 2003/06/22 21:51:21 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;property_set.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;explosion.hxx&quot;
-#include &quot;buildings/building.hxx&quot;
-#include &quot;buildings/building_map.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;projectile.hxx&quot;
-#include &quot;vehicles/vehicle.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-Projectile::Projectile (GameObj* p,
-			const FloatVector2d&amp; arg_pos, const FloatVector2d&amp; arg_velocity)
-  : sur (resources-&gt;get_sprite(&quot;feuerkraft/projectile&quot;)),
-    sur_light (resources-&gt;get_sprite(&quot;feuerkraft/projectile-light&quot;)),
-    tmp_pos (arg_pos),
-    velocity (arg_velocity),
-    lifetime (45 + rand () % 5 ),
-    parent (p)
-{
-  //std::cout &lt;&lt; &quot;Velocity: &quot; &lt;&lt; velocity.x &lt;&lt; &quot; &quot; &lt;&lt; velocity.y &lt;&lt; std::endl;
-  pos  = arg_pos;
-  
-  properties-&gt;register_float(&quot;lifetime&quot;,   &amp;lifetime);
-  properties-&gt;register_float(&quot;x-pos&quot;,      &amp;pos.x);
-  properties-&gt;register_float(&quot;y-pos&quot;,      &amp;pos.y);
-  properties-&gt;register_float(&quot;velocity-x&quot;, &amp;velocity.x);
-  properties-&gt;register_float(&quot;velocity-y&quot;, &amp;velocity.y);
-}
-
-Projectile::~Projectile ()
-{
-  
-}
-
-void 
-Projectile::draw (View&amp; view)
-{
-  if (lifetime &gt; 0) {
-    sur.set_angle(Math::rad2deg(velocity.get_orientation()));
-    sur_light.set_angle(Math::rad2deg(velocity.get_orientation()));
-    view.get_sc().color().draw(sur, pos.x, pos.y);
-    view.get_sc().light().draw(sur_light, pos.x, pos.y);
-  }
-
-  //std::cout &lt;&lt; &quot;Pos: &quot; &lt;&lt; pos.x &lt;&lt; &quot; &quot; &lt;&lt; pos.y &lt;&lt; std::endl;
-  //CL_Display::draw_line (tmp_pos.x, tmp_pos.y, 
-  //		 pos.x, pos.y, 1.0, 1.0, 1.0, 0.0);
-}
-
-void 
-Projectile::update (float delta)
-{
-  sur.update(delta);
-  delta = delta * 50.0f;
-
-  if (lifetime &gt;= 0)
-    {
-      tmp_pos = pos;
-
-      pos += velocity * delta;
-      --lifetime; // FIXME: not delta clean
-    }
-
-  if (lifetime &lt; 0)
-    detonate ();
-
-  CollisionManager::current()-&gt;add_point(get_id(), pos.x, pos.y);
-}
-
-bool 
-Projectile::removable ()
-{
-  return (lifetime &lt; 0);
-}
-
-void 
-Projectile::detonate ()
-{
-  lifetime = -1;
-  GameWorld::current()-&gt;add_front(new Explosion(pos));
-}
-
-void
-Projectile::on_collision(GameObj* obj)
-{
-  if (Projectile::parent != obj)
-    {
-      //std::cout &lt;&lt; &quot;Projectile &quot; &lt;&lt; get_id() &lt;&lt; &quot; touched gameobj &quot; &lt;&lt; obj-&gt;get_id() &lt;&lt; std::endl;
-      Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(obj);
-      if (vehicle)
-        vehicle-&gt;collide(this);
-      detonate();
-    }
-}
-
-void
-Projectile::on_collision_with_building(Building* building)
-{
-  //std::cout &lt;&lt; &quot;Projectile touched building&quot; &lt;&lt; get_id() &lt;&lt; std::endl;
-  building-&gt;collide (this);
-  detonate ();
-}
-
-/* EOF */

Copied: trunk/src/property.cpp (from rev 341, trunk/src/property.cxx)


Property changes on: trunk/src/property.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/property.cxx
===================================================================
--- trunk/src/property.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/property.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,158 +0,0 @@
-//  $Id: property.cxx,v 1.7 2003/06/09 20:27:31 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;assert.h&gt;
-#include &lt;ClanLib/Core/System/clanstring.h&gt;
-#include &quot;property.hxx&quot;
-
-Property::Property(const std::string&amp; arg_name)
-  : name(arg_name), type(T_EMPTY)
-{
-}
-
-Property::Property(const std::string&amp; arg_name, bool* value_ptr)
-  : name(arg_name), type(T_BOOL)
-{
-  data.m_bool = value_ptr;
-}
-
-Property::Property(const std::string&amp; arg_name, int* value_ptr)
-  : name(arg_name), type(T_INT)
-{
-  data.m_int = value_ptr;
-}
-
-Property::Property(const std::string&amp; arg_name, float* value_ptr)
-  : name(arg_name), type(T_FLOAT)
-{
-  data.m_float = value_ptr;
-}
-
-Property::Property(const std::string&amp; arg_name, std::string* value_ptr)
-  : name(arg_name), type(T_STRING)
-{
-  data.m_string = value_ptr;
-}
-
-Property::~Property()
-{
-}
-
-void
-Property::set_bool(bool value)
-{
-  assert(type == T_BOOL);
-  *data.m_bool = value;
-}
-
-void
-Property::set_int(int value)
-{
-  assert(type == T_INT || type == T_EMPTY);
-  *data.m_int = value;
-  type = T_INT;
-}
-
-void
-Property::set_float(float value)
-{
-  assert(type == T_FLOAT);
-  *data.m_float = value;
-}
-
-void
-Property::set_string(const std::string&amp; value)
-{
-  assert(type == T_STRING);
-  *data.m_string = value;
-}
-
-bool
-Property::get_bool() const
-{
-  assert(type == T_BOOL);
-  return *data.m_bool;
-}
-
-int
-Property::get_int() const
-{
-  assert(type == T_INT);
-  return *data.m_int;
-}
-
-float
-Property::get_float() const
-{
-  assert(type == T_FLOAT);
-  return *data.m_float;
-}
-
-std::string
-Property::get_string() const
-{
-  assert(type == T_STRING);
-  return *data.m_string;
-}
-
-std::string
-Property::to_string() const
-{
-  switch (type)
-    {
-    case Property::T_BOOL:
-      return CL_String::to(get_bool());
-
-    case Property::T_FLOAT:
-      return CL_String::to(get_float());
-      
-    case Property::T_INT:
-      return CL_String::to(get_int());
-
-    case Property::T_STRING:
-      return get_string();
-
-    default:
-      return &quot;&lt;empty&gt;&quot;;
-    }
-}
-
-std::ostream&amp; operator&lt;&lt;(std::ostream&amp; s, const Property&amp; property)
-{
-  switch (property.type)
-    {
-    case Property::T_BOOL:
-      return s &lt;&lt; property.get_bool();
-
-    case Property::T_FLOAT:
-      return s &lt;&lt; property.get_float();
-      
-    case Property::T_INT:
-      return s &lt;&lt; property.get_int();
-
-    case Property::T_STRING:
-      return s &lt;&lt; property.get_string();
-
-    default:
-      return s &lt;&lt; &quot;&lt;empty&gt;&quot;;
-    }
-}
-
-/* EOF */

Copied: trunk/src/property_set.cpp (from rev 341, trunk/src/property_set.cxx)


Property changes on: trunk/src/property_set.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/property_set.cxx
===================================================================
--- trunk/src/property_set.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/property_set.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,108 +0,0 @@
-//  $Id: property_set.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &quot;property.hxx&quot;
-#include &quot;property_set.hxx&quot;
-
-PropertySet::PropertySet()
-{
-  
-}
-
-PropertySet::~PropertySet() 
-{
-  for(Properties::iterator i = properties.begin(); i != properties.end(); ++i)
-    {
-      delete i-&gt;second;
-    }
-}
-
-Property* 
-PropertySet::lookup(const std::string&amp; name)
-{
-  Properties::iterator i = properties.find(name);
-  if (i == properties.end())
-    return 0;
-  else
-    return i-&gt;second;
-}
-
-void
-PropertySet::register_bool(const std::string&amp; name, bool* value_ptr)
-{
-  assert(lookup(name) == 0);
-  properties[name] = new Property(name, value_ptr);
-}
-
-void
-PropertySet::register_int(const std::string&amp; name, int* value_ptr)
-{
-  assert(lookup(name) == 0);
-  properties[name] = new Property(name, value_ptr);
-}
-
-void
-PropertySet::register_float(const std::string&amp; name, float* value_ptr)
-{
-  assert(lookup(name) == 0);
-  properties[name] = new Property(name, value_ptr);
-}
-
-void
-PropertySet::register_string(const std::string&amp; name, std::string* value_ptr)
-{
-  assert(lookup(name) == 0);
-  properties[name] = new Property(name, value_ptr);
-}
-
-void
-PropertySet::set_bool(const std::string&amp; name, bool value)
-{
-  Property* property = lookup(name);
-  assert(property);
-  property-&gt;set_bool(value);
-}
-
-void
-PropertySet::set_int(const std::string&amp; name, int value)
-{
-  Property* property = lookup(name);
-  assert(property);
-  property-&gt;set_int(value);
-}
-
-void
-PropertySet::set_float(const std::string&amp; name, float value)
-{
-  Property* property = lookup(name);
-  assert(property);
-  property-&gt;set_float(value);
-}
-
-void
-PropertySet::set_string(const std::string&amp; name, const std::string&amp; value)
-{
-  Property* property = lookup(name);
-  assert(property);
-  property-&gt;set_string(value);
-
-}
-
-/* EOF */

Copied: trunk/src/radar.cpp (from rev 341, trunk/src/radar.cxx)


Property changes on: trunk/src/radar.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/radar.cxx
===================================================================
--- trunk/src/radar.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/radar.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,104 +0,0 @@
-//  $Id: radar.cxx,v 1.15 2003/06/23 10:01:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright(C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or(at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;buildings/building_map.hxx&quot;
-#include &quot;game_obj_manager.hxx&quot;
-#include &quot;radar.hxx&quot;
-#include &quot;math.hxx&quot;
-#include &quot;player.hxx&quot;
-#include &quot;vehicles/vehicle.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-Radar::Radar(const FloatVector2d&amp; arg_pos, 
-             PlayerPtr p)
-  : player(p),
-    background(resources-&gt;get_sprite(&quot;feuerkraft/radar&quot;)),
-    pos(arg_pos),
-    angle(0)
-{
-}
-
-Radar::~Radar()
-{
-}
-
-void 
-Radar::draw(CL_GraphicContext&amp; gc)
-{
-  FloatVector2d end(0.0f, 64.0f);
-
-  end = end.rotate(angle);
-
-  end += pos;
-
-  background.draw(int(pos.x), int(pos.y), &amp;gc);
-  
-  GameObjManager* objs = GameWorld::current()-&gt;get_game_obj_manager();
-  for (GameObjManager::iterator i = objs-&gt;begin(); i != objs-&gt;end(); ++i)
-    {
-      (*i)-&gt;draw_radar(*this);
-    }
-
-  GameWorld::current()-&gt;get_buildingmap()-&gt;draw_radar(*this);
-
-  CL_Display::draw_line(int(pos.x), int(pos.y - 5),
-                        int(pos.x), int(pos.y + 5),
-                        CL_Color(0, 255, 0));
-
-  CL_Display::draw_line(int(pos.x - 5), int(pos.y),
-                        int(pos.x + 5), int(pos.y),
-                        CL_Color(0, 255, 0));
-}
-
-void
-Radar::draw_blip(const FloatVector2d&amp; arg_pos, int size,
-                 float red, float green, float blue)
-{
-  // Callculate the distance between 'pos' and the vehicle that holds
-  // the radar
-  FloatVector2d diff = arg_pos;
-
-  diff -= player-&gt;get_current_unit()-&gt;get_pos();
-  diff *= 1/30.0f;
-
-  float alpha =(diff.get_length() / 64.0);
-  alpha *= alpha * alpha;
-  alpha = 1.0f - alpha;
-
-  if (diff.get_length() &lt; 64.0)
-    {
-      //diff = diff.rotate(-vehicle-&gt;get_angle () + (3.14159/2), FloatVector2d (0, 0, 1.0));
-      
-      CL_Display::fill_rect(CL_Rect(int(pos.x + diff.x) - size, int(pos.y + diff.y) - size,
-                                    int(pos.x + diff.x) + size, int(pos.y + diff.y) + size),
-                            CL_Color(int(255*red),
-                                     int(255*green),
-                                     int(255*blue), 
-                                     int(255*alpha)));
-    }
-}
-
-void 
-Radar::update(float delta)
-{
-  angle += 10.0f * delta;
-}
-
-/* EOF */

Copied: trunk/src/resource_manager.cpp (from rev 341, trunk/src/resource_manager.cxx)


Property changes on: trunk/src/resource_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/resource_manager.cxx
===================================================================
--- trunk/src/resource_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/resource_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,82 +0,0 @@
-//  $Id: resource_manager.cxx,v 1.12 2003/09/15 20:23:53 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/surface.h&gt;
-#include &lt;ClanLib/Display/font.h&gt;
-#include &lt;ClanLib/Core/Resources/resource_manager.h&gt;
-#include &lt;ClanLib/Core/System/error.h&gt;
-#include &lt;ClanLib/Core/System/cl_assert.h&gt;
-
-#include &quot;path_manager.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-ResourceManager* resources;
-
-ResourceManager::ResourceManager ()
-{
-  resource_manager  = new CL_ResourceManager();
-  resource_manager-&gt;add_resources(CL_ResourceManager(path_manager.complete(&quot;feuerkraft.xml&quot;), false));
-  resource_manager-&gt;add_resources(CL_ResourceManager(path_manager.complete(&quot;tiles.xml&quot;), false));
-}
-
-ResourceManager::~ResourceManager ()
-{
-}
-
-CL_Surface
-ResourceManager::get_surface (const std::string&amp; location)
-{
-  try {
-    return CL_Surface (location, resource_manager);
-  } catch(CL_Error&amp; err) {
-      std::cout &lt;&lt; &quot;ResourceManager: Error: &quot; &lt;&lt; err.message &lt;&lt; std::endl;
-    return CL_Surface();
-  }
-}
-
-CL_Sprite
-ResourceManager::get_sprite (const std::string&amp; location)
-{
-  try {
-    CL_Sprite sprite(location, resource_manager);
-    sprite.set_alignment(origin_center);
-    return sprite;
-  } catch (CL_Error&amp; err) {
-    std::cout &lt;&lt; &quot;ResourceManager: Error: &quot; &lt;&lt; err.message &lt;&lt; std::endl;
-    return CL_Sprite ();
-  }
-}
-
-CL_Font
-ResourceManager::get_font(const std::string&amp; location)
-{
-  try {
-    CL_Font font(location, resource_manager);
-    return font;
-  } catch(CL_Error&amp; err) {
-    std::cout &lt;&lt; &quot;Couldn't load font: &quot; &lt;&lt; location &lt;&lt; std::endl;
-    std::cout &lt;&lt; &quot;CL_Error: &quot; &lt;&lt; err.message &lt;&lt; std::endl;
-    assert(false);
-    return CL_Font();
-  }
-}
-
-/* EOF */

Copied: trunk/src/robot_tank.cpp (from rev 341, trunk/src/robot_tank.cxx)


Property changes on: trunk/src/robot_tank.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/robot_tank.cxx
===================================================================
--- trunk/src/robot_tank.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/robot_tank.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,145 +0,0 @@
-//  $Id: robot_tank.cxx,v 1.6 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;vector2d.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;math.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;robot_tank.hxx&quot;
-
-RobotTank::RobotTank(float x_, float y_, float orientation_, float velocity_)
-{
-  pos.x = x_;
-  pos.y = y_;
-  orientation = orientation_; 
-  velocity = velocity_;
-
-  max_velocity = 150.0f;
-  throttle_state = T_NEUTRAL;
-  steering_state = S_NEUTRAL;
-
-  sprite = resources-&gt;get_sprite(&quot;feuerkraft/trooper&quot;);
-  sprite.set_alignment(origin_center);
-
-  ai_count = 0;
-}
-
-void
-RobotTank::update (float delta)
-{
-  update_ai(delta);
-
-  const float max_acceleration = 25.0f;
-  const float max_deceleration = 10.0f;
-  const float max_steering = 1.0f;
-
-  // update velocity
-  switch(throttle_state)
-    {
-    case T_ACCELERATE:
-      velocity += max_acceleration * delta;
-      break;
-    case T_NEUTRAL:
-      velocity -= 5.0f * delta;
-      break;
-    case T_BREAK:
-      velocity -= max_deceleration * delta;
-      break;
-    default:
-      assert(false);
-    }
-
-  if (velocity &lt; 0)
-    velocity = 0;
-  else if (velocity &gt; max_velocity)
-    velocity = max_velocity;
-
-  // update orientation
-  switch(steering_state)
-    {
-    case S_LEFT:
-      orientation += max_steering * delta;
-      break;
-    case S_NEUTRAL:
-      // do nothing
-      break;
-    case S_RIGHT:
-      orientation -= max_steering * delta;
-      break;
-    default:
-      assert(false);
-    }
-
-  // update position
-  FloatVector2d vec(velocity * delta, 0);
-  vec.set_orientation(orientation);
-  pos += vec;
-}
-
-void
-RobotTank::update_ai (float delta)
-{
-  ai_count += delta;
-  
-  if (ai_count &gt; 2)
-    {
-      ai_count = 0;
-      
-      switch (rand() % 5)
-        {
-        case 0:
-        case 1:
-        case 2:
-          throttle_state = T_ACCELERATE;
-          break;
-        case 3:
-          throttle_state = T_BREAK;
-          break;
-        case 4:
-          throttle_state = T_NEUTRAL;
-          break;
-        }
-      steering_state = SteeringState(rand() % S_MAX);
-    }
-}
-
-void
-RobotTank::draw (View&amp; view)
-{
-  // FIXME: Orientation is wrong
-  sprite.set_angle(Math::deg2rad(-orientation - Math::pi_2));
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-void
-RobotTank::draw_energie (View&amp; view)
-{
-}
-
-void
-RobotTank::draw_radar (Radar&amp; radar)
-{
-}
-
-void
-RobotTank::draw_levelmap (LevelMap&amp; view)
-{
-}
-
-/* EOF */

Copied: trunk/src/rocket.cpp (from rev 341, trunk/src/rocket.cxx)


Property changes on: trunk/src/rocket.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/rocket.cxx
===================================================================
--- trunk/src/rocket.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/rocket.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,105 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;resource_manager.hxx&quot;
-#include &quot;collision_manager.hxx&quot;
-#include &quot;explosion.hxx&quot;
-#include &quot;particles/rocket_smoke_particle.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;buildings/building.hxx&quot;
-#include &quot;rocket.hxx&quot;
-
-Rocket::Rocket(const FloatVector2d&amp; pos, float orientation)
-  : pos(pos),
-    orientation(orientation),
-    velocity(10.0f),
-    max_velocity(50.0f),
-    life_time(0)
-{
-  release_count = 0;
-  sprite = resources-&gt;get_sprite(&quot;feuerkraft/rocket&quot;);
-
-  sprite_light     = resources-&gt;get_sprite(&quot;feuerkraft/rocket-light&quot;);
-  sprite_highlight = resources-&gt;get_sprite(&quot;feuerkraft/rocket-highlight&quot;);
-
-  smoke  = resources-&gt;get_sprite(&quot;feuerkraft/rocket_smoke&quot;);
-}
-
-Rocket::~Rocket()
-{
-}
-
-void
-Rocket::draw(View&amp; view)
-{
-  sprite.set_angle(Math::rad2deg(orientation));
-  sprite_light.set_angle(Math::rad2deg(orientation));
-  sprite_highlight.set_angle(Math::rad2deg(orientation));
-
-  // Light flicker
-  sprite_light.set_alpha(Math::frand()*0.5f + 0.5f);
-  sprite_highlight.set_alpha(Math::frand()*0.5f + 0.5f);
-
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-  view.get_sc().light().draw(sprite_light, pos.x, pos.y);
-  view.get_sc().highlight().draw(sprite_highlight, pos.x, pos.y);
-}
-
-void
-Rocket::update(float delta)
-{
-  pos += FloatVector2d(velocity, 0).rotate(orientation);
-
-  velocity += 10.0f * delta;
-  if (velocity &gt; max_velocity)
-    velocity = max_velocity;
-
-  CollisionManager::current()-&gt;add_point(get_id(), pos.x, pos.y);
-
-  release_count += delta;
-  if (release_count &gt; 0.03f)
-    GameWorld::current()-&gt;add(new RocketSmokeParticle(pos));
-
-  while (release_count &gt; 0.03f)
-    {
-      release_count -= 0.03f;
-    }
-
-  life_time += delta;
-  if (life_time &gt; 2.0f)
-    {
-      detonate();
-    }
-}
-
-void
-Rocket::on_collision_with_building(Building* building)
-{
-  building-&gt;collide(35);
-  detonate();
-}
-
-void
-Rocket::detonate()
-{
-  GameWorld::current()-&gt;add_front(new Explosion(pos, Explosion::MEDIUM));
-  remove();
-}
-
-/* EOF */

Copied: trunk/src/satchel_charge.cpp (from rev 341, trunk/src/satchel_charge.cxx)


Property changes on: trunk/src/satchel_charge.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/satchel_charge.cxx
===================================================================
--- trunk/src/satchel_charge.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/satchel_charge.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,56 +0,0 @@
-//  $Id: satchel_charge.cxx,v 1.2 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;view.hxx&quot;
-#include &quot;alist.hxx&quot;
-#include &quot;explosion.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;satchel_charge.hxx&quot;
-
-SatchelCharge::SatchelCharge(const AList&amp; lst)
-{
-  pos.x = lst.get_float(&quot;x-pos&quot;);
-  pos.y = lst.get_float(&quot;y-pos&quot;);
-
-  properties-&gt;register_float(&quot;x-pos&quot;, &amp;pos.x);
-  properties-&gt;register_float(&quot;y-pos&quot;, &amp;pos.y);
-
-  sprite = resources-&gt;get_sprite (&quot;feuerkraft/satchel&quot;);
-}
-
-void
-SatchelCharge::update(float delta)
-{
-}
-
-void
-SatchelCharge::draw(View&amp; view)
-{
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-void
-SatchelCharge::detonate()
-{
-  GameWorld::current()-&gt;add (new Explosion(pos, Explosion::MEDIUM));
-  remove();
-}
-
-/* EOF */

Copied: trunk/src/scm_functor.cpp (from rev 341, trunk/src/scm_functor.cxx)


Property changes on: trunk/src/scm_functor.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scm_functor.cxx
===================================================================
--- trunk/src/scm_functor.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scm_functor.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,80 +0,0 @@
-//  $Id: scm_functor.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;libguile.h&gt;
-#include &quot;scm_functor.hxx&quot;
-
-SCMFunctor::SCMFunctor(SCM arg_func)
-{
-  func = arg_func;
-  scm_gc_protect_object(func);
-}
-
-SCMFunctor::~SCMFunctor()
-{
-  scm_gc_unprotect_object(func);
-}
-
-SCMFunctor::SCMFunctor(const SCMFunctor&amp; hook)
-{
-  func = hook.func;
-
-  scm_gc_protect_object(func);
-}
-
-SCMFunctor&amp; 
-SCMFunctor::operator= (const SCMFunctor&amp; hook)
-{
-  if (this != &amp;hook)
-    {
-      scm_gc_unprotect_object(func);
-
-      func = hook.func;
-
-      scm_gc_protect_object(func);
-    }
-  return *this;
-}
-
-void
-SCMFunctor::operator()()
-{
-  scm_call_0(func);
-}
-
-void
-SCMFunctor::operator()(SCM arg)
-{
-  scm_call_1(func, arg);
-}
-
-void
-SCMFunctor::operator()(SCM arg1, SCM arg2)
-{
-  scm_call_2(func, arg1, arg2);
-}
-
-void
-SCMFunctor::operator()(SCM arg1, SCM arg2, SCM arg3)
-{
-  scm_call_3(func, arg1, arg2, arg3);
-}
-
-/* EOF */

Copied: trunk/src/scm_sequence_hook.cpp (from rev 341, trunk/src/scm_sequence_hook.cxx)


Property changes on: trunk/src/scm_sequence_hook.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scm_sequence_hook.cxx
===================================================================
--- trunk/src/scm_sequence_hook.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scm_sequence_hook.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,63 +0,0 @@
-//  $Id: scm_sequence_hook.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;libguile.h&gt;
-#include &quot;scm_sequence_hook.hxx&quot;
-
-SCMSequenceHook::SCMSequenceHook(SCM arg_func)
-{
-  func = arg_func;
-  scm_gc_protect_object(func);
-}
-
-SCMSequenceHook::~SCMSequenceHook()
-{
-  scm_gc_unprotect_object(func);
-}
-
-SCMSequenceHook::SCMSequenceHook(const SCMSequenceHook&amp; hook)
-{
-  func = hook.func;
-
-  scm_gc_protect_object(func);
-}
-
-SCMSequenceHook&amp; 
-SCMSequenceHook::operator= (const SCMSequenceHook&amp; hook)
-{
-  if (this != &amp;hook)
-    {
-      scm_gc_unprotect_object(func);
-
-      func = hook.func;
-
-      scm_gc_protect_object(func);
-    }
-  return *this;
-}
-
-void
-SCMSequenceHook::call()
-{
-  std::cout &lt;&lt; &quot;SCMSequenceHook::call(): &quot; &lt;&lt; get_id() &lt;&lt; std::endl;
-  scm_call_0(func);
-}
-
-/* EOF */

Copied: trunk/src/screen.cpp (from rev 341, trunk/src/screen.cxx)


Property changes on: trunk/src/screen.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/screen.cxx
===================================================================
--- trunk/src/screen.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/screen.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,78 +0,0 @@
-//  $Id: screen.cxx,v 1.7 2003/06/06 09:49:00 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;screen.hxx&quot;
-
-Screen::Screen ()
-{
-}
-
-Screen::~Screen ()
-{
-}
-
-void 
-Screen::draw (CL_GraphicContext&amp; gc)
-{
-  for (GuiObjIter i = gui_objs.begin (); i != gui_objs.end (); ++i)
-    {
-      (*i)-&gt;draw(gc);
-    }
-}
-
-void 
-Screen::update (float delta)
-{
-  for (GuiObjIter i = gui_objs.begin (); i != gui_objs.end (); ++i)
-    {
-      (*i)-&gt;update (delta);
-    }
-}
-
-bool
-Screen::has(GuiObj* obj)
-{
-  for (GuiObjIter i = gui_objs.begin (); i != gui_objs.end (); ++i)
-    if (obj == *i)
-      return true;
-  
-  return false;
-}
-
-void 
-Screen::add (GuiObj* obj)
-{
-  if (!has(obj))
-    gui_objs.push_back (obj);
-}
-
-void 
-Screen::remove (GuiObj* obj)
-{
-  for (GuiObjIter i = gui_objs.begin (); i != gui_objs.end (); ++i)
-    {
-      if (*i == obj)
-        {
-          gui_objs.erase(i);
-          return;
-        }
-    }
-}
-
-/* EOF */

Copied: trunk/src/screenshot.cpp (from rev 341, trunk/src/screenshot.cxx)


Property changes on: trunk/src/screenshot.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/screenshot.cxx
===================================================================
--- trunk/src/screenshot.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/screenshot.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,84 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;stdio.h&gt;
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;ClanLib/Display/display_window.h&gt;
-#include &lt;ClanLib/Display/pixel_buffer.h&gt;
-#include &lt;ClanLib/Display/pixel_format.h&gt;
-#include &quot;screenshot.hxx&quot;
-
-void
-Screenshot::write_screenshot_pnm(const std::string&amp; filename)
-{
-  CL_PixelBuffer buf = take_screen_shot();
-
-  FILE* out = fopen(filename.c_str(), &quot;wb&quot;);
-  
-  if (!out)
-    {
-      perror(filename.c_str());
-      std::cout &lt;&lt; &quot;Screenshot: Couldn't write file: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-      return;
-    }
-
-  buf.lock();
-  int width  = buf.get_width();
-  int pitch  = buf.get_width()*3;
-  int height = buf.get_height();
-
-  fprintf(out,
-	  &quot;P6\n&quot;
-	  &quot;# CREATOR: Feuerkraft\n&quot;
-          &quot;%d %d\n&quot;
-	  &quot;255\n&quot;,
-	  width,
-	  height);
-
-  unsigned char* data = static_cast&lt;unsigned char*&gt;(buf.get_data());
-  
-  for(int i = height-1; i &gt;= 0; --i)
-    {
-      fwrite(data + pitch*i,
-             sizeof(unsigned char),
-             pitch, 
-             out);
-    }
-
-  buf.unlock();
-  fclose(out);
-}
-
-CL_PixelBuffer
-Screenshot::take_screen_shot()
-{
-  CL_PixelBuffer back_buffer = CL_Display::get_current_window()-&gt;get_back_buffer();
-  
-  unsigned short width = back_buffer.get_width();
-  unsigned short height = back_buffer.get_height();
-		
-  CL_PixelBuffer pbuf(width, height, width*3, CL_PixelFormat::bgr888);
-  back_buffer.convert(pbuf);
-  
-  return pbuf;
-}
-
-
-/* EOF */

Modified: trunk/src/scripting/Makefile.am
===================================================================
--- trunk/src/scripting/Makefile.am	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/Makefile.am	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,63 +1,63 @@
 noinst_LIBRARIES = libfeuerkraft_scripting.a
 
 command_source = \
- ai_commands.cxx \
- ai_commands.hxx \
- ai_vehicle_commands.cxx \
- ai_vehicle_commands.hxx \
- building_commands.cxx   \
- building_commands.hxx   \
- clanlib_commands.hxx    \
- clanlib_commands.cxx    \
- comm_commands.cxx       \
- comm_commands.hxx       \
- display_commands.hxx    \
- display_commands.cxx    \
- debug_commands.hxx      \
- debug_commands.cxx      \
- effect_commands.cxx     \
- effect_commands.hxx     \
- gameobj_commands.cxx    \
- gameobj_commands.hxx    \
- game_commands.cxx       \
- game_commands.hxx       \
- input_commands.cxx      \
- input_commands.hxx      \
- menu_commands.cxx       \
- menu_commands.hxx       \
- object_commands.cxx     \
- object_commands.hxx     \
- player_commands.cxx     \
- player_commands.hxx     \
- sequence_commands.cxx   \
- sequence_commands.hxx   \
- sound_commands.cxx      \
- sound_commands.hxx      \
- trigger_commands.cxx    \
- trigger_commands.hxx    \
- vehicle_commands.cxx    \
- vehicle_commands.hxx    \
- script_helper.cxx       \
- script_helper.hxx
+ ai_commands.cpp \
+ ai_commands.hpp \
+ ai_vehicle_commands.cpp \
+ ai_vehicle_commands.hpp \
+ building_commands.cpp   \
+ building_commands.hpp   \
+ clanlib_commands.hpp    \
+ clanlib_commands.cpp    \
+ comm_commands.cpp       \
+ comm_commands.hpp       \
+ display_commands.hpp    \
+ display_commands.cpp    \
+ debug_commands.hpp      \
+ debug_commands.cpp      \
+ effect_commands.cpp     \
+ effect_commands.hpp     \
+ gameobj_commands.cpp    \
+ gameobj_commands.hpp    \
+ game_commands.cpp       \
+ game_commands.hpp       \
+ input_commands.cpp      \
+ input_commands.hpp      \
+ menu_commands.cpp       \
+ menu_commands.hpp       \
+ object_commands.cpp     \
+ object_commands.hpp     \
+ player_commands.cpp     \
+ player_commands.hpp     \
+ sequence_commands.cpp   \
+ sequence_commands.hpp   \
+ sound_commands.cpp      \
+ sound_commands.hpp      \
+ trigger_commands.cpp    \
+ trigger_commands.hpp    \
+ vehicle_commands.cpp    \
+ vehicle_commands.hpp    \
+ script_helper.cpp       \
+ script_helper.hpp
 
 libfeuerkraft_scripting_a_SOURCES = \
  $(command_source) \
- feuerkraft_wrap.cxx
+ feuerkraft_wrap.cpp
 
 #lib_LTLIBRARIES = libguile-feuerkraft.la
 
-#libguile_feuerkraft_la_SOURCES = feuerkraft_wrap.cxx
+#libguile_feuerkraft_la_SOURCES = feuerkraft_wrap.cpp
 #libguile_feuerkraft_la_LIBADD = libfeuerkraft_scripting.a
 
-# Include feuerkraft_wrap.cxx in case the user doesn't have swig installed
-EXTRA_DIST = feuerkraft_wrap.cxx
+# Include feuerkraft_wrap.cpp in case the user doesn't have swig installed
+EXTRA_DIST = feuerkraft_wrap.cpp
 
-feuerkraft_wrap.cxx: feuerkraft.i  $(command_source)
+feuerkraft_wrap.cpp: feuerkraft.i  $(command_source)
 	$(SWIG) -guile -c++  -o $@ $&lt;
 
 # We override the default compile command to skip all the warnings
 # that compiling the wrappers causes.
-feuerkraft_wrap.o : feuerkraft_wrap.cxx
+feuerkraft_wrap.o : feuerkraft_wrap.cpp
 	$(CXX) -c -O2 -o $@ $&lt;
 
 # EOF #

Copied: trunk/src/scripting/ai_commands.cpp (from rev 341, trunk/src/scripting/ai_commands.cxx)


Property changes on: trunk/src/scripting/ai_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/ai_commands.cxx
===================================================================
--- trunk/src/scripting/ai_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/ai_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,79 +0,0 @@
-//  $Id: ai_commands.cxx,v 1.3 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../soldier.hxx&quot;
-#include &quot;../ai_manager.hxx&quot;
-#include &quot;script_helper.hxx&quot;
-#include &quot;ai_commands.hxx&quot;
-
-void
-ai_goto(int handle, float x, float y)
-{
-  Soldier* soldier = Scripting::get_object&lt;Soldier&gt;(handle);
-
-  if (soldier)
-    {
-      AI* ai = AIManager::instance()-&gt;get_ai(soldier);
-      SoldierAI* soldier_ai = 0;
-      if (ai &amp;&amp; (soldier_ai = dynamic_cast&lt;SoldierAI*&gt;(ai)))
-        {
-          soldier_ai-&gt;goto_to(FloatVector2d(x, y));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;Soldier doesn't have an AI&quot; &lt;&lt; std::endl;
-        }
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;No soldier with id: &quot; &lt;&lt; handle &lt;&lt; std::endl;
-    }
-}
-
-void
-ai_stop(int handle)
-{
-  SoldierAI* soldier_ai = Scripting::get_ai&lt;SoldierAI&gt;(handle);
-  if (soldier_ai)
-    soldier_ai-&gt;stop();
-}
-
-bool
-ai_has(int handle)
-{
-  AI* ai = AIManager::instance()-&gt;get_ai(Scripting::get_object&lt;GameObj&gt;(handle));
-  return ai;
-}
-
-void
-ai_attach(int handle)
-{
-  Unit* unit = Scripting::get_object&lt;Unit&gt;(handle);
-  if (unit)
-    unit-&gt;attach_ai();
-}
-
-void ai_dettach(int handle)
-{
-  Unit* unit = Scripting::get_object&lt;Unit&gt;(handle);
-  if (unit)
-    unit-&gt;dettach_ai();
-}
-
-/* EOF */

Copied: trunk/src/scripting/ai_vehicle_commands.cpp (from rev 341, trunk/src/scripting/ai_vehicle_commands.cxx)


Property changes on: trunk/src/scripting/ai_vehicle_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/ai_vehicle_commands.cxx
===================================================================
--- trunk/src/scripting/ai_vehicle_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/ai_vehicle_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,76 +0,0 @@
-//  $Id: ai_vehicle_commands.cxx,v 1.5 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;../ai_vehicle.hxx&quot;
-#include &quot;ai_vehicle_commands.hxx&quot;
-
-static AIVehicle*
-get_AIVehicle(int object_id)
-{
-  AIVehicle* vehicle = dynamic_cast&lt;AIVehicle*&gt;(GameObjManager::current()-&gt;get_object_by_id(object_id));
-  if (vehicle)
-    {
-      return vehicle;
-    }
-  else
-    {
-      std::cout  &lt;&lt; &quot;AIVehicle: no object given by id: &quot; &lt;&lt; object_id &lt;&lt; std::endl;
-      return 0;
-    }
-}
- 
-
-int
-ai_vehicle_create(int x, int y)
-{
-  AIVehicle* vehicle = new AIVehicle(FloatVector2d(x,y));
-
-  return GameObjManager::current()-&gt;add_object(vehicle);
-}
-
-void
-ai_vehicle_wait(int object_id, float seconds)
-{
-  AIVehicle* vehicle = get_AIVehicle(object_id);
-
-  if (vehicle)
-    vehicle-&gt;wait(seconds);
-}
-
-void
-ai_vehicle_drive_to(int object_id, int x, int y)
-{
-  AIVehicle* vehicle = get_AIVehicle(object_id);
-
-  if (vehicle)
-    vehicle-&gt;drive_to(FloatVector2d(x, y));
-}
-
-void
-ai_vehicle_clear_orders(int object_id)
-{
-  AIVehicle* vehicle = get_AIVehicle(object_id);
-
-  if (vehicle)
-    vehicle-&gt;clear_orders();
-}
-
-/* EOF */

Copied: trunk/src/scripting/building_commands.cpp (from rev 341, trunk/src/scripting/building_commands.cxx)


Property changes on: trunk/src/scripting/building_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/building_commands.cxx
===================================================================
--- trunk/src/scripting/building_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/building_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,177 +0,0 @@
-//  $Id: building_commands.cxx,v 1.13 2003/06/23 09:04:10 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;guile/gh.h&gt;
-#include &quot;../guile.hxx&quot;
-#include &quot;../game_world.hxx&quot;
-#include &quot;../property.hxx&quot;
-#include &quot;../property_set.hxx&quot;
-#include &quot;../buildings/building.hxx&quot;
-#include &quot;../buildings/custom_building.hxx&quot;
-#include &quot;../buildings/building_type_manager.hxx&quot;
-#include &quot;../buildings/building_manager.hxx&quot;
-#include &quot;building_commands.hxx&quot;
-
-int
-building_create(int type, int x, int y)
-{
-  Building* building;
-
-  if (type == 1)
-    {
-      building = 0;
-    }
-  else
-    {
-      AList props;
-      props.set_int(&quot;x-pos&quot;, x);
-      props.set_int(&quot;y-pos&quot;, y);
-      building = BuildingTypeManager::current()-&gt;create_building(type, props);
-    }
-
-  if (building)
-    {
-      BuildingManager::current()-&gt;add_building(building, x, y);
-      return building-&gt;get_id();
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;BuildingCommands: Unhandled building type: &quot; &lt;&lt; type &lt;&lt; std::endl;
-      return 0;
-    }
-}
-
-void
-building_remove(int handle)
-{
-}
-
-int
-building_get_tile(int x, int y)
-{
-  return 0;
-}
-
-int
-building_get(int x, int y)
-{
-  return 0;
-}
-
-int
-building_create_type(const char* name, SCM lst)
-{
-  AList alist;
-  
-  while(!gh_null_p(lst))
-    {
-      SCM key   = gh_car(lst);
-
-      if (gh_null_p(gh_cdr(lst)))
-        {
-          std::cout &lt;&lt; &quot;Missing argument to keyword!&quot; &lt;&lt; std::endl;
-        }
-
-      SCM value = gh_cadr(lst);
-
-      if (gh_boolean_p(value))
-        {
-          alist.set_bool(Guile::keyword2string(key), gh_scm2bool(value));
-        }
-      else if (gh_number_p(value))
-        {
-          alist.set_int(Guile::keyword2string(key), gh_scm2int(value));
-        }
-      else if (gh_string_p(value))
-        {
-          alist.set_string(Guile::keyword2string(key), Guile::scm2string(value));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;BuildingCommands: unknown argumnent type&quot; &lt;&lt; std::endl;
-        }
-
-      lst = gh_cddr(lst);
-    }
-
-  return BuildingTypeManager::current()-&gt;register_factory(new CustomBuildingFactory(name, alist));
-}
-
-SCM 
-building_get_property(int handle, const char* name)
-{
-  Building* building = BuildingManager::current()-&gt;get_building_by_id(handle);
-  if (!building)
-    {
-      std::cout &lt;&lt; &quot;building_get_property: unknown handle: &quot; &lt;&lt; handle &lt;&lt; std::endl;
-      return SCM_UNSPECIFIED;
-    }
-  else
-    {
-      PropertySet* properties = building-&gt;get_properties();
-      if (!properties)
-        {
-          return SCM_UNSPECIFIED;
-        }
-      else
-        {
-          Property* property = properties-&gt;lookup(name);
-          
-          if (!property)
-            {
-              return SCM_UNSPECIFIED;
-            }
-          else
-            {
-              return Guile::property2scm(*property);
-            }
-        }
-    }
-}
-
-void
-building_set_property(int handle, const char* name, SCM value)
-{
-  Building* building = BuildingManager::current()-&gt;get_building_by_id(handle);
-  if (!building)
-    {
-      std::cout &lt;&lt; &quot;building_set_property: unknown handle: &quot; &lt;&lt; handle &lt;&lt; std::endl;
-    }
-  else
-    {
-      PropertySet* properties = building-&gt;get_properties();
-      if (!properties)
-        {
-          std::cout &lt;&lt; &quot;building_set_property: object has no properties&quot; &lt;&lt; std::endl;
-        }
-      else
-        {
-          Guile::scm2property(*properties, name, value);
-        }
-    }
-}
-
-int
-building_get_type_from_name(const char* name)
-{
-  return BuildingTypeManager::current()-&gt;name_to_id(name);
-}
-
-/* EOF */

Copied: trunk/src/scripting/clanlib_commands.cpp (from rev 341, trunk/src/scripting/clanlib_commands.cxx)


Property changes on: trunk/src/scripting/clanlib_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/clanlib_commands.cxx
===================================================================
--- trunk/src/scripting/clanlib_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/clanlib_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,49 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;clanlib_commands.hxx&quot;
-
-SCM post_keep_alive_func = SCM_BOOL_F;
-
-SCM  clanlib_get_post_keep_alive_func()
-{
-  return post_keep_alive_func;
-}
-
-void clanlib_set_post_keep_alive_func(SCM func)
-{
-  if (post_keep_alive_func != func)
-    {
-      if (post_keep_alive_func != SCM_BOOL_F)
-        scm_gc_unprotect_object(post_keep_alive_func);
-
-      post_keep_alive_func = func;
-      scm_gc_protect_object(post_keep_alive_func);
-    }  
-}
-
-void clanlib_call_post_keep_alive_func()
-{
-  if (post_keep_alive_func != SCM_BOOL_F)
-    {
-      gh_call0(post_keep_alive_func);
-    }
-}
-
-/* EOF */

Copied: trunk/src/scripting/comm_commands.cpp (from rev 341, trunk/src/scripting/comm_commands.cxx)


Property changes on: trunk/src/scripting/comm_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/comm_commands.cxx
===================================================================
--- trunk/src/scripting/comm_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/comm_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,41 +0,0 @@
-//  $Id: comm_commands.cxx,v 1.3 2003/06/05 21:17:11 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &quot;../message_buffer.hxx&quot;
-#include &quot;../communication_dialog.hxx&quot;
-#include &quot;comm_commands.hxx&quot;
-
-void
-comm_send_message(int color, const char* str) 
-{
-  std::stringstream s;
-  s &lt;&lt; color &lt;&lt; &quot;: '&quot; &lt;&lt; str &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-  std::cout &lt;&lt; &quot;### &quot; &lt;&lt; str &lt;&lt; std::endl;
-  MessageBuffer::current()-&gt;add(s.str());
-}
-
-void
-comm_unit_message(int unit, const char* str)
-{
-  CommunicationDialog::current()-&gt;send(unit, str);
-}
-
-/* EOF */

Copied: trunk/src/scripting/debug_commands.cpp (from rev 341, trunk/src/scripting/debug_commands.cxx)


Property changes on: trunk/src/scripting/debug_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/debug_commands.cxx
===================================================================
--- trunk/src/scripting/debug_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/debug_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,66 +0,0 @@
-//  $Id: debug_commands.cxx,v 1.1 2003/06/18 13:04:21 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;string.h&gt;
-#include &lt;stdexcept&gt;
-#include &lt;iostream&gt;
-#include &quot;../globals.hxx&quot;
-#include &quot;debug_commands.hxx&quot;
-
-static
-bool&amp; debug_lookup_flag(const char* name)
-{
-  if (strcmp(name, &quot;colmap&quot;) == 0)
-    {
-      return draw_colmap;
-    }
-  else
-    {
-      throw std::domain_error(&quot;Debug: Unknown flag &quot; + std::string(name));
-    }
-}
-
-void
-debug_set_flag(const char* name, bool value)
-{
-  try 
-    {
-      debug_lookup_flag(name) = value;
-    } 
-  catch (std::domain_error&amp; err) 
-    {
-      std::cout &lt;&lt; err.what() &lt;&lt; std::endl;
-    }
-}
-
-bool
-debug_get_flag(const char* name)
-{
-  try 
-    {
-      return debug_lookup_flag(name);
-    } 
-  catch (std::domain_error&amp; err) 
-    {
-      std::cout &lt;&lt; err.what() &lt;&lt; std::endl;
-      return false;
-    }
-}
-
-/* EOF */

Copied: trunk/src/scripting/display_commands.cpp (from rev 341, trunk/src/scripting/display_commands.cxx)


Property changes on: trunk/src/scripting/display_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/display_commands.cxx
===================================================================
--- trunk/src/scripting/display_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/display_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,53 +0,0 @@
-//  $Id: display_commands.cxx,v 1.3 2003/06/08 15:31:27 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../display_manager.hxx&quot;
-#include &quot;display_commands.hxx&quot;
-
-bool
-display_levelmap_visible()
-{
-  return DisplayManager::current()-&gt;get_levelmap();
-}
-
-void
-display_show_levelmap()
-{
-  DisplayManager::current()-&gt;show_levelmap(); 
-}
-
-void
-display_hide_levelmap()
-{
-  DisplayManager::current()-&gt;hide_levelmap();
-}
-
-void
-display_show_help()
-{
-  DisplayManager::current()-&gt;show_help();
-}
-
-void
-display_hide_help()
-{
-  DisplayManager::current()-&gt;hide_help();
-}
-
-/* EOF */

Copied: trunk/src/scripting/effect_commands.cpp (from rev 341, trunk/src/scripting/effect_commands.cxx)


Property changes on: trunk/src/scripting/effect_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/effect_commands.cxx
===================================================================
--- trunk/src/scripting/effect_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/effect_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,30 +0,0 @@
-//  $Id: effect_commands.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../explosion.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;effect_commands.hxx&quot;
-
-void effect_add_explosion(int x, int y)
-{
-  GameObjManager::current()-&gt;add_object(new Explosion(FloatVector2d(x,y), 
-                                                      Explosion::MEDIUM));
-}
-
-/* EOF */

Copied: trunk/src/scripting/game_commands.cpp (from rev 341, trunk/src/scripting/game_commands.cxx)


Property changes on: trunk/src/scripting/game_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/game_commands.cxx
===================================================================
--- trunk/src/scripting/game_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/game_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,48 +0,0 @@
-//  $Id: game_commands.cxx,v 1.1 2003/06/10 00:38:50 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../game_session_manager.hxx&quot;
-#include &quot;game_commands.hxx&quot;
-
-void
-game_pause()
-{
-  GameSessionManager::instance()-&gt;pause();
-}
-
-void
-game_quit()
-{
-  GameSessionManager::instance()-&gt;quit();
-}
-
-void
-game_load(const char* filename)
-{
-  GameSessionManager::instance()-&gt;load(filename);
-}
-
-void
-game_save(const char* filename)
-{
-  GameSessionManager::instance()-&gt;save(filename);
-}
-
-/* EOF */

Copied: trunk/src/scripting/gameobj_commands.cpp (from rev 341, trunk/src/scripting/gameobj_commands.cxx)


Property changes on: trunk/src/scripting/gameobj_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/gameobj_commands.cxx
===================================================================
--- trunk/src/scripting/gameobj_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/gameobj_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,164 +0,0 @@
-//  $Id: gameobj_commands.cxx,v 1.9 2003/06/22 21:51:21 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../guile.hxx&quot;
-#include &quot;../property_set.hxx&quot;
-#include &quot;../property.hxx&quot;
-
-#include &quot;../satchel_charge.hxx&quot;
-#include &quot;../soldier.hxx&quot;
-#include &quot;../vehicles/vehicle.hxx&quot;
-#include &quot;../vehicles/helicopter.hxx&quot;
-#include &quot;../unit.hxx&quot;
-
-#include &quot;../game_obj.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;../game_obj_factory.hxx&quot;
-#include &quot;gameobj_commands.hxx&quot;
-
-SCM
-gameobj_get_property(int handle, const char* name)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      PropertySet* properties = obj-&gt;get_properties();
-      if (properties)
-        {
-          Property* prop = properties-&gt;lookup(name);
-          if (prop)
-            return Guile::property2scm(*prop);
-        }
-    }
-    
-  return SCM_UNSPECIFIED;
-}
-
-void
-gameobj_set_property(int handle, const char* name, SCM value)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      PropertySet* properties = obj-&gt;get_properties();
-      if (properties)
-        {
-          Guile::scm2property(*properties, name, value);
-        }      
-    }
-}
-
-SCM
-gameobj_properties(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  
-  if (obj)
-    {
-      SCM lst = SCM_EOL;
-      PropertySet* properties = obj-&gt;get_properties();
-
-      if (properties)
-        {
-          for (PropertySet::iterator i = properties-&gt;begin();
-               i != properties-&gt;end();
-               ++i)
-            {
-              lst = gh_cons(gh_str02scm(i-&gt;second-&gt;get_name().c_str()), lst);
-            }
-        }
-      return gh_reverse(lst);
-    }
-  return SCM_BOOL_F;
-}
-
-int
-gameobj_create(int type_id, SCM lst)
-{
-  GameObj* obj = GameObjFactory::instance()-&gt;create(type_id, Guile::scm2alist(lst));
-  if (obj)
-    return GameObjManager::current()-&gt;add_object(obj);
-  else
-    return 0;
-}
-
-void
-gameobj_remove(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    obj-&gt;remove();
-}
-
-bool
-gameobj_is_vehicle(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  return (obj &amp;&amp; dynamic_cast&lt;Vehicle*&gt;(obj));
-}
-
-bool
-gameobj_is_unit(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  return (obj &amp;&amp; dynamic_cast&lt;Unit*&gt;(obj));
-}
-
-bool
-gameobj_is_soldier(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  return (obj &amp;&amp; dynamic_cast&lt;Soldier*&gt;(obj));
-}
-
-bool
-gameobj_is_helicopter(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  return (obj &amp;&amp; dynamic_cast&lt;Helicopter*&gt;(obj));
-}
-
-void
-satchel_detonate(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      SatchelCharge* satchel = dynamic_cast&lt;SatchelCharge*&gt;(obj);
-      if (satchel)
-        satchel-&gt;detonate();
-    }
-}
-
-SCM
-gameobj_get_all()
-{
-  SCM lst = SCM_EOL;
-
-  for (GameObjManager::iterator i = GameObjManager::current()-&gt;begin();
-       i != GameObjManager::current()-&gt;end();
-       ++i)
-    {
-      lst = gh_cons(scm_long2num((*i)-&gt;get_id()), lst);
-    }
-
-  return scm_reverse(lst);
-}
-
-/* EOF */

Copied: trunk/src/scripting/input_commands.cpp (from rev 341, trunk/src/scripting/input_commands.cxx)


Property changes on: trunk/src/scripting/input_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/input_commands.cxx
===================================================================
--- trunk/src/scripting/input_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/input_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,60 +0,0 @@
-//  $Id: input_commands.cxx,v 1.5 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/mouse.h&gt;
-#include &quot;../scm_functor.hxx&quot;
-#include &quot;../keys.hxx&quot;
-#include &quot;../view.hxx&quot;
-#include &quot;../keyboard_manager.hxx&quot;
-#include &quot;../input/input_manager.hxx&quot;
-#include &quot;input_commands.hxx&quot;
-
-void
-input_register_callback(const char* key, SCM func)
-{
-  KeyboardManager::instance()-&gt;register_down_callback(string2keyid(key), SCMFunctor(func));
-}
-
-int
-input_get_mouse_x()
-{
-  return CL_Mouse::get_x();
-}
-
-int
-input_get_mouse_y()
-{
-  return CL_Mouse::get_y();
-}
-
-float
-input_get_mouse_world_x()
-{
-  return View::current()-&gt;screen_to_world(FloatVector2d(CL_Mouse::get_x(),
-                                                        CL_Mouse::get_y())).x;  
-}
-
-float
-input_get_mouse_world_y()
-{
-  return View::current()-&gt;screen_to_world(FloatVector2d(CL_Mouse::get_x(),
-                                                        CL_Mouse::get_y())).y;
-}
-
-/* EOF */

Copied: trunk/src/scripting/menu_commands.cpp (from rev 341, trunk/src/scripting/menu_commands.cxx)


Property changes on: trunk/src/scripting/menu_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/menu_commands.cxx
===================================================================
--- trunk/src/scripting/menu_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/menu_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,94 +0,0 @@
-//  $Id: menu_commands.cxx,v 1.7 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../scm_functor.hxx&quot;
-#include &quot;../menu_handle_mgr.hxx&quot;
-#include &quot;../display_manager.hxx&quot;
-#include &quot;menu_commands.hxx&quot;
-
-void
-menu_show(int menu_id)
-{
-  Menu* menu = menu_handle_mgr.lookup_by_handle(menu_id);
-  if (menu)
-    DisplayManager::current()-&gt;push_menu(menu);
-  else
-    std::cout &lt;&lt; &quot;Incorrect menu handle: &quot; &lt;&lt; menu_id &lt;&lt; std::endl;
-}
-
-void
-menu_hide()
-{
-  DisplayManager::current()-&gt;hide_menu();
-}
-
-int
-menu_create()
-{
-  Menu* menu = menu_handle_mgr.create();
-  return menu_handle_mgr.lookup_by_object(menu);
-}
-
-int
-menu_add_item(int menu_id, const char* label, SCM func)
-{
-  Menu* menu = menu_handle_mgr.lookup_by_handle(menu_id);
-  if (menu)
-    {
-      MenuItem* menu_item = menu_item_handle_mgr.create(&quot;- &quot; + std::string(label),
-                                                        new MenuItemGenericFunctor&lt;SCMFunctor&gt;(func));
-      menu-&gt;add_item(menu_item);
-      return menu_item_handle_mgr.lookup_by_object(menu_item);
-    }
-  return -1;
-}
-
-int
-menu_add_submenu_item(int menu_id, const char* label, int sub_menu_id)
-{
-  Menu* menu     = menu_handle_mgr.lookup_by_handle(menu_id);
-  Menu* sub_menu = menu_handle_mgr.lookup_by_handle(sub_menu_id);
-
-  if (menu &amp;&amp; sub_menu)
-    {
-      MenuItem* menu_item = menu_item_handle_mgr.create(&quot;+ &quot; + std::string(label), 
-                                                        new MenuItemSubMenuFunctor(sub_menu));
-      menu-&gt;add_item(menu_item);
-      return menu_item_handle_mgr.lookup_by_object(menu_item);
-    }
-  else
-    {
-      std::cout &lt;&lt; __FUNCTION__ &lt;&lt; &quot;: Invalid menu id: &quot; &lt;&lt; menu_id &lt;&lt; &quot; &quot; &lt;&lt; sub_menu_id &lt;&lt; std::endl;
-      return 0;
-    }
-}
-
-void
-menu_remove_item(int menu_id, int item_id)
-{
-}
-
-bool
-menu_visible()
-{
-  return DisplayManager::current()-&gt;get_menu();
-}
-
-/* EOF */

Copied: trunk/src/scripting/object_commands.cpp (from rev 341, trunk/src/scripting/object_commands.cxx)


Property changes on: trunk/src/scripting/object_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/object_commands.cxx
===================================================================
--- trunk/src/scripting/object_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/object_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,29 +0,0 @@
-//  $Id: object_commands.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;object_commands.hxx&quot;
-
-void object_remove(int id)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(id);
-  GameObjManager::current()-&gt;remove_object(obj);
-}
-
-/* EOF */

Copied: trunk/src/scripting/player_commands.cpp (from rev 341, trunk/src/scripting/player_commands.cxx)


Property changes on: trunk/src/scripting/player_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/player_commands.cxx
===================================================================
--- trunk/src/scripting/player_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/player_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,75 +0,0 @@
-//  $Id: player_commands.cxx,v 1.6 2003/06/17 22:06:13 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../game_obj.hxx&quot;
-#include &quot;../unit.hxx&quot;
-#include &quot;../player.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;player_commands.hxx&quot;
-
-extern Player* player;
-
-void
-player_set_current_unit(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      Unit* unit = dynamic_cast&lt;Unit*&gt;(obj);
-      if (unit)
-        player-&gt;set_current_unit(unit);
-    }
-  else
-    {
-      std::cout &lt;&lt; __FUNCTION__ &lt;&lt; &quot;: No such object: &quot; &lt;&lt; handle &lt;&lt; std::endl;
-    }
-}
-
-int
-player_get_current_unit()
-{
-  GameObj* game_obj = player-&gt;get_current_unit();
-  return game_obj-&gt;get_id();
-}
-
-void
-player_set_soldier(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      Unit* unit = dynamic_cast&lt;Unit*&gt;(obj);
-      if (unit)
-        player-&gt;set_soldier(unit);
-    }
-  else
-    {
-      std::cout &lt;&lt; __FUNCTION__ &lt;&lt; &quot;: No such object: &quot; &lt;&lt; handle &lt;&lt; std::endl;
-    }
-}
-
-int
-player_get_soldier()
-{
-  GameObj* game_obj = player-&gt;get_soldier();
-  return game_obj-&gt;get_id();
-}
-
-/* EOF */

Copied: trunk/src/scripting/script_helper.cpp (from rev 341, trunk/src/scripting/script_helper.cxx)


Property changes on: trunk/src/scripting/script_helper.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/script_helper.cxx
===================================================================
--- trunk/src/scripting/script_helper.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/script_helper.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,24 +0,0 @@
-//  $Id: script_helper.cxx,v 1.1 2003/06/18 13:03:13 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;script_helper.hxx&quot;
-
-
-
-/* EOF */

Copied: trunk/src/scripting/sequence_commands.cpp (from rev 341, trunk/src/scripting/sequence_commands.cxx)


Property changes on: trunk/src/scripting/sequence_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/sequence_commands.cxx
===================================================================
--- trunk/src/scripting/sequence_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/sequence_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,39 +0,0 @@
-//  $Id: sequence_commands.cxx,v 1.4 2003/09/15 20:23:53 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../scm_functor.hxx&quot;
-#include &quot;../sequence_manager.hxx&quot;
-#include &quot;sequence_commands.hxx&quot;
-
-int  sequence_start()
-{
-  return SequenceManager::current()-&gt;start_sequence();
-}
-
-void sequence_end(int id)
-{
-  SequenceManager::current()-&gt;end_sequence(id);
-}
-
-void sequence_add_hook(SCM func)
-{
-  SequenceManager::current()-&gt;add_hook(new GenericSequenceHook&lt;SCMFunctor&gt;(SCMFunctor(func)));
-}
-
-/* EOF */

Copied: trunk/src/scripting/sound_commands.cpp (from rev 341, trunk/src/scripting/sound_commands.cxx)


Property changes on: trunk/src/scripting/sound_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/sound_commands.cxx
===================================================================
--- trunk/src/scripting/sound_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/sound_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,45 +0,0 @@
-//  $Id: sound_commands.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../sound/sound.hxx&quot;
-#include &quot;sound_commands.hxx&quot;
-
-void
-sound_play_music(const char* name)
-{
-}
-
-void
-sound_stop_music()
-{
-}
-
-int
-sound_play_sound(const char* name)
-{
-  PingusSound::play_sound(name);
-  return 0; // Returning a handle is currently not supported 
-}
-
-void
-sound_stop_sound(int handle)
-{
-}
-
-/* EOF */

Copied: trunk/src/scripting/trigger_commands.cpp (from rev 341, trunk/src/scripting/trigger_commands.cxx)


Property changes on: trunk/src/scripting/trigger_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/trigger_commands.cxx
===================================================================
--- trunk/src/scripting/trigger_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/trigger_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,43 +0,0 @@
-//  $Id: trigger_commands.cxx,v 1.3 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../trigger_manager.hxx&quot;
-#include &quot;../scm_functor.hxx&quot;
-#include &quot;trigger_commands.hxx&quot;
-
-// FIXME: return handles to the triggers to allow removal of them
-
-void
-trigger_add_timed(float seconds, SCM func)
-{
-  TriggerManager::current()-&gt;add_timed_trigger(seconds, SCMFunctor(func));
-}
-
-void
-trigger_add_tile(int x, int y, SCM func)
-{
-  TriggerManager::current()-&gt;add_tile_trigger(x, y, SCMFunctor(func));
-}
-
-void
-trigger_add_region(int x1, int y1, int x2, int y2, SCM func)
-{
-}
-
-/* EOF */

Copied: trunk/src/scripting/vehicle_commands.cpp (from rev 341, trunk/src/scripting/vehicle_commands.cxx)


Property changes on: trunk/src/scripting/vehicle_commands.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/scripting/vehicle_commands.cxx
===================================================================
--- trunk/src/scripting/vehicle_commands.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/scripting/vehicle_commands.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,70 +0,0 @@
-//  $Id: vehicle_commands.cxx,v 1.2 2003/06/07 18:57:43 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../vehicles/helicopter.hxx&quot;
-#include &quot;../vehicles/vehicle.hxx&quot;
-#include &quot;../game_obj_manager.hxx&quot;
-#include &quot;vehicle_commands.hxx&quot;
-
-int vehicle_find_nearest(float x, float y, float max_distance)
-{
-  Vehicle* nearest_vehicle = 0;
-  float    nearest_vehicle_distance = 0;
-  
-  for (GameObjManager::iterator i = GameObjManager::current()-&gt;begin();
-       i != GameObjManager::current()-&gt;end(); 
-       ++i)
-    {
-      Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(*i);
-      if (vehicle)
-        {
-          float distance = (vehicle-&gt;get_pos() - FloatVector2d(x, y)).get_length();
-          if (distance &lt;= max_distance)
-            {
-              if (nearest_vehicle)
-                {
-                  if (distance &lt; nearest_vehicle_distance)
-                    nearest_vehicle = vehicle;
-                }
-              else
-                {
-                  nearest_vehicle = vehicle;
-                }
-            }           
-        }
-    }
-  if (nearest_vehicle)
-    return nearest_vehicle-&gt;get_id();
-  else
-    return 0;
-}
-
-void
-helicopter_start_or_land(int handle)
-{
-  GameObj* obj = GameObjManager::current()-&gt;get_object_by_id(handle);
-  if (obj)
-    {
-      Helicopter* heli = dynamic_cast&lt;Helicopter*&gt;(obj);
-      if (heli)
-        heli-&gt;land_or_start();
-    }
-}
-
-/* EOF */

Copied: trunk/src/sequence_manager.cpp (from rev 341, trunk/src/sequence_manager.cxx)


Property changes on: trunk/src/sequence_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sequence_manager.cxx
===================================================================
--- trunk/src/sequence_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sequence_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,70 +0,0 @@
-//  $Id: sequence_manager.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;sequence_manager.hxx&quot;
-
-SequenceManager* SequenceManager::current_ = 0; 
-
-SequenceHook::SequenceHook()
-{
-  
-}
-
-void
-SequenceHook::call()
-{
-  std::cout &lt;&lt; &quot;SequenceHook: &quot; &lt;&lt; id &lt;&lt; &quot; called&quot; &lt;&lt; std::endl;
-}
-
-SequenceManager::SequenceManager()
-{
-  current_sequence_id = 0;
-}
-
-int
-SequenceManager::start_sequence()
-{
-  ++current_sequence_id;
-
-  return current_sequence_id;
-}
-
-void
-SequenceManager::end_sequence(int sequence_id)
-{
-  //std::cout &lt;&lt; &quot;Calling hook with id: &quot; &lt;&lt; current_sequence_id &lt;&lt; &quot; &quot; &lt;&lt; hooks.size() &lt;&lt; std::endl;
-  for (Hooks::iterator i = hooks.begin(); i != hooks.end(); ++i)
-    {
-      if ((*i)-&gt;get_id() == sequence_id)
-        {
-          (*i)-&gt;call();
-        }
-    }
-}
-
-void
-SequenceManager::add_hook(SequenceHook* hook)
-{
-  std::cout &lt;&lt; &quot;Adding hook with id: &quot; &lt;&lt; current_sequence_id &lt;&lt; std::endl;
-  hook-&gt;set_id(current_sequence_id);
-  hooks.push_back(hook);
-}
-
-/* EOF */

Copied: trunk/src/sexpr_world_reader.cpp (from rev 341, trunk/src/sexpr_world_reader.cxx)


Property changes on: trunk/src/sexpr_world_reader.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sexpr_world_reader.cxx
===================================================================
--- trunk/src/sexpr_world_reader.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sexpr_world_reader.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,187 +0,0 @@
-//  $Id: sexpr_world_reader.cxx,v 1.6 2003/08/20 00:15:10 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &quot;guile.hxx&quot;
-#include &quot;world_builder.hxx&quot;
-#include &quot;sexpr_world_reader.hxx&quot;
-
-SexprWorldReader::SexprWorldReader(const std::string&amp; arg_filename, 
-                                   WorldBuilder* arg_builder)
-  : builder(arg_builder)
-{
-  SCM fdes = scm_open_file (scm_makfrom0str(arg_filename.c_str()),
-                            scm_makfrom0str(&quot;r&quot;));
-  SCM lst  = scm_read (fdes);
-
-  data = lst;
-
-  scm_close(fdes);
-}
-
-SexprWorldReader::SexprWorldReader(SCM arg_data, WorldBuilder* arg_builder)
-  : builder(arg_builder),
-    data(arg_data)
-{
-}
-
-void
-SexprWorldReader::run()
-{
-  parse_file(data);
-}
-
-void
-SexprWorldReader::parse_file(SCM desc)
-{
-  if (gh_equal_p (gh_symbol2scm (&quot;feuerkraft-scenario&quot;), gh_car(desc)))
-    {
-      desc = gh_cdr(desc);
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;File is not a feuerkraft scenario&quot; &lt;&lt; std::endl;
-      assert(false);
-    }
-
-  while (gh_pair_p(desc))
-    {
-      if (gh_pair_p (gh_car (desc)))
-	{
-	  SCM symbol = gh_caar(desc);
-	  SCM data   = gh_cdar(desc);   
-          
-	  if (gh_symbol_p (symbol))
-	    {
-	      if (gh_equal_p(gh_symbol2scm(&quot;groundmap&quot;), symbol))
-		{
-		  parse_groundmap(data);
-		}
-	      else if (gh_equal_p(gh_symbol2scm(&quot;buildings&quot;), symbol)) 
-		{
-                  parse_buildings(data);
-		}
-	      else if (gh_equal_p(gh_symbol2scm(&quot;objects&quot;), symbol))
-		{
-		  parse_objects(data);
-		}
-	      else if (gh_equal_p(gh_symbol2scm(&quot;scripts&quot;), symbol))
-		{
-		  parse_scripts(data);
-		}
-	      else
-		{
-		  std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; symbol &lt;&lt; &quot; &quot; &lt;&lt; data &lt;&lt; std::endl;;
-		}
-	    }
-	  else
-	    {
-	      std::cout &lt;&lt; &quot;Error not a symbol: &quot;;// &lt;&lt; symbol &lt;&lt; &quot; &quot; &lt;&lt; data &lt;&lt; std::endl;;
-	      gh_display (symbol); gh_newline ();
-	    }
-	}
-      else
-	{
-	  std::cout &lt;&lt; &quot;Error not a pair: &quot; &lt;&lt; gh_car(desc) &lt;&lt; std::endl;;
-	}
-
-      desc = gh_cdr(desc);
-    }
-}
-
-void
-SexprWorldReader::parse_buildings(SCM data)
-{
-  while(!gh_null_p(data))
-    {
-      SCM building = gh_car(data);
-      
-      if (gh_symbol_p(gh_car(building)))
-        {
-          builder-&gt;add_building(Guile::symbol2string(gh_car(building)),
-                                Guile::scm2alist(gh_cdr(building)));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;SexprWorldReader: Not a building&quot; &lt;&lt; std::endl;
-          gh_display(building);
-          gh_newline();
-        }
-
-      data = gh_cdr(data);
-    }  
-}
-
-void
-SexprWorldReader::parse_objects(SCM data)
-{
-  while(!gh_null_p(data))
-    {
-      SCM object = gh_car(data);
-      
-      if (gh_symbol_p(gh_car(object)))
-        {
-          builder-&gt;add_object(Guile::symbol2string(gh_car(object)),
-                              Guile::scm2alist(gh_cdr(object)));
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;SexprWorldReader: Not a script file:&quot; &lt;&lt; std::endl;
-          gh_display(object);
-          gh_newline();
-        }
-     
-      data = gh_cdr(data);
-    }
-}
-
-void
-SexprWorldReader::parse_brushes(SCM data)
-{
-  while(!gh_null_p(data))
-    {
-      
-      data = gh_cdr(data);
-    }  
-}
-
-void
-SexprWorldReader::parse_groundmap(SCM data)
-{
-  while(!gh_null_p(data))
-    {
-      
-      data = gh_cdr(data);
-    }  
-}
-
-void
-SexprWorldReader::parse_scripts(SCM data)
-{
-  while(!gh_null_p(data))
-    {
-      SCM script = gh_car(data);
-      
-      builder-&gt;add_script(Guile::scm2string(script));
-      
-      data = gh_cdr(data);
-    }
-}
-
-/* EOF */

Copied: trunk/src/shockwave.cpp (from rev 341, trunk/src/shockwave.cxx)


Property changes on: trunk/src/shockwave.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/shockwave.cxx
===================================================================
--- trunk/src/shockwave.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/shockwave.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,57 +0,0 @@
-//  $Id: shockwave.cxx,v 1.7 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;view.hxx&quot;
-#include &quot;shockwave.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-Shockwave::Shockwave(FloatVector2d arg_pos) 
-  : pos (arg_pos)
-{
-  progress = 0;
-  sprite = resources-&gt;get_sprite (&quot;feuerkraft/shockwave&quot;);
-}
-
-Shockwave::~Shockwave ()
-{
-}
-
-template&lt;class T&gt; 
-T mid (T min, T some, T max)
-{
-  return std::min(std::max(min, some), max);
-}
-
-void 
-Shockwave::draw(View&amp; view)
-{
-  sprite.set_alpha(1.0f - (progress/10.0f));
-  sprite.set_scale(progress + .5, progress + .5);
-  view.get_sc().color().draw(sprite, pos.x, pos.y);
-}
-
-void 
-Shockwave::update (float delta)
-{
-  progress += delta * 10.0f;
-  if (progress &gt;= 10.0)
-    remove ();
-}
-
-/* EOF */

Copied: trunk/src/shortcut_pathfinder.cpp (from rev 341, trunk/src/shortcut_pathfinder.cxx)


Property changes on: trunk/src/shortcut_pathfinder.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/shortcut_pathfinder.cxx
===================================================================
--- trunk/src/shortcut_pathfinder.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/shortcut_pathfinder.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,191 +0,0 @@
-//  $Id: shortcut_pathfinder.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/core.h&gt;
-#include &lt;iostream&gt;
-#include &lt;unistd.h&gt;
-#include &quot;shortcut_pathfinder.hxx&quot;
-
-struct NodeCost;
-struct NodeWalkable;
-
-typedef ShortcutPathfinder&lt;Field&lt;int&gt;, NodeWalkable, NodeCost&gt; MyPathfinder;
-
-struct NodeWalkable {
-  inline bool operator()(int a) {
-    return a &gt; 0;
-  };
-};
-
-struct NodeCost {
-  Pos goal;
-
-  NodeCost(Pos&amp; goal) 
-    : goal(goal)
-  {
-  }
-
-  inline int operator()(Node&amp; node) {
-    return int(PosDistance(Pos(node.x, node.y), goal));
-  };
-};
-
-void generate_map(Field&lt;int&gt;&amp; field)
-{
-  for(int y = 0; y &lt; field.get_height(); ++y)
-    for(int x = 0; x &lt; field.get_width(); ++x)
-      {
-        field(x,y) = rand()%10;
-      }
-
-  // Map smoothing
-  for(int count = 0; count &lt; 3; ++count)
-    for(int y = 1; y &lt; field.get_height()-1; ++y)
-      for(int x = 1; x &lt; field.get_width()-1; ++x)
-        {
-          field(x,y) = (field(x-1,y) + field(x+1,y) + field(x,y-1) + field(x,y+1))/4;
-        }
-}
-
-#ifdef TESTME
-/*
-  .2msec for 256x256 grid
-*/
-int main()
-{
-  CL_SetupCore::init();
-
-  srand(time(NULL));
-  Field&lt;int&gt; field(50, 30);
-
-  unsigned int start_time = CL_System::get_time();
-  unsigned int end_time;
-
-  generate_map(field);
-
-  MyPathfinder pathfinder(&amp;field, NodeWalkable(), NodeCost(goal));
-
-  Pos start;
-  Pos end;
-
-  for(int count = 0; count &lt; 1000; ++count)
-    {
-      start.x = rand()%field.get_width();
-      start.y = rand()%field.get_height();
-  
-      end.x = rand()%field.get_width();
-      end.y = rand()%field.get_height();
-      
-      pathfinder.init(start, end);
-      //pathfinder.display();
-
-      //int i = 0;
-      //std::cout &lt;&lt; &quot;Start: &quot; &lt;&lt; start.x &lt;&lt; &quot; &quot; &lt;&lt; start.y &lt;&lt; std::endl;
-      //std::cout &lt;&lt; &quot;End:   &quot; &lt;&lt; end.x &lt;&lt; &quot; &quot; &lt;&lt; end.y &lt;&lt; std::endl;
-
-      int rounds = 0;
-      while(!pathfinder.finished())
-        {
-          //for(int i = 0; i &lt; 10 &amp;&amp; !pathfinder.finished(); ++i)
-          pathfinder.process_one_open_node();
-          ++rounds;
-          //std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-          //pathfinder.display();
-          //getchar();
-        }
-
-      std::cout &lt;&lt; &quot;c&quot; &lt;&lt; std::endl;
-      pathfinder.display();
-      std::cout &lt;&lt; &quot;Rounds: &quot; &lt;&lt; rounds &lt;&lt; std::endl;
-      getchar();
-     
-      //pathfinder.display();
-      
-      /*
-        if (pathfinder.get_state() != ShortcutPathfinder::PATH_FOUND)
-        {
-        std::cout &lt;&lt; &quot;No Path could be found&quot; &lt;&lt; std::endl;
-        }
-        else
-        {
-        std::cout &lt;&lt; &quot;Found path&quot; &lt;&lt; std::endl;
-        std::vector&lt;Pos&gt;&amp; path = pathfinder.get_path();
-        for (std::vector&lt;Pos&gt;::iterator i = path.begin(); i != path.end(); ++i)
-        {
-        std::cout &lt;&lt; &quot;[&quot; &lt;&lt; i-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; i-&gt;y &lt;&lt; &quot;] &quot;;
-        }       
-        std::cout &lt;&lt; std::endl;
-        }
-      */
-
-      //      getchar();
-      //std::cout &lt;&lt; &quot;round: &quot; &lt;&lt; ++i &lt;&lt; std::endl;
-    }
-  end_time = CL_System::get_time();
-  std::cout &lt;&lt; &quot;Msec: &quot; &lt;&lt; end_time - start_time &lt;&lt; std::endl;
-
-  CL_SetupCore::deinit();
-}
-#elif TESTME2
-int main()
-{
-  CL_SetupCore::init();
-
-  srand(time(NULL));
-  Field&lt;int&gt; field(256, 256);
-
-  generate_map(field);
-
-  MyPathfinder pathfinder(&amp;field, NodeWalkable(), NodeCost());
-
-  Pos start;
-  Pos end;
-
-  unsigned int start_time = CL_System::get_time();
-  unsigned int end_time;
-
-
-  for(int count = 0; count &lt; 1000; ++count)
-    {
-      start.x = rand()%field.get_width();
-      start.y = rand()%field.get_height();
-  
-      end.x = rand()%field.get_width();
-      end.y = rand()%field.get_height();
-
-      pathfinder.init(start, end);
-    
-      while(!pathfinder.finished())
-        {
-          pathfinder.process_one_open_node();
-        }
-      //std::cout &lt;&lt; &quot;State: &quot; &lt;&lt; rounds &lt;&lt; &quot; &quot; &lt;&lt; pathfinder.get_state() &lt;&lt; std::endl;
-    }
-  end_time = CL_System::get_time();
-  std::cout &lt;&lt; &quot;Msec: &quot; &lt;&lt; end_time - start_time &lt;&lt; std::endl;
-
-  CL_SetupCore::deinit();
-}
-#endif
-
-// Local Variables:
-// compile-command: &quot;g++-3.2 -DTESTME -g -Wall -O2 shortcut_pathfinder.cxx  -o shortcut_pathfinder -lclanCore&quot;
-// End:
-
-/* EOF */

Copied: trunk/src/soldier.cpp (from rev 341, trunk/src/soldier.cxx)


Property changes on: trunk/src/soldier.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/soldier.cxx
===================================================================
--- trunk/src/soldier.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/soldier.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,136 +0,0 @@
-//  $Id: soldier.cxx,v 1.18 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-
-#include &quot;buildings/building_map.hxx&quot;
-#include &quot;alist.hxx&quot;
-#include &quot;math.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;input/controller.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;ai_manager.hxx&quot;
-#include &quot;soldier.hxx&quot;
-
-Soldier::Soldier(const AList&amp; lst) 
-  : ai(0),
-    sur(resources-&gt;get_sprite(&quot;feuerkraft/soldier&quot;)),
-    sur_light(resources-&gt;get_sprite(&quot;feuerkraft/soldier-light&quot;))
-{
-  pos.x = lst.get_float(&quot;x-pos&quot;);
-  pos.y = lst.get_float(&quot;y-pos&quot;);
-}
-
-Soldier::~Soldier ()
-{
-  delete ai;
-}
-
-void
-Soldier::update_controlls(const Controller&amp; controller)
-{
-  acceleration = controller.get_axis_state(ACCELERATE_AXIS);
-  steering     = controller.get_axis_state(ORIENTATION_AXIS);
-}
-
-void 
-Soldier::draw (View&amp; view)
-{
-  FloatVector2d velocity;
-
-  velocity.x = steering;
-  velocity.y = acceleration;
-
-  float new_orientation = velocity.get_orientation() + Math::pi_2;
-
-  if (velocity.x == 0 &amp;&amp; velocity.y == 0)
-    {
-      new_orientation = orientation;
-      sur.set_frame(1);
-    }
-
-  sur.set_angle(Math::rad2deg(new_orientation));
-  view.get_sc().color().draw(sur, pos.x, pos.y);
-  view.get_sc().light().draw(sur_light, pos.x, pos.y);
-  orientation = new_orientation;
-}
-
-void 
-Soldier::update(float delta)
-{
-  sur.update(delta);
-
-  FloatVector2d velocity;
-
-  velocity.x = steering;
-  velocity.y = acceleration;
-
-  FloatVector2d new_pos = pos + (velocity * 100.0f * delta);
-
-  BuildingMap* building_map = GameWorld::current()-&gt;get_buildingmap();
-
-  if (building_map-&gt;get_building(new_pos) == 0)
-    {
-      pos = new_pos;
-    }
-  else
-    {
-      // Soldier is stuck in a building, allow him to walk so he
-      // can unstuck himself
-      if (building_map-&gt;get_building(pos) != 0)
-        pos = new_pos;
-      else if (building_map-&gt;get_building(FloatVector2d(pos.x, new_pos.y)) == 0)
-        pos = FloatVector2d(pos.x, new_pos.y);
-      else if (building_map-&gt;get_building(FloatVector2d(new_pos.x, pos.y)) == 0)
-        pos = FloatVector2d(new_pos.x, pos.y);
-    }
-}
-
-bool 
-Soldier::is_colliding(FloatVector2d obj_pos)
-{
-  FloatVector2d diff = obj_pos - pos;
-  if (diff.get_length() &gt; 5)
-    return false;
-  else
-    return true;
-}
-
-void
-Soldier::attach_ai()
-{
-  if (ai == 0)
-    {
-      ai = new SoldierAI(this);
-      AIManager::instance()-&gt;add(ai);
-    }
-}
-
-void
-Soldier::deattach_ai()
-{
-  if (ai)
-    {
-      AIManager::instance()-&gt;remove(ai);
-      delete ai;
-      ai = 0;
-    }
-}
-
-/* EOF */

Copied: trunk/src/soldier_ai.cpp (from rev 341, trunk/src/soldier_ai.cxx)


Property changes on: trunk/src/soldier_ai.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/soldier_ai.cxx
===================================================================
--- trunk/src/soldier_ai.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/soldier_ai.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,94 +0,0 @@
-//  $Id: soldier_ai.cxx,v 1.2 2003/06/18 14:38:28 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;math.hxx&quot;
-#include &quot;soldier.hxx&quot;
-#include &quot;soldier_ai.hxx&quot;
-
-SoldierAI::SoldierAI(Soldier* arg_soldier)
-  : soldier(arg_soldier),
-    state(GOTO_TARGET)
-{
-  target_pos = FloatVector2d(2000.0f, 2000.0f);
-}
-
-void
-SoldierAI::update(float delta)
-{
-  switch(state)
-    {
-    case RANDOM:
-      controller.set_axis_state(ACCELERATE_AXIS,  Math::frand()*2.0f - 1.0f);
-      controller.set_axis_state(ORIENTATION_AXIS, Math::frand()*2.0f - 1.0f);
-      break;
-          
-    case WAITING:
-      controller.set_axis_state(ACCELERATE_AXIS,  0);
-      controller.set_axis_state(ORIENTATION_AXIS, 0);
-      break;
-            
-    case GOTO_TARGET:
-      /*std::cout &lt;&lt; &quot;Soldier: &quot;
-                &lt;&lt; target_pos &lt;&lt; &quot; &quot;
-                &lt;&lt; soldier-&gt;get_pos() &lt;&lt; &quot; &quot;
-                &lt;&lt; (target_pos - soldier-&gt;get_pos()).get_length() &lt;&lt; std::endl;*/
-
-      if (target_pos.y &gt; soldier-&gt;get_pos().y)
-        controller.set_axis_state(ACCELERATE_AXIS,  1.0f);
-      else if (target_pos.y &lt; soldier-&gt;get_pos().y)
-        controller.set_axis_state(ACCELERATE_AXIS,   -1.0f);
-
-      if (target_pos.x &gt; soldier-&gt;get_pos().x)
-        controller.set_axis_state(ORIENTATION_AXIS,  1.0f);
-      else if (target_pos.x &lt; soldier-&gt;get_pos().x)
-        controller.set_axis_state(ORIENTATION_AXIS,  -1.0f);
-
-      if ((target_pos - soldier-&gt;get_pos()).get_length() &lt; 10.0f)
-        state = WAITING;
-
-      break;
-
-    default:
-      break;
-    }
-
-  soldier-&gt;update_controlls(controller);
-}
-
-void
-SoldierAI::goto_to(const FloatVector2d&amp; arg_target_pos)
-{
-  state = GOTO_TARGET;
-  target_pos = arg_target_pos;
-}
-
-void
-SoldierAI::stop()
-{
-  state = WAITING;
-}
-
-GameObj*
-SoldierAI::get_object()
-{
-  return soldier;
-}
-
-/* EOF */

Copied: trunk/src/sound/sound.cpp (from rev 341, trunk/src/sound/sound.cxx)


Property changes on: trunk/src/sound/sound.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sound/sound.cxx
===================================================================
--- trunk/src/sound/sound.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sound/sound.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,126 +0,0 @@
-//  $Id: sound.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Core/System/error.h&gt;
-#include &lt;iostream&gt;
-#include &lt;assert.h&gt;
-#include &quot;../path_manager.hxx&quot;
-#include &quot;../globals.hxx&quot;
-#include &quot;sound_dummy.hxx&quot;
-#include &quot;sound_real.hxx&quot;
-
-PingusSound* PingusSound::sound;
-
-using namespace Sound;
-
-void
-PingusSound::init (PingusSound* s)
-{
-  if (s == 0)
-    {
-      if (sound_enabled || music_enabled)
-        {
-          if (verbose)
-            std::cout &lt;&lt; &quot;Init Sound&quot; &lt;&lt; std::endl;
-
-          try {
-            PingusSound::init (new PingusSoundReal ());
-          } catch (CL_Error&amp; err) {
-            std::cout &lt;&lt; &quot;CL_Error: &quot; &lt;&lt; err.message &lt;&lt; std::endl;
-            std::cout &lt;&lt; &quot;Sound will be disabled&quot; &lt;&lt; std::endl;
-            PingusSound::init (new PingusSoundDummy ());
-          }
-        }
-      else
-        {
-          if (verbose)
-            std::cout &lt;&lt; &quot;Sound disabled&quot; &lt;&lt; std::endl;
-          PingusSound::init (new PingusSoundDummy ());
-        }
-    }
-  else
-    {
-      sound = s;
-    }
-}
-
-void
-PingusSound::deinit ()
-{
-  delete sound;
-  sound = 0;
-}
-
-/** Load a sound file and play it immediately.
-
-    @param filename The complete filename */
-
-void
-PingusSound::play_sound(const std::string&amp; name, float volume, float panning)
-{
-  assert (sound);
-  sound-&gt;real_play_sound(name, volume, panning);
-}
-
-void
-PingusSound::play_sound(Sound::Name name, float volume, float panning)
-{
-  // FIXME: We need to return a handle to the sound
-
-  // This should be configurable via a .xml file
-  switch (name)
-    {
-    case Sound::DIGGER:
-      play_sound (path_manager.complete (&quot;sounds/digger.wav&quot;), volume, panning);
-      break;
-    case Sound::PLOP:
-      play_sound (path_manager.complete (&quot;sounds/plop.wav&quot;), volume, panning);
-      break;
-    case Sound::GOODIDEA:
-      play_sound (path_manager.complete (&quot;sounds/goodidea.wav&quot;), volume, panning);
-      break;
-    case Sound::OHNO:
-      play_sound (path_manager.complete (&quot;sounds/ohno.wav&quot;), volume, panning);
-      break;
-    case Sound::TICK:
-      play_sound (path_manager.complete (&quot;sounds/tick.wav&quot;), volume, panning);
-      break;
-    }
-}
-
-/** Load a sound file and play it immediately.
-
-    @param name
-    @param volume   volume */
-void
-PingusSound::play_music(const std::string &amp; name, float volume)
-{
-  assert (sound);
-  sound-&gt;real_play_music(path_manager.complete (&quot;data/music/&quot; + name), volume);
-}
-
-void
-PingusSound::stop_music()
-{
-  assert(sound);
-  sound-&gt;real_stop_music();
-}
-
-/* EOF */
-

Copied: trunk/src/sound/sound_dummy.cpp (from rev 341, trunk/src/sound/sound_dummy.cxx)


Property changes on: trunk/src/sound/sound_dummy.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sound/sound_dummy.cxx
===================================================================
--- trunk/src/sound/sound_dummy.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sound/sound_dummy.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,47 +0,0 @@
-//  $Id: sound_dummy.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../globals.hxx&quot;
-#include &quot;sound_dummy.hxx&quot;
-
-namespace Sound {
-
-void
-PingusSoundDummy::real_play_sound(const std::string &amp; filename, float /*volume*/, float /*panning*/)
-{
-  std::cout &lt;&lt; &quot;PingusSoundDummy::real_play_sound: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-}
-
-
-void
-PingusSoundDummy::real_play_music(const std::string &amp; filename, float /*volume*/)
-{
-  std::cout &lt;&lt; &quot;PingusSoundDummy::real_play_music: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-}
-
-void
-PingusSoundDummy::real_stop_music()
-{
-}
-
-} // namespace Sound
-
-/* EOF */
-

Copied: trunk/src/sound/sound_real.cpp (from rev 341, trunk/src/sound/sound_real.cxx)


Property changes on: trunk/src/sound/sound_real.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sound/sound_real.cxx
===================================================================
--- trunk/src/sound/sound_real.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sound/sound_real.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,175 +0,0 @@
-//  $Id: sound_real.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-
-#include &lt;ClanLib/sound.h&gt;
-#include &lt;ClanLib/mikmod.h&gt;
-#include &lt;ClanLib/Core/System/error.h&gt;
-
-#include &lt;iostream&gt;
-#include &quot;../globals.hxx&quot;
-#include &quot;sound_res_mgr.hxx&quot;
-#include &quot;sound_real.hxx&quot;
-
-#ifdef HAVE_LIBCLANVORBIS
-#  include &lt;ClanLib/vorbis.h&gt;
-#endif
-
-#ifdef HAVE_LIBCLANMIKMOD
-#  include &lt;ClanLib/mikmod.h&gt;
-#  include &lt;ClanLib/MikMod/setupmikmod.h&gt;
-#endif
-
-namespace Sound {
-
-PingusSoundReal::PingusSoundReal ()
-  : music_sample (0), music_session(0)
-{
-  std::cout &lt;&lt; &quot;Initializing ClanLib-Sound&quot; &lt;&lt; std::endl;
-
-  CL_SetupSound::init();
-
-  std::cout &lt;&lt; &quot;Initializing ClanLib-MikMod&quot; &lt;&lt; std::endl;
-
-#ifdef HAVE_LIBCLANVORBIS
-  CL_SetupVorbis::init();
-#endif
-
-#ifdef HAVE_LIBCLANMIKMOD
-  CL_SetupMikMod::init();
-#endif
-
-  output = new CL_SoundOutput(44100);
-}
-
-PingusSoundReal::~PingusSoundReal()
-{
-  real_stop_music();
-
-  delete output;
-
-#ifdef HAVE_LIBCLANMIKMOD
-  CL_SetupMikMod::deinit();
-#endif
-
-#ifdef HAVE_LIBCLANVORBIS
-  CL_SetupVorbis::init();
-#endif
-
-  CL_SetupSound::deinit();
-}
-
-struct sound_is_finished
-{
-  bool operator()(CL_SoundBuffer_Session&amp; sess) {
-    return !sess.is_playing();
-  }
-};
-
-void
-PingusSoundReal::real_play_sound(const std::string&amp; name, float volume, float panning)
-{
-  if (!sound_enabled)
-    return;
-
-  SoundHandle buffer;
-  CL_SoundBuffer_Session sess;
-
-  try {
-    buffer = SoundResMgr::load(name);
-    sess   = buffer-&gt;prepare();
-  } catch (const CL_Error &amp; e) {
-    std::cout &lt;&lt; &quot;Can't open sound '&quot; &lt;&lt; name &lt;&lt; &quot;' -- skipping\n&quot;
-              &lt;&lt; &quot;  CL_Error: &quot; &lt;&lt; e.message &lt;&lt; std::endl;
-    return;
-  }
-
-  sess.set_volume(volume);
-  sess.set_pan(panning);
-  sess.set_looping(false);
-  sess.play();
-}
-
-void
-PingusSoundReal::real_stop_music ()
-{
-  if (music_session)
-    {
-      music_session-&gt;stop();
-      delete music_session;
-      music_session = 0;
-
-      if (music_sample)
-        {
-          delete music_sample;
-          music_sample = NULL;
-        }
-    }
-}
-
-void
-PingusSoundReal::real_play_music (const std::string &amp; arg_filename, float volume)
-{
-  std::string filename;
-
-  filename = arg_filename;
-
-  if (!music_enabled)
-    return;
-
-  std::cout &lt;&lt; &quot;PingusSoundReal: Playing music: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-
-  real_stop_music();
-
-  music_sample = 0;
-
-  if (filename.substr(filename.size()-4, 4) == &quot;.ogg&quot;)
-    {
-#ifdef HAVE_LIBCLANVORBIS
-      music_sample = new CL_SoundBuffer (new CL_SoundProvider_Vorbis(filename.c_str()), true);
-#else
-      music_sample = 0;
-#endif
-    }
-  else if (filename.substr(filename.size()-4, 4) == &quot;.wav&quot;)
-    {
-      music_sample = new CL_SoundBuffer (new CL_SoundProvider_Wave(filename.c_str(), NULL), true);
-    }
-  else
-    {  // MikMod should support the rest...
-#ifdef HAVE_LIBCLANMIKMOD
-      music_sample = new CL_SoundBuffer (new CL_SoundProvider_MikMod(filename.c_str()), true);
-#else
-      music_sample = 0;
-#endif
-    }
-
-  if (music_sample)
-    {
-      music_session = new CL_SoundBuffer_Session(music_sample-&gt;prepare());
-      music_session-&gt;set_volume(volume * 0.5f); // FIXME: music_volume
-      music_session-&gt;set_looping(false);
-      music_session-&gt;play();
-    }
-}
-
-} // namespace Sound
-
-/* EOF */
-

Copied: trunk/src/sound/sound_res_mgr.cpp (from rev 341, trunk/src/sound/sound_res_mgr.cxx)


Property changes on: trunk/src/sound/sound_res_mgr.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/sound/sound_res_mgr.cxx
===================================================================
--- trunk/src/sound/sound_res_mgr.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/sound/sound_res_mgr.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,51 +0,0 @@
-//  $Id: sound_res_mgr.cxx,v 1.3 2003/06/07 16:16:08 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/sound.h&gt;
-#include &lt;iostream&gt;
-#include &quot;../path_manager.hxx&quot;
-#include &quot;../globals.hxx&quot;
-
-#include &quot;sound_res_mgr.hxx&quot;
-
-SoundResMgr::SoundMap SoundResMgr::sound_map;
-
-SoundHandle
-SoundResMgr::load(const std::string&amp; name)
-{
-  SoundMap::iterator i = sound_map.find(name);
-
-  if (i == sound_map.end())
-    {
-      std::string filename = path_manager.complete(&quot;sounds/&quot; + name + &quot;.wav&quot;);
-      CL_SoundBuffer* buffer = new CL_SoundBuffer(new CL_SoundProvider_Wave(filename, NULL), true);
-      std::cout &lt;&lt; &quot;SoundResMgr: Loading sound from disk: &quot;
-                                 &lt;&lt; name &lt;&lt; &quot; -&gt; &quot; &lt;&lt; filename &lt;&lt; std::endl;
-
-      sound_map[name] = buffer;
-      return buffer;
-    }
-  else
-    {
-      std::cout &lt;&lt; &quot;SoundResMgr: Loading sound from cache: &quot; &lt;&lt; name &lt;&lt; std::endl;
-      return i-&gt;second;
-    }
-}
-
-/* EOF */

Copied: trunk/src/start_screen.cpp (from rev 341, trunk/src/start_screen.cxx)


Property changes on: trunk/src/start_screen.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/start_screen.cxx
===================================================================
--- trunk/src/start_screen.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/start_screen.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,139 +0,0 @@
-//  $Id: start_screen.cxx,v 1.4 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Core/System/system.h&gt;
-#include &quot;start_screen.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-
-StartScreen::StartScreen (CL_DisplayWindow* arg_display)
-  : display (arg_display),
-    logo (resources-&gt;get_sprite (&quot;feuerkraft/logo&quot;)),
-    endlogo (resources-&gt;get_sprite (&quot;feuerkraft/endlogo&quot;)),
-    display_time (0),
-    logo_mode (S_STARTLOGO)
-{
-}
-
-StartScreen::~StartScreen ()
-{
-}
-
-void 
-StartScreen::draw ()
-{
-  if (logo_mode == S_STARTLOGO)
-    {
-      if (display_time &lt;= 2.0f)
-	logo.set_alpha ((display_time/2.0f));
-      else
-	logo.set_alpha (1.0f);
-  
-      //FIXME:Display2 CL_Display::clear_display ();    
-      
-      logo.draw (CL_Display::get_width ()/2,
-		 CL_Display::get_height ()/2,
-		 display-&gt;get_gc ());
-    }
-  else if (logo_mode == S_FADETOGAME)
-    {
-      if (display_time &lt;= 1.5f)
-	{
-	  logo.set_alpha (1.0f - (display_time/1.5f));
-	  logo.draw (CL_Display::get_width ()/2,
-		     CL_Display::get_height ()/2,
-		     display-&gt;get_gc ());
-	}
-      else
-	logo_mode = S_GAME;
-    }
-  else if (logo_mode == S_GAME)
-    {
-      // do nothing
-    }
-  else if (logo_mode == S_ENDLOGO)
-    {
-      if (display_time &lt;= 1.5f)
-	  endlogo.set_alpha ((display_time/1.5f));
-      else
-	  endlogo.set_alpha (1.0f);
-
-      endlogo.draw (CL_Display::get_width ()/2,
-		    CL_Display::get_height ()/2);
-    }
-  else if (logo_mode == S_FADETOBLACK)
-    {
-      endlogo.set_alpha (1.0f);
-      endlogo.draw (CL_Display::get_width ()/2,
-		    CL_Display::get_height ()/2);
-
-      CL_Display::fill_rect (CL_Rect(0, 0, CL_Display::get_width (), CL_Display::get_height ()),
-			     CL_Color(0, 0, 0, int(255.0f * display_time/2.0f)));
-      if (display_time &gt;= 2.0f)
-	logo_mode = S_QUIT;
-    }
-}
-
-void 
-StartScreen::update (float delta)
-{
-  display_time += delta;
-
-  if (logo_mode == S_STARTLOGO &amp;&amp; (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE)
-				   || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_SPACE)
-				   || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_RETURN)))
-    {
-      while (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_RETURN)
-	     || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE)
-	     || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_SPACE))
-	CL_System::keep_alive ();
-
-      logo_mode = S_FADETOGAME;
-      display_time = 0;
-    }
-  else if (logo_mode == S_GAME  &amp;&amp; (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE)))
-    {
-      while (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE))
-	CL_System::keep_alive ();
-
-      display_time = 0;
-      logo_mode = S_ENDLOGO;
-    }
-  else if (logo_mode == S_ENDLOGO &amp;&amp; (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE)
-				      || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_SPACE)
-				      || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_RETURN)))
-    {
-      while (display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_RETURN)
-	     || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_ESCAPE)
-	     || display-&gt;get_ic()-&gt;get_keyboard().get_keycode (CL_KEY_SPACE))
-	CL_System::keep_alive ();
-
-
-      logo_mode = S_FADETOBLACK;
-      display_time = 0;
-    }
-  
-}
-
-bool 
-StartScreen::done ()
-{
-  return logo_mode == S_FADETOGAME;
-}
-
-/* EOF */

Copied: trunk/src/system.cpp (from rev 341, trunk/src/system.cxx)


Property changes on: trunk/src/system.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/system.cxx
===================================================================
--- trunk/src/system.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/system.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,351 +0,0 @@
-//  $Id: system.cxx,v 1.5 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 1999 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef WIN32
-#  include &lt;dirent.h&gt;
-#  include &lt;fcntl.h&gt;
-#  include &lt;fnmatch.h&gt;
-#  include &lt;sys/stat.h&gt;
-#  include &lt;sys/types.h&gt;
-#  include &lt;unistd.h&gt;
-#  include &lt;errno.h&gt;
-#else /* !WIN32 */
-#  pragma warning( disable : 4786)
-#  include &lt;windows.h&gt;
-#  include &lt;fstream&gt;
-#  include &lt;direct.h&gt;
-#endif
-
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;cstdio&gt;
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Core/System/clanstring.h&gt;
-#include &quot;gettext.h&quot;
-
-//#include &quot;PingusError.hxx&quot; 
-#include &quot;system.hxx&quot;
-
-int System::verbose;
-std::string System::default_email;
-std::string System::default_username;
-std::string System::default_language;
-
-
-System::DirectoryEntry::DirectoryEntry(const std::string&amp; n)
-{
-  name = n;
-}
-
-System::Directory
-System::opendir(const std::string&amp; pathname, const std::string&amp; pattern)
-{
-  std::list&lt;System::DirectoryEntry&gt; dir_list;
-
-#ifndef WIN32 
-  DIR* dp;
-  dirent* de; 
-  
-  dp = ::opendir(pathname.c_str());
-
-  if (dp == 0)
-    {
-      std::cout &lt;&lt; _(&quot;System: Couldn't open: &quot;) &lt;&lt; pathname &lt;&lt; std::endl;
-    }
-  else
-    {
-      while ((de = ::readdir(dp)) != 0) 
-	{
-	  if (fnmatch(pattern.c_str(), de-&gt;d_name, FNM_PATHNAME) == 0) 
-	    {
-	      if (de-&gt;d_type == 'd')
-		{
-		  dir_list.push_back(DirectoryEntry(de-&gt;d_name));
-		}
-	      else 
-		{
-		  dir_list.push_back(DirectoryEntry(de-&gt;d_name));
-		}
-	    }
-	}
-      
-      closedir(dp);
-    }
-#else /* !WIN32 */
-  WIN32_FIND_DATA coFindData;
-  std::string FindFileDir = pathname + &quot;\\&quot; + pattern;
-  std::string FileLocation;
-  HANDLE hFind = FindFirstFile(TEXT(FindFileDir.c_str()),&amp;coFindData);
-
-  if (hFind == INVALID_HANDLE_VALUE)
-    {
-      std::cout &lt;&lt; &quot;System: Couldn't open: &quot; &lt;&lt; pathname &lt;&lt; std::endl;
-    }
-  
-  do
-    {     
-      dir_list.push_back(DirectoryEntry(coFindData.cFileName));
-    }
-  while (FindNextFile(hFind,&amp;coFindData));
-
-  FindClose(hFind);  
-#endif
-
-  return dir_list;
-}
-
-// Returns the basic filename without the path
-std::string
-System::basename(std::string filename)
-{
-  // Should be replaced with STL
-  
-  const char* str = filename.c_str();
-  int i;
-
-  for(i = filename.size() - 1; i &gt;= 0; --i) 
-    {
-      if (*(str + i) == '/') {
-	break;
-      }
-    }
-  
-  return (str+i + 1);
-}
-
-bool
-System::exist(std::string filename)
-{
-#ifndef WIN32
-  return !access(filename.c_str(), F_OK);
-#else
-  //don't know a better solution
-  std::ifstream check(filename.c_str());
-  if(!check) return false;
-  return true;
-#endif
-}
-
-void
-System::create_dir(std::string directory)
-{
-#ifndef WIN32
-  if (!exist(directory))
-    {
-      if (mkdir(directory.c_str(), S_IRUSR | S_IWUSR | S_IXUSR | S_IRGRP | S_IXGRP) != 0)
-	{
-	  throw Error(directory + &quot;: &quot; + strerror(errno));
-	}
-      else
-	{
-	  std::cout &lt;&lt; _(&quot;Successfully created: &quot;) &lt;&lt; directory &lt;&lt; std::endl;
-	}
-    }  
-  else
-    {
-      if (verbose) std::cout &lt;&lt; _(&quot;Found: &quot;) &lt;&lt; directory &lt;&lt; std::endl;
-    }
-#else
-  CreateDirectory(directory.c_str(), 0);
-#endif
-}
-
-/** Change into the directory named dir, on error throw an PingusError */
-void
-System::change_dir (std::string dir)
-{
-#ifdef WIN32
-  _chdir (dir.c_str ());
-#else
-  chdir (dir.c_str ());
-#endif
-}
-
-void
-System::init_directories()
-{
-  std::string statdir  = get_statdir();
-  std::string vardir   = get_vardir();
-  
-  create_dir(statdir);
-  create_dir(statdir + &quot;levels/&quot;);
-  create_dir(statdir + &quot;levels/dist&quot;);
-  create_dir(statdir + &quot;stat/&quot;);
-  create_dir(statdir + &quot;cache/&quot;);
-  create_dir(statdir + &quot;demos/&quot;);
-  create_dir(statdir + &quot;screenshots/&quot;);
-  create_dir(statdir + &quot;themes/&quot;);
-
-  // create_dir(vardir);
-}
- 
-std::string
-System::get_statdir()
-{
-#ifdef WIN32
-  return &quot;stat\\&quot;;
-#else /* !WIN32 */
-  char* homedir = getenv(&quot;HOME&quot;);
-
-  if (homedir) 
-    {
-      return std::string(homedir) + &quot;/.feuerkraft/&quot;;
-    }
-  else
-    {
-      throw Error(_(&quot;Enviroment variable $HOME not set, fix that and start again.&quot;));
-    }
-#endif
-}
-
-std::string 
-System::get_cachedir()
-{
-  return get_statdir() + &quot;cache/&quot;;
-}
-
-std::string
-System::get_vardir()
-{
-#ifdef WIN32   
-  return &quot;var\\&quot;;
-#else
-  return &quot;/var/games/pingus/&quot;;
-#endif
-}
-
-std::string
-System::get_tmpdir()
-{
-#ifdef WIN32   
-  // FIXME: Warrning this hardcoded values are mostlikly wrong!
-  return &quot;c:\\windows\\temp\\&quot;;
-#else
-  return &quot;/tmp/&quot;;
-#endif
-}
-
-/** Returns the Username how the current user or an empty string */
-std::string
-System::get_username()
-{
-  if (default_username.empty())
-    {
-      char* username = getenv(&quot;USERNAME&quot;);
-
-      if (username)
-	return std::string(username);
-      else
-	return &quot;&quot;;
-    }
-  else
-    {
-      return default_username;
-    }
-}
-
-/** Returns the EMail of the user or an empty string */
-std::string 
-System::get_email()
-{
-  if (default_email.empty())
-    {
-      char* email = getenv(&quot;EMAIL&quot;);
-
-      if (email)
-	// FIXME: $EMAIL contains the complete from header, not only
-	// the email address
-	return std::string(email);
-      else
-	return &quot;&quot;;
-    }
-  else
-    {
-      return default_email;
-    }
-}
-
-std::string
-System::get_language()
-{
-  char* lang = getenv(&quot;LANG&quot;);
-
-  if (lang &amp;&amp; strcmp(lang, &quot;C&quot;) != 0)
-    {
-      if (strcmp(lang, &quot;de_DE&quot;) == 0)
-	return &quot;de&quot;;
-      else
-	return lang; 
-    }
-  else
-    return default_language;
-}
-
-std::string
-System::translate(std::map&lt;std::string, std::string&gt; strs)
-{
-  std::string str = strs[System::get_language()];
-  
-  if (str.empty())
-    {
-      return strs[default_language];
-    }
-  else 
-    {
-      return str;
-    }
-}
-
-/** Read file and create a checksum and return it */
-std::string
-System::checksum (std::string filename)
-{
-  FILE* in;
-  int bytes_read;
-  char buffer[4096];
-  int checksum = 0;
-
-  in = fopen(filename.c_str(), &quot;r&quot;);
-
-  if (!in)
-    {
-      std::cout &lt;&lt; _(&quot;System::checksum: Couldn't open file: &quot;) &lt;&lt; filename &lt;&lt; std::endl;
-      return &quot;&quot;;
-    }
-
-  do 
-    {
-      bytes_read = fread (buffer, sizeof (char), 4096, in);
-      
-      if (bytes_read == -1)
-	{
-	  throw Error (_(&quot;System:checksum: file read error&quot;));
-	}
-
-      for (int i=0; i &lt; bytes_read; i++)
-	checksum = checksum * 17 + buffer[i];
-    } 
-  while (bytes_read != 0);
-
-  fclose (in);
-
-  return CL_String::to(checksum);
-}
-
-/* EOF */

Copied: trunk/src/tree.cpp (from rev 341, trunk/src/tree.cxx)


Property changes on: trunk/src/tree.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/tree.cxx
===================================================================
--- trunk/src/tree.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/tree.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,74 +0,0 @@
-//  $Id: tree.cxx,v 1.12 2003/06/20 20:54:23 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;assert.hxx&quot;
-#include &quot;view.hxx&quot;
-#include &quot;property_set.hxx&quot;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;alist.hxx&quot;
-#include &quot;tree.hxx&quot;
-
-Tree::Tree (const AList&amp; lst)
-{
-  // Get the init values
-  AList def;
-
-  def.set_float(&quot;x-pos&quot;, 0.0f);
-  def.set_float(&quot;y-pos&quot;, 0.0f);
-  def.set_float(&quot;z-pos&quot;, 10.0f);
-  def.set_string(&quot;sprite&quot;, &quot;feuerkraft/tree&quot;);
-  
-  def.merge(lst);
-
-  // Load stuff
-  sprite_name = def.get_string(&quot;sprite&quot;);
-  sur = resources-&gt;get_sprite(sprite_name);
-  AssertMsg(!sur.is_null(), &quot;Tree: surface not loaded correctly: '&quot; &lt;&lt; sprite_name &lt;&lt; &quot;'&quot;);
-    
-  pos.x = def.get_float(&quot;x-pos&quot;);
-  pos.y = def.get_float(&quot;y-pos&quot;);
-  z_pos = def.get_float(&quot;z-pos&quot;);
-
-  // Register Variables
-  properties-&gt;register_string(&quot;sprite&quot;, &amp;sprite_name);
-  properties-&gt;register_float (&quot;x-pos&quot;, &amp;pos.x);
-  properties-&gt;register_float (&quot;y-pos&quot;, &amp;pos.y);
-  properties-&gt;register_float (&quot;z-pos&quot;, &amp;z_pos);
-}
-
-Tree::~Tree ()
-{
-}
-
-void
-Tree::properties_updated()
-{
-  std::cout &lt;&lt; &quot;Loading Tree Sprites&quot; &lt;&lt; std::endl;
-  sur = resources-&gt;get_sprite(sprite_name);
-  sur.set_alignment(origin_center);
-}
-  
-void 
-Tree::draw (View&amp; view)
-{
-  view.get_sc().color().draw(sur, pos.x, pos.y);
-}
-
-/* EOF */

Copied: trunk/src/trigger_manager.cpp (from rev 341, trunk/src/trigger_manager.cxx)


Property changes on: trunk/src/trigger_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/trigger_manager.cxx
===================================================================
--- trunk/src/trigger_manager.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/trigger_manager.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,52 +0,0 @@
-//  $Id: trigger_manager.cxx,v 1.2 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;algorithm&gt;
-#include &quot;trigger_manager.hxx&quot;
-
-TriggerManager* TriggerManager::current_ = 0;
-
-TriggerManager::TriggerManager()
-{
-  current_ = this;
-}
-
-struct TriggerIsRemovable
-{
-  bool operator()(TriggerManager::Trigger* trigger) {
-    return trigger-&gt;removable;
-  }
-};
-
-void
-TriggerManager::update(float delta)
-{
-  // Keep iterators intact
-  Triggers tmp_triggers = triggers;
-  for (Triggers::iterator i = tmp_triggers.begin(); i != tmp_triggers.end(); ++i)
-    {
-      (*i)-&gt;update(delta);
-    }
-
-  triggers.erase(std::remove_if(triggers.begin(), triggers.end (), TriggerIsRemovable()),
-                 triggers.end ());
-}
-
-/* EOF */

Copied: trunk/src/unit.cpp (from rev 341, trunk/src/unit.cxx)


Property changes on: trunk/src/unit.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/unit.cxx
===================================================================
--- trunk/src/unit.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/unit.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,60 +0,0 @@
-//  $Id: unit.cxx,v 1.5 2003/08/20 00:02:46 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;property_set.hxx&quot;
-#include &quot;player.hxx&quot;
-#include &quot;radar.hxx&quot;
-#include &quot;unit.hxx&quot;
-
-extern Player* player;
-
-Unit::Unit()
-{
-  pos = FloatVector2d(0,0);
-  orientation = 0;
-
-  properties-&gt;register_float(&quot;x-pos&quot;, &amp;pos.x);
-  properties-&gt;register_float(&quot;y-pos&quot;, &amp;pos.y);
-  properties-&gt;register_float(&quot;orientation&quot;, &amp;orientation);
-}
-
-Unit::~Unit()
-{
-}
-
-void
-Unit::draw_radar(Radar&amp; radar)
-{
-  if (player-&gt;get_current_unit() != this)
-    radar.draw_blip(pos, 2, 1.0f, 0, 0);
-}
-
-void
-Unit::set_position(const FloatVector2d&amp; new_pos)
-{
-  pos = new_pos;
-}
-
-void
-Unit::set_orientation(float new_orientation)
-{
-  orientation = new_orientation;
-}
-
-/* EOF */

Copied: trunk/src/vector2d.cpp (from rev 341, trunk/src/vector2d.cxx)


Property changes on: trunk/src/vector2d.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vector2d.cxx
===================================================================
--- trunk/src/vector2d.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vector2d.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,132 +0,0 @@
-//  $Id: vector2d.cxx,v 1.6 2003/06/09 20:27:31 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &lt;iostream&gt;
-#include &quot;vector2d.hxx&quot;
-
-FloatVector2d::FloatVector2d()
-  : x(0.0f), y(0.0f)
-{
-}
-
-FloatVector2d::FloatVector2d(float arg_x, float arg_y)
-  : x(arg_x), y(arg_y)
-{
-}
-
-FloatVector2d
-FloatVector2d::make_polar(float length, float orientation)
-{
-  return FloatVector2d(cos(orientation) * length,
-                       sin(orientation) * length);
-}
-
-void
-FloatVector2d::set_orientation(float angle)
-{
-  x = sin(angle) * get_length();
-  y = cos(angle) * get_length();
-}
-
-FloatVector2d&amp;
-FloatVector2d::rotate(float angle)
-{
-  float length = get_length();
-  float orientation = get_orientation();
-
-  x = cos(orientation + angle) * length;
-  y = sin(orientation + angle) * length;
-  return *this;
-}
-
-float
-FloatVector2d::get_length() const
-{
-  return sqrt(x*x + y*y);
-}
-
-float
-FloatVector2d::get_manhatten_length() const
-{
-  return fabsf(x) + fabsf(y);
-}
-
-float
-FloatVector2d::get_orientation() const
-{
-  return atan2(y, x);
-}
-
-FloatVector2d
-FloatVector2d::operator- () const
-{
-  return FloatVector2d(-x, -y);
-}
-
-FloatVector2d
-FloatVector2d::operator+ (const FloatVector2d&amp; add) const
-{
-  return FloatVector2d(x + add.x, 
-                       y + add.y);
-}
-
-FloatVector2d
-FloatVector2d::operator- (const FloatVector2d&amp; sub) const
-{
-  return FloatVector2d(x - sub.x,
-                       y - sub.y);
-}
-
-FloatVector2d
-FloatVector2d::operator* (float  mul) const
-{
-  return FloatVector2d(x * mul, y * mul);
-}
-
-FloatVector2d&amp;
-FloatVector2d::operator+= (const FloatVector2d&amp; add)
-{
-  x += add.x;
-  y += add.y;
-  return *this;
-}
-
-FloatVector2d&amp;
-FloatVector2d::operator-= (const FloatVector2d&amp; sub)
-{
-  x -= sub.x;
-  y -= sub.y;
-  return *this;
-}
-
-FloatVector2d&amp;
-FloatVector2d::operator*= (float   mul)
-{
-  x *= mul;
-  y *= mul;
-  return *this;
-}
-
-std::ostream&amp; operator&lt;&lt; (std::ostream&amp; os, const FloatVector2d&amp; v)
-{
-  return os &lt;&lt; &quot;(&quot; &lt;&lt; v.x &lt;&lt; &quot;, &quot; &lt;&lt; v.y &lt;&lt; &quot;)&quot;;
-}
-
-/* EOF */

Copied: trunk/src/vehicle_ai.cpp (from rev 341, trunk/src/vehicle_ai.cxx)


Property changes on: trunk/src/vehicle_ai.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicle_ai.cxx
===================================================================
--- trunk/src/vehicle_ai.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicle_ai.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,106 +0,0 @@
-//  $Id: vehicle_ai.cxx,v 1.2 2003/06/22 17:22:47 grumbel Exp $
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;math.hxx&quot;
-#include &quot;vehicles/vehicle.hxx&quot;
-#include &quot;vehicle_ai.hxx&quot;
-
-VehicleAI::VehicleAI(Vehicle* arg_vehicle)
-  : vehicle(arg_vehicle)
-{
-}
-
-VehicleRoboAI::VehicleRoboAI(Vehicle* vehicle)
-  : VehicleAI(vehicle)
-{
-  ai_count = 0;
-}
-
-void
-VehicleRoboAI::update(float delta)
-{
-  ai_count += delta;
-  
-  if (ai_count &gt; 2)
-    {
-      ai_count = 0;
-      
-      switch (rand() % 5)
-        {
-        case 0:
-        case 1:
-        case 2:
-          controller.set_axis_state(ACCELERATE_AXIS, 1.0f);
-          break;
-        case 3:
-          controller.set_axis_state(ACCELERATE_AXIS, -1.0f);
-          break;
-        case 4:
-          controller.set_axis_state(ACCELERATE_AXIS, 0.0f);
-          break;
-        }
-
-      controller.set_axis_state(ORIENTATION_AXIS, Math::frand() * 2.0f - 1.0f);
-    }
-  
-  if (rand() % 30 == 0)
-    {
-      controller.set_button_state(PRIMARY_FIRE_BUTTON, true);
-    }
-  else
-    {
-      controller.set_button_state(PRIMARY_FIRE_BUTTON, false);
-    }
-  
-  vehicle-&gt;update_controlls(controller);
-}
-
-VehiclePathAI::VehiclePathAI(Vehicle* vehicle)
-  : VehicleAI(vehicle),
-    driving(false),
-    length(0.0f),
-    line_segments(vehicle-&gt;get_pos().x, 
-                  vehicle-&gt;get_pos().y,
-                  vehicle-&gt;get_orientation())
-{
-}
-
-void
-VehiclePathAI::update(float delta)
-{
-  if (driving)
-    {
-      length += 100.0f * delta;
-
-      vehicle-&gt;set_position(line_segments.get_pos(length));
-      vehicle-&gt;set_orientation(line_segments.get_orientation(length));
-
-      if (line_segments.get_length() &lt; length)
-        driving = false;
-    }
-}
-
-void
-VehiclePathAI::drive_to(const FloatVector2d&amp; pos)
-{
-  driving = true;
-  line_segments.add_controll_point(pos.x, pos.y, 50.0f);  
-}
-
-/* EOF */

Copied: trunk/src/vehicle_status.cpp (from rev 341, trunk/src/vehicle_status.cxx)


Property changes on: trunk/src/vehicle_status.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicle_status.cxx
===================================================================
--- trunk/src/vehicle_status.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicle_status.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,72 +0,0 @@
-//  $Id: vehicle_status.cxx,v 1.9 2003/06/08 15:31:27 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &quot;resource_manager.hxx&quot;
-#include &quot;player.hxx&quot;
-#include &quot;vehicles/vehicle.hxx&quot;
-#include &quot;vehicle_status.hxx&quot;
-
-extern Player* player;
-
-VehicleStatus::VehicleStatus()
-  : ammo (resources-&gt;get_sprite(&quot;feuerkraft/ammo&quot;)),
-    fuel (resources-&gt;get_sprite(&quot;feuerkraft/fuel&quot;))
-{
-  fuel.set_alignment(origin_top_left);
-  ammo.set_alignment(origin_top_left);
-}
-
-VehicleStatus::~VehicleStatus ()
-{
-}
-
-void 
-VehicleStatus::update (float delta)
-{
-}
-
-void 
-VehicleStatus::draw (CL_GraphicContext&amp; gc)
-{
-  Vehicle* vehicle = dynamic_cast&lt;Vehicle*&gt;(player-&gt;get_current_unit());
-  if (vehicle)
-    {
-      fuel.draw ( 8, CL_Display::get_height() - 8 - 30);
-      draw_rect (38, CL_Display::get_height() - 8 - 24, vehicle-&gt;get_fuel ());
-
-      ammo.draw ( 8, CL_Display::get_height() - 40 - 30);
-      draw_rect (38, CL_Display::get_height() - 40 - 24, vehicle-&gt;get_ammo ());
-    }
-}
-
-void
-VehicleStatus::draw_rect (int x_pos, int y_pos, float fill)
-{
-  CL_Display::fill_rect (CL_Rect(x_pos, y_pos, x_pos + 100, y_pos + 14),
-			 CL_Color(0, 0, 0,200));
-  if (fill &gt; 0.0)
-    CL_Display::fill_rect (CL_Rect(x_pos + 2, y_pos + 2, int(x_pos + (98 * fill)), y_pos + 12),
-			   CL_Color(int((1.0 - fill)*255), 
-                                    int(255*fill),
-                                    0,
-                                    200));
-}
-
-/* EOF */

Copied: trunk/src/vehicle_view.cpp (from rev 341, trunk/src/vehicle_view.cxx)


Property changes on: trunk/src/vehicle_view.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicle_view.cxx
===================================================================
--- trunk/src/vehicle_view.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicle_view.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,74 +0,0 @@
-//  $Id: vehicle_view.cxx,v 1.11 2003/06/06 14:25:47 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &quot;vehicle_view.hxx&quot;
-
-VehicleViewUpdater::VehicleViewUpdater (Unit* arg_unit)
-  : unit(arg_unit)
-{
-  pos = unit-&gt;get_pos();
-  speed = 0.1f;
-  zoom_follower = 1.0f;
-}
-
-VehicleViewUpdater::~VehicleViewUpdater ()
-{
-}
-
-void 
-VehicleViewUpdater::update (float delta, ViewState&amp; state)
-{
-  delta *= 50.0f;
-  FloatVector2d target = unit-&gt;get_pos ();
-
-#if 0  // FIXME:
-  float zoom = (-fabs(unit-&gt;get_velocity ()/10.0f) + 1.0) * 1.5f;
-
-  if (zoom_follower &gt; zoom) zoom_follower -= 0.01 * delta;
-  if (zoom_follower &lt; zoom) zoom_follower += 0.01 * delta;
-
-  state.zoom = zoom_follower;
-#endif 
-
-  if ((pos - target).get_length() &gt; 1.0f)
-    {
-      FloatVector2d direction = (target - pos);
-      pos += direction * speed;
-   }
-  
-  state.x_offset = int(pos.x);
-  state.y_offset = int(pos.y);
-
-  float my_rotation = -(unit-&gt;get_orientation()/3.1415927*180.0) + 90;
-
-  if (state.rotation &gt; my_rotation) 
-    state.rotation -= 2 * delta;
-  
-  if (state.rotation &lt; my_rotation) 
-    state.rotation += 2 * delta;
-}
-
-void
-VehicleViewUpdater::set_unit(Unit* arg_unit)
-{
-  unit = arg_unit;
-}
-
-/* EOF */

Copied: trunk/src/vehicles/helicopter.cpp (from rev 341, trunk/src/vehicles/helicopter.cxx)


Property changes on: trunk/src/vehicles/helicopter.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/helicopter.cxx
===================================================================
--- trunk/src/vehicles/helicopter.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/helicopter.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,256 +0,0 @@
-//  $Id: helicopter.cxx,v 1.11 2003/06/22 17:22:47 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../alist.hxx&quot;
-#include &quot;../projectile.hxx&quot;
-#include &quot;../explosion.hxx&quot;
-#include &quot;../vehicle_ai.hxx&quot;
-#include &quot;../ai_manager.hxx&quot;
-#include &quot;../rocket.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;helicopter.hxx&quot;
-
-Helicopter::Helicopter(const AList&amp; lst)
-  : strafe (0.0),
-    reloading (0),
-    secondary_reload(0),
-    energie (100),
-    destroyed (false),
-    ai(0)
-{
-  if (lst.get_int(&quot;type&quot;) == 0)
-    {
-      heli          = resources-&gt;get_sprite(&quot;feuerkraft/huey&quot;);
-      heli_shadow   = resources-&gt;get_sprite(&quot;feuerkraft/huey_shadow&quot;);
-      helidestroyed = resources-&gt;get_sprite(&quot;feuerkraft/helidestroyed&quot;);
-      
-      RotorDescription rotor;
-      rotor.direction = RotorDescription::LEFT;
-      rotor.slow_sprite =&quot;feuerkraft/huey_rotor&quot;;
-      rotor.fast_sprite = &quot;feuerkraft/huey_rotor2&quot;;
-      rotors.push_back(Rotor(rotor));
-    }
-  else if (lst.get_int(&quot;type&quot;) == 1)
-    {
-      heli          = resources-&gt;get_sprite(&quot;feuerkraft/helicopter&quot;);
-      heli_shadow   = resources-&gt;get_sprite(&quot;feuerkraft/helicopter_shadow&quot;);
-      helidestroyed = resources-&gt;get_sprite(&quot;feuerkraft/helidestroyed&quot;);
-      
-      RotorDescription rotor;
-      rotor.direction = RotorDescription::LEFT;
-      rotor.slow_sprite =&quot;feuerkraft/huey_rotor&quot;;
-      rotor.fast_sprite = &quot;feuerkraft/huey_rotor2&quot;;
-      rotors.push_back(Rotor(rotor));      
-    }
-  else // if (lst.get_int(&quot;type&quot;) == 2)
-    {
-      heli          = resources-&gt;get_sprite(&quot;feuerkraft/chinook&quot;);
-      heli_shadow   = resources-&gt;get_sprite(&quot;feuerkraft/chinook_shadow&quot;);
-      helidestroyed = resources-&gt;get_sprite(&quot;feuerkraft/helidestroyed&quot;);
-        
-      RotorDescription rotor1;
-      rotor1.offset = FloatVector2d(40.0f, 0);
-      rotor1.slow_sprite = &quot;feuerkraft/chinook_rotor&quot;;
-      rotor1.fast_sprite = &quot;feuerkraft/chinook_rotor2&quot;;
-      rotor1.direction = RotorDescription::LEFT;
-      rotors.push_back(Rotor(rotor1));
-  
-      RotorDescription rotor2;
-      rotor2.offset = FloatVector2d(-40.0f, 0);
-      rotor2.slow_sprite = &quot;feuerkraft/chinook_rotor&quot;;
-      rotor2.fast_sprite = &quot;feuerkraft/chinook_rotor2&quot;;
-      rotor2.direction = RotorDescription::RIGHT;
-      rotors.push_back(Rotor(rotor2));
-    }
-
-  pos.x = lst.get_float(&quot;x-pos&quot;);
-  pos.y = lst.get_float(&quot;y-pos&quot;);
-
-  velocity = 0;
-  orientation = 0;
-
-  height = 0;
-  state = LANDED;
-}
-
-Helicopter::~Helicopter ()
-{
-}
-
-void 
-Helicopter::draw (View&amp; view)
-{
-  if (!destroyed)
-    {
-      heli_shadow.set_angle(Math::rad2deg(orientation));
-      view.get_sc().color().draw(heli_shadow, pos.x + height/2.0f, pos.y + height);
-
-      heli.set_angle(Math::rad2deg(orientation));
-      view.get_sc().color().draw(heli, pos.x, pos.y);
-
-      for (Rotors::iterator i = rotors.begin(); i != rotors.end(); ++i)
-        {
-          (*i).draw(view, pos, orientation);
-        }
-
-      energie.draw(view, int(pos.x), int(pos.y - 40));
-    }
-  else
-    {
-      helidestroyed.set_angle(Math::rad2deg(orientation));
-      view.get_sc().color().draw(helidestroyed, pos.x, pos.y);
-    }
-}
-
-void 
-Helicopter::update (float delta)
-{
-  for (Rotors::iterator i = rotors.begin(); i != rotors.end(); ++i)
-    (*i).update(delta);
-
-  if (state == LANDING)
-    {
-      height -= 20.0f * delta;
-      if (height &lt; 0.0f)
-        {
-          height = 0;
-          state = LANDED;
-
-          for (Rotors::iterator i = rotors.begin(); i != rotors.end(); ++i)
-            (*i).stop();
-        }
-    }
-  else if (state == STARTING)
-    {
-      bool running = true;
-      for (Rotors::iterator i = rotors.begin(); i != rotors.end(); ++i)
-        if (!(*i).is_running())
-          running = false;          
-
-      if (running)
-        {
-          height += 20.0f * delta;
-          if (height &gt; 50.0f)
-            {
-              height = 50;
-              state = FLYING;
-            }
-        }
-    }
-    
-  // Apply controlls
-  if (state != LANDED &amp;&amp; height &gt; 0)
-    {
-      orientation += 3.0f  * steering * delta;
-      velocity    -= 15.0f * acceleration * delta;
-      strafe      -= 5.0f  * strafe_steering * delta;
-    }
-
-  strafe_steering = steering = acceleration = 0;
-
-  if (secondary_firing &amp;&amp; secondary_reload &gt; .1)
-    {
-      secondary_reload = 0;
-      GameWorld::current()-&gt;add (new Projectile (this, get_pos(),
-                                                 FloatVector2d::make_polar(20 + Math::frand()*2.0f,
-                                                                           orientation + 3.1415927f
-                                                                           + Math::frand()*0.06f - 0.03f)));
-    }
-  secondary_reload += delta;
- 
-  delta *= 50;
-
-  if (energie &lt;= 0 &amp;&amp; !destroyed)
-    {
-      GameWorld::current()-&gt;add(new Explosion (pos, Explosion::MEDIUM));
-      destroyed = true;
-    }
-
-  FloatVector2d vel(velocity, 0.0);
- 
-  pos += vel.rotate(orientation);
-
-  // Let the heli strafe
-  pos += FloatVector2d(0.0, strafe).rotate(orientation) * delta;
-
-  velocity /= 1.03f;
-  strafe   /= 1.03f;
-
-  if (firing &amp;&amp; !reloading)
-    {
-      GameWorld::current()-&gt;add(new Rocket(get_pos(), orientation + 3.1415927f));
-      reloading = 10;
-    }
-
-  if (reloading)
-    --reloading;
-}
-
-void
-Helicopter::land_or_start()
-{
-  if (state == FLYING || state == STARTING)
-    {
-      state = LANDING;
-    }
-  else if (state == LANDED || state == LANDING)
-    {
-      state = STARTING;
-      for (Rotors::iterator i = rotors.begin(); i != rotors.end(); ++i)
-        (*i).start();
-    }
-}
-
-bool 
-Helicopter::is_colliding (FloatVector2d obj_pos)
-{
-  float range = 20.0; 
-
-  return  (obj_pos.x &gt; pos.x - range &amp;&amp; obj_pos.x &lt; pos.x + range
-	   &amp;&amp; obj_pos.y &gt; pos.y - range &amp;&amp; obj_pos.y &lt; pos.y + range);
-}
-
-void
-Helicopter::collide (Projectile*) 
-{
-  energie -= 15;
-}
-
-void
-Helicopter::attach_ai()
-{
-  ai = new VehicleRoboAI(this);
-  AIManager::instance()-&gt;add(ai);
-}
-
-void
-Helicopter::dettach_ai()
-{
-  if (ai)
-    {
-      AIManager::instance()-&gt;remove(ai);
-      delete ai;
-      ai = 0;
-    }
-
-}
-
-/* EOF */

Copied: trunk/src/vehicles/jeep.cpp (from rev 341, trunk/src/vehicles/jeep.cxx)


Property changes on: trunk/src/vehicles/jeep.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/jeep.cxx
===================================================================
--- trunk/src/vehicles/jeep.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/jeep.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,149 +0,0 @@
-//  $Id: jeep.cxx,v 1.6 2003/06/03 14:11:22 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/gl.h&gt;
-#include &lt;iostream&gt;
-#include &quot;../buildings/building_map.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;jeep.hxx&quot;
-
-const float circle = 6.2831854f;
-
-Jeep::Jeep(FloatVector2d arg_pos) 
-  : energie (50),
-    velocity (0.0),
-    angle (0.0)
-{
-  pos.x = arg_pos.x;
-  pos.y = arg_pos.y;
-  jeep = resources-&gt;get_sprite (&quot;feuerkraft/jeep&quot;);
-}
-
-void 
-Jeep::update (float delta)
-{
-  delta *= 50;
-
-  FloatVector2d tmp_pos = pos + FloatVector2d(-velocity, 0.0).rotate(angle) * delta;
-
-  if (!(GameWorld::current()-&gt;get_buildingmap ()-&gt;get_building (FloatVector2d(pos.x, tmp_pos.y))))
-    {
-      pos.y = tmp_pos.y;
-    }
-  else
-    {
-      //velocity /= delta;
-    }
-
-  if (!(GameWorld::current()-&gt;get_buildingmap ()-&gt;get_building (FloatVector2d(tmp_pos.x, pos.y))))
-    {
-      pos.x = tmp_pos.x;
-    }
-  else
-    {
-      //velocity /= delta;
-    }
-
-
-  velocity /= 1.03f;
-}
-
-void 
-Jeep::draw (View&amp; view)
-{
-  const float circle = 6.2831854f;
-  
-  jeep.set_angle(angle/(circle/2.0)*180);
-  view.get_sc().color().draw(jeep, pos.x, pos.y);
-  energie.draw (view, int(pos.x), int(pos.y - 30));
-}
-
-void 
-Jeep::turn_left (float delta)
-{
-  angle += 0.06f * (velocity/5) * delta;
-}
-
-void 
-Jeep::turn_right (float delta)
-{
-  angle -= 0.06f * (velocity/5) * delta;
-}
-
-void 
-Jeep::turn_left2 (float delta) 
-{
-}
-
-void
-Jeep::turn_right2 (float delta) 
-{
-}
-
-void
-Jeep::increase_velocity (float delta)
-{
-  velocity += 0.25f * delta;
-}
-
-void
-Jeep::decrease_velocity (float delta)
-{
-  velocity -= 0.25f * delta;
-}
-
-void
-Jeep::start_fire () 
-{
-}
-
-void
-Jeep::stop_fire () 
-{
-}
-
-void
-Jeep::drop_mine () 
-{
-}
-
-void 
-Jeep::collide (Projectile*)
-{
-  energie -= 5;
-}
-
-void 
-Jeep::collide (FloatVector2d force) 
-{
-  energie -= int(force.get_length());
-  
-  std::cout &lt;&lt; &quot;Jeep: Got force: &quot; &lt;&lt; force.get_length() &lt;&lt; std::endl;
-}
-
-bool 
-Jeep::is_colliding (FloatVector2d obj_pos)
-{
-  float range = 6.0; 
-
-  return  (obj_pos.x &gt; pos.x - range &amp;&amp; obj_pos.x &lt; pos.x + range
-	   &amp;&amp; obj_pos.y &gt; pos.y - range &amp;&amp; obj_pos.y &lt; pos.y + range);
-}
-
-/* EOF */

Copied: trunk/src/vehicles/rotor.cpp (from rev 341, trunk/src/vehicles/rotor.cxx)


Property changes on: trunk/src/vehicles/rotor.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/rotor.cxx
===================================================================
--- trunk/src/vehicles/rotor.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/rotor.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,113 +0,0 @@
-//  $Id$
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2003 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &quot;../view.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;rotor.hxx&quot;
-
-Rotor::Rotor(const RotorDescription&amp; desc)
-{
-  // Rotor::Description
-  direction = desc.direction;
-  slow = CL_Sprite(resources-&gt;get_sprite(desc.slow_sprite));
-  fast = CL_Sprite(resources-&gt;get_sprite(desc.fast_sprite));
-  offset = desc.offset;
-
-  running      = false;
-  orientation  = 0;
-  velocity     = 0;
-  max_velocity = 10.0f;
-  acceleration = 1.5f;
-}
-
-void
-Rotor::draw(View&amp; view, const FloatVector2d&amp; pos, float parent_orientation)
-{
-  FloatVector2d off = offset;
-  FloatVector2d p = pos + off.rotate(parent_orientation);
-
-  if (velocity &gt; 8.0f)
-    {
-      if (direction == RotorDescription::LEFT)
-        {
-          fast.set_angle(Math::rad2deg(orientation));
-          view.get_sc().color().draw(fast, p.x, p.y);
-        }
-      else
-        {
-          fast.set_angle(Math::rad2deg(-orientation));
-          view.get_sc().color().draw(fast, p.x, p.y);
-        }
-    }
-  else
-    {
-      if (direction == RotorDescription::LEFT)
-        {
-          slow.set_angle(Math::rad2deg(orientation));
-          view.get_sc().color().draw(slow, p.x, p.y);
-        }
-      else
-        {
-          slow.set_angle(Math::rad2deg(-orientation));
-          view.get_sc().color().draw(slow, p.x, p.y);
-        }
-    }
-}
-
-void
-Rotor::update(float delta)
-{
-  fast.update(delta);
-  fast.set_angle(orientation);
-
-  slow.update(delta);
-  slow.set_angle(orientation);
-
-  orientation += velocity * delta;
-
-  if (running)
-    {
-      velocity += acceleration * delta;
-
-      if (velocity &gt; max_velocity)
-        velocity = max_velocity;
-    }
-  else
-    {
-      velocity -= acceleration * delta;
-
-      if (velocity &lt; 0)
-        velocity = 0;
-    }
-}
-
-void
-Rotor::start()
-{
-  running = true;
-}
-
-void
-Rotor::stop()
-{
-  running = false;
-}
-
-/* EOF */

Copied: trunk/src/vehicles/tank.cpp (from rev 341, trunk/src/vehicles/tank.cxx)


Property changes on: trunk/src/vehicles/tank.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/tank.cxx
===================================================================
--- trunk/src/vehicles/tank.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/tank.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,431 +0,0 @@
-//  $Id: tank.cxx,v 1.26 2003/06/22 17:22:47 grumbel Exp $
-// 
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;iostream&gt;
-#include &lt;string&gt;
-
-#include &quot;../assert.hxx&quot;
-#include &quot;../mine.hxx&quot;
-#include &quot;../alist.hxx&quot;
-#include &quot;../property_set.hxx&quot;
-#include &quot;../groundmap/ground_map.hxx&quot;
-#include &quot;../buildings/building_map.hxx&quot;
-#include &quot;../particles/smoke_particle.hxx&quot;
-#include &quot;../particles/sand_particle.hxx&quot;
-#include &quot;../particles/grass_particle.hxx&quot;
-#include &quot;../particles/smoke_emitter.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../property_set.hxx&quot;
-#include &quot;../alist.hxx&quot;
-#include &quot;../vehicle_ai.hxx&quot;
-#include &quot;../ai_manager.hxx&quot;
-#include &quot;../collision_manager.hxx&quot;
-
-#include &quot;turret.hxx&quot;
-#include &quot;tank.hxx&quot;
-
-const float circle = 6.2831854f;
-
-Tank::Tank(const AList&amp; lst)
-  : energie(100)
-{
-  // FIME: This needs cleanup
-  AList def;
-
-  def.set_float (&quot;x-pos&quot;, 0);
-  def.set_float (&quot;y-pos&quot;, 0);
-  def.set_int   (&quot;reloading_speed&quot;, 5);
-  
-  // Surfaces
-  def.set_string(&quot;tank&quot;,   &quot;feuerkraft/tank&quot;);
-  def.set_string(&quot;turret&quot;, &quot;feuerkraft/turret&quot;);
-  def.set_string(&quot;fire&quot;,   &quot;feuerkraft/fire&quot;);    
-
-  def.merge(lst);
-
-  // Load
-  smod   = resources-&gt;get_sprite(def.get_string(&quot;tank&quot;));
-  sur    = resources-&gt;get_sprite(def.get_string(&quot;tank&quot;));
-  sur_light     = resources-&gt;get_sprite(&quot;feuerkraft/tank_light&quot;);
-  sur_highlight = resources-&gt;get_sprite(&quot;feuerkraft/tank_highlight&quot;);
-
-  turret = new Turret(this, 
-                      def.get_int(&quot;reloading_speed&quot;),
-                      def.get_string(&quot;turret&quot;), 
-                      def.get_string(&quot;fire&quot;));
-
-  pos.x = def.get_float(&quot;x-pos&quot;);
-  pos.y = def.get_float(&quot;y-pos&quot;);
-  
-  // Init local variables
-  speed = 0.0f;
-  increment = 2.0f;
-  burning = false;
-  
-  sur_destroyed = resources-&gt;get_sprite (&quot;feuerkraft/tank2destroyed&quot;);
-  shadow        = resources-&gt;get_sprite (&quot;feuerkraft/tank2_shadow&quot;);
-  smod_step = 0;
-  mine_reload_time = 0;
-  destroyed = false;
-  velocity = 0.0f;
-
-  orientation = Math::south;
-  tmp_angle = orientation;
-
-  sur.set_alignment(origin_center);
-  sur_destroyed.set_alignment(origin_center);
-
-  particle_release = 0.0f;
-  
-  properties-&gt;register_float(&quot;ammo&quot;,  &amp;ammo);
-  properties-&gt;register_float(&quot;fuel&quot;,  &amp;fuel);
-  
-  smoke_emitter = new SmokeEmitter(pos);
-  ai = 0;
-}
-
-Tank::Tank (const FloatVector2d &amp;arg_pos,
-	    int reloading_speed, std::string tank, std::string str_turret, std::string fire) 
-  : speed (0.0f),
-    increment (2.0f),
-    burning(false),
-    smod (resources-&gt;get_sprite (tank.c_str ())),
-    sur_destroyed (resources-&gt;get_sprite (&quot;feuerkraft/tank2destroyed&quot;)),
-    sur (resources-&gt;get_sprite (tank.c_str ())),
-    sur_light(resources-&gt;get_sprite(&quot;feuerkraft/tank_light&quot;)),
-    sur_highlight(resources-&gt;get_sprite(&quot;feuerkraft/tank_highlight&quot;)),
-    shadow (resources-&gt;get_sprite (&quot;feuerkraft/tank2_shadow&quot;)),
-    turret (NULL),
-    smod_step (0),
-    mine_reload_time (0),
-    energie (100),
-    destroyed (false)
-{
-  ai = 0;
-  velocity = 0.0f;
-
-  orientation = Math::south;
-  tmp_angle = orientation;
-
-  sur.set_alignment(origin_center);
-  sur_destroyed.set_alignment(origin_center);
-
-  turret = new Turret(this, reloading_speed, str_turret, fire);
-  pos = arg_pos;
-
-  particle_release = 0.0f;
-  
-  properties-&gt;register_float(&quot;ammo&quot;,  &amp;ammo);
-  properties-&gt;register_float(&quot;fuel&quot;,  &amp;fuel);
-  
-  smoke_emitter = new SmokeEmitter(pos);
-}
-
-Tank::~Tank ()
-{
-  delete smoke_emitter;
-  delete turret;
-}
-
-void
-Tank::draw_energie (View&amp; view)
-{
-  energie.draw (view, 
-		int(pos.x), int(pos.y - 40));
-}
-  
-void
-Tank::draw_levelmap (LevelMap&amp; levelmap)
-{
-  CL_Display::fill_rect (CL_Rect(int(pos.x / 40), int(pos.y / 40),
-				 int(pos.x / 40) + 4, int(pos.y / 40) + 4),
-			 CL_Color(255, 0, 0, 255));
-}
-
-void
-Tank::draw (View&amp; view)
-{
-  if (destroyed)
-    {
-      view.get_sc().color().draw(sur_destroyed, pos.x, pos.y);
-    }
-  else
-    {
-      for (std::deque&lt;FloatVector2d&gt;::iterator i = smodpos.begin ();
-	   i != smodpos.end (); ++i)
-	{
-	  /*view.draw (smod, 
-            int(i-&gt;x - (smod.get_width ()/2)),
-            int(i-&gt;y - (smod.get_height ()/2)),
-            int(fmod (i-&gt;z, circle) / circle * 16.0));*/
-	  //view.draw (smod, 
-	}
-
-#ifdef UGLY_SHADOWS_ENABLED
-      view.draw(shadow, pos + FloatVector2d (0,0), orientation);
-      view.draw(shadow, pos + FloatVector2d (5,5), orientation);
-      view.draw(shadow, pos + FloatVector2d (10,10), orientation);
-      view.draw(shadow, pos + FloatVector2d (15,15), orientation);
-#endif /* UGLY_SHADOWS_ENABLED */
-
-      // Draw the tank
-      sur_light.set_scale(2.5, 2.5);
-      sur_highlight.set_scale(2.5, 2.5);
-      sur.set_angle(Math::rad2deg(orientation + Math::pi));
-      sur_light.set_angle(Math::rad2deg(orientation + Math::pi));
-      sur_highlight.set_angle(Math::rad2deg(orientation + Math::pi));
-
-      view.get_sc().color().draw(sur, pos.x, pos.y);
-
-      if (sur_light)
-        view.get_sc().light().draw(sur_light, pos.x, pos.y);
-      if (sur_highlight)
-        view.get_sc().highlight().draw(sur_highlight, pos.x, pos.y);
-
-      turret-&gt;draw(view);
-
-      // Draw Collision rect
-      FloatVector2d x1 (-30, -15);
-      FloatVector2d y1 (-30, 15);
-      FloatVector2d x2 (30, -15);
-      FloatVector2d y2 (30, 15);
-
-      x1.rotate(orientation);
-      y1.rotate(orientation);
-      x2.rotate(orientation);
-      y2.rotate(orientation);
-
-      x1 += pos;
-      y1 += pos;
-      x2 += pos;
-      y2 += pos;
-
-      /*view.draw_line (x1.x, x1.y, x2.x, x2.y, 1.0, 1.0, 1.0);
-        view.draw_line (y1.x, y1.y, y2.x, y2.y, 1.0, 1.0, 1.0);
-        view.draw_line (y2.x, y2.y, x2.x, x2.y, 1.0, 1.0, 1.0);
-        view.draw_line (y1.x, y1.y, x1.x, x1.y, 1.0, 1.0, 1.0);*/
-    }
-}
-
-void 
-Tank::explode ()
-{
-  GameWorld::current()-&gt;add (new Explosion (pos, Explosion::MEDIUM));
-  destroyed = true;
-  destroy_time = CL_System::get_time ();
-}
-
-void
-Tank::respawn ()
-{
-  /* FIXME: This respawn code is extremly ugly... 
-     Tank* tank = new Tank(FloatVector2d (560, 1245), 5,
-     &quot;feuerkraft/tank2&quot;, &quot;feuerkraft/turret2&quot;, &quot;feuerkraft/fire2&quot;);
-     GameWorld::current()-&gt;add (tank);
-     if (get_controller ())
-     {
-     get_controller ()-&gt;set_controllable (tank);
-     tank-&gt;set_controller (get_controller ());
-     vehicle_view.set_vehicle (tank);
-     }
-     destroy_time = -1;
-  */
-}
-
-void 
-Tank::update (float delta)
-{
-  if (burning)
-    {
-      smoke_emitter-&gt;set_pos(pos + (FloatVector2d(-5.0f, 0.0f).rotate(orientation)));
-      smoke_emitter-&gt;update(delta);
-    }
-
-  // Apply controlls
-  orientation += 3.0f * steering * delta;
-  velocity    += 15.0f * acceleration * delta;
-
-  turret-&gt;increase_angle(strafe_steering * delta);
-
-  steering = acceleration = 0;
-
-  if (firing)
-    turret-&gt;start_fire();
-  else
-    turret-&gt;stop_fire();
-
-  // FIXME: Ugly
-  if (destroyed &amp;&amp; destroy_time != -1 &amp;&amp; destroy_time + 2000 &lt; (int) CL_System::get_time ())
-    {
-      respawn ();
-    }
-
-  particle_release += fabs(velocity);
-
-  if (particle_release &gt; 20.0f &amp;&amp; !destroyed)
-    {
-      GroundType type = GameWorld::current()-&gt;get_groundmap ()-&gt;get_groundtype (pos.x, pos.y);
-
-      if (type == GT_SAND)
-	GameWorld::current()-&gt;add (new SandParticle(pos));
-      else if (type == GT_GRASS)
-	GameWorld::current()-&gt;add (new GrassParticle(pos));
-
-      particle_release = 0;
-    }
-  
-  delta = delta * 50.0f;
-
-  if (destroyed)
-    return;
-
-  if (energie &lt;= 25)
-    burning = true;
-
-  if (energie &lt;= 0)
-    explode ();
-  
-  turret-&gt;update (delta);
-
-  if (mine_reload_time)
-    --mine_reload_time;
-
-  if (velocity &gt; 0.06f)
-    velocity -= 0.05f;
-  else if (velocity &lt; -0.06f)
-    velocity += 0.05f;
-  else
-    velocity = 0;
-
-  // Terminal velocity
-  if (velocity &gt; 5)
-    velocity = 5.0f;
-  else if (velocity &lt; -2)
-    velocity = -2.0f;
-
-  FloatVector2d vel = FloatVector2d::make_polar(velocity, orientation);
-
-  if (velocity != 0.0 || tmp_angle != orientation)
-    {
-      if (smod_step++ &gt; 5)
-	{
-	  smod_step = 0;
-	  tmp_angle = orientation;
-	  smodpos.push_back(pos);
-	  if (smodpos.size () &gt; 200)
-	    smodpos.pop_front ();
-	}
-    }
-
-  tmp_pos = pos;
-  pos += vel * delta;
-
-  CollisionManager::current()-&gt;add_rect(get_id(), pos.x, pos.y, 30, 68, orientation);
-}
-
-void
-Tank::set_angle (float arg_orientation)
-{
-  orientation = arg_orientation;
-}
-
-void
-Tank::drop_mine ()
-{
-  if (mine_reload_time &lt;= 0)
-    {
-      FloatVector2d vel = FloatVector2d(25.0f, 0.0f).rotate (orientation);
-
-      Mine* mine = new Mine(AList());
-      mine-&gt;get_properties()-&gt;set_float(&quot;x-pos&quot;, pos.x + vel.x);
-      mine-&gt;get_properties()-&gt;set_float(&quot;y-pos&quot;, pos.y + vel.y);
-
-      GameWorld::current()-&gt;add(mine);
-      mine_reload_time = 50;
-    }
-}
-
-bool 
-Tank::is_colliding (FloatVector2d obj_pos)
-{
-  float range = 10.0; 
-
-  return  (obj_pos.x &gt; pos.x - range &amp;&amp; obj_pos.x &lt; pos.x + range
-	   &amp;&amp; obj_pos.y &gt; pos.y - range &amp;&amp; obj_pos.y &lt; pos.y + range);
-}
-
-void 
-Tank::collide (Projectile*)
-{
-  energie -= 5;
-}
-
-void 
-Tank::collide (Mine*)
-{
-  energie -= 25;
-}
-
-void 
-Tank::collide (FloatVector2d force)
-{
-  energie -= int(force.get_length());
-  
-  std::cout &lt;&lt; &quot;Tank: Got force: &quot; &lt;&lt; force.get_length() &lt;&lt; std::endl;
-}
-
-void
-Tank::on_collision_with_building(Building* building)
-{
-  //std::cout &lt;&lt; &quot;Tank: collision with building &quot; &lt;&lt; get_id() &lt;&lt; std::endl;
-  pos = tmp_pos;
-  velocity = 0;
-}
-
-void
-Tank::on_collision(GameObj* obj)
-{
-  if (dynamic_cast&lt;Unit*&gt;(obj))
-    {
-      //std::cout &lt;&lt; &quot;Tank: collision from &quot; &lt;&lt; get_id() &lt;&lt; &quot; with: &quot; &lt;&lt; obj-&gt;get_id() &lt;&lt; std::endl;
-      pos = tmp_pos;
-      velocity = 0;
-    }
-}
-
-void
-Tank::attach_ai()
-{
-  ai = new VehicleRoboAI(this);
-  AIManager::instance()-&gt;add(ai);
-}
-
-void
-Tank::dettach_ai()
-{
-  if (ai)
-    {
-      AIManager::instance()-&gt;remove(ai);
-      delete ai;
-      ai = 0;
-    }
-}
-
-// EOF //

Copied: trunk/src/vehicles/turret.cpp (from rev 341, trunk/src/vehicles/turret.cxx)


Property changes on: trunk/src/vehicles/turret.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/turret.cxx
===================================================================
--- trunk/src/vehicles/turret.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/turret.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,116 +0,0 @@
-#include &lt;iostream&gt;
-#include &quot;../projectile.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;../resource_manager.hxx&quot;
-#include &quot;../rocket.hxx&quot;
-#include &quot;../math.hxx&quot;
-#include &quot;tank.hxx&quot;
-#include &quot;turret.hxx&quot;
-
-const float circle = 6.2831854f;
-
-Turret::Turret (Tank* arg_tank, int r_speed, std::string surface, std::string fire) 
-  : fire_sur (resources-&gt;get_sprite (fire.c_str ())),
-    sur (resources-&gt;get_sprite (surface.c_str ())),
-    shadow (resources-&gt;get_sprite (&quot;feuerkraft/turret2_shadow&quot;)),
-    orientation (0),
-    fireing (false),
-    reloading (0),
-    reloading_speed (r_speed)
-{
-  tank = arg_tank;
-}
-
-Turret::~Turret ()
-{
-}
-
-void 
-Turret::draw (View&amp; view)
-{
-  float absolute_orientation = tank-&gt;get_orientation () + orientation;
-
-#ifdef UGLY_SHADOWS_ENABLED  
-  view.draw(shadow, tank-&gt;get_pos () + FloatVector2d (10,10), absolute_orientation);
-  view.draw(shadow, tank-&gt;get_pos () + FloatVector2d (15,15), absolute_orientation);
-  view.draw(shadow, tank-&gt;get_pos () + FloatVector2d (20,20), absolute_orientation);
-  view.draw(shadow, tank-&gt;get_pos () + FloatVector2d (25,25), absolute_orientation);
-#endif 
-
-  sur.set_angle((absolute_orientation + Math::pi) / Math::pi * 180.0f);
-  view.get_sc().color().draw(sur, tank-&gt;get_pos().x, tank-&gt;get_pos().y);
-
-  if (fireing &amp;&amp; reloading == 0 &amp;&amp; tank-&gt;ammo &gt; 0.0)
-    {
-      fire_sur.set_angle(Math::rad2deg(absolute_orientation + Math::pi));
-      view.get_sc().color().draw(fire_sur, tank-&gt;get_pos().x, tank-&gt;get_pos().y);
-      fireing = false;
-      reloading = reloading_speed;
-    }
-}
-
-void
-Turret::update (float delta)
-{
-
-  static bool floppy;
-
-  if (reloading)
-    reloading--;
-
-  if (fireing &amp;&amp; reloading == 0 &amp;&amp; tank-&gt;ammo &gt; 0.0)
-    {
-      tank-&gt;ammo -=  0.003 * delta;
-
-      float rot_angle = tank-&gt;get_orientation() + orientation;
-      
-      FloatVector2d dir = FloatVector2d::make_polar(10.0 + tank-&gt;get_velocity(), rot_angle);
-
-      if (floppy)
-	{
-	  GameWorld::current()-&gt;add (new Projectile (tank, tank-&gt;get_pos ()
-                                                     + FloatVector2d::make_polar(-5.0f, rot_angle),
-                                                     dir));
-	}
-      else
-	{
-	  GameWorld::current()-&gt;add (new Projectile (tank, tank-&gt;get_pos ()
-                                                     + FloatVector2d::make_polar(5.0, rot_angle),
-                                                     dir));
-	}
-      floppy = !floppy;
-    }
-}
-
-void 
-Turret::increase_angle (float delta)
-{
-  orientation += tank-&gt;get_increment () * delta;
-  //angle = fmod (angle + circle, circle);
-}
-
-void
-Turret::start_fire ()
-{
-  fireing = true;
-}
-
-void
-Turret::stop_fire ()
-{
-  fireing = false;
-}
-
-void 
-Turret::set_relative_orientation (float arg_orientation)
-{
-  orientation = arg_orientation;
-}
-
-void
-Turret::set_absolute_orientation (float arg_orientation)
-{
-  orientation = orientation - tank-&gt;get_orientation();
-}
-
-// EOF 

Copied: trunk/src/vehicles/vehicle.cpp (from rev 341, trunk/src/vehicles/vehicle.cxx)


Property changes on: trunk/src/vehicles/vehicle.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/vehicles/vehicle.cxx
===================================================================
--- trunk/src/vehicles/vehicle.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/vehicles/vehicle.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,75 +0,0 @@
-//  $Id: vehicle.cxx,v 1.11 2003/10/31 23:24:41 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &quot;../input/controller.hxx&quot;
-#include &quot;vehicle.hxx&quot;
-
-Vehicle::Vehicle ()
-  : ammo (1.0f), 
-    fuel (1.0f)
-{
-  acceleration = 0;
-  steering = 0;
-  strafe_steering = 0;
-  firing = false;
-  secondary_firing = false;
-}
-
-float 
-Vehicle::get_ammo ()
-{
-  return ammo;
-}
-
-float 
-Vehicle::get_fuel ()
-{
-  return fuel;
-}
-
-void 
-Vehicle::refuel (float delta)
-{
-  fuel += 0.003 * delta;
-
-  if (fuel &gt; 1.0f)
-    fuel = 1.0f;
-}
-
-void 
-Vehicle::reload_ammo (float delta)
-{
-  ammo += 0.003 * delta;
-
-  if (ammo &gt; 1.0f)
-    ammo = 1.0f;
-}
-
-void
-Vehicle::update_controlls(const Controller&amp; controller)
-{
-  acceleration = -controller.get_axis_state(ACCELERATE_AXIS);
-  steering     = controller.get_axis_state(ORIENTATION_AXIS);
-  strafe_steering = controller.get_axis_state(STRAFE_AXIS);
-  firing       = controller.get_button_state(PRIMARY_FIRE_BUTTON);
-  secondary_firing       = controller.get_button_state(SECONDARY_FIRE_BUTTON);
-}
-
-/* EOF */

Copied: trunk/src/view.cpp (from rev 341, trunk/src/view.cxx)


Property changes on: trunk/src/view.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/src/view.cxx
===================================================================
--- trunk/src/view.cxx	2009-01-27 11:12:17 UTC (rev 343)
+++ trunk/src/view.cxx	2009-01-27 11:16:10 UTC (rev 344)
@@ -1,237 +0,0 @@
-//  $Id: view.cxx,v 1.19 2003/10/20 21:30:09 grumbel Exp $
-//
-//  Feuerkraft - A Tank Battle Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;iostream&gt;
-#include &lt;ClanLib/Display/display.h&gt;
-#include &lt;ClanLib/Display/sprite.h&gt;
-#include &lt;ClanLib/Display/surface.h&gt;
-
-#include &quot;assert.hxx&quot;
-#include &quot;color.hxx&quot;
-#include &quot;math.hxx&quot;
-#include &quot;view.hxx&quot;
-
-View* View::current_ = 0;
-
-View::View (int arg_x1, int arg_y1, 
-	    int arg_x2, int arg_y2,
-	    ViewUpdater* arg_updater)
-  : x1 (arg_x1), y1 (arg_y1),
-    x2 (arg_x2), y2 (arg_y2),
-    view_updater(arg_updater)
-{
-  //std::cout &lt;&lt; &quot;View: &quot; &lt;&lt; x1 &lt;&lt; &quot; &quot; &lt;&lt; y1 &lt;&lt; &quot; &quot; &lt;&lt; x2 &lt;&lt; &quot; &quot; &lt;&lt; y2 
-    //&lt;&lt; &quot; &quot; &lt;&lt; state.x_offset &lt;&lt; &quot; &quot; &lt;&lt; state.y_offset &lt;&lt; std::endl;
-  
-  state.x_offset = -x1;
-  state.y_offset = -y1;
-
-  state.zoom = 1.0;
-  state.rotation = 0;
-  
-  scene_context = new SceneContext();
-
-  current_ = this;
-}
-
-View::~View ()
-{
-  delete view_updater;
-}
-
-float
-View::get_x_offset () 
-{
-  return x1 - state.x_offset + (x2 - x1)/2; 
-}
-
-float
-View::get_y_offset ()
-{
-  return y1 - state.y_offset + (y2 - y1)/2; 
-}
-
-/*
-void
-View::draw (CL_Sprite&amp; sprite, const FloatVector2d&amp; pos, float angle)
-{
-  sprite.set_angle(Math::rad2deg(angle));
-  sprite.draw(int(pos.x + get_x_offset ()), 
-              int(pos.y + get_y_offset ()));
-}
-
-void 
-View::draw_line (float x1, float y1, float x2, float y2, 
-                 const Color&amp; color)
-{
-  CL_Display::draw_line(int((x1 + get_x_offset ())),
-                        int((y1 + get_y_offset ())),
-                        int((x2 + get_x_offset ())),
-                        int((y2 + get_y_offset ())),
-                        color.get_cl_color());
-}
-
-void 
-View::draw_fillrect (float x1, float y1, float x2, float y2, 
-                     const Color&amp; color)
-{
-  CL_Display::fill_rect (CL_Rect(int((x1 + get_x_offset ())),
-                                 int((y1 + get_y_offset ())), 
-                                 int((x2 + get_x_offset ())),
-                                 int((y2 + get_y_offset ()))),
-			 color.get_cl_color());
-}
-
-void
-View::draw_rect (float x1, float y1, float x2, float y2, 
-		 const Color&amp; arg_color)
-{
-  const CL_Color&amp; color = arg_color.get_cl_color();
-
-  CL_Display::draw_line (int(x1 + get_x_offset ()), int(y1 + get_y_offset ()), 
-			 int(x1 + get_x_offset ()), int(y2 + get_y_offset ()),
-			 color);
-  CL_Display::draw_line (int(x2 + get_x_offset ()), int(y1 + get_y_offset ()), 
-			 int(x2 + get_x_offset ()), int(y2 + get_y_offset ()),
-			 color);
-  CL_Display::draw_line (int(x1 + get_x_offset ()), int(y1 + get_y_offset ()), 
-			 int(x2 + get_x_offset ()), int(y1 + get_y_offset ()),
-			 color);
-  CL_Display::draw_line (int(x1 + get_x_offset ()), int(y2 + get_y_offset ()), 
-			 int(x2 + get_x_offset ()), int(y2 + get_y_offset ()),
-			 color);
-}
-
-void 
-View::draw_pixel (float x_pos, float y_pos, 
-                  const Color&amp; color)
-{
-  //CL_Display::put_pixel (x1 + get_x_offset (),
-  //			 y1 + get_y_offset (), r, g, b, a);
-  AssertMsg(0, &quot;View::draw_pixel () not implemented&quot;);
-}
-
-void 
-View::draw_circle (float x_pos, float y_pos, float radius,
-		   const Color&amp; color)
-{
-  // FIXME: Probally not the fast circle draw algo on this world...
-  const float pi = 3.1415927f * 2.0f;
-  const float steps = 16;
-  FloatVector2d next    = FloatVector2d::make_polar(radius, 0 * pi/float(steps));
-
-  for (int i = 1; i &lt;= steps; ++i)
-    {
-      FloatVector2d current = next;
-      next = FloatVector2d::make_polar(radius, i * pi/float(steps));
-      
-     .get_sc().color().draw_line(x_pos + current.x, y_pos + current.y,
-                         x_pos + next.x,    y_pos + next.y,
-                         color);
-    }
-}
-
-void
-View::draw_arc (float x_pos, float y_pos, float radius, float angle_start, float angle_stop,
-                const Color&amp; color)
-{
-  angle_start = Math::normalize_angle(angle_start);
-  angle_stop  = Math::normalize_angle(angle_stop);
-
-  const float steps = 16;
-
-  float enclosed_angle = Math::normalize_angle(angle_stop - angle_start);
-  
-  float x, y;
-
-  float last_x = x_pos + radius * cos(angle_start);
-  float last_y = y_pos + radius * sin(angle_start);
-  
-  for(int i = 1; i &lt;= steps; ++i)
-    {
-      x = x_pos + radius * cos(angle_start + i*enclosed_angle/steps);
-      y = y_pos + radius * sin(angle_start + i*enclosed_angle/steps);
-
-     .get_sc().color().draw_line(last_x, last_y, x, y, color);
-
-      last_x = x;
-      last_y = y;
-    }
-}
-*/
-void
-View::set_updater(ViewUpdater* arg_updater)
-{
-  delete view_updater;
-  view_updater = arg_updater;
-}
-
-void
-View::update(float delta)
-{
-  //std::cout &lt;&lt; &quot;View:update: &quot; &lt;&lt; x1 &lt;&lt; &quot; &quot; &lt;&lt; y1 &lt;&lt; &quot; &quot; &lt;&lt; x2 &lt;&lt; &quot; &quot; &lt;&lt; y2 
-    //&lt;&lt; &quot; &quot; &lt;&lt; state.x_offset &lt;&lt; &quot; &quot; &lt;&lt; state.y_offset &lt;&lt; std::endl;
-
-  if (view_updater)
-    view_updater-&gt;update(delta, state);
-
-  scene_context-&gt;reset_modelview();
-  scene_context-&gt;translate(get_x_offset(), get_y_offset());
-  //drawing_context.translate(state.x_offset, state.y_offset);
-}
-
-bool
-View::get_property (ViewProperty p)
-{
-  return properties &amp; p;
-}
-
-void
-View::set_property (ViewProperty p)
-{
-  properties |= p;
-}
-
-int
-View::get_width ()
-{
-  return x2 - x1; // FIXME: Off by one?!
-}
-
-int
-View::get_height ()
-{
-  return y2 - y1;// FIXME: Off by one?!
-}
-
-FloatVector2d
-View::screen_to_world (const FloatVector2d&amp; pos)
-{
-  return FloatVector2d (pos.x - get_x_offset (),
-                        pos.y - get_y_offset ());
-}
-
-FloatVector2d
-View::world_to_screen (const FloatVector2d&amp; pos)
-{
-  return FloatVector2d (pos.x + get_x_offset (),
-                        pos.y + get_y_offset ());
-}
-
-/* EOF */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000009.html">[Feuerkraft-commit] r343 - in trunk/src: . buildings display editor	generic groundmap input particles scripting sound vehicles
</A></li>
	<LI>Next message: <A HREF="000007.html">[Feuerkraft-commit] r345 - in trunk/src: buildings editor generic	groundmap input particles sound vehicles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/feuerkraft-commit">More information about the Feuerkraft-commit
mailing list</a><br>
</body></html>
